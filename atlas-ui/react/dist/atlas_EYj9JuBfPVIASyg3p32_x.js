import{r as a,j as e,a as tt,c as lt,R as ct}from"./atlas_BUUBlV_8LvS6kQP4OUrY2.js";import{R as st,L as dt,c as mt,d as ut,e as _e,M as ht,F as xt,H as ft,a as pt}from"./atlas_y8qBQ_Ie_uz4_UzeiGd98.js";import{W as Oe}from"./atlas_DDJH3F64TRS7xAljnqyWd.js";import{O as $e}from"./atlas_C0798p1R6_QDmDHuetMGI.js";import{a5 as Ve,C as We,a6 as Be,G as He,b as pe,z as ge,M as be,B as Ue,a2 as Ke,o as qe,cM as Ze,y as Ye,V as ze,v as at,cN as nt,cO as rt}from"./atlas_B2lpKXcKkLCAPkjGiW29w.js";import{R as gt,S as bt,M as wt,a as Ge,D as yt,b as vt,c as Ft}from"./atlas_CCEOSjome__zLFOlS2Cst.js";import{S as Je,a as jt,b as Nt,E as Ct}from"./atlas_CfhhaxGwBcPT2qqtYp9rE.js";import{E as St}from"./atlas_BnnGpc4u6b98cEcrvrhfh.js";import{S as ke,C as Et}from"./atlas_DSAzaem9rs8MzJwI0e4IU.js";import{V as Mt}from"./atlas_B1yVjMjn8-bEoHhgQeu_h.js";import{T as Rt,D as kt}from"./atlas_uGVyzaQCg-nBsfBECLnd6.js";import{G as Dt}from"./atlas_Bgee5lmCAHE93pfv8wh7h.js";import"./atlas_DTIMc2Yn_GAbDXRKstHHt.js";import"./atlas_BQNDIxYWnXCSJpAGcevGg.js";import"./atlas_Dxn46XnhZ7eBTSIoCFpFX.js";import"./atlas_BKvmFXuXk1OxDb5S8--uJ.js";import"./atlas_devLC-KyT9W7vfPUn064J.js";import"./atlas_BifK6JcEApz6XO464-6-4.js";import"./atlas_h5pT_zCyRew3cfxwEy6vB.js";import"./atlas_DygZSZMdumXofNROQ5yv5.js";import"./atlas_CSlBQIGGeTr5KA5bldqFG.js";import"./atlas_DznaApmpB7DbXWh7fGRfv.js";import"./atlas_DUA_rDVOMk2xHTme7rYaj.js";import"./atlas_Cb25c0eoydluDLJd2Za9a.js";import"./atlas_0c8ugtrdxDmUoxh2sessY.js";import"./atlas_D5vNLDHKvonOdx3Dq0Nso.js";import"./atlas_Cjg6r2ColoUW7cCOm3eNN.js";import"./atlas_DFAhS78XbvMY8Hq-lokcg.js";import"./atlas_CZCpRd54Ss24_zPvDswww.js";import"./atlas_DhJOnpPczKrCb0oVhiPWn.js";import"./atlas_C-f7jfPSq_h0lCZiVK6H5.js";import"./atlas_CHRQk7A_WSIhi4jPvGSXj.js";import"./atlas_DTRJSnWt8dWR1TtFy4VNC.js";import"./atlas_BgP_sg7E1JBtlWMVwDfz5.js";import"./atlas_VWY9RJdq0XpV9MTrfLfJ9.js";import"./atlas_VqUmJJeMdcSeMKKGFSNfW.js";import"./atlas_Bj6xu46pe86acJmaM7AKW.js";import"./atlas_DvbK2lMOVCiR3qJX5YLua.js";import"./atlas_BauBXJjMcWKMXThNhB6q5.js";import"./atlas_B3RkDvpNk536AE_rRbe80.js";import"./atlas_DYCC0I8CWwSnbae8AhZKF.js";import"./atlas_CbODoUbu5doB7AYCFuMwm.js";import"./atlas_roENHj88NUZWPZyIhD4DJ.js";import"./atlas_D0FsRhdQeQIWjRj6QakEV.js";import"./atlas_m3tbS7LiTybR9Cau3-zX1.js";import"./atlas_7-yzAfcQvwI6scuZmLqt5.js";import"./atlas_Bp3-ReYcl5jhQc4PwK3Dc.js";import"./atlas_CQInv1sXf_RwTlHJKe5wM.js";import"./atlas_Dq8AGxXUyIgZtiBEF0WQY.js";import"./atlas_DRlcfImLC8Mak4qT5jpjq.js";import"./atlas_LLpsj1SJhd40MT6CtNbOD.js";import"./atlas_D88CE_Ty4Io2KBHayAsI6.js";import"./atlas_COgkr6cYg1YrKAiY7jkqK.js";import"./atlas_CkCwqIV0bQfF8ViY6cfHX.js";import"./atlas_DvcDKNREAlIk_hSgPfgoN.js";import"./atlas_BhznHcpScXg6UpfU6Pkoa.js";import"./atlas_CvsviNDba8JfR-qVXNNhT.js";import"./atlas_kjvrcGFBIoP7usRz2KdQT.js";import"./atlas_Zc5m1k8ikykX9c1vc933A.js";import"./atlas_DpeTw7vra83-XQn_Fd2f7.js";import"./atlas_BVLl2LqCt4Tpzzp4uJbnT.js";import"./atlas_n8x409af92PJTNqf6Fsoi.js";import"./atlas_BGEWOEoKPv5-oqVWR0u_6.js";import"./atlas_5mExBlgWsJte0Ermbt3vh.js";import"./atlas_DdqI6dZaifTwIxW8no3kL.js";import"./atlas_DLSRW1FI1JJcrEdveEXjh.js";import"./atlas_Cap3DOu3WDs04BYSa397H.js";import"./atlas_DDCiW7QzIfNLPEz5WRchT.js";import"./atlas_CX43Rv79CUc9F90Wm9Uey.js";import"./atlas_uWvK9tbm0dQG-fIrawaEt.js";const Lt=s=>{let t=0;for(let n=0;n<s.length;n++)t=(t<<5)-t+s.charCodeAt(n),t=t&t;return Math.abs(t)%1e4/1e4*.15},At=s=>{let t=0;for(let n=0;n<s.length;n++)t=(t<<3)-t+s.charCodeAt(n)*7,t=t&t;return Math.abs(t)%1e4/1e4*Math.PI*2},Qe=(s,t,n,h,d)=>{const g=t*(1-n*n)/(1+n*Math.cos(s)),p=g*Math.cos(s),m=g*Math.sin(s),i=p*Math.cos(d)-m*Math.sin(d)*Math.cos(h),y=p*Math.sin(d)+m*Math.cos(d)*Math.cos(h),v=m*Math.sin(h);return new ze(i,v,y)},ot=({planets:s,stars:t,systemName:n,cosmicOriginTime:h,currentTime:d,onTimeOffsetChange:g})=>{const p=a.useRef(null),m=a.useRef(null),i=a.useRef(null),y=a.useRef(null),v=a.useRef([]),P=a.useRef([]),E=a.useRef([]),u=a.useRef(0),M=a.useRef(null),re=(A,Y="#ffffff")=>{const T=document.createElement("canvas"),x=T.getContext("2d");if(!x)return null;T.width=768,T.height=192,x.fillStyle="rgba(0, 0, 0, 0.8)",x.fillRect(0,0,T.width,T.height),x.strokeStyle="#ffffff",x.lineWidth=3,x.strokeRect(3,3,T.width-6,T.height-6),x.fillStyle=Y,x.font="bold 48px Arial",x.textAlign="center",x.textBaseline="middle",x.fillText(A,384,96);const B=new at(T),G=new nt({map:B,transparent:!0,alphaTest:.1}),q=new rt(G);return q.scale.set(30,7.5,1),q};return u.current=d,a.useEffect(()=>{if(!p.current)return;const A=p.current,Y=A.clientWidth,T=A.clientHeight,x=new Ve;x.background=new We(17),m.current=x;const B=new Be(60,Y/T,.1,1e4);B.position.set(0,120,180),B.lookAt(0,0,0);const G=new Oe({antialias:!0,alpha:!0});G.setSize(Y,T),G.setClearColor(17,1),i.current=G,A.appendChild(G.domElement);const q={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},ce={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},O=new He;t.forEach((r,z)=>{const o=parseFloat(r.Size)*2.5,w=new pe(o,32,32),D=ce[r.Color]||"#FFFF44",U=new ge({color:D,transparent:!0,opacity:.9}),L=new be(w,U),I=t.map((F,Q)=>parseFloat(F.Size)*2.5),K=Math.max(...I)*3;t.length===1?L.position.set(0,0,0):t.length===2?L.position.set(z===0?-K:K,0,0):z===0?L.position.set(-K,0,0):z===1?L.position.set(K,0,0):L.position.set(0,K,0);const ie=new pe(o*1.5,32,32),S=new ge({color:D,transparent:!0,opacity:.3}),b=new be(ie,S);L.add(b),O.add(L)}),x.add(O);const oe=Math.max(...s.map(r=>r.orbital_radius)),R=150,_=t.map(r=>parseFloat(r.Size)*2.5),ve=Math.max(..._)*1.5,Fe=Math.max(40,ve+15);s.forEach((r,z)=>{const o=r.orbital_radius/oe,w=Fe+o*R,D=r.eccentricity_factor,U=w,L=Lt(r.name),I=At(r.name),C=360,K=2,ie=4;for(let W=0;W<C;W+=K+ie){const le=[];for(let te=W;te<Math.min(W+K,C-1);te++){const de=te/C*2*Math.PI,l=Qe(de,U,D,L,I);le.push(l)}if(le.length>1){const te=new Ue().setFromPoints(le),de=new Ke({color:7372944,transparent:!0,opacity:.8,linewidth:2}),l=new qe(te,de);x.add(l),P.current.push(l)}}const S=r.diameter/6e3,b=Math.max(Math.min(S,10),2),F=new pe(b,32,32),Q=q[r.planet_type]||"#FFFFFF",ee=new ge({color:Q,transparent:!0,opacity:.9}),V=new be(F,ee),ue=new be(new pe(b*1.5,32,32),new ge({color:Q,transparent:!0,opacity:.2}));V.add(ue),x.add(V),v.current.push(V),V.planetData=r,V.orbitRadius=w,V.semiMajorAxis=U,V.eccentricity=D,V.inclination=L,V.ascendingNode=I;const c=r.name.replace(/_/g," "),f=re(c,"#ffffff");f&&(f.position.copy(V.position),f.position.y+=b+10,f.planetData=r,x.add(f),E.current.push(f))});const je=new Ze(4210752,.4);x.add(je);const Ne=new Ye(16777215,1,2e3);Ne.position.set(0,0,0),x.add(Ne);const ae=new $e(B,G.domElement);ae.enableDamping=!0,ae.dampingFactor=.05,ae.minDistance=50,ae.maxDistance=800,ae.autoRotate=!1,ae.autoRotateSpeed=.5,ae.enablePan=!0,ae.enableZoom=!0,ae.target.set(0,0,0),M.current=ae;const J=r=>{r.ctrlKey&&(r.preventDefault(),r.deltaY>0?g(604800):g(-604800))},Se=r=>{r.key==="Escape"&&document.dispatchEvent(new CustomEvent("solar-system-close-fullscreen"))},j=G.domElement;j.addEventListener("wheel",J),document.addEventListener("keydown",Se);const N=()=>{y.current=requestAnimationFrame(N),M.current&&M.current.update(),v.current.forEach((r,z)=>{const o=r.planetData,w=r.semiMajorAxis,D=r.eccentricity,U=r.inclination,L=r.ascendingNode,I=o.orbital_period_seconds,C=2*Math.PI/I,K=(o.initial_orbital_angle+u.current*C)%(2*Math.PI),ie=Qe(K,w,D,U,L);r.position.copy(ie);const S=o.rotation_period_seconds,b=2*Math.PI/S;if(r.rotation.y=u.current*b%(2*Math.PI),E.current[z]){const F=r.geometry.parameters?.radius||2;E.current[z].position.copy(r.position),E.current[z].position.y+=F+10}}),G.render(x,B)};N();const k=()=>{const r=A.clientWidth,z=A.clientHeight;B.aspect=r/z,B.updateProjectionMatrix(),G.setSize(r,z)};return window.addEventListener("resize",k),()=>{window.removeEventListener("resize",k),document.removeEventListener("keydown",Se),j.removeEventListener("wheel",J),M.current&&M.current.dispose(),y.current&&cancelAnimationFrame(y.current),A&&G.domElement&&A.removeChild(G.domElement),G.dispose(),v.current=[],P.current=[],E.current=[]}},[s,t,h]),e.jsx("div",{ref:p,className:"w-full h-full"})},Pt=s=>{let t=0;for(let n=0;n<s.length;n++)t=(t<<5)-t+s.charCodeAt(n),t=t&t;return Math.abs(t)%1e4/1e4*.15},zt=s=>{let t=0;for(let n=0;n<s.length;n++)t=(t<<3)-t+s.charCodeAt(n)*7,t=t&t;return Math.abs(t)%1e4/1e4*Math.PI*2},Xe=(s,t,n,h,d)=>{const g=t*(1-n*n)/(1+n*Math.cos(s)),p=g*Math.cos(s),m=g*Math.sin(s),i=p*Math.cos(d)-m*Math.sin(d)*Math.cos(h),y=p*Math.sin(d)+m*Math.cos(d)*Math.cos(h),v=m*Math.sin(h);return new ze(i,v,y)},It=({planets:s,stars:t,systemName:n,cosmicOriginTime:h})=>{const d=a.useRef(null),g=a.useRef(null),p=a.useRef(null),m=a.useRef(null),i=a.useRef([]),y=a.useRef([]),v=a.useRef([]),P=a.useRef(0),E=a.useRef(null),u=Math.floor(Date.now()/1e3),[M,re]=a.useState(0),[A,Y]=a.useState(!1),[T,x]=a.useState(!1),[B,G]=a.useState(!1),[q,ce]=a.useState(0),[O,oe]=a.useState(null),[R,_]=a.useState(!0),[ve,Fe]=a.useState(null),je=u-h+M;P.current=je,a.useEffect(()=>{(async()=>{try{_(!0),Fe(null);const N=await fetch("/api/system/rendering-data");if(!N.ok)throw new Error(`HTTP error! status: ${N.status}`);const k=await N.json();if(k.success)oe(k.system_data);else throw new Error(k.error||"Failed to fetch system data")}catch(N){Fe(N instanceof Error?N.message:"Unknown error")}finally{_(!1)}})()},[]);const Ne=()=>{x(!0),setTimeout(()=>{Y(!1),x(!1)},300)},ae=(j,N="#ffffff")=>{const k=document.createElement("canvas"),r=k.getContext("2d");if(!r)return null;k.width=512,k.height=128,r.fillStyle="rgba(0, 0, 0, 0.7)",r.fillRect(0,0,k.width,k.height),r.strokeStyle="#ffffff",r.lineWidth=2,r.strokeRect(2,2,k.width-4,k.height-4),r.fillStyle=N,r.font="bold 32px Arial",r.textAlign="center",r.textBaseline="middle",r.fillText(j,256,64);const z=new at(k),o=new nt({map:z,transparent:!0,alphaTest:.1}),w=new rt(o);return w.scale.set(20,5,1),w};a.useEffect(()=>{const j=N=>{N.key==="Escape"&&A&&Ne()};return A&&ce(M),document.addEventListener("solar-system-close-fullscreen",Ne),document.addEventListener("keydown",j),()=>{document.removeEventListener("solar-system-close-fullscreen",Ne),document.removeEventListener("keydown",j)}},[A,M]),a.useEffect(()=>{if(A&&B){const j=setTimeout(()=>{G(!1)},50);return()=>clearTimeout(j)}},[A,B]),a.useEffect(()=>{if(R||!O||(window.tonnirLoggedInSystem=!1,!d.current))return;const j=d.current,N=j.clientWidth,k=N<640,r=new Ve;r.background=new We(17),g.current=r;const z=new Be(45,N/120,.1,1e4);z.position.set(0,80,120),z.lookAt(0,0,0);const o=new Oe({antialias:!0,alpha:!0});o.setSize(N,120),o.setClearColor(17,1),p.current=o,j.appendChild(o.domElement);const w={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},D={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},U=new He;O.stars.forEach((c,f)=>{const W=parseFloat(c.Size)*1.43,le=new pe(W,16,16),te=D[c.Color]||"#FFFF44",de=new ge({color:te,transparent:!0,opacity:.9}),l=new be(le,de),$=O.stars.map((xe,we)=>parseFloat(xe.Size)*1.43),X=Math.max(...$)*3;O.stars.length===1?l.position.set(0,0,0):O.stars.length===2?l.position.set(f===0?-X:X,0,0):f===0?l.position.set(-X,0,0):f===1?l.position.set(X,0,0):l.position.set(0,X,0);const me=new pe(W*1.5,16,16),he=new ge({color:te,transparent:!0,opacity:.3}),H=new be(me,he);l.add(H),U.add(l)}),r.add(U);const L=O.timing.max_orbital_radius,I=80,C=O.stars.map(c=>parseFloat(c.Size)*1.43),K=Math.max(...C)*1.5,ie=Math.max(30,K+10);window.systemMaxOrbitalRadius=L,O.planets.forEach((c,f)=>{const W=c.orbital_radius/L,le=ie+W*I,te=c.eccentricity_factor,de=le,l=Pt(c.name),$=zt(c.name),Z=360,X=2,me=4;for(let Me=0;Me<Z;Me+=X+me){const De=[];for(let ne=Me;ne<Math.min(Me+X,Z-1);ne++){const Le=ne/Z*2*Math.PI,Ce=Xe(Le,de,te,l,$);De.push(Ce)}if(De.length>1){const ne=new Ue().setFromPoints(De),Le=new Ke({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Ce=new qe(ne,Le);r.add(Ce),y.current.push(Ce)}}const he=c.diameter/12e3,H=Math.max(Math.min(he,5),1),xe=new pe(H,16,16),we=w[c.planet_type]||"#FFFFFF",fe=new ge({color:we,transparent:!0,opacity:.9}),se=new be(xe,fe),Re=new be(new pe(H*1.5,16,16),new ge({color:we,transparent:!0,opacity:.2}));se.add(Re),r.add(se),i.current.push(se),se.planetData=c,se.orbitRadius=le,se.semiMajorAxis=de,se.eccentricity=te,se.inclination=l,se.ascendingNode=$;const Ee=c.name.replace(/_/g," "),ye=ae(Ee,"#ffffff");ye&&(ye.position.copy(se.position),ye.position.y+=H+6,ye.planetData=c,r.add(ye),v.current.push(ye))});const S=new Ze(4210752,.4);r.add(S);const b=new Ye(16777215,1,1e3);b.position.set(0,0,0),r.add(b);const F=new $e(z,o.domElement);F.enableDamping=!0,F.dampingFactor=.05,F.minDistance=20,F.maxDistance=500,F.autoRotate=!1,F.autoRotateSpeed=.5,F.enablePan=!0,F.enableZoom=!0,F.target.set(0,0,0),E.current=F;const Q=c=>{c.ctrlKey&&(c.preventDefault(),c.deltaY>0?re(f=>f+604800):re(f=>f-604800))},ee=o.domElement;ee.style.borderRadius="8px",ee.addEventListener("wheel",Q);const V=()=>{m.current=requestAnimationFrame(V),E.current&&E.current.update(),i.current.forEach((c,f)=>{const W=c.planetData,le=c.semiMajorAxis,te=c.eccentricity,de=c.inclination,l=c.ascendingNode,$=W.orbital_period_seconds,Z=2*Math.PI/$,X=(W.initial_orbital_angle+P.current*Z)%(2*Math.PI),me=Xe(X,le,te,de,l);c.position.copy(me);const he=W.rotation_period_seconds,H=2*Math.PI/he;if(c.rotation.y=P.current*H%(2*Math.PI),v.current[f]){const xe=c.geometry.parameters?.radius||2;v.current[f].position.copy(c.position),v.current[f].position.y+=xe+6}}),o.render(r,z)};V();const ue=()=>{const c=j.clientWidth,f=(c<640,120);z.aspect=c/f,z.updateProjectionMatrix(),o.setSize(c,f)};return window.addEventListener("resize",ue),()=>{window.removeEventListener("resize",ue),ee.removeEventListener("wheel",Q),E.current&&E.current.dispose(),m.current&&cancelAnimationFrame(m.current),j&&o.domElement&&j.removeChild(o.domElement),o.dispose(),i.current=[],y.current=[],v.current=[]}},[s,t,h,O]);const J=j=>{if(j<=0)return"Cosmic Origin Time";const N=Math.floor(j/(365.25*24*3600)),k=Math.floor(j%(365.25*24*3600)/(24*3600)),r=Math.floor(j%(24*3600)/3600);return N>0?`${N}y ${k}d ${r}h`:k>0?`${k}d ${r}h`:`${r}h`},Se=j=>j.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Solar System Perspective"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{ref:d,className:"w-full border border-white/20 rounded bg-black/20",style:{height:"auto"}}),!R&&!ve&&n&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:n})}),e.jsx("button",{onClick:()=>{Y(!0),G(!0)},className:"absolute top-2 right-2 p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg z-10",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-[10px]",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-[10px]",children:[O?.planets?.length||s.length," Planets"]})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Time: ",J(je)]})]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View"})]})]}),A&&tt.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${T||B?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${T||B?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:Se(n)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:Se(n)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[O?.planets?.length||s.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",J(u-h+q)]})]})]}),e.jsx("button",{onClick:Ne,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-100y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-100*365.25*24*3600,max:100*365.25*24*3600,step:604800,value:q,onChange:j=>{const N=Number(j.target.value),k=-(u-h);ce(Math.max(N,k))},className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded",style:{left:`${(0- -100*365.25*24*3600)/(100*365.25*24*3600- -100*365.25*24*3600)*100}%`}})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+100y"}),e.jsx("button",{onClick:()=>ce(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",q===0?"Present":q>0?`+${Math.abs(q/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(q/(365.25*24*3600)).toFixed(1)} years`," • Range: 200 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(ot,{planets:O?.planets||s,stars:O?.stars||t,systemName:n,cosmicOriginTime:h,currentTime:u-h+q,onTimeOffsetChange:j=>ce(N=>N+j)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},Tt=({system:s,galaxy:t,systemIndex:n,cosmicOriginTime:h})=>{const[d,g]=a.useState({isOnCooldown:!1,isSaved:!1,isCollecting:!1,timeUntilNext:0});a.useEffect(()=>{let m;const i=()=>{const E=Ge.generateLocationId("system",t.coordinates.join(","),n,void 0),u=Ge.canCollectFromLocation(E),M=Ge.getTimeUntilNextCollection(E),re=t.coordinates,A=Je.generateSystemUrl(re,n,Je.getCurrentPage()),T=dt.getLocations().some(x=>x.stargateUrl===A);g(x=>({isOnCooldown:!u&&M>0,isSaved:T,isCollecting:x.isCollecting,timeUntilNext:M}))},y=()=>{g(E=>({...E,isCollecting:!0})),m=setTimeout(()=>{g(E=>({...E,isCollecting:!1}))},1e3)};i();const v=setInterval(i,1e3),P=st.subscribe("mining_completed",y);return()=>{clearInterval(v),m&&clearTimeout(m),P()}},[s.name,n,t.coordinates]);const p=m=>m.replace(/_/g," ");return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[e.jsx(gt,{locationType:"system",locationId:s.name,coordinates:t.coordinates.join(","),systemIndex:n,className:"text-xs"}),e.jsx(bt,{type:"system",name:s.name,coordinates:t.coordinates.join(","),systemIndex:n,className:"text-xs"}),e.jsx("div",{className:"inline-flex items-center bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] font-medium px-1.5 py-0.5 rounded h-[21px] box-border",children:"VISITED"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(wt,{isOnCooldown:d.isOnCooldown,isSaved:d.isSaved,isCollecting:d.isCollecting}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Details"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"System Type"}),e.jsx("div",{className:"text-sm font-bold text-blue-300 capitalize",children:s.star_system_type})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Planets"}),e.jsx("div",{className:"text-sm font-bold text-purple-300",children:s.num_planets})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-orange-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Stars"}),e.jsx("div",{className:"text-sm font-bold text-orange-300",children:s.stars.length})]})]}),e.jsx("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-3",children:e.jsx(It,{planets:s.planets,stars:s.stars,systemName:s.name,cosmicOriginTime:h})}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-yellow-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Stellar Composition"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1",children:s.stars.map((m,i)=>e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-yellow-500/20",children:[e.jsxs("div",{className:"text-xs text-gray-300 flex items-center gap-2",children:[e.jsxs("span",{children:["Star ",i+1]}),e.jsx("span",{className:"font-bold text-yellow-300",children:m.Type})]}),e.jsxs("div",{className:"text-xs text-gray-300",children:[m.Color," • ",m.Size]})]},i))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System:"}),e.jsx("div",{className:"text-white truncate font-medium",children:p(s.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System ID:"}),e.jsxs("div",{className:"text-white font-medium",children:["#",n+1]})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),e.jsx("div",{className:"text-white truncate font-medium",children:p(t.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),e.jsx("div",{className:"text-white font-medium",children:t.coordinates.join(", ")})]})]})]})]})},Gt=s=>{let t=0;for(let n=0;n<s.length;n++)t=(t<<5)-t+s.charCodeAt(n),t=t&t;return Math.abs(t)%1e4/1e4*.15},_t=s=>{let t=0;for(let n=0;n<s.length;n++)t=(t<<3)-t+s.charCodeAt(n)*7,t=t&t;return Math.abs(t)%1e4/1e4*Math.PI*2},et=(s,t,n,h,d)=>{const g=t*(1-n*n)/(1+n*Math.cos(s)),p=g*Math.cos(s),m=g*Math.sin(s),i=p*Math.cos(d)-m*Math.sin(d)*Math.cos(h),y=p*Math.sin(d)+m*Math.cos(d)*Math.cos(h),v=m*Math.sin(h);return new ze(i,v,y)},it=a.forwardRef(({planets:s,stars:t,systemName:n,cosmicOriginTime:h,systemUrl:d},g)=>{const p=a.useRef(null),m=a.useRef(null),i=a.useRef(null),y=a.useRef(null),v=a.useRef([]),P=a.useRef([]),E=a.useRef([]),u=a.useRef(null),M=a.useRef(0),re=a.useRef(null),A=Math.floor(Date.now()/1e3),[Y,T]=a.useState(0),[x,B]=a.useState(!1),[G,q]=a.useState(!1),[ce,O]=a.useState(!1),[oe,R]=a.useState(0),[_,ve]=a.useState(null),[Fe,je]=a.useState(!0),[Ne,ae]=a.useState(null),[J,Se]=a.useState(!1);a.useImperativeHandle(g,()=>({captureScreenshot:()=>k(),isGeneratingImage:J}));const j=A-h+Y;M.current=j,a.useEffect(()=>{(async()=>{try{je(!0),ae(null);const w=await fetch("/api/system/rendering-data");if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);const D=await w.json();if(D.success)ve(D.system_data);else throw new Error(D.error||"Failed to fetch system data")}catch(w){ae(w instanceof Error?w.message:"Unknown error")}finally{je(!1)}})()},[]);const N=()=>{q(!0),setTimeout(()=>{B(!1),q(!1)},300)};a.useEffect(()=>{const o=w=>{w.key==="Escape"&&x&&N()};return x&&R(Y),document.addEventListener("solar-system-close-fullscreen",N),document.addEventListener("keydown",o),()=>{document.removeEventListener("solar-system-close-fullscreen",N),document.removeEventListener("keydown",o)}},[x,Y]),a.useEffect(()=>{if(x&&ce){const o=setTimeout(()=>{O(!1)},50);return()=>clearTimeout(o)}},[x,ce]),a.useEffect(()=>{if(Fe||!_||(window.tonnirLoggedInSystem=!1,!p.current))return;const o=p.current,w=o.clientWidth,D=o.clientHeight,U=Math.min(w,D),L=new Ve;L.background=new We(17),m.current=L;const I=new Be(45,1,.1,1e4);I.position.set(0,300,0),I.lookAt(0,0,0),re.current=I;const C=new Oe({antialias:!0,alpha:!0});C.setSize(U,U),C.setClearColor(17,1),i.current=C,C.domElement.className="",o.appendChild(C.domElement);const K={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},ie={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},S=new He;_.stars.forEach((l,$)=>{const Z=parseFloat(l.Size)*1.75,X=new pe(Z,16,16),me=ie[l.Color]||"#FFFF44",he=new ge({color:me,transparent:!0,opacity:.9}),H=new be(X,he),xe=_.stars.map((ye,Me)=>parseFloat(ye.Size)*1.75),fe=Math.max(...xe)*3;_.stars.length===1?H.position.set(0,0,0):_.stars.length===2?H.position.set($===0?-fe:fe,0,0):$===0?H.position.set(-fe,0,0):$===1?H.position.set(fe,0,0):H.position.set(0,fe,0);const se=new pe(Z*1.5,16,16),Re=new ge({color:me,transparent:!0,opacity:.3}),Ee=new be(se,Re);H.add(Ee),S.add(H)}),L.add(S);const b=_.timing.max_orbital_radius,F=80,Q=_.stars.map(l=>parseFloat(l.Size)*1.75),ee=Math.max(...Q)*1.5,V=Math.max(30,ee+10);window.systemMaxOrbitalRadius=b,_.planets.forEach((l,$)=>{const Z=l.orbital_radius/b,X=V+Z*F,me=l.eccentricity_factor,he=X,H=Gt(l.name),xe=_t(l.name),we=360,fe=2,se=4;for(let Ce=0;Ce<we;Ce+=fe+se){const Ie=[];for(let Ae=Ce;Ae<Math.min(Ce+fe,we-1);Ae++){const Te=Ae/we*2*Math.PI,Pe=et(Te,he,me,H,xe);Ie.push(Pe)}if(Ie.length>1){const Ae=new Ue().setFromPoints(Ie),Te=new Ke({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Pe=new qe(Ae,Te);L.add(Pe),P.current.push(Pe)}}const Re=l.diameter/12e3,Ee=Math.max(Math.min(Re,5),1),ye=new pe(Ee,16,16),Me=K[l.planet_type]||"#FFFFFF",De=new ge({color:Me,transparent:!0,opacity:.9}),ne=new be(ye,De),Le=new be(new pe(Ee*1.5,16,16),new ge({color:Me,transparent:!0,opacity:.2}));ne.add(Le),L.add(ne),v.current.push(ne),ne.planetData=l,ne.orbitRadius=X,ne.semiMajorAxis=he,ne.eccentricity=me,ne.inclination=H,ne.ascendingNode=xe,E.current.push(null)});const ue=new Ze(4210752,.4);L.add(ue);const c=new Ye(16777215,1,1e3);c.position.set(0,0,0),L.add(c);const f=new $e(I,C.domElement);f.enableDamping=!0,f.dampingFactor=.05,f.minDistance=50,f.maxDistance=800,f.autoRotate=!1,f.autoRotateSpeed=.5,f.enablePan=!0,f.enableZoom=!0,f.target.set(0,0,0),u.current=f;const W=l=>{if(l.ctrlKey)l.preventDefault(),l.deltaY>0?T($=>$+604800):T($=>$-604800);else{l.preventDefault();const $=.1,Z=I.position.distanceTo(new ze(0,0,0));l.deltaY>0&&Z<500?I.position.multiplyScalar(1+$):l.deltaY<0&&Z>20&&I.position.multiplyScalar(1-$)}},le=C.domElement;le.style.borderRadius="8px",le.addEventListener("wheel",W);const te=()=>{y.current=requestAnimationFrame(te),v.current.forEach((l,$)=>{const Z=l.planetData,X=l.semiMajorAxis,me=l.eccentricity,he=l.inclination,H=l.ascendingNode,xe=Z.orbital_period_seconds,we=2*Math.PI/xe,fe=(Z.initial_orbital_angle+M.current*we)%(2*Math.PI),se=et(fe,X,me,he,H);l.position.copy(se);const Re=Z.rotation_period_seconds,Ee=2*Math.PI/Re;l.rotation.y=M.current*Ee%(2*Math.PI)}),u.current&&u.current.update(),C.render(L,I)};te();const de=()=>{if(!p.current||!C)return;const l=p.current,$=Math.min(l.clientWidth,l.clientHeight);C.setSize($,$),I.aspect=1,I.updateProjectionMatrix()};return window.addEventListener("resize",de),()=>{window.removeEventListener("resize",de),le.removeEventListener("wheel",W),u.current&&u.current.dispose(),y.current&&cancelAnimationFrame(y.current),o&&C.domElement&&o.removeChild(C.domElement),C.dispose(),v.current=[],P.current=[],E.current=[]}},[s,t,h,_,Y]);const k=()=>{if(!i.current||!m.current||!re.current||J)return;Se(!0),u.current&&(u.current.enabled=!1);const o=i.current,w=m.current,D=re.current,U=o.domElement.width,L=o.domElement.height,I=3840/U,C=[];w.traverse(S=>{if(S.isPoints&&S.material){const b=S.material;if(b.size!==void 0&&(C.push({material:b,originalSize:b.size}),b.size=b.size*I*1),S.geometry&&S.geometry.attributes.size){const F=S.geometry.attributes.size,Q=F.array.slice();C.push({geometry:S.geometry,originalSizeArray:Q});for(let ee=0;ee<F.array.length;ee++)F.array[ee]*=I*1;F.needsUpdate=!0}}if(S.isSprite&&(C.push({object:S,originalScale:S.scale.clone()}),S.scale.multiplyScalar(I*1)),S.isLine&&S.material){const b=S.material;b.linewidth!==void 0&&(C.push({material:b,originalLinewidth:b.linewidth}),b.linewidth=b.linewidth*I*1)}});const K=3840,ie=3840;o.setSize(K,ie),D.aspect=1,D.updateProjectionMatrix(),o.render(w,D),o.domElement.toBlob(S=>{if(S){const b=document.createElement("canvas"),F=b.getContext("2d");if(b.width=K,b.height=ie,F){const Q=new Image;Q.onload=async()=>{F.drawImage(Q,0,0),jt(F,{imageWidth:K,imageHeight:ie}),d&&await Nt(F,K,ie,{type:"system",stargateUrl:d}),b.toBlob(V=>{if(V){const ue=URL.createObjectURL(V),c=document.createElement("a");c.href=ue,c.download=`system_${n}_${Date.now()}.jpg`,c.click(),URL.revokeObjectURL(ue)}},"image/jpeg",1)};const ee=URL.createObjectURL(S);Q.src=ee}}C.forEach(({material:b,object:F,originalSize:Q,originalScale:ee,originalLinewidth:V,geometry:ue,originalSizeArray:c})=>{if(Q!==void 0&&(b.size=Q),ee!==void 0&&F.scale.copy(ee),V!==void 0&&(b.linewidth=V),ue&&c){const f=ue.attributes.size;for(let W=0;W<c.length;W++)f.array[W]=c[W];f.needsUpdate=!0}}),o.setSize(U,L),D.aspect=1,D.updateProjectionMatrix(),u.current&&(u.current.enabled=!0),Se(!1)},"image/jpeg",1)},r=o=>{const w=Math.floor(o/31557600),D=Math.floor(o%(365.25*24*3600)/(24*3600)),U=Math.floor(o%(24*3600)/3600);return w>0?`${w}y ${D}d ${U}h`:D>0?`${D}d ${U}h`:`${U}h`},z=o=>o.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center w-full h-full",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{ref:p,className:"w-full h-full border border-white/20 rounded bg-black/20"}),e.jsx(Ct,{isVisible:J}),!Fe&&!Ne&&n&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:z(n)})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 z-10",children:[e.jsx("button",{onClick:k,disabled:J,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${J?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:J?"Generating image...":"Download 4K screenshot",children:J?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(yt,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>{J||(B(!0),O(!0))},disabled:J,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${J?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:J?"Please wait...":"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})]})}),x&&tt.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${G||ce?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${G||ce?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:z(n)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:z(n)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[_?.planets?.length||s.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",r(A-h+oe)]})]})]}),e.jsx("button",{onClick:N,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-100y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-100*365.25*24*3600,max:100*365.25*24*3600,step:604800,value:oe,onChange:o=>{const w=Number(o.target.value),D=-(A-h);R(Math.max(w,D))},className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded",style:{left:`${(0- -100*365.25*24*3600)/(100*365.25*24*3600- -100*365.25*24*3600)*100}%`}})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+100y"}),e.jsx("button",{onClick:()=>R(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",oe===0?"Present":oe>0?`+${Math.abs(oe/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(oe/(365.25*24*3600)).toFixed(1)} years`," • Range: 200 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(ot,{planets:_?.planets||s,stars:_?.stars||t,systemName:n,cosmicOriginTime:h,currentTime:A-h+oe,onTimeOffsetChange:o=>R(w=>w+o)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})});it.displayName="SolarSystem3DViewerLeft";const Ot=({systemUrl:s,system:t,cosmicOriginTime:n})=>{const h=a.useRef(null),[d,g]=a.useState(!1),[p,m]=a.useState(!1),[i,y]=a.useState(!1),[v,P]=a.useState(!1),E=a.useRef(null);return a.useEffect(()=>{const u=h.current;if(!u)return;const M=u.getContext("2d");if(!M)return;let re=[];const A=800;let Y,T;const x=800;let B,G=.5;function q(){const R=u?.parentElement;if(!R||!u)return;const _=R.clientWidth,ve=R.clientHeight;u.width=Math.min(_,x),u.height=Math.min(ve,x),Y=u.width/2,T=u.height/2}function ce(){q(),re=[];for(let R=0;R<A;R++)re.push({x:Math.random()*(u?.width||800),y:Math.random()*(u?.height||800),z:Math.random()*(u?.width||800),o:Math.random()});O()}function O(){!u||!M||(M.clearRect(0,0,u.width,u.height),re.forEach(R=>{R.z-=G,R.z<=0&&(R.z=u.width,R.x=Math.random()*u.width,R.y=Math.random()*u.height,R.o=Math.random());const _=u.width/R.z,ve=(R.x-Y)*_+Y,Fe=(R.y-T)*_+T,je=2*_;M.beginPath(),M.fillStyle=`rgba(255, 255, 255, ${R.o})`,M.arc(ve,Fe,je,0,2*Math.PI),M.fill()}),G<60&&(G+=1),B=requestAnimationFrame(O))}ce();const oe=()=>q();return window.addEventListener("resize",oe),()=>{window.removeEventListener("resize",oe),B&&cancelAnimationFrame(B)}},[]),a.useEffect(()=>{g(!0),setTimeout(()=>{m(!0)},800)},[]),a.useEffect(()=>{const u=setInterval(()=>{E.current&&i&&!E.current.isGeneratingImage&&i&&y(!1)},50);return()=>clearInterval(u)},[i]),a.useEffect(()=>{const u=()=>{P(!0)},M=st.subscribe("mining_completed",u);return()=>{M()}},[]),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"System Visualization"})}),e.jsxs("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:[e.jsx("canvas",{ref:h,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${p?"opacity-0":"opacity-100"}`,style:{filter:p?"blur(50px)":"none"}}),d&&t&&e.jsx("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${d&&p?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:e.jsx(it,{ref:E,planets:t.planets,stars:t.stars,systemName:t.name,cosmicOriginTime:n||0,systemUrl:s})}),e.jsx(vt,{isActive:v,onAnimationComplete:()=>{P(!1)}})]}),e.jsxs("div",{className:"text-center mt-auto",children:[e.jsx(Ft,{href:s,onTakeScreenshot:()=>{E.current&&!i&&(y(!0),E.current.captureScreenshot())},isGeneratingImage:i}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]})]})},$t=({planets:s,coordinates:t,systemIndex:n})=>{const[h,d]=a.useState(new Set),g=i=>({"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"})[i]||"#FFFFFF";a.useEffect(()=>{(()=>{try{const y=mt(t,n,s),v=new Set;y.forEach(P=>{v.add(P.toLowerCase())}),d(v)}catch{}})()},[t,n,s]);const p=i=>i.replace(/_/g," "),m=i=>{try{ut(t,n,i,s)}catch{}window.location.href=`/planet/${i.toLowerCase()}`};return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3",children:s.map(i=>e.jsxs("div",{className:"relative bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 hover:border-white/40 transition-all duration-300 group overflow-hidden",children:[h.has(i.name.toLowerCase())&&e.jsx("div",{className:"absolute top-1 right-1 z-10",title:"Planet visited",children:e.jsx(St,{className:"text-green-400"})}),e.jsx("div",{className:"absolute -top-3 -left-3 w-8 h-8 rounded-full border border-white/40 shadow-sm z-20 animate-pulse",style:{backgroundColor:g(i.planet_type)}}),e.jsxs("button",{onClick:()=>m(i.name),className:"w-full text-left block p-2 sm:p-3 text-gray-200 hover:text-white transition-colors duration-300 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Planet"}),e.jsx("div",{className:"text-sm font-semibold text-white truncate group-hover:text-blue-300 transition-colors duration-300",children:p(i.name)})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]},i.name))}),s.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No planets found"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This system appears to be empty"})]})]})},Vt=({currentSystem:s,galaxy:t})=>{const[n,h]=a.useState(!1),[d,g]=a.useState(!1),[p,m]=a.useState(!0);a.useEffect(()=>{h(s.index>0),g(!0),m(!1)},[s.index]);const i=async()=>{if(s.index>0){if(!ke.canAffordTravel("system",1)){ke.executeTravel("system",1);return}if(!ke.executeTravel("system",1))return;const P=t.coordinates.join(",");_e(P,s.index-1),window.location.href=`/system/${s.index-1}`}},y=async()=>{if(!ke.canAffordTravel("system",1)){ke.executeTravel("system",1);return}if(!ke.executeTravel("system",1))return;const P=t.coordinates.join(",");_e(P,s.index+1),window.location.href=`/system/${s.index+1}`};return p?null:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:i,disabled:!n,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${n?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:y,disabled:!d,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${d?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})},Wt=({system:s,galaxy:t,system_url:n,version:h,system_index:d,image_url:g,page:p,cosmic_origin_time:m})=>{const[i]=a.useState(t.coordinates.join(","));a.useEffect(()=>{document.body.setAttribute("data-coordinates",i),document.body.setAttribute("data-system-index",d.toString()),_e(i,d)},[i,d]);const y=P=>P.replace(/_/g," "),v=P=>P.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsx(ht,{}),e.jsxs("div",{className:"w-full min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(xt,{}),e.jsxs("div",{className:"relative z-10 pt-1 flex-1 flex flex-col",children:[e.jsx(ft,{}),e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8 flex-1",children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["System '",y(s.name),"'"]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-300 flex items-center justify-center gap-x-4 gap-y-1 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Dt,{size:15,color:"#ffffffff"}),v(t.name)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Et,{size:15,color:"#ffffffff"}),t.coordinates.join(", ")]})]})]}),e.jsx(Vt,{currentSystem:{name:s.name,index:d},galaxy:t}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[e.jsx("div",{className:"order-1 lg:order-1",children:e.jsx(Ot,{systemUrl:n,system:s,cosmicOriginTime:m})}),e.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),e.jsx("div",{className:"order-2 lg:order-2",children:e.jsx(Tt,{system:s,galaxy:t,systemIndex:d,cosmicOriginTime:m})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:["Planets in '",y(s.name),"'"]}),e.jsx($t,{planets:s.planets,coordinates:i,systemIndex:d})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${p}`,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:e.jsxs("span",{className:"text-base sm:text-lg",children:["← Back to Galaxy '",v(t.name),"'"]})})})]}),e.jsx(Mt,{version:h})]}),e.jsx(Rt,{}),e.jsx(pt,{currentLocation:{type:"system",name:s.name,coordinates:t.coordinates.join(","),systemIndex:s.index}}),e.jsx(kt,{currentView:"system"})]})]})};document.addEventListener("DOMContentLoaded",async()=>{try{const s=document.getElementById("system-data"),t=document.getElementById("galaxy-data"),n=document.getElementById("meta-data");if(!s||!t||!n)return;const h=JSON.parse(s.textContent||"{}"),d=JSON.parse(t.textContent||"{}"),g=JSON.parse(n.textContent||"{}"),p={system:h,galaxy:d,system_url:g.system_url,version:g.version,system_index:g.system_index,image_url:g.image_url,page:g.page||1,cosmic_origin_time:g.cosmic_origin_time},m=document.getElementById("atlas-react-root");m&&lt.createRoot(m).render(ct.createElement(Wt,p))}catch{}});
