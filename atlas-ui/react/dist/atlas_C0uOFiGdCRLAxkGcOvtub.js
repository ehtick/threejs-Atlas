import{S as z,g as L,D as A}from"./atlas_CvjINy7MGUzH_F6zr4ome.js";import{V as u,S as N,D as F,C as V,G as M,E as U,B as P,n as y,M as Y,i as x}from"./atlas_CePo6YWp7kQwmK1a1tWI3.js";const l={DOODLE_COUNT:{min:30,max:48},DOODLE_SIZE:{min:.08,max:.2},COMPLEXITY:{min:15,max:35},MOVEMENT_SPEED:{min:.03,max:.09},OPACITY:{min:.3,max:1},TIME_SPEED:{min:.1,max:3},RING_CYCLE_DURATION:{min:25,max:45},RING_EVENT_DURATION:{min:3,max:8},SEPARATION_DURATION:{min:.8,max:2.5},RETURNING_DURATION:{min:.8,max:2.5}};class k{group;doodles=[];doodleData=[];planetRadius;startTime;timeSpeed;rng;lightDirection=new u(1,1,1).normalize();lastDebugTime=0;debugInterval=30;debugMode=!1;cosmicRingState="normal";ringCycleDuration;ringEventDuration;separationDuration;returningDuration;doodleBasePositions=[];orbitalVisibilityFactor;orbitalData;currentTimeYears;createLitMaterial(t,i){const e=`
      varying vec3 vWorldPosition;
      varying vec3 vWorldNormal;
      
      void main() {
        vec4 worldPosition = modelMatrix * vec4(position, 1.0);
        vWorldPosition = worldPosition.xyz;
        vWorldNormal = normalize(mat3(modelMatrix) * normal);
        
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,a=`
      uniform vec3 color;
      uniform float opacity;
      uniform vec3 lightDirection;
      uniform float ambientStrength;
      uniform float lightIntensity;
      
      varying vec3 vWorldPosition;
      varying vec3 vWorldNormal;
      
      void main() {
        vec3 normal = normalize(vWorldNormal);
        vec3 lightDir = normalize(-lightDirection);

        float dotNL = dot(normal, lightDir);
        float lightingFactor = max(0.0, dotNL);

        float rimLight = 1.0 - abs(dotNL);
        rimLight = pow(rimLight, 3.0) * 0.1;

        float totalLight = ambientStrength + (lightIntensity * lightingFactor) + rimLight;
        totalLight = clamp(totalLight, 0.6, 1.2);

        vec3 finalColor = mix(color * 0.8, color * totalLight, 0.7);
        
        gl_FragColor = vec4(finalColor, opacity);
      }
    `;return new N({vertexShader:e,fragmentShader:a,uniforms:{color:{value:new V(t)},opacity:{value:i},lightDirection:{value:this.lightDirection.clone()},ambientStrength:{value:.5},lightIntensity:{value:.8}},transparent:!0,side:F})}projectPointOnSphere(t,i,e,a){const s=a.clone().normalize(),n=new u(0,1,0).cross(s).normalize();n.lengthSq()<.001&&n.set(1,0,0).cross(s).normalize();const o=s.clone().cross(n).normalize(),c=n.clone().multiplyScalar(t).add(o.clone().multiplyScalar(i));return s.clone().add(c).normalize().multiplyScalar(e)}constructor(t,i={},e){this.group=new M,this.planetRadius=t;const a=e||12345;this.rng=new z(a),this.startTime=a%1e4/1e3,this.timeSpeed=this.rng.uniform(l.TIME_SPEED.min,l.TIME_SPEED.max),this.ringEventDuration=this.rng.uniform(l.RING_EVENT_DURATION.min,l.RING_EVENT_DURATION.max),this.separationDuration=this.rng.uniform(l.SEPARATION_DURATION.min,l.SEPARATION_DURATION.max),this.returningDuration=this.rng.uniform(l.RETURNING_DURATION.min,l.RETURNING_DURATION.max);const s=this.rng.uniform(l.RING_CYCLE_DURATION.min,l.RING_CYCLE_DURATION.max);this.ringCycleDuration=s+this.ringEventDuration,this.orbitalData=i.orbitalData,this.currentTimeYears=i.currentTime||0,this.orbitalVisibilityFactor=this.calculateOrbitalVisibility(),this.debugMode=!1,this.doodleData=this.generateProceduralDoodles(),this.doodleData.length>0&&this.createDoodles()}generateProceduralDoodles(){const t=[],i=this.rng.randint(l.DOODLE_COUNT.min,l.DOODLE_COUNT.max),e=["arc","fractals","squiggle"],a=["wave","pulse","spiral"];for(let s=0;s<i;s++){const n=this.rng.random()*2*Math.PI,o=Math.acos(this.rng.random()*2-1),c=[Math.sin(o)*Math.cos(n),Math.sin(o)*Math.sin(n),Math.cos(o)],r=this.rng.randint(200,255),h=this.rng.randint(0,100),g=this.rng.randint(150,255),d=this.rng.uniform(l.OPACITY.min,l.OPACITY.max),p=`#${r.toString(16).padStart(2,"0")}${h.toString(16).padStart(2,"0")}${g.toString(16).padStart(2,"0")}`;t.push({position_3d:c,type:e[this.rng.randint(0,e.length-1)],size:this.rng.uniform(l.DOODLE_SIZE.min,l.DOODLE_SIZE.max),color:[p,d],complexity:this.rng.randint(l.COMPLEXITY.min,l.COMPLEXITY.max),movement_speed:this.rng.uniform(l.MOVEMENT_SPEED.min,l.MOVEMENT_SPEED.max),movement_pattern:a[this.rng.randint(0,a.length-1)]})}return t}createDoodles(){this.doodleData.forEach((t,i)=>{let e;switch(t.type){case"arc":e=this.createArcDoodle(t);break;case"fractals":e=this.createFractalDoodle(t);break;case"squiggle":e=this.createSquiggleDoodle(t);break;default:e=this.createSquiggleDoodle(t)}const a=new u(...t.position_3d).normalize();this.doodleBasePositions[i]=a.multiplyScalar(this.planetRadius),this.doodles.push(e),this.group.add(e)})}createArcDoodle(t){const i=new M,a=new U(0,0,t.size*this.planetRadius,t.size*this.planetRadius*.7,0,Math.PI*1.5,!1,0).getPoints(50),s=new P().setFromPoints(a),n=this.createLitMaterial(t.color[0],t.color[1]),o=new y(s,n);return i.add(o),i}createFractalDoodle(t){const i=new M,e=Math.floor(t.complexity*.6)+2,a=new u(...t.position_3d),s=this.planetRadius;for(let n=0;n<e;n++){const o=(this.rng.random()-.5)*t.size*this.planetRadius,c=(this.rng.random()-.5)*t.size*this.planetRadius,r=[],h=Math.floor(this.rng.random()*20)+8,g=this.rng.random()*t.size*this.planetRadius*.3+.1;for(let m=0;m<=h;m++){const D=m/h*Math.PI*2,S=g*(.7+this.rng.random()*.6),_=D+(this.rng.random()-.5)*.5,R=o+Math.cos(_)*S,v=c+Math.sin(_)*S,b=this.projectPointOnSphere(R,v,s,a);r.push(b)}r.push(r[0]);const d=new P().setFromPoints(r),p=this.createLitMaterial(t.color[0],t.color[1]),f=new y(d,p);i.add(f)}return i}createSquiggleDoodle(t){const i=new M,e=Math.floor(t.complexity*.8)+3,a=new u(...t.position_3d),s=this.planetRadius;for(let n=0;n<e;n++){const o=[],c=this.rng.random()*15+5;let r=(this.rng.random()-.5)*t.size*this.planetRadius,h=(this.rng.random()-.5)*t.size*this.planetRadius;for(let f=0;f<=c;f++){const m=this.projectPointOnSphere(r,h,s,a);o.push(m),r+=(this.rng.random()-.5)*t.size*this.planetRadius*.2,h+=(this.rng.random()-.5)*t.size*this.planetRadius*.2;const D=t.size*this.planetRadius*.8;r=Math.max(-D,Math.min(D,r)),h=Math.max(-D,Math.min(D,h))}const g=new P().setFromPoints(o),d=this.createLitMaterial(t.color[0],t.color[1]),p=new y(g,d);i.add(p)}return i}update(t){const e=L(A,this.timeSpeed,this.startTime),a=this.orbitalVisibilityFactor;if(this.orbitalVisibilityFactor=this.calculateOrbitalVisibility(),this.debugMode){const n=Date.now()/1e3;n-this.lastDebugTime>this.debugInterval&&(this.lastDebugTime=n,this.logOrbitalStatus()),a<=.001&&this.orbitalVisibilityFactor>.001||a>.001&&this.orbitalVisibilityFactor<=.001}if(!this.orbitalData||!this.orbitalData.enabled){this.cosmicRingState="normal",this.doodles.forEach(n=>{n.position.set(0,0,0)}),this.applyNormalAnimations(e);return}if(this.orbitalVisibilityFactor<=.001){this.cosmicRingState="normal",this.doodles.forEach(n=>{n.position.set(0,0,0)}),this.applyNormalAnimations(e);return}const s=e%this.ringCycleDuration;this.updateCosmicRingState(s),this.doodles.forEach((n,o)=>{const c=this.doodleData[o];if(!c)return;const r=this.calculateCosmicRingEffect(s,o),h=new u(0,0,0),g=this.doodleBasePositions[o],d=o%3,p=this.planetRadius*2.5,f=d*.3*this.planetRadius,m=g.clone().normalize().multiplyScalar(p+f),S=e*12,_=1+d*.4,R=S*_+o*(Math.PI*2/this.doodles.length),v=p*.08,b=new u().crossVectors(m,new u(0,1,0)).normalize();b.lengthSq()<.001&&b.set(1,0,0).cross(m.clone().normalize()).normalize();const C=new u().crossVectors(m.clone().normalize(),b).normalize(),w=m.clone().add(b.multiplyScalar(Math.cos(R)*v)).add(C.multiplyScalar(Math.sin(R)*v));let T;if(r.separationFactor<=.001)T=h.clone();else{let E=r.separationFactor;this.cosmicRingState==="separating"?E=this.easeOutQuart(E):this.cosmicRingState==="returning"&&(E=this.easeInOutCubic(E)),T=h.clone().lerp(w,E)}n.position.copy(T);const I=c.movement_speed*r.speedMultiplier;switch(c.movement_pattern){case"wave":n.rotation.z=Math.sin(e*I)*.2;break;case"pulse":n.rotation.z=Math.sin(e*I*2)*.15;break;case"spiral":n.rotation.z=e*I;break}})}calculateOrbitalVisibility(){if(!this.orbitalData||!this.orbitalData.enabled)return 1;const i=this.currentTimeYears%this.orbitalData.cycle_duration_years/this.orbitalData.cycle_duration_years,e=this.orbitalData.visible_duration_years/this.orbitalData.cycle_duration_years;if(i<e){const a=i/e;return a<.1?a/.1:a>.9?(1-a)/.1:1}else return 0}applyNormalAnimations(t){this.doodles.forEach((i,e)=>{const a=this.doodleData[e];if(!a)return;const s=a.movement_speed;switch(a.movement_pattern){case"wave":i.rotation.z=Math.sin(t*s)*.2;break;case"pulse":i.rotation.z=Math.sin(t*s*2)*.15;break;case"spiral":i.rotation.z=t*s;break}})}updateCosmicRingState(t){const i=this.ringCycleDuration-this.ringEventDuration;t<i?this.cosmicRingState="normal":t<i+this.separationDuration?this.cosmicRingState="separating":t<i+this.separationDuration+(this.ringEventDuration-this.separationDuration-this.returningDuration)?this.cosmicRingState="ring_mode":this.cosmicRingState="returning"}calculateCosmicRingEffect(t,i){const e=this.ringCycleDuration-this.ringEventDuration;let a=0,s=0,n=1;switch(this.cosmicRingState){case"normal":a=0,s=0,n=1;break;case"separating":const c=(t-e)/this.separationDuration;a=this.easeOutQuart(c),s=12,n=1+a*7;break;case"ring_mode":a=1,s=12,n=8;break;case"returning":const r=e+this.separationDuration+(this.ringEventDuration-this.separationDuration-this.returningDuration),h=(t-r)/this.returningDuration;a=1-this.easeInQuart(h),s=12,n=1+a*7;break}const o=i/this.doodles.length*.3;if(this.cosmicRingState==="separating"){const c=Math.max(0,(t-e-o*this.separationDuration)/this.separationDuration);a=this.easeOutQuart(c)}else if(this.cosmicRingState==="returning"){const c=e+this.separationDuration+(this.ringEventDuration-this.separationDuration-this.returningDuration),r=Math.max(0,(t-c-o*this.returningDuration)/this.returningDuration);a=1-this.easeInQuart(r)}return{separationFactor:a,orbitalSpeed:s,speedMultiplier:n}}smoothstep(t,i,e){const a=Math.max(0,Math.min(1,(e-t)/(i-t)));return a*a*(3-2*a)}logOrbitalStatus(){if(!this.orbitalData||!this.orbitalData.enabled)return;const t=this.currentTimeYears,i=t%this.orbitalData.cycle_duration_years/this.orbitalData.cycle_duration_years,e=this.orbitalData.visible_duration_years/this.orbitalData.cycle_duration_years,a=i<e,s=t%this.orbitalData.cycle_duration_years;let n;a?n=this.orbitalData.visible_duration_years-s:n=this.orbitalData.cycle_duration_years-s;const o=n*365.25,c=o*24,r=c*60;o>1?`${o.toFixed(1)}`:c>1?`${c.toFixed(1)}`:`${r.toFixed(1)}`}easeInOutCubic(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}easeOutQuart(t){return 1-Math.pow(1-t,4)}easeInQuart(t){return t*t*t*t}updateLightDirection(t){this.lightDirection.copy(t).normalize(),this.doodles.forEach(i=>{i.traverse(e=>{e instanceof y&&e.material instanceof N&&e.material.uniforms.lightDirection&&e.material.uniforms.lightDirection.value.copy(this.lightDirection)})})}updateFromThreeLight(t){const i=t.position.clone().normalize();this.updateLightDirection(i)}addToScene(t,i){this.group.position.copy(i),t.add(this.group)}removeFromScene(t){t.remove(this.group)}getObject3D(){return this.group}dispose(){this.doodles.forEach(t=>{t.traverse(i=>{i instanceof Y?(i.geometry.dispose(),i.material instanceof x&&i.material.dispose()):i instanceof y&&(i.geometry.dispose(),i.material instanceof x&&i.material.dispose())})}),this.doodles=[]}}function q(O,t,i,e){const a=e?.timing?.elapsed_time?e.timing.elapsed_time/31557600:0,s=e?.surface_elements?.exotic_doodles;return new k(O,{planetRadius:O,orbitalData:s,currentTime:a},i)}export{k as E,q as c};
