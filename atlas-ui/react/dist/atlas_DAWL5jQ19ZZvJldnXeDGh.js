import{r as s,j as e,a as Ue,c as et,R as tt}from"./atlas_BiACxVxc6cO5okV5F68Rd.js";import{R as st,L as nt,c as at,d as rt,S as Se,e as Pe,F as ot,H as it,a as lt}from"./atlas_BAqEsQWQ_MCEaSfE85tyi.js";import{W as Ie}from"./atlas_hV4YbJX4LmBeaYZmYRF0y.js";import{a2 as _e,C as Ge,a3 as Oe,G as $e,b as de,z as me,M as ue,V as Ne,B as Ve,W as Be,n as We,a8 as Ye,y as He,v as qe,cK as Ke,cL as Ze,I as ze}from"./atlas_BOOzg5XYrrU1N4SZySfRd.js";import{R as ct,S as dt,M as mt,a as Te,b as Xe,D as ut,T as ht}from"./atlas_JNmU8gMIa1SHExpBzTLAF.js";import{O as xt}from"./atlas_BJLzboHTaSIGvKgNbvLUr.js";import{V as ft}from"./atlas_DrLTn8mjMle6vK3_h1E1S.js";import"./atlas_5StMBQg7EZ_DcUhMgqODi.js";const Je=({planets:a,stars:c,systemName:p,cosmicOriginTime:L,currentTime:v,onTimeOffsetChange:j})=>{const H=s.useRef(null),b=s.useRef(null),d=s.useRef(null),$=s.useRef(null),D=s.useRef([]),A=s.useRef([]),m=s.useRef([]),V=s.useRef(0),Q=(N,K="#ffffff")=>{const E=document.createElement("canvas"),h=E.getContext("2d");if(!h)return null;E.width=768,E.height=192,h.fillStyle="rgba(0, 0, 0, 0.8)",h.fillRect(0,0,E.width,E.height),h.strokeStyle="#ffffff",h.lineWidth=3,h.strokeRect(3,3,E.width-6,E.height-6),h.fillStyle=K,h.font="bold 48px Arial",h.textAlign="center",h.textBaseline="middle",h.fillText(N,384,96);const u=new qe(E),T=new Ke({map:u,transparent:!0,alphaTest:.1}),B=new Ze(T);return B.scale.set(30,7.5,1),B};return V.current=v,s.useEffect(()=>{if(!H.current)return;const N=H.current,K=N.clientWidth,E=N.clientHeight,h=new _e;h.background=new Ge(17),b.current=h;const u=new Oe(60,K/E,.1,1e4);u.position.set(0,120,180),u.lookAt(0,0,0);const T=new Ie({antialias:!0,alpha:!0});T.setSize(K,E),T.setClearColor(17,1),d.current=T,N.appendChild(T.domElement);const B={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},he={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},z=new $e;c.forEach((t,S)=>{const o=parseFloat(t.Size)*4,l=new de(o,32,32),_=he[t.Color]||"#FFFF44",X=new me({color:_,transparent:!0,opacity:.9}),C=new ue(l,X);c.length===1?C.position.set(0,0,0):c.length===2?C.position.set(S===0?-o*2:o*2,0,0):S===0?C.position.set(-o*2,0,0):S===1?C.position.set(o*2,0,0):C.position.set(0,o*2,0);const G=new de(o*1.5,32,32),te=new me({color:_,transparent:!0,opacity:.3}),ee=new ue(G,te);C.add(ee),z.add(C)}),h.add(z);const xe=Math.max(...a.map(t=>t.orbital_radius)),g=150;a.forEach((t,S)=>{const l=30+t.orbital_radius/xe*g,_=t.eccentricity_factor,X=l,C=X*Math.sqrt(1-_*_),G=360,te=2,ee=4;for(let q=0;q<G;q+=te+ee){const Y=[];for(let J=q;J<Math.min(q+te,G-1);J++){const re=J/G*2*Math.PI,oe=X*Math.cos(re),Fe=C*Math.sin(re);Y.push(new Ne(oe,0,Fe))}if(Y.length>1){const J=new Ve().setFromPoints(Y),re=new Be({color:7372944,transparent:!0,opacity:.8,linewidth:2}),oe=new We(J,re);h.add(oe),A.current.push(oe)}}const ce=t.diameter/8e3,M=Math.max(Math.min(ce,8),2.5),y=new de(M,32,32),U=B[t.planet_type]||"#FFFFFF",n=new me({color:U,transparent:!0,opacity:.9}),f=new ue(y,n),k=new ue(new de(M*1.5,32,32),new me({color:U,transparent:!0,opacity:.2}));f.add(k),h.add(f),D.current.push(f),f.planetData=t,f.orbitRadius=l,f.semiMajorAxis=X,f.semiMinorAxis=C;const W=t.name.replace(/_/g," "),R=Q(W,"#ffffff");R&&(R.position.copy(f.position),R.position.y+=M+10,R.planetData=t,h.add(R),m.current.push(R))});const le=new Ye(4210752,.4);h.add(le);const fe=new He(16777215,1,2e3);fe.position.set(0,0,0),h.add(fe);let se=!1,ae=0,ne=0,we=0;const ge=t=>{se=!0,ae=t.clientX,ne=t.clientY},ye=t=>{if(!se)return;const S=t.clientX-ae,o=t.clientY-ne,l=new ze;l.setFromVector3(u.position),l.theta-=S*.01,l.phi+=o*.01,l.phi=Math.max(.1,Math.min(Math.PI-.1,l.phi)),u.position.setFromSpherical(l),u.lookAt(0,0,0),ae=t.clientX,ne=t.clientY},F=()=>{se=!1,setTimeout(()=>{},3e3)},P=t=>{if(t.ctrlKey)t.preventDefault(),t.deltaY>0?j(604800):j(-604800);else{t.preventDefault();const S=.1,o=u.position.distanceTo(new Ne(0,0,0));t.deltaY>0&&o<800?u.position.multiplyScalar(1+S):t.deltaY<0&&o>50&&u.position.multiplyScalar(1-S)}},r=t=>{t.key==="Escape"&&document.dispatchEvent(new CustomEvent("solar-system-close-fullscreen"))},i=t=>{if(t.preventDefault(),t.touches.length===1)se=!0,ae=t.touches[0].clientX,ne=t.touches[0].clientY;else if(t.touches.length===2){const S=t.touches[0].clientX-t.touches[1].clientX,o=t.touches[0].clientY-t.touches[1].clientY;we=Math.sqrt(S*S+o*o)}},w=t=>{if(t.preventDefault(),t.touches.length===1&&se){const S=t.touches[0].clientX-ae,o=t.touches[0].clientY-ne,l=new ze;l.setFromVector3(u.position),l.theta-=S*.01,l.phi+=o*.01,l.phi=Math.max(.1,Math.min(Math.PI-.1,l.phi)),u.position.setFromSpherical(l),u.lookAt(0,0,0),ae=t.touches[0].clientX,ne=t.touches[0].clientY}else if(t.touches.length===2){const S=t.touches[0].clientX-t.touches[1].clientX,o=t.touches[0].clientY-t.touches[1].clientY,l=Math.sqrt(S*S+o*o);if(we>0){const X=l/we,C=u.position.distanceTo(new Ne(0,0,0));X>1&&C>50?u.position.multiplyScalar(1-.01):X<1&&C<800&&u.position.multiplyScalar(1+.01)}we=l}},I=t=>{t.preventDefault(),se=!1,we=0,setTimeout(()=>{},3e3)},x=T.domElement;x.style.cursor="grab",x.addEventListener("mousedown",t=>{x.style.cursor="grabbing",ge(t)}),x.addEventListener("mousemove",ye),x.addEventListener("mouseup",()=>{x.style.cursor="grab",F()}),x.addEventListener("mouseleave",()=>{x.style.cursor="grab",F()}),x.addEventListener("wheel",P),x.addEventListener("touchstart",i,{passive:!1}),x.addEventListener("touchmove",w,{passive:!1}),x.addEventListener("touchend",I,{passive:!1}),document.addEventListener("keydown",r);const Z=()=>{$.current=requestAnimationFrame(Z),D.current.forEach((t,S)=>{const o=t.planetData,l=t.semiMajorAxis,_=t.semiMinorAxis,X=o.orbital_period_seconds,C=2*Math.PI/X,G=(o.initial_orbital_angle+V.current*C)%(2*Math.PI);t.position.x=l*Math.cos(G),t.position.z=_*Math.sin(G),t.position.y=0;const te=o.rotation_period_seconds,ee=2*Math.PI/te;if(t.rotation.y=V.current*ee%(2*Math.PI),m.current[S]){const ce=t.geometry.parameters?.radius||2;m.current[S].position.copy(t.position),m.current[S].position.y+=ce+10}}),T.render(h,u)};Z();const O=()=>{const t=N.clientWidth,S=N.clientHeight;u.aspect=t/S,u.updateProjectionMatrix(),T.setSize(t,S)};return window.addEventListener("resize",O),()=>{window.removeEventListener("resize",O),document.removeEventListener("keydown",r),x.removeEventListener("mousedown",ge),x.removeEventListener("mousemove",ye),x.removeEventListener("mouseup",F),x.removeEventListener("mouseleave",F),x.removeEventListener("wheel",P),x.removeEventListener("touchstart",i),x.removeEventListener("touchmove",w),x.removeEventListener("touchend",I),$.current&&cancelAnimationFrame($.current),N&&T.domElement&&N.removeChild(T.domElement),T.dispose(),D.current=[],A.current=[],m.current=[]}},[a,c,L]),e.jsx("div",{ref:H,className:"w-full h-full"})},pt=({planets:a,stars:c,systemName:p,cosmicOriginTime:L})=>{const v=s.useRef(null),j=s.useRef(null),H=s.useRef(null),b=s.useRef(null),d=s.useRef([]),$=s.useRef([]),D=s.useRef([]),A=s.useRef(0),m=Math.floor(Date.now()/1e3),[V,Q]=s.useState(0),[N,K]=s.useState(!1),[E,h]=s.useState(!1),[u,T]=s.useState(!1),[B,he]=s.useState(0),[z,xe]=s.useState(null),[g,le]=s.useState(!0),[fe,se]=s.useState(null),ae=m-L+V;A.current=ae,s.useEffect(()=>{(async()=>{try{le(!0),se(null);const P=await fetch("/api/system/rendering-data");if(!P.ok)throw new Error(`HTTP error! status: ${P.status}`);const r=await P.json();if(r.success)xe(r.system_data);else throw new Error(r.error||"Failed to fetch system data")}catch(P){se(P instanceof Error?P.message:"Unknown error")}finally{le(!1)}})()},[]);const ne=()=>{h(!0),setTimeout(()=>{K(!1),h(!1)},300)},we=(F,P="#ffffff")=>{const r=document.createElement("canvas"),i=r.getContext("2d");if(!i)return null;r.width=512,r.height=128,i.fillStyle="rgba(0, 0, 0, 0.7)",i.fillRect(0,0,r.width,r.height),i.strokeStyle="#ffffff",i.lineWidth=2,i.strokeRect(2,2,r.width-4,r.height-4),i.fillStyle=P,i.font="bold 32px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText(F,256,64);const w=new qe(r),I=new Ke({map:w,transparent:!0,alphaTest:.1}),x=new Ze(I);return x.scale.set(20,5,1),x};s.useEffect(()=>{const F=P=>{P.key==="Escape"&&N&&ne()};return N&&he(V),document.addEventListener("solar-system-close-fullscreen",ne),document.addEventListener("keydown",F),()=>{document.removeEventListener("solar-system-close-fullscreen",ne),document.removeEventListener("keydown",F)}},[N,V]),s.useEffect(()=>{if(N&&u){const F=setTimeout(()=>{T(!1)},50);return()=>clearTimeout(F)}},[N,u]),s.useEffect(()=>{if(g||!z||(window.tonnirLoggedInSystem=!1,!v.current))return;const F=v.current,P=F.clientWidth,r=P<640,i=new _e;i.background=new Ge(17),j.current=i;const w=new Oe(45,P/(r?120:140),.1,1e4);w.position.set(0,80,120),w.lookAt(0,0,0);const I=new Ie({antialias:!0,alpha:!0});I.setSize(P,r?120:140),I.setClearColor(17,1),H.current=I,F.appendChild(I.domElement);const x={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},Z={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},O=new $e;z.stars.forEach((n,f)=>{const k=parseFloat(n.Size)*3,W=new de(k,16,16),R=Z[n.Color]||"#FFFF44",q=new me({color:R,transparent:!0,opacity:.9}),Y=new ue(W,q);z.stars.length===1?Y.position.set(0,0,0):z.stars.length===2?Y.position.set(f===0?-k*2:k*2,0,0):f===0?Y.position.set(-k*2,0,0):f===1?Y.position.set(k*2,0,0):Y.position.set(0,k*2,0);const J=new de(k*1.5,16,16),re=new me({color:R,transparent:!0,opacity:.3}),oe=new ue(J,re);Y.add(oe),O.add(Y)}),i.add(O);const t=z.timing.max_orbital_radius,S=80;window.systemMaxOrbitalRadius=t,z.planets.forEach((n,f)=>{const W=20+n.orbital_radius/t*S,R=n.eccentricity_factor,q=W,Y=q*Math.sqrt(1-R*R),J=360,re=2,oe=4;for(let ve=0;ve<J;ve+=re+oe){const Me=[];for(let ke=ve;ke<Math.min(ve+re,J-1);ke++){const Re=ke/J*2*Math.PI,Le=q*Math.cos(Re),Qe=Y*Math.sin(Re);Me.push(new Ne(Le,0,Qe))}if(Me.length>1){const ke=new Ve().setFromPoints(Me),Re=new Be({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Le=new We(ke,Re);i.add(Le),$.current.push(Le)}}const Fe=n.diameter/15e3,Ee=Math.max(Math.min(Fe,4),1.5),De=new de(Ee,16,16),be=x[n.planet_type]||"#FFFFFF",Ae=new me({color:be,transparent:!0,opacity:.9}),ie=new ue(De,Ae),Ce=new ue(new de(Ee*1.5,16,16),new me({color:be,transparent:!0,opacity:.2}));ie.add(Ce),i.add(ie),d.current.push(ie),ie.planetData=n,ie.orbitRadius=W,ie.semiMajorAxis=q,ie.semiMinorAxis=Y;const je=n.name.replace(/_/g," "),pe=we(je,"#ffffff");pe&&(pe.position.copy(ie.position),pe.position.y+=Ee+6,pe.planetData=n,i.add(pe),D.current.push(pe))});const o=new Ye(4210752,.4);i.add(o);const l=new He(16777215,1,1e3);l.position.set(0,0,0),i.add(l);let _=!1,X=0,C=0;const G=n=>{_=!0,X=n.clientX,C=n.clientY},te=n=>{if(!_)return;const f=n.clientX-X,k=n.clientY-C,W=new ze;W.setFromVector3(w.position),W.theta-=f*.01,W.phi+=k*.01,W.phi=Math.max(.1,Math.min(Math.PI-.1,W.phi)),w.position.setFromSpherical(W),w.lookAt(0,0,0),X=n.clientX,C=n.clientY},ee=()=>{_=!1,setTimeout(()=>{},3e3)},ce=n=>{if(n.ctrlKey)n.preventDefault(),n.deltaY>0?Q(f=>f+604800):Q(f=>f-604800);else{n.preventDefault();const f=.1,k=w.position.distanceTo(new Ne(0,0,0));n.deltaY>0&&k<500?w.position.multiplyScalar(1+f):n.deltaY<0&&k>20&&w.position.multiplyScalar(1-f)}},M=I.domElement;M.style.cursor="grab",M.style.borderRadius="8px",M.addEventListener("mousedown",n=>{M.style.cursor="grabbing",G(n)}),M.addEventListener("mousemove",te),M.addEventListener("mouseup",()=>{M.style.cursor="grab",ee()}),M.addEventListener("mouseleave",()=>{M.style.cursor="grab",ee()}),M.addEventListener("wheel",ce);const y=()=>{b.current=requestAnimationFrame(y),d.current.forEach((n,f)=>{const k=n.planetData,W=n.semiMajorAxis,R=n.semiMinorAxis,q=k.orbital_period_seconds,Y=2*Math.PI/q,J=(k.initial_orbital_angle+A.current*Y)%(2*Math.PI);n.position.x=W*Math.cos(J),n.position.z=R*Math.sin(J),n.position.y=0;const re=k.rotation_period_seconds,oe=2*Math.PI/re;if(n.rotation.y=A.current*oe%(2*Math.PI),D.current[f]){const Fe=n.geometry.parameters?.radius||2;D.current[f].position.copy(n.position),D.current[f].position.y+=Fe+6}}),I.render(i,w)};y();const U=()=>{const n=F.clientWidth,f=n<640?120:140;w.aspect=n/f,w.updateProjectionMatrix(),I.setSize(n,f)};return window.addEventListener("resize",U),()=>{window.removeEventListener("resize",U),M.removeEventListener("mousedown",G),M.removeEventListener("mousemove",te),M.removeEventListener("mouseup",ee),M.removeEventListener("mouseleave",ee),M.removeEventListener("wheel",ce),b.current&&cancelAnimationFrame(b.current),F&&I.domElement&&F.removeChild(I.domElement),I.dispose(),d.current=[],$.current=[],D.current=[]}},[a,c,L,z]);const ge=F=>{const P=Math.floor(F/31557600),r=Math.floor(F%(365.25*24*3600)/(24*3600)),i=Math.floor(F%(24*3600)/3600);return P>0?`${P}y ${r}d ${i}h`:r>0?`${r}d ${i}h`:`${i}h`},ye=F=>F.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Solar System Perspective"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{ref:v,className:"w-full border border-white/20 rounded bg-black/20",style:{height:"auto"}}),!g&&!fe&&p&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:p})}),e.jsx("button",{onClick:()=>{K(!0),T(!0)},className:"absolute top-2 right-2 p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg z-10",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-[10px]",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-[10px]",children:[z?.planets?.length||a.length," Planets"]})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Time: ",ge(ae)]})]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View"})]})]}),N&&Ue.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${E||u?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${E||u?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:ye(p)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:ye(p)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[z?.planets?.length||a.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",ge(m-L+B)]})]})]}),e.jsx("button",{onClick:ne,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:B,onChange:F=>he(Number(F.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>he(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",B===0?"Present":B>0?`+${Math.abs(B/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(B/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Je,{planets:z?.planets||a,stars:z?.stars||c,systemName:p,cosmicOriginTime:L,currentTime:m-L+B,onTimeOffsetChange:F=>he(P=>P+F)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},gt=({system:a,galaxy:c,systemIndex:p,cosmicOriginTime:L})=>{const[v,j]=s.useState({isOnCooldown:!1,isSaved:!1,isCollecting:!1,timeUntilNext:0});s.useEffect(()=>{let b;const d=()=>{const m=Te.generateLocationId("system",c.coordinates.join(","),p,void 0),V=Te.canCollectFromLocation(m),Q=Te.getTimeUntilNextCollection(m),N=c.coordinates,K=Xe.generateSystemUrl(N,p,Xe.getCurrentPage()),h=nt.getLocations().some(u=>u.stargateUrl===K);j(u=>({isOnCooldown:!V&&Q>0,isSaved:h,isCollecting:u.isCollecting,timeUntilNext:Q}))},$=()=>{j(m=>({...m,isCollecting:!0})),b=setTimeout(()=>{j(m=>({...m,isCollecting:!1}))},1e3)};d();const D=setInterval(d,1e3),A=st.subscribe("mining_completed",$);return()=>{clearInterval(D),b&&clearTimeout(b),A()}},[a.name,p,c.coordinates]);const H=b=>b.replace(/_/g," ");return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[e.jsx(ct,{locationType:"system",locationId:a.name,coordinates:c.coordinates.join(","),systemIndex:p,className:"text-xs"}),e.jsx(dt,{type:"system",name:a.name,coordinates:c.coordinates.join(","),systemIndex:p,className:"text-xs"}),e.jsx("div",{className:"inline-flex items-center bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] font-medium px-1.5 py-0.5 rounded h-[21px] box-border",children:"VISITED"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(mt,{isOnCooldown:v.isOnCooldown,isSaved:v.isSaved,isCollecting:v.isCollecting}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Details"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"System Type"}),e.jsx("div",{className:"text-sm font-bold text-blue-300 capitalize",children:a.star_system_type})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Planets"}),e.jsx("div",{className:"text-sm font-bold text-purple-300",children:a.num_planets})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-orange-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Stars"}),e.jsx("div",{className:"text-sm font-bold text-orange-300",children:a.stars.length})]})]}),e.jsx("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-3",children:e.jsx(pt,{planets:a.planets,stars:a.stars,systemName:a.name,cosmicOriginTime:L})}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-yellow-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Stellar Composition"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1",children:a.stars.map((b,d)=>e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-yellow-500/20",children:[e.jsxs("div",{className:"text-xs text-gray-300",children:["Star ",d+1]}),e.jsx("div",{className:"text-xs font-bold text-yellow-300",children:b.Type}),e.jsxs("div",{className:"text-xs text-gray-300",children:[b.Color," • ",b.Size]})]},d))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System:"}),e.jsx("div",{className:"text-white truncate font-medium",children:H(a.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System ID:"}),e.jsxs("div",{className:"text-white font-medium",children:["#",p+1]})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),e.jsx("div",{className:"text-white truncate font-medium",children:H(c.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),e.jsx("div",{className:"text-white font-medium",children:c.coordinates.join(", ")})]})]})]})]})},bt=({planets:a,stars:c,systemName:p,cosmicOriginTime:L})=>{const v=s.useRef(null),j=s.useRef(null),H=s.useRef(null),b=s.useRef(null),d=s.useRef([]),$=s.useRef([]),D=s.useRef([]),A=s.useRef(null),m=s.useRef(0),V=s.useRef(null),Q=Math.floor(Date.now()/1e3),[N,K]=s.useState(0),[E,h]=s.useState(!1),[u,T]=s.useState(!1),[B,he]=s.useState(!1),[z,xe]=s.useState(0),[g,le]=s.useState(null),[fe,se]=s.useState(!0),[ae,ne]=s.useState(null),we=Q-L+N;m.current=we,s.useEffect(()=>{(async()=>{try{se(!0),ne(null);const i=await fetch("/api/system/rendering-data");if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const w=await i.json();if(w.success)le(w.system_data);else throw new Error(w.error||"Failed to fetch system data")}catch(i){ne(i instanceof Error?i.message:"Unknown error")}finally{se(!1)}})()},[]);const ge=()=>{T(!0),setTimeout(()=>{h(!1),T(!1)},300)};s.useEffect(()=>{const r=i=>{i.key==="Escape"&&E&&ge()};return E&&xe(N),document.addEventListener("solar-system-close-fullscreen",ge),document.addEventListener("keydown",r),()=>{document.removeEventListener("solar-system-close-fullscreen",ge),document.removeEventListener("keydown",r)}},[E,N]),s.useEffect(()=>{if(E&&B){const r=setTimeout(()=>{he(!1)},50);return()=>clearTimeout(r)}},[E,B]),s.useEffect(()=>{if(fe||!g||(window.tonnirLoggedInSystem=!1,!v.current))return;const r=v.current,i=r.clientWidth,w=r.clientHeight,I=Math.min(i,w),x=new _e;x.background=new Ge(17),j.current=x;const Z=new Oe(45,1,.1,1e4);Z.position.set(0,300,0),Z.lookAt(0,0,0),V.current=Z;const O=new Ie({antialias:!0,alpha:!0});O.setSize(I,I),O.setClearColor(17,1),H.current=O,r.appendChild(O.domElement);const t={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},S={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},o=new $e;g.stars.forEach((y,U)=>{const n=parseFloat(y.Size)*3,f=new de(n,16,16),k=S[y.Color]||"#FFFF44",W=new me({color:k,transparent:!0,opacity:.9}),R=new ue(f,W);g.stars.length===1?R.position.set(0,0,0):g.stars.length===2?R.position.set(U===0?-n*2:n*2,0,0):U===0?R.position.set(-n*2,0,0):U===1?R.position.set(n*2,0,0):R.position.set(0,n*2,0);const q=new de(n*1.5,16,16),Y=new me({color:k,transparent:!0,opacity:.3}),J=new ue(q,Y);R.add(J),o.add(R)}),x.add(o);const l=g.timing.max_orbital_radius,_=80;window.systemMaxOrbitalRadius=l,g.planets.forEach((y,U)=>{const f=20+y.orbital_radius/l*_,k=y.eccentricity_factor,W=f,R=W*Math.sqrt(1-k*k),q=360,Y=2,J=4;for(let ie=0;ie<q;ie+=Y+J){const Ce=[];for(let je=ie;je<Math.min(ie+Y,q-1);je++){const pe=je/q*2*Math.PI,ve=W*Math.cos(pe),Me=R*Math.sin(pe);Ce.push(new Ne(ve,0,Me))}if(Ce.length>1){const je=new Ve().setFromPoints(Ce),pe=new Be({color:7372944,transparent:!0,opacity:.8,linewidth:2}),ve=new We(je,pe);x.add(ve),$.current.push(ve)}}const re=y.diameter/15e3,oe=Math.max(Math.min(re,4),1.5),Fe=new de(oe,16,16),Ee=t[y.planet_type]||"#FFFFFF",De=new me({color:Ee,transparent:!0,opacity:.9}),be=new ue(Fe,De),Ae=new ue(new de(oe*1.5,16,16),new me({color:Ee,transparent:!0,opacity:.2}));be.add(Ae),x.add(be),d.current.push(be),be.planetData=y,be.orbitRadius=f,be.semiMajorAxis=W,be.semiMinorAxis=R,D.current.push(null)});const X=new Ye(4210752,.4);x.add(X);const C=new He(16777215,1,1e3);C.position.set(0,0,0),x.add(C);const G=new xt(Z,O.domElement);G.enableDamping=!0,G.dampingFactor=.05,G.minDistance=50,G.maxDistance=800,G.autoRotate=!1,G.autoRotateSpeed=.5,G.enablePan=!0,G.enableZoom=!0,G.target.set(0,0,0),A.current=G;const te=y=>{if(y.ctrlKey)y.preventDefault(),y.deltaY>0?K(U=>U+604800):K(U=>U-604800);else{y.preventDefault();const U=.1,n=Z.position.distanceTo(new Ne(0,0,0));y.deltaY>0&&n<500?Z.position.multiplyScalar(1+U):y.deltaY<0&&n>20&&Z.position.multiplyScalar(1-U)}},ee=O.domElement;ee.style.borderRadius="8px",ee.addEventListener("wheel",te);const ce=()=>{b.current=requestAnimationFrame(ce),d.current.forEach((y,U)=>{const n=y.planetData,f=y.semiMajorAxis,k=y.semiMinorAxis,W=n.orbital_period_seconds,R=2*Math.PI/W,q=(n.initial_orbital_angle+m.current*R)%(2*Math.PI);y.position.x=f*Math.cos(q),y.position.z=k*Math.sin(q),y.position.y=0;const Y=n.rotation_period_seconds,J=2*Math.PI/Y;y.rotation.y=m.current*J%(2*Math.PI)}),A.current&&A.current.update(),O.render(x,Z)};ce();const M=()=>{if(!v.current||!O)return;const y=v.current,U=Math.min(y.clientWidth,y.clientHeight);O.setSize(U,U),Z.aspect=1,Z.updateProjectionMatrix()};return window.addEventListener("resize",M),()=>{window.removeEventListener("resize",M),ee.removeEventListener("wheel",te),A.current&&A.current.dispose(),b.current&&cancelAnimationFrame(b.current),r&&O.domElement&&r.removeChild(O.domElement),O.dispose(),d.current=[],$.current=[],D.current=[]}},[a,c,L,g,N]);const ye=()=>{if(!H.current||!j.current||!V.current)return;const r=H.current,i=j.current,w=V.current,I=r.domElement.width,x=r.domElement.height,Z=3840/I,O=[];i.traverse(o=>{if(o.isPoints&&o.material){const l=o.material;if(l.size!==void 0&&(O.push({material:l,originalSize:l.size}),l.size=l.size*Z*1.75),o.geometry&&o.geometry.attributes.size){const _=o.geometry.attributes.size,X=_.array.slice();O.push({geometry:o.geometry,originalSizeArray:X});for(let C=0;C<_.array.length;C++)_.array[C]*=Z*1.75;_.needsUpdate=!0}}if(o.isSprite&&(O.push({object:o,originalScale:o.scale.clone()}),o.scale.multiplyScalar(Z*1.75)),o.isLine&&o.material){const l=o.material;l.linewidth!==void 0&&(O.push({material:l,originalLinewidth:l.linewidth}),l.linewidth=l.linewidth*Z*1.75)}}),r.setSize(3840,3840),w.aspect=1,w.updateProjectionMatrix(),r.render(i,w),r.domElement.toBlob(o=>{if(o){const l=URL.createObjectURL(o),_=document.createElement("a");_.href=l,_.download=`system_${p}_${Date.now()}.png`,_.click(),URL.revokeObjectURL(l)}O.forEach(({material:l,object:_,originalSize:X,originalScale:C,originalLinewidth:G,geometry:te,originalSizeArray:ee})=>{if(X!==void 0&&(l.size=X),C!==void 0&&_.scale.copy(C),G!==void 0&&(l.linewidth=G),te&&ee){const ce=te.attributes.size;for(let M=0;M<ee.length;M++)ce.array[M]=ee[M];ce.needsUpdate=!0}}),r.setSize(I,x),w.aspect=1,w.updateProjectionMatrix()},"image/png",1)},F=r=>{const i=Math.floor(r/31557600),w=Math.floor(r%(365.25*24*3600)/(24*3600)),I=Math.floor(r%(24*3600)/3600);return i>0?`${i}y ${w}d ${I}h`:w>0?`${w}d ${I}h`:`${I}h`},P=r=>r.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center w-full h-full",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{ref:v,className:"w-full h-full border border-white/20 rounded bg-black/20"}),!fe&&!ae&&p&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:P(p)})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 z-10",children:[e.jsx("button",{onClick:ye,className:"p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg",title:"Download screenshot",children:e.jsx(ut,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>{h(!0),he(!0)},className:"p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})]})}),E&&Ue.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${u||B?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${u||B?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:P(p)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:P(p)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[g?.planets?.length||a.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",F(Q-L+z)]})]})]}),e.jsx("button",{onClick:ge,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:z,onChange:r=>xe(Number(r.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>xe(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",z===0?"Present":z>0?`+${Math.abs(z/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(z/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Je,{planets:g?.planets||a,stars:g?.stars||c,systemName:p,cosmicOriginTime:L,currentTime:Q-L+z,onTimeOffsetChange:r=>xe(i=>i+r)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},wt=({systemUrl:a,system:c,cosmicOriginTime:p})=>{const L=s.useRef(null),[v,j]=s.useState("Aligning Stargate..."),[H,b]=s.useState(!1),[d,$]=s.useState(!1),[D,A]=s.useState(!1);return s.useEffect(()=>{const m=L.current;if(!m)return;const V=m.getContext("2d");if(!V)return;let Q=[];const N=800;let K,E;const h=800;let u,T=.5;function B(){const g=m?.parentElement;if(!g||!m)return;const le=g.clientWidth,fe=g.clientHeight;m.width=Math.min(le,h),m.height=Math.min(fe,h),K=m.width/2,E=m.height/2}function he(){B(),Q=[];for(let g=0;g<N;g++)Q.push({x:Math.random()*(m?.width||800),y:Math.random()*(m?.height||800),z:Math.random()*(m?.width||800),o:Math.random()});z()}function z(){!m||!V||(V.clearRect(0,0,m.width,m.height),Q.forEach(g=>{g.z-=T,g.z<=0&&(g.z=m.width,g.x=Math.random()*m.width,g.y=Math.random()*m.height,g.o=Math.random());const le=m.width/g.z,fe=(g.x-K)*le+K,se=(g.y-E)*le+E,ae=2*le;V.beginPath(),V.fillStyle=`rgba(255, 255, 255, ${g.o})`,V.arc(fe,se,ae,0,2*Math.PI),V.fill()}),T<60&&(T+=1),u=requestAnimationFrame(z))}he();const xe=()=>B();return window.addEventListener("resize",xe),()=>{window.removeEventListener("resize",xe),u&&cancelAnimationFrame(u)}},[]),s.useEffect(()=>{$(!0),setTimeout(()=>{A(!0)},800)},[]),s.useEffect(()=>{if(sessionStorage.getItem("stargateAnimationShown")){j("Stargate system aligned");return}sessionStorage.setItem("stargateAnimationShown","true"),b(!0);const V=(h,u)=>Array.from({length:u},()=>h[Math.floor(Math.random()*h.length)]).join(""),Q=[{chars:"01",duration:40,iterations:20},{chars:"0123456789",duration:25,iterations:30},{chars:"0123456789ABCDEF",duration:20,iterations:40},{chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}|;:\\'\",.<>?/`~",duration:10,iterations:100}];let N=0,K=0;const E=()=>{if(N>=Q.length){const u="Stargate system aligned";let T=0;j("");const B=()=>{T<u.length?(j(u.substring(0,T+1)),T++,setTimeout(B,30)):b(!1)};B();return}const h=Q[N];j(V(h.chars,32)),K++,K>=h.iterations&&(N++,K=0),setTimeout(E,h.duration)};E()},[]),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h3",{className:"text-sm font-medium text-white",children:c?.name||"System"})}),e.jsxs("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:[e.jsx("canvas",{ref:L,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${D?"opacity-0":"opacity-100"}`,style:{filter:D?"blur(50px)":"none"}}),d&&c&&e.jsx("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${d&&D?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:e.jsx(bt,{planets:c.planets,stars:c.stars,systemName:c.name,cosmicOriginTime:p||0})})]}),e.jsxs("div",{className:"text-center mt-auto",children:[e.jsxs("a",{href:a,className:`inline-block px-4 py-2 bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 text-gray-200 font-medium text-sm rounded-lg border border-slate-600 hover:border-slate-500 shadow-md hover:shadow-lg transition-all duration-300 relative overflow-hidden group ${H?"animate-pulse":""}`,style:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("span",{className:"relative z-10 font-mono flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6s.792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95a1 1 0 001.715 1.029zM8.5 10a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM10 14c-.304 0-.792-.193-1.264-.979a1 1 0 00-1.715 1.029C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 00-1.715-1.029C10.792 13.807 10.304 14 10 14z",clipRule:"evenodd"})}),v]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-slate-600/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]})]})},vt=({planets:a,coordinates:c,systemIndex:p})=>{const[L,v]=s.useState(new Set),j=d=>({"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"})[d]||"#FFFFFF";s.useEffect(()=>{(()=>{try{const $=at(c,p,a),D=new Set;$.forEach(A=>{D.add(A.toLowerCase())}),v(D)}catch{}})()},[c,p,a]);const H=d=>d.replace(/_/g," "),b=d=>{try{rt(c,p,d,a)}catch{}window.location.href=`/planet/${d.toLowerCase()}`};return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3",children:a.map(d=>e.jsxs("div",{className:"relative bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 hover:border-white/40 transition-all duration-300 group overflow-hidden",children:[L.has(d.name.toLowerCase())&&e.jsx("div",{className:"absolute top-1 right-1 bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] px-1.5 py-0.5 rounded z-10",children:"VISITED"}),e.jsx("div",{className:"absolute -top-3 -left-3 w-8 h-8 rounded-full border border-white/40 shadow-sm z-20 animate-pulse",style:{backgroundColor:j(d.planet_type)}}),e.jsxs("button",{onClick:()=>b(d.name),className:"w-full text-left block p-2 sm:p-3 text-gray-200 hover:text-white transition-colors duration-300 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Planet"}),e.jsx("div",{className:"text-sm font-semibold text-white truncate group-hover:text-blue-300 transition-colors duration-300",children:H(d.name)})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]},d.name))}),a.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No planets found"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This system appears to be empty"})]})]})},yt=({currentSystem:a,galaxy:c})=>{const[p,L]=s.useState(!1),[v,j]=s.useState(!1),[H,b]=s.useState(!0);s.useEffect(()=>{L(a.index>0),j(!0),b(!1)},[a.index]);const d=async()=>{if(a.index>0){if(!Se.canAffordTravel("system",1)){Se.executeTravel("system",1);return}if(!Se.executeTravel("system",1))return;const A=c.coordinates.join(",");Pe(A,a.index-1),window.location.href=`/system/${a.index-1}`}},$=async()=>{if(!Se.canAffordTravel("system",1)){Se.executeTravel("system",1);return}if(!Se.executeTravel("system",1))return;const A=c.coordinates.join(",");Pe(A,a.index+1),window.location.href=`/system/${a.index+1}`};return H?null:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:d,disabled:!p,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${p?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:$,disabled:!v,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${v?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})},Ft=({system:a,galaxy:c,system_url:p,version:L,system_index:v,image_url:j,page:H,cosmic_origin_time:b})=>{const[d]=s.useState(c.coordinates.join(","));s.useEffect(()=>{document.body.setAttribute("data-coordinates",d),document.body.setAttribute("data-system-index",v.toString()),Pe(d,v)},[d,v]);const $=A=>A.replace(/_/g," "),D=A=>A.replace(/_/g," ");return e.jsxs("div",{className:"w-full h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white overflow-auto",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(ot,{}),e.jsxs("div",{className:"relative z-10 pt-1",children:[e.jsx(it,{}),e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["System '",$(a.name),"'"]}),e.jsxs("p",{className:"text-lg sm:text-xl text-gray-300",children:["at Galaxy '",D(c.name),"' - Coordinates ",c.coordinates.join(", ")]})]}),e.jsx(yt,{currentSystem:{name:a.name,index:v},galaxy:c}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[e.jsx("div",{className:"order-1 lg:order-1",children:e.jsx(wt,{systemUrl:p,system:a,cosmicOriginTime:b})}),e.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),e.jsx("div",{className:"order-2 lg:order-2",children:e.jsx(gt,{system:a,galaxy:c,systemIndex:v,cosmicOriginTime:b})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:["Planets in '",$(a.name),"'"]}),e.jsx(vt,{planets:a.planets,coordinates:d,systemIndex:v})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${H}`,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:e.jsxs("span",{className:"text-base sm:text-lg",children:["← Back to Galaxy '",D(c.name),"'"]})})})]}),e.jsx(ft,{version:L})]}),e.jsx(ht,{}),e.jsx(lt,{currentLocation:{type:"system",name:a.name,coordinates:c.coordinates.join(","),systemIndex:a.index}})]})};document.addEventListener("DOMContentLoaded",async()=>{try{const a=document.getElementById("system-data"),c=document.getElementById("galaxy-data"),p=document.getElementById("meta-data");if(!a||!c||!p)return;const L=JSON.parse(a.textContent||"{}"),v=JSON.parse(c.textContent||"{}"),j=JSON.parse(p.textContent||"{}"),H={system:L,galaxy:v,system_url:j.system_url,version:j.version,system_index:j.system_index,image_url:j.image_url,page:j.page||1,cosmic_origin_time:j.cosmic_origin_time},b=document.getElementById("atlas-react-root");b&&et.createRoot(b).render(tt.createElement(Ft,H))}catch{}});
