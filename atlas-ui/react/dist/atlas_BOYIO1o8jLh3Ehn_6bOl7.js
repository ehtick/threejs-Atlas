import{c as Ee,A as Se,S as be}from"./atlas_CtjRlAX5HR7UzNXl58rox.js";import{c as Ie,R as Pe}from"./atlas_BYg2jUdFTMYuT2F7MhcYk.js";import{c as Z,A as Fe,a as p,b as U,d as xe,e as Te}from"./atlas_CZZN4FSbVhyEyl3hOtGg0.js";import{c as h,L as j,a as we}from"./atlas_J0HMdOiKxSZXCO5Pjnyc-.js";import{c as R}from"./atlas_C9tsJDAc8qabC9WZSFlDv.js";import{c as D,T as Ce,a as Me}from"./atlas_DW6yrqaAmXZU48bAWXCCD.js";import{c as Y,R as ve}from"./atlas_B6knAclC5aKwWOpB46pcx.js";import{P as Le,c as $e}from"./atlas_BLqTt933csgNZ8WfJfZ2l.js";import{g as C,c as Ae,P as ke}from"./atlas_BD566_P1NuoG48mLckNpM.js";import{P as Ge}from"./atlas_ClpHlG635phkJgd0jX62w.js";import{c as ee}from"./atlas_C_Z4ja4IE5q43l4BYAJkf.js";import{c as se}from"./atlas_BmvbCg_nXPe-Y9bwtF7r6.js";import{c as te}from"./atlas_BUTFa7udw6Txh2o0WR25_.js";import{c as ze}from"./atlas_D19uPJlJEUW0ZIz6LBVmW.js";import{c as Oe}from"./atlas_BGAW-w3pSh-yTnmd5tacN.js";import{c as We}from"./atlas_MRX5E0VB7LEQ_ZtO8cyqu.js";import{c as re,D as qe}from"./atlas_DINAM4Lr0jfRHZKx5817c.js";import{E as Ve,c as ce}from"./atlas_DxVg-vol3s6yoC8Upc5Zh.js";import{c as ie,E as Be}from"./atlas_BMCIDSFT2IAf2gtkwieJi.js";import{c as ae,C as Ne}from"./atlas_Cz6jWgcqSXWPZKtJQ_w2t.js";import{c as He,V as Ue}from"./atlas_D0TLelHOSXeqmvoNAWIEQ.js";import{c as je,M as Ye}from"./atlas_-JqT5kPESFcHIKIpyKgUx.js";import{c as Ke,M as Je}from"./atlas_BTtuy0nuLZiBCEww2B85l.js";import{c as oe,A as Qe}from"./atlas_BBosmtQcNkMH9AOEbEMhQ.js";import{c as Xe,S as Ze}from"./atlas_D101bTpT_uK5JoEOFMGnD.js";import{P as K}from"./atlas_fotS74vjilY4HIeqjwtBd.js";import{F as fe}from"./atlas_D-rh6GaF5TEbUIhRsZE3x.js";import{c as Re,O as De}from"./atlas_BtNkzp0DMBCgrTtLuK5Lh.js";import{c as ne,F as es}from"./atlas_CryzSHSCKzr2djs5Bm7w4.js";import{c as de,A as ss}from"./atlas_D9H8bCWtVYeO3kjXNDApP.js";import{c as le,O as ts}from"./atlas_CY8M7rtWUGBzV1aLpPPy2.js";import{c as me,L as rs}from"./atlas_C6Z_yhrNl2nPOPxusWV1F.js";import{c as _e,M as cs}from"./atlas_bTtju4Rhh-pJ-XxJ_a1qj.js";import{c as is,F as as}from"./atlas_n7fSzfs0F7m2O94W0LtYt.js";import{c as os,C as fs}from"./atlas_Bv4rffqgg1gYHQpqA0lxi.js";import{c as ns,R as ds}from"./atlas_KGO4Ud9O9DMtg2_f-ZiFg.js";import{c as ls}from"./atlas_CfbyHVXKYbN9cryE9CrO5.js";import{c as ms,V as _s}from"./atlas_DqNxpagfXWoPy_OB8xJwj.js";import{j as pe,C as J}from"./atlas_C6UiBtzYYNZp5NEn_kUjD.js";const ps=!1;class I{static instance;creators=new Map;effects=new Map;nextId=1;layerSystem;constructor(){this.registerDefaultEffects()}static getInstance(){return I.instance||(I.instance=new I),I.instance}registerDefaultEffects(){this.registerEffect("atmosphere_glow",{create:(e,s)=>new Fe(s,e),fromPythonData:(e,s)=>Z(s,e.atmosphere||{})}),this.registerEffect("atmosphere_clouds",{create:(e,s)=>new U(s,e),fromPythonData:(e,s)=>p(s,e.surface_elements||{},void 0,e.timing?.cosmic_origin_time)}),this.registerEffect("atmospheric_streaks",{create:(e,s)=>new Qe(s,e),fromPythonData:(e,s)=>oe(s,e.atmosphere||{})}),this.registerEffect("atmosphere",{create:(e,s)=>new Te(s,e),fromPythonData:(e,s)=>xe(s,e)}),this.registerEffect("ring_system",{create:(e,s)=>new Pe(s,e),fromPythonData:(e,s)=>Ie(e.rings||{},s)}),this.registerEffect("fragmentation",{create:(e,s)=>new fe(s,e),fromPythonData:(e,s)=>new fe(s,{color:e.surface?.fragment_color||[.3,.3,.3],fragmentCount:e.surface?.fragment_count||20})}),this.registerEffect("land_masses",{create:(e,s)=>new j(s,e),fromPythonData:(e,s)=>h(s,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("ocean_waves",{create:(e,s)=>new De(e),fromPythonData:(e,s)=>Re(e)}),this.registerEffect("aquifer_water",{create:(e,s,i)=>new ss(i,e),fromPythonData:(e,s,i)=>de(i,e)}),this.registerEffect("ocean_currents",{create:(e,s,i)=>new ts(i,e),fromPythonData:(e,s,i)=>le(i,e)}),this.registerEffect("fluid_layers",{create:(e,s)=>new es(s,e),fromPythonData:(e,s)=>ne(s,e)}),this.registerEffect("lava_flows",{create:(e,s)=>new rs(s,e),fromPythonData:(e,s)=>me(s,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("molten_lava",{create:(e,s,i)=>new cs(i,e),fromPythonData:(e,s,i)=>_e(i,e,e.seeds?.planet_seed)}),this.registerEffect("fire_eruption",{create:(e,s)=>new as(s,e),fromPythonData:(e,s,i)=>is(e,s)}),this.registerEffect("carbon_trails",{create:(e,s)=>new fs(s,e),fromPythonData:(e,s,i)=>os(e,s)}),this.registerEffect("radiation_rings",{create:(e,s)=>new ds(s,e),fromPythonData:(e,s)=>ns(s,e,e.seeds?.planet_seed)}),this.registerEffect("crystal_formations",{create:(e,s)=>(console.warn("Crystal formations effect not implemented yet"),null)}),this.registerEffect("star_field",{create:(e,s)=>new Ze(s,e),fromPythonData:(e,s)=>Xe(s,e.seeds?.planet_seed||e.planet_seed)}),this.registerEffect("tundra_snowflakes",{create:(e,s)=>new Ce(s,e),fromPythonData:(e,s)=>D(s,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("river_lines",{create:(e,s)=>new ve(s,e),fromPythonData:(e,s)=>Y(s,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("anomaly_phase_matter",{create:(e,s)=>new Se(s,e),fromPythonData:(e,s)=>Ee(s,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("pulsating_cube",{create:(e,s)=>new Le(s,e),fromPythonData:(e,s)=>{const i=C(e);return $e(s,e.surface_elements||{},e.seeds?.planet_seed,i,e)}}),this.registerEffect("planet_rays",{create:(e,s)=>new ke(s,e),fromPythonData:(e,s)=>Ae(s,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("visual_debug_3d",{create:(e,s)=>new _s(s,e),fromPythonData:(e,s)=>ms(e,s)}),this.registerEffect("diamond_cracks",{create:(e,s)=>new qe({...e,radius:s}),fromPythonData:(e,s)=>re(e,s,e.seeds?.shape_seed||e.seeds?.planet_seed)}),this.registerEffect("exotic_geometric_shapes",{create:(e,s)=>new Ve(s,e),fromPythonData:(e,s)=>{const i=C(e);return ce(s,e.surface_elements||{},e.seeds?.planet_seed,i)}}),this.registerEffect("exotic_doodles",{create:(e,s)=>new Be(s,e),fromPythonData:(e,s)=>ie(s,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("cave_surface_holes",{create:(e,s,i)=>new Ne(s,e),fromPythonData:(e,s,i)=>ae(s,e,e.seeds?.planet_seed)}),this.registerEffect("vegetation",{create:(e,s,i)=>new Ue(s,e),fromPythonData:(e,s,i)=>He(s,e.surface_elements||{},e.seeds?.planet_seed,e.timing?.cosmic_origin_time)}),this.registerEffect("magma_flows",{create:(e,s,i)=>new Ye(s,e),fromPythonData:(e,s,i)=>je(s,e.surface_elements||{},e.seeds?.planet_seed,e.timing?.cosmic_origin_time)}),this.registerEffect("magma_eruptions",{create:(e,s,i)=>new Je(s,e),fromPythonData:(e,s,i)=>Ke(s,e.surface_elements||{},e.seeds?.planet_seed,e.timing?.cosmic_origin_time)})}registerEffect(e,s){this.creators.set(e,s)}createEffect(e,s,i,o,u=0){const a=this.creators.get(e);if(!a)return console.warn(`Effect type '${e}' not registered`),null;try{const l=a.create(s,i,this.layerSystem);if(!l)return null;const y={id:`effect_${this.nextId++}`,type:e,effect:l,priority:u,enabled:!0};return this.effects.set(y.id,y),y}catch(l){return console.error(`Error creating effect '${e}':`,l),null}}createEffectFromPythonData(e,s,i,o,u=0){const a=this.creators.get(e);if(!a||!a.fromPythonData)return this.createEffect(e,s,i,o,u);try{const l=a.fromPythonData(s,i,this.layerSystem);if(!l)return null;const y={id:`effect_${this.nextId++}`,type:e,effect:l,priority:u,enabled:!0};return this.effects.set(y.id,y),y}catch(l){return console.error(`Error creating effect '${e}' from Python data:`,l),null}}createEffectsFromList(e,s,i){const o=[],u=e.sort((a,l)=>(a.priority||0)-(l.priority||0));for(const a of u){const l=this.createEffect(a.type,a.params,s,i,a.priority);l&&(l.enabled=a.enabled!==!1,o.push(l))}return o}createEffectsFromPythonPlanetData(e,s,i,o,u){const a=[];try{const l=C(e);if(u?this.layerSystem=u:this.layerSystem=new Ge(i,l),e.surface_elements){const r=e.surface_elements;if(r.effects_3d&&Array.isArray(r.effects_3d))for(const _ of r.effects_3d){if(_.type==="atmospheric_streaks"){const S=oe(s,_.params,e.seeds?.shape_seed+3e3),b={id:`effect_${this.nextId++}`,type:"atmospheric_streaks",effect:S,priority:_.priority||0,enabled:!0,name:"Atmospheric Streaks"};this.effects.set(b.id,b),a.push(b),S.addToScene(o,i.position);continue}const g=this.createEffect(_.type,_.params,s,i,_.priority||0);g?(g.name=_.type.replace(/_/g," ").replace(/\b\w/g,S=>S.toUpperCase()),a.push(g),g.effect.apply&&g.effect.apply(i),g.effect.addToScene&&g.effect.addToScene(o,i.position)):console.error("❌ FALLO AL CREAR EFECTO:",_.type)}switch(r.type.toLowerCase()){case"gas_giant":if(this.layerSystem){const t=ee(this.layerSystem,{...r,base_color:l,turbulence:e.turbulence||r.turbulence},e.seeds?.shape_seed||e.seeds?.planet_seed||e.seeds?.planet_seed),c=se(this.layerSystem,{...r,base_color:l,storm_intensity:e.storm_intensity||r.storm_intensity},(e.seeds?.shape_seed||e.seeds?.planet_seed)+1e3),f={id:`effect_${this.nextId++}`,type:"cloud_bands_layer",effect:t,priority:0,enabled:!0};this.effects.set(f.id,f),a.push(f);const d={id:`effect_${this.nextId++}`,type:"cloud_gyros_layer",effect:c,priority:1,enabled:!0};if(this.effects.set(d.id,d),a.push(d),r.polar_hexagon&&r.polar_hexagon.enabled){const n=e.timing?.elapsed_time?e.timing.elapsed_time/31557600:0,m=new K({planetColor:l,hexagonData:r.polar_hexagon,planetRadius:s,currentTime:n}),E={id:`effect_${this.nextId++}`,type:"polar_hexagon",effect:m,priority:10,enabled:!0};this.effects.set(E.id,E),a.push(E),o&&m.addToScene(o)}}else console.error("❌ PlanetLayerSystem not initialized!");break;case"frozen_gas_giant":if(this.layerSystem){const t=ee(this.layerSystem,{...r,base_color:l,turbulence:e.turbulence||r.turbulence,icy_tint:!0},e.seeds?.shape_seed||e.seeds?.planet_seed),c={id:`effect_${this.nextId++}`,type:"cloud_bands_layer",effect:t,priority:0,enabled:!0};if(this.effects.set(c.id,c),a.push(c),r.polar_hexagon&&r.polar_hexagon.enabled){const f=e.timing?.elapsed_time?e.timing.elapsed_time/31557600:0,d=new K({planetColor:l,hexagonData:r.polar_hexagon,planetRadius:s,currentTime:f}),n={id:`effect_${this.nextId++}`,type:"polar_hexagon",effect:d,priority:10,enabled:!0};this.effects.set(n.id,n),a.push(n),o&&d.addToScene(o)}}break;case"aquifer":const _=de(this.layerSystem,e);if(_){const t={id:`effect_${this.nextId++}`,type:"aquifer_water",effect:_,priority:2,enabled:!0,name:"Aquifer Water Surface"};this.effects.set(t.id,t),a.push(t)}const g=le(this.layerSystem,e);if(g){const t={id:`effect_${this.nextId++}`,type:"ocean_currents",effect:g,priority:1,enabled:!0,name:"Ocean Currents"};this.effects.set(t.id,t),a.push(t)}if(r.clouds&&r.clouds.length>0){const t=p(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),c={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:t,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}if(r.land_masses&&r.land_masses.length>0){const t=h(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+7e3);if(t){const c={id:`effect_${this.nextId++}`,type:"land_masses",effect:t,priority:3,enabled:!0,name:"Emergent Land Masses"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}}if(r.atmosphere_clouds&&r.atmosphere_clouds.length>0){const t=p(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+8e3,e.timing?.cosmic_origin_time);if(t){const c={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:t,priority:4,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}}break;case"nebulous":if(this.layerSystem){const t=se(this.layerSystem,{...r,base_color:l,storm_intensity:r.nebula_density||.6,color_variance:r.color_variance||.2},(e.seeds?.shape_seed||e.seeds?.planet_seed)+2e3),c={id:`effect_${this.nextId++}`,type:"cloud_gyros_layer",effect:t,priority:0,enabled:!0};if(this.effects.set(c.id,c),a.push(c),r.polar_hexagon&&r.polar_hexagon.enabled){const f=e.timing?.elapsed_time?e.timing.elapsed_time/31557600:0,d=new K({planetColor:l,hexagonData:r.polar_hexagon,planetRadius:s,currentTime:f}),n={id:`effect_${this.nextId++}`,type:"polar_hexagon",effect:d,priority:10,enabled:!0};this.effects.set(n.id,n),a.push(n),o&&d.addToScene(o)}}break;case"metallic":case"metallic_3d":if(this.layerSystem){const t=Oe(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed),c={id:`effect_${this.nextId++}`,type:"metallic_surface_layer",effect:t,priority:0,enabled:!0};this.effects.set(c.id,c),a.push(c)}break;case"diamond":if(this.layerSystem){const t=We(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed),c={id:`effect_${this.nextId++}`,type:"diamond_surface_layer",effect:t,priority:0,enabled:!0};this.effects.set(c.id,c),a.push(c);const f=re(e,s,e.seeds?.shape_seed||e.seeds?.planet_seed),d={id:`effect_${this.nextId++}`,type:"diamond_cracks",effect:f,priority:1,enabled:!0};if(this.effects.set(d.id,d),a.push(d),f.addToScene(o,i.position),r.clouds&&r.clouds.length>0){const n=p(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),m={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:n,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(m.id,m),a.push(m),n.addToScene(o,i.position)}}break;case"rocky":if(this.layerSystem){const t=te(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed,"ROCKY"),c={id:`effect_${this.nextId++}`,type:"rocky_terrain_layer",effect:t,priority:0,enabled:!0};if(this.effects.set(c.id,c),a.push(c),r.clouds&&r.clouds.length>0){const f=p(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),d={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:f,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(d.id,d),a.push(d),f.addToScene(o,i.position)}}break;case"icy":if(this.layerSystem){const t=ze(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed),c={id:`effect_${this.nextId++}`,type:"icy_terrain_layer",effect:t,priority:0,enabled:!0};this.effects.set(c.id,c),a.push(c);const f=we(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+8e3);if(f){const n={id:`effect_${this.nextId++}`,type:"transparent_land_masses",effect:f,priority:1,enabled:!0,name:"Ice Formations"};this.effects.set(n.id,n),a.push(n),f.addToScene(o,i.position)}else console.warn("❄️ Failed to create transparent LandMasses for Icy planet");if(r.clouds&&r.clouds.length>0){const n=p(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),m={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:n,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(m.id,m),a.push(m),n.addToScene(o,i.position)}const d=R(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+9e3);if(d){const n={id:`effect_${this.nextId++}`,type:"icy_features",effect:d,priority:2,enabled:!0,name:"Ice Crystals & Features"};this.effects.set(n.id,n),a.push(n),d.addToScene(o,i.position)}}break;case"oceanic":const S=ne(s,e);if(S){const t={id:`effect_${this.nextId++}`,type:"fluid_layers",effect:S,priority:3,enabled:!0,name:"Fluid Ocean Layers"};this.effects.set(t.id,t),a.push(t),S.addToScene(o,i.position)}if(r.green_patches&&r.green_patches.length>0){const t=h(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3);if(t){const c={id:`effect_${this.nextId++}`,type:"land_masses",effect:t,priority:5,enabled:!0,name:"Land Masses (Islands)"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}}if(r.clouds&&r.clouds.length>0){const t=p(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),c={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:t,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}break;case"tundra":if(r.green_patches&&r.green_patches.length>0){const t=h(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3);if(t){const c={id:`effect_${this.nextId++}`,type:"land_masses",effect:t,priority:5,enabled:!0,name:"Tundra Terrain"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}}const b=R(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+9e3);if(b){const t={id:`effect_${this.nextId++}`,type:"icy_features",effect:b,priority:6,enabled:!0,name:"Snow Patches & Ice"};this.effects.set(t.id,t),a.push(t),b.addToScene(o,i.position)}if(r.clouds&&r.clouds.length>0){const t=p(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),c={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:t,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}const v=D(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+15e3);if(v){const t={id:`effect_${this.nextId++}`,type:"tundra_snowflakes",effect:v,priority:20,enabled:!0,name:"Snowflakes"};this.effects.set(t.id,t),a.push(t),v.addToScene(o,i.position)}break;case"arid":let P;if(r.clouds&&r.clouds.length>0?P=p(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time):P=new U(s,{color:new J(.9,.8,.7),cloudCount:20,size:4.2,opacity:.7,density:1.2,seed:(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,rotationSpeed:.004,movementAmplitude:.012,puffiness:1.3,timeSpeed:1}),P){const t={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:P,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(t.id,t),a.push(t),P.addToScene(o,i.position)}let F;if(r.green_patches&&r.green_patches.length>0){const t={...r,green_patches:r.green_patches.map(c=>({...c,color:[.5,0,0,c.color?.[3]||1]}))};F=h(s,t,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3)}else F=new j(s,{seed:(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3,greenPatches:Array.from({length:25},(t,c)=>{const f=(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3+c*100,d=Math.sin(f)*.5+.5,n=Math.acos(1-2*(c+d)/25),m=2*Math.PI*(c*2.399%1);let E;return c<8?E=.25+d*.25:c<16?E=.15+d*.15:E=.08+d*.12,{position_3d:[Math.sin(n)*Math.cos(m),Math.sin(n)*Math.sin(m),Math.cos(n)],size:E,sides:12+Math.floor(d*16),color:[.5,0,0,.7+d*.2]}})});if(F){const t={id:`effect_${this.nextId++}`,type:"land_masses",effect:F,priority:5,enabled:!0,name:"Arid Terrain"};this.effects.set(t.id,t),a.push(t),F.addToScene(o,i.position)}const L=Y(s,r,e.seeds?.shape_seed||e.seeds?.planet_seed);if(L){const t={id:`effect_${this.nextId++}`,type:"river_lines",effect:L,priority:6,enabled:!0,name:"Dried River Channels"};this.effects.set(t.id,t),a.push(t),L.addToScene(o,i.position)}break;case"molten_core":case"molten core":const Q=_e(this.layerSystem,e);if(Q){const t={id:`effect_${this.nextId++}`,type:"molten_lava",effect:Q,priority:2,enabled:!0,name:"Molten Lava Surface"};this.effects.set(t.id,t),a.push(t)}const $=me(s,r,(e.seeds?.planet_seed||e.seeds?.shape_seed)+9e3);if($){const t={id:`effect_${this.nextId++}`,type:"lava_flows",effect:$,priority:4,enabled:!0,name:"Lava Flows & Fire Whips"};this.effects.set(t.id,t),a.push(t),$.addToScene(o,i.position)}const A=this.createEffectFromPythonData("fire_eruption",e,s,i)?.effect;if(A){const t={id:`effect_${this.nextId++}`,type:"fire_eruption",effect:A,priority:15,enabled:!0,name:"Fire Eruptions"};this.effects.set(t.id,t),a.push(t),A.addToScene(o,i.position)}if(r.green_patches&&r.green_patches.length>0){const t={...r,green_patches:r.green_patches.map(f=>({...f,color:[1,.55,0,f.color?.[3]||.9]}))},c=h(s,t,(e.seeds?.planet_seed||e.seeds?.shape_seed)+1e4);if(c){const f={id:`effect_${this.nextId++}`,type:"land_masses",effect:c,priority:3,enabled:!0,name:"Incandescent Land Masses"};this.effects.set(f.id,f),a.push(f),c.addToScene(o,i.position)}}if(r.clouds&&r.clouds.length>0){const t=p(s,r,(e.seeds?.planet_seed||e.seeds?.shape_seed)+4e3,e.timing?.cosmic_origin_time),c={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:t,priority:15,enabled:!0,name:"Molten Atmospheric Clouds"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}break;case"exotic":if(r.clouds&&r.clouds.length>0){const t=p(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),c={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:t,priority:15,enabled:!0,name:"Exotic Atmospheric Clouds"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}const k=ce(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+5e3,l);if(k){const t={id:`effect_${this.nextId++}`,type:"exotic_geometric_shapes",effect:k,priority:10,enabled:!0,name:"Exotic Geometric Shapes"};this.effects.set(t.id,t),a.push(t),k.addToScene(o,i.position)}const G=ie(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3,e);if(G){const t={id:`effect_${this.nextId++}`,type:"exotic_doodles",effect:G,priority:12,enabled:!0,name:"Exotic Doodles"};this.effects.set(t.id,t),a.push(t),G.addToScene(o,i.position)}break;case"cave":let x;if(r.atmosphere_clouds&&r.atmosphere_clouds.clouds&&r.atmosphere_clouds.clouds.length>0?x=p(s,r.atmosphere_clouds,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time):x=new U(s,{color:new J(.75,.75,.75),cloudCount:12,size:3.5,opacity:.65,density:.8,seed:(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,rotationSpeed:.003,movementAmplitude:.008,puffiness:1.1,timeSpeed:.8}),x){const t={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:x,priority:15,enabled:!0,name:"Cave Atmospheric Clouds"};this.effects.set(t.id,t),a.push(t),x.addToScene(o,i.position)}let T;if(r.green_patches&&r.green_patches.length>0)T=h(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+5e3);else{const t=new be((e.seeds?.shape_seed||e.seeds?.planet_seed)+5e3),c=[];for(let f=0;f<10;f++){const d=t.random()*2*Math.PI,n=Math.acos(t.random()*2-1);let m;f<3?m=.2+t.random()*.2:f<7?m=.12+t.random()*.13:m=.08+t.random()*.07,c.push({position_3d:[Math.sin(n)*Math.cos(d),Math.sin(n)*Math.sin(d),Math.cos(n)],size:m,sides:12+Math.floor(t.random()*8),color:[.29,.25,.21,.75+t.random()*.15]})}T=new j(s,{greenPatches:c,seed:(e.seeds?.shape_seed||e.seeds?.planet_seed)+5e3})}if(T){const t={id:`effect_${this.nextId++}`,type:"land_masses",effect:T,priority:5,enabled:!0,name:"Cave Land Masses"};this.effects.set(t.id,t),a.push(t),T.addToScene(o,i.position)}if(this.layerSystem){const t=te(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed,"CAVE"),c={id:`effect_${this.nextId++}`,type:"rocky_terrain_layer",effect:t,priority:1,enabled:!0,name:"Cave Rocky Terrain"};this.effects.set(c.id,c),a.push(c)}const M=ae(s,e,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3);if(M){const t={id:`effect_${this.nextId++}`,type:"cave_surface_holes",effect:M,priority:10,enabled:!0,name:"Cave Surface Holes"};if(this.effects.set(t.id,t),a.push(t),M.addToScene(o,i.position),this.layerSystem){const c=this.layerSystem.baseMaterial?.uniforms?.baseColor?.value||new J(9127187);M.applyToPlanetSystem(this.layerSystem,c)}}const z=Y(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+7e3);if(z){const t={id:`effect_${this.nextId++}`,type:"river_lines",effect:z,priority:8,enabled:!0,name:"Cave Drainage Channels"};this.effects.set(t.id,t),a.push(t),z.addToScene(o,i.position)}break;case"anomaly":const X=["anomaly_phase_matter","pulsating_cube","planet_rays"],he=e.seeds?.planet_seed||Math.floor(Math.random()*1e6),ye=X.length;for(let t=0;t<ye;t++){const c=X[t],f=he+t*1e4,d=this.createEffectFromPythonData(c,{...e,seeds:{...e.seeds,planet_seed:f}},s,i,10+t);d&&(d.name=c.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase()),a.push(d),d.effect.addToScene&&d.effect.addToScene(o,i.position))}if(e.atmosphere&&e.atmosphere.type!=="None"){const t=this.createEffectFromPythonData("atmosphere",e.atmosphere,s,i,5);t&&(a.push(t),t.effect.addToScene(o,i.position))}break;case"carbon":if(r.clouds&&r.clouds.length>0){const t=p(s,r,(e.seeds?.planet_seed||e.seeds?.shape_seed)+4e3,e.timing?.cosmic_origin_time),c={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:t,priority:15,enabled:!0,name:"Carbon Atmospheric Dust"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}if(r.green_patches&&r.green_patches.length>0){const t={...r,green_patches:r.green_patches.map(f=>({...f,color:[.1,.07,.06,f.color?.[3]||.9],size:(f.size||.1)*1.5}))},c=h(s,t,(e.seeds?.planet_seed||e.seeds?.shape_seed)+6e3);if(c){const f={id:`effect_${this.nextId++}`,type:"land_masses",effect:c,priority:5,enabled:!0,name:"Carbon Formations"};this.effects.set(f.id,f),a.push(f),c.addToScene(o,i.position)}}const O=Me(s,r,(e.seeds?.planet_seed||e.seeds?.shape_seed)+15e3);if(O){const t={id:`effect_${this.nextId++}`,type:"tundra_snowflakes",effect:O,priority:20,enabled:!0,name:"Carbon Dust Particles"};this.effects.set(t.id,t),a.push(t),O.addToScene(o,i.position)}const W=this.createEffectFromPythonData("carbon_trails",e,s,i);if(W){const t={id:`effect_${this.nextId++}`,type:"carbon_trails",effect:W.effect,priority:25,enabled:!0,name:"Carbon Gas Trails"};this.effects.set(t.id,t),a.push(t),W.effect.addToScene(o,i.position)}break;case"forest":const q=this.createEffectFromPythonData("vegetation",e,s,i);if(q){const t={id:`effect_${this.nextId++}`,type:"vegetation",effect:q.effect,priority:10,enabled:!0,name:"Forest Vegetation"};this.effects.set(t.id,t),a.push(t),q.effect.addToScene(o,i.position)}if(r.clouds&&r.clouds.length>0){const t=p(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time);if(t){const c={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:t,priority:15,enabled:!0,name:"Forest Atmospheric Clouds"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}}if(r.green_patches&&r.green_patches.length>0){const t={...r,green_patches:r.green_patches.map(f=>({...f,size:(f.size||.1)*1.5,color:f.color||[.2,.4,.1,1]}))},c=h(s,t,(e.seeds?.planet_seed||e.seeds?.shape_seed)+6e3);if(c){const f={id:`effect_${this.nextId++}`,type:"land_masses",effect:c,priority:5,enabled:!0,name:"Forest Land Masses"};this.effects.set(f.id,f),a.push(f),c.addToScene(o,i.position)}}break;case"magma":const V=this.createEffectFromPythonData("magma_flows",e,s,i);if(V){const t={id:`effect_${this.nextId++}`,type:"magma_flows",effect:V.effect,priority:12,enabled:!0,name:"Magma Flows & Lakes"};this.effects.set(t.id,t),a.push(t),V.effect.addToScene(o,i.position)}const B=this.createEffectFromPythonData("magma_eruptions",e,s,i);if(B){const t={id:`effect_${this.nextId++}`,type:"magma_eruptions",effect:B.effect,priority:13,enabled:!0,name:"Magma Eruptions & Arcs"};this.effects.set(t.id,t),a.push(t),B.effect.addToScene(o,i.position)}if(r.clouds&&r.clouds.length>0){const t=p(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time);if(t){const c={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:t,priority:15,enabled:!0,name:"Magma Atmospheric Clouds"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}}if(r.green_patches&&r.green_patches.length>0){const t=h(s,r,(e.seeds?.planet_seed||e.seeds?.shape_seed)+6e3);if(t){const c={id:`effect_${this.nextId++}`,type:"land_masses",effect:t,priority:5,enabled:!0,name:"Magmatic Land Masses"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}}break;case"radioactive":if(r.clouds&&r.clouds.length>0){const t=p(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+5e3,e.timing?.cosmic_origin_time),c={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:t,priority:15,enabled:!0,name:"Radioactive Toxic Clouds"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}if(r.green_patches&&r.green_patches.length>0){const t=h(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3);if(t){const c={id:`effect_${this.nextId++}`,type:"land_masses",effect:t,priority:10,enabled:!0,name:"Radioactive Contaminated Areas"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}}const N=this.createEffectFromPythonData("radiation_rings",e,s,i);if(N){const t={id:`effect_${this.nextId++}`,type:"radiation_rings",effect:N.effect,priority:21,enabled:!0,name:"Radioactive Surface Rings"};this.effects.set(t.id,t),a.push(t),N.effect.addToScene(o,i.position)}break;case"super_earth":if(r.clouds&&r.clouds.length>0){const t=p(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+8e3,e.timing?.cosmic_origin_time);if(t){const c={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:t,priority:15,enabled:!0,name:"Super Earth Dense Atmosphere"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}}if(r.green_patches&&r.green_patches.length>0){const t=h(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+9e3);if(t){const c={id:`effect_${this.nextId++}`,type:"land_masses",effect:t,priority:5,enabled:!0,name:"Super Earth Massive Continents"};this.effects.set(c.id,c),a.push(c),t.addToScene(o,i.position)}}const H=ls(s,r,(e.seeds?.shape_seed||e.seeds?.planet_seed)+11e3);if(H){const t={id:`effect_${this.nextId++}`,type:"super_earth_water_features",effect:H,priority:6,enabled:!0,name:"Super Earth Water Features"};this.effects.set(t.id,t),a.push(t),H.addToScene(o,i.position)}break;default:if(e.planet_info?.type?.toLowerCase()==="anomaly"){const c=["anomaly_phase_matter","pulsating_cube","planet_rays"],f=e.seeds?.planet_seed||Math.floor(Math.random()*1e6),d=c.length;for(let n=0;n<d;n++){const m=c[n],E=f+n*1e4,w=this.createEffectFromPythonData(m,{...e,seeds:{...e.seeds,planet_seed:E}},s,i,10+n);w&&(w.name=m.replace(/_/g," ").replace(/\b\w/g,ge=>ge.toUpperCase()),a.push(w),w.effect.addToScene&&w.effect.addToScene(o,i.position))}if(e.atmosphere&&e.atmosphere.type!=="None"){const n=this.createEffectFromPythonData("atmosphere",e.atmosphere,s,i,5);n&&(a.push(n),n.effect.addToScene(o,i.position))}}else if(i.material instanceof pe){const t=C(e);i.material.color.copy(t)}break}}else if(i.material instanceof pe){const r=C(e);i.material.color.copy(r)}const y=e.planet_info?.type?.toLowerCase()||e.surface_elements?.type?.toLowerCase(),ue=y==="anomaly"||e.surface_elements?.type==="anomaly";if(e.atmosphere&&!ue){if(e.atmosphere.streaks||["Gas Giant","Frozen Gas Giant"].includes(e.planet_info?.type)){const r=Z(s,e.atmosphere||{},e.seeds?.shape_seed+2e3);if(r){const _={id:`effect_${this.nextId++}`,type:"atmosphere_glow",effect:r,priority:20,enabled:!0};this.effects.set(_.id,_),a.push(_),r.addToScene(o,i.position)}}if(e.atmosphere.type&&e.atmosphere.type!=="None"){const r={...e.atmosphere};y==="oceanic"&&(r.opacity=Math.min(r.opacity||.3,.15),r.width=Math.min(r.width||15,8));const _=this.createEffectFromPythonData("atmosphere",r,s,i,5);_&&(a.push(_),_.effect.addToScene(o,i.position))}}if(e.rings&&e.rings.has_rings||["Gas Giant","Frozen Gas Giant","Super Earth"].includes(e.planet_info?.type)){const r=this.createEffectFromPythonData("ring_system",e,s,i,1);r?(a.push(r),r.effect.addToScene(o,i.position)):console.warn("⚠️ Failed to create ring effect")}if(e.surface_elements?.has_fragmentation_zones){const r=this.createEffectFromPythonData("fragmentation",e,s,i,5);r&&(a.push(r),r.effect.addToScene(o,i.position))}this.layerSystem&&this.layerSystem.addToScene(o);try{const r=this.createEffectFromPythonData("star_field",e,s,i,-100);r&&r.effect&&(r.effect.addToScene(o,i.position),a.push(r))}catch(r){console.warn("Could not create StarField:",r)}return a.forEach((r,_)=>{}),a.length===0&&console.warn("⚠️ NO EFFECTS WERE CREATED! Check the data structure and conditions."),a}catch(l){throw console.error("Error in EffectRegistry.createEffectsFromPythonPlanetData:",l),l}}getEffect(e){return this.effects.get(e)||null}getEffectsByType(e){return Array.from(this.effects.values()).filter(s=>s.type===e)}getAllEffects(){return Array.from(this.effects.values())}toggleEffect(e,s){const i=this.effects.get(e);if(i){i.enabled=s!==void 0?s:!i.enabled;const o=i.effect;if(o&&o.getObject3D){const u=o.getObject3D();u&&(u.visible=i.enabled)}if(this.layerSystem){const u=this.layerSystem.getLayerMeshes(),l={cloud_bands_layer:"cloudBands",cloud_gyros_layer:"cloudGyros",metallic_surface_layer:"metallicSurface",diamond_surface_layer:"diamondSurface",rocky_terrain_layer:"rockyTerrain",icy_terrain_layer:"icyTerrain",aquifer_water:"aquiferWater",ocean_currents:"oceanCurrents",molten_lava:"moltenLava"}[i.type];l&&u[l]&&(u[l].visible=i.enabled)}}else console.warn(`⚠️ Effect not found: ${e}`)}updateAllEffects(e,s){this.layerSystem&&this.layerSystem.update(e,s);for(const i of this.effects.values())if(i.enabled&&i.effect.update)try{i.effect.update(e,s)}catch(o){console.error(`Error updating effect ${i.type}:`,o)}}updateLightForAllEffects(e){this.layerSystem&&this.layerSystem.updateFromThreeLight(e);for(const s of this.effects.values())if(s.enabled&&s.effect.updateFromThreeLight)try{s.effect.updateFromThreeLight(e)}catch(i){console.error(`Error updating light for effect ${s.type}:`,i)}}removeEffect(e){const s=this.effects.get(e);s&&(s.effect.dispose&&s.effect.dispose(),this.effects.delete(e))}clearAllEffects(){this.layerSystem&&(this.layerSystem.dispose(),this.layerSystem=void 0);for(const e of this.effects.values())e.effect.dispose&&e.effect.dispose();this.effects.clear(),this.nextId=1}getStats(){const e=Array.from(this.effects.values());return{registeredTypes:this.creators.size,activeEffects:e.length,enabledEffects:e.filter(s=>s.enabled).length}}getAvailableEffectTypes(){return Array.from(this.creators.keys())}}const st=I.getInstance();export{st as e};
