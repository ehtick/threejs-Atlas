import{r as s,j as e,a as qe,c as st,R as nt}from"./atlas_BSujyM3STIIs7ogMAeFeS.js";import{R as Ke,L as rt,d as at,e as ot,f as ze,M as it,F as lt,H as ct,a as dt}from"./atlas_CamEFqmJHciALUfcRd9gd.js";import{W as _e}from"./atlas_XGSDCzrG-pjJUG7P8pQ46.js";import{a5 as Ge,C as Oe,a6 as Ve,G as $e,b as he,z as xe,M as pe,V as Me,B as Be,a2 as We,o as Ye,cL as He,y as Ue,v as Ze,cM as Je,cN as Qe,I as Ie}from"./atlas_S2gaYUaVDGx2fzGLEfKud.js";import{R as mt,S as ut,M as ht,a as Te,D as xt,b as pt,c as ft}from"./atlas_BCKGl-FCiTQJBn96MMVjn.js";import{S as Xe,a as gt,b as bt,E as wt}from"./atlas_C5BIzlNijw3pAI5GjgnTd.js";import{O as vt}from"./atlas_D_U2TZ8CYBU6mWNRLKbuk.js";import{S as ke,C as yt}from"./atlas_DkUe-H4NvZWgmB_LGrx9T.js";import{V as Ft}from"./atlas_DFpgC65o32Sm57XjKQ2G5.js";import{T as jt,D as Nt}from"./atlas_qCPVmroG4oNgbykKwNamR.js";import{G as Et}from"./atlas_UeK9Hy31EVbKuhJ8jkBWr.js";import"./atlas_BrYhsyGbdfinGesBjh40k.js";import"./atlas_DhYLk9xu4Hn3qb7qcWDa_.js";import"./atlas_XeJvk2NHk9pvQBQNpBJiW.js";import"./atlas_nEeIqfFouBkG-lfgz55PI.js";import"./atlas_ChU1OZn73_ret8fa2ScFF.js";import"./atlas_LS1CRdxBlz8anFyzP-o4h.js";import"./atlas_CO_10RTS9xO9UpIIJCwlx.js";import"./atlas_CeFkr8QgH_SccGFLiJ0HS.js";import"./atlas_CSmsl7SqrbFcQ9sQMHAx4.js";import"./atlas_DudFzZ5I17UI3NsGmP1Fc.js";import"./atlas_DWKWZ5kthcgPjGQ2Wo2LT.js";import"./atlas_CDYEnrGsRx_wwk0tbL6zz.js";import"./atlas_D9NfKou0mXPyCo66aiXAf.js";import"./atlas_DW8kOfd2r41E9V7f3QrTC.js";import"./atlas_IQ72mvJMYHB5jxjSku4yG.js";import"./atlas_B7nfVtdCEC1XYhTi8ViLE.js";import"./atlas_-3HiC_x_SNXjkLB6C4QP7.js";import"./atlas_Byi4SCjpCxmMouP_9SBg4.js";import"./atlas_DashPGmj9yF_f6-NcBkjR.js";import"./atlas_DEHj5KFmDxgx9LOVr4b7h.js";import"./atlas_NE84I3VVQuBFOMSOV7kxx.js";import"./atlas_Cfdi4am9q5wdgUkgR0N98.js";import"./atlas_a19_zJpOkKcCijtbF8oOK.js";import"./atlas_BNksjYrNRRtm4JZDMUwTb.js";import"./atlas_DwPODjRfWit9sDH_fm0tF.js";import"./atlas_sg-4cSA_Tl1d40z7DJgjJ.js";import"./atlas_Csrq49YNffS2Izpn0aEeR.js";import"./atlas_CC-_HR1mTNQw2XW9_EW4Z.js";import"./atlas_Bk5FLo6Elp_UFF7DyHwbc.js";import"./atlas_Btgn615SfzpL-sXE2hmO0.js";import"./atlas_CTaNyFROgdbvGQcUhKCL-.js";import"./atlas_B48C6ffkEhLWrj9QIhgV9.js";import"./atlas_C3IgHzAkE4yzF15MnrSpK.js";import"./atlas_CaXkQ_FUi8-tYtHDoL0ke.js";import"./atlas_BYjz_umZO8RJsnPrkpCtp.js";import"./atlas_93AQvJS-gt0IA7mnr1VrP.js";import"./atlas_bvX41TYwe13qrecz9iv2p.js";import"./atlas_CtdZllMRGhud7oRu-1xQY.js";import"./atlas_DDfTK_RJ6W8qLG8p-30d7.js";import"./atlas_DUgih18lyo_1tpe1Pamoo.js";import"./atlas_D8jM-c0-1URlThnpQiFR9.js";import"./atlas_D0Vqc-K20opkzY0JiOJ9s.js";import"./atlas_Ck47_zUWlSp5-o1-2Ydtq.js";import"./atlas_y9KbmJin1oEheLLl3-fFM.js";import"./atlas_B80hD1fMN_SBhij1cE9_v.js";import"./atlas_DgU80w_OxPhfLBwmSASww.js";import"./atlas_BD3Qo2KQOSdX1sIrjFRF1.js";import"./atlas_BfmvW8jFQdK_RvjQZCsA6.js";import"./atlas_ydN86Ri2qoAPaorA3C-Id.js";import"./atlas_zK8LlPrkYRbv-GlFsCmm0.js";import"./atlas_B54ugi6BhqofgGtIPWnI1.js";import"./atlas_BoW_ITJwi5HbX1a-1u71i.js";import"./atlas_nNRAZlXsRs7ZKHtJoMUGQ.js";import"./atlas_CtWAN5h_nVGTF6YXGQMtR.js";import"./atlas_BjQsxep0Cm0Sl3t3u5lf7.js";import"./atlas_BNHJ6aWi1b_rytD4uhAmB.js";import"./atlas_Dtrmf1_lMQ9_aCLozWSkD.js";import"./atlas_0ecw89cApIs9Dkin9BzPt.js";const et=({planets:n,stars:m,systemName:g,cosmicOriginTime:C,currentTime:E,onTimeOffsetChange:z})=>{const k=s.useRef(null),y=s.useRef(null),l=s.useRef(null),A=s.useRef(null),P=s.useRef([]),I=s.useRef([]),R=s.useRef([]),d=s.useRef(0),B=(L,ae="#ffffff")=>{const _=document.createElement("canvas"),w=_.getContext("2d");if(!w)return null;_.width=768,_.height=192,w.fillStyle="rgba(0, 0, 0, 0.8)",w.fillRect(0,0,_.width,_.height),w.strokeStyle="#ffffff",w.lineWidth=3,w.strokeRect(3,3,_.width-6,_.height-6),w.fillStyle=ae,w.font="bold 48px Arial",w.textAlign="center",w.textBaseline="middle",w.fillText(L,384,96);const h=new Ze(_),W=new Je({map:h,transparent:!0,alphaTest:.1}),K=new Qe(W);return K.scale.set(30,7.5,1),K};return d.current=E,s.useEffect(()=>{if(!k.current)return;const L=k.current,ae=L.clientWidth,_=L.clientHeight,w=new Ge;w.background=new Oe(17),y.current=w;const h=new Ve(60,ae/_,.1,1e4);h.position.set(0,120,180),h.lookAt(0,0,0);const W=new _e({antialias:!0,alpha:!0});W.setSize(ae,_),W.setClearColor(17,1),l.current=W,L.appendChild(W.domElement);const K={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},me={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},H=new $e;m.forEach((t,x)=>{const c=parseFloat(t.Size)*4,o=new he(c,32,32),J=me[t.Color]||"#FFFF44",X=new xe({color:J,transparent:!0,opacity:.9}),u=new pe(o,X);m.length===1?u.position.set(0,0,0):m.length===2?u.position.set(x===0?-c*2:c*2,0,0):x===0?u.position.set(-c*2,0,0):x===1?u.position.set(c*2,0,0):u.position.set(0,c*2,0);const b=new he(c*1.5,32,32),$=new xe({color:J,transparent:!0,opacity:.3}),q=new pe(b,$);u.add(q),H.add(u)}),w.add(H);const be=Math.max(...n.map(t=>t.orbital_radius)),ie=150;n.forEach((t,x)=>{const o=30+t.orbital_radius/be*ie,J=t.eccentricity_factor,X=o,u=X*Math.sqrt(1-J*J),b=360,$=2,q=4;for(let Q=0;Q<b;Q+=$+q){const G=[];for(let Y=Q;Y<Math.min(Q+$,b-1);Y++){const O=Y/b*2*Math.PI,ee=X*Math.cos(O),ue=u*Math.sin(O);G.push(new Me(ee,0,ue))}if(G.length>1){const Y=new Be().setFromPoints(G),O=new We({color:7372944,transparent:!0,opacity:.8,linewidth:2}),ee=new Ye(Y,O);w.add(ee),I.current.push(ee)}}const se=t.diameter/8e3,f=Math.max(Math.min(se,8),2.5),de=new he(f,32,32),re=K[t.planet_type]||"#FFFFFF",a=new xe({color:re,transparent:!0,opacity:.9}),p=new pe(de,a),i=new pe(new he(f*1.5,32,32),new xe({color:re,transparent:!0,opacity:.2}));p.add(i),w.add(p),P.current.push(p),p.planetData=t,p.orbitRadius=o,p.semiMajorAxis=X,p.semiMinorAxis=u;const j=t.name.replace(/_/g," "),N=B(j,"#ffffff");N&&(N.position.copy(p.position),N.position.y+=f+10,N.planetData=t,w.add(N),R.current.push(N))});const M=new He(4210752,.4);w.add(M);const U=new Ue(16777215,1,2e3);U.position.set(0,0,0),w.add(U);let le=!1,ce=0,oe=0,we=0;const Ee=t=>{le=!0,ce=t.clientX,oe=t.clientY},ne=t=>{if(!le)return;const x=t.clientX-ce,c=t.clientY-oe,o=new Ie;o.setFromVector3(h.position),o.theta-=x*.01,o.phi+=c*.01,o.phi=Math.max(.1,Math.min(Math.PI-.1,o.phi)),h.position.setFromSpherical(o),h.lookAt(0,0,0),ce=t.clientX,oe=t.clientY},v=()=>{le=!1,setTimeout(()=>{},3e3)},D=t=>{if(t.ctrlKey)t.preventDefault(),t.deltaY>0?z(604800):z(-604800);else{t.preventDefault();const x=.1,c=h.position.distanceTo(new Me(0,0,0));t.deltaY>0&&c<800?h.position.multiplyScalar(1+x):t.deltaY<0&&c>50&&h.position.multiplyScalar(1-x)}},S=t=>{t.key==="Escape"&&document.dispatchEvent(new CustomEvent("solar-system-close-fullscreen"))},F=t=>{if(t.preventDefault(),t.touches.length===1)le=!0,ce=t.touches[0].clientX,oe=t.touches[0].clientY;else if(t.touches.length===2){const x=t.touches[0].clientX-t.touches[1].clientX,c=t.touches[0].clientY-t.touches[1].clientY;we=Math.sqrt(x*x+c*c)}},te=t=>{if(t.preventDefault(),t.touches.length===1&&le){const x=t.touches[0].clientX-ce,c=t.touches[0].clientY-oe,o=new Ie;o.setFromVector3(h.position),o.theta-=x*.01,o.phi+=c*.01,o.phi=Math.max(.1,Math.min(Math.PI-.1,o.phi)),h.position.setFromSpherical(o),h.lookAt(0,0,0),ce=t.touches[0].clientX,oe=t.touches[0].clientY}else if(t.touches.length===2){const x=t.touches[0].clientX-t.touches[1].clientX,c=t.touches[0].clientY-t.touches[1].clientY,o=Math.sqrt(x*x+c*c);if(we>0){const X=o/we,u=h.position.distanceTo(new Me(0,0,0));X>1&&u>50?h.position.multiplyScalar(1-.01):X<1&&u<800&&h.position.multiplyScalar(1+.01)}we=o}},Z=t=>{t.preventDefault(),le=!1,we=0,setTimeout(()=>{},3e3)},r=W.domElement;r.style.cursor="grab",r.addEventListener("mousedown",t=>{r.style.cursor="grabbing",Ee(t)}),r.addEventListener("mousemove",ne),r.addEventListener("mouseup",()=>{r.style.cursor="grab",v()}),r.addEventListener("mouseleave",()=>{r.style.cursor="grab",v()}),r.addEventListener("wheel",D),r.addEventListener("touchstart",F,{passive:!1}),r.addEventListener("touchmove",te,{passive:!1}),r.addEventListener("touchend",Z,{passive:!1}),document.addEventListener("keydown",S);const T=()=>{A.current=requestAnimationFrame(T),P.current.forEach((t,x)=>{const c=t.planetData,o=t.semiMajorAxis,J=t.semiMinorAxis,X=c.orbital_period_seconds,u=2*Math.PI/X,b=(c.initial_orbital_angle+d.current*u)%(2*Math.PI);t.position.x=o*Math.cos(b),t.position.z=J*Math.sin(b),t.position.y=0;const $=c.rotation_period_seconds,q=2*Math.PI/$;if(t.rotation.y=d.current*q%(2*Math.PI),R.current[x]){const se=t.geometry.parameters?.radius||2;R.current[x].position.copy(t.position),R.current[x].position.y+=se+10}}),W.render(w,h)};T();const V=()=>{const t=L.clientWidth,x=L.clientHeight;h.aspect=t/x,h.updateProjectionMatrix(),W.setSize(t,x)};return window.addEventListener("resize",V),()=>{window.removeEventListener("resize",V),document.removeEventListener("keydown",S),r.removeEventListener("mousedown",Ee),r.removeEventListener("mousemove",ne),r.removeEventListener("mouseup",v),r.removeEventListener("mouseleave",v),r.removeEventListener("wheel",D),r.removeEventListener("touchstart",F),r.removeEventListener("touchmove",te),r.removeEventListener("touchend",Z),A.current&&cancelAnimationFrame(A.current),L&&W.domElement&&L.removeChild(W.domElement),W.dispose(),P.current=[],I.current=[],R.current=[]}},[n,m,C]),e.jsx("div",{ref:k,className:"w-full h-full"})},St=({planets:n,stars:m,systemName:g,cosmicOriginTime:C})=>{const E=s.useRef(null),z=s.useRef(null),k=s.useRef(null),y=s.useRef(null),l=s.useRef([]),A=s.useRef([]),P=s.useRef([]),I=s.useRef(0),R=Math.floor(Date.now()/1e3),[d,B]=s.useState(0),[L,ae]=s.useState(!1),[_,w]=s.useState(!1),[h,W]=s.useState(!1),[K,me]=s.useState(0),[H,be]=s.useState(null),[ie,M]=s.useState(!0),[U,le]=s.useState(null),ce=R-C+d;I.current=ce,s.useEffect(()=>{(async()=>{try{M(!0),le(null);const D=await fetch("/api/system/rendering-data");if(!D.ok)throw new Error(`HTTP error! status: ${D.status}`);const S=await D.json();if(S.success)be(S.system_data);else throw new Error(S.error||"Failed to fetch system data")}catch(D){le(D instanceof Error?D.message:"Unknown error")}finally{M(!1)}})()},[]);const oe=()=>{w(!0),setTimeout(()=>{ae(!1),w(!1)},300)},we=(v,D="#ffffff")=>{const S=document.createElement("canvas"),F=S.getContext("2d");if(!F)return null;S.width=512,S.height=128,F.fillStyle="rgba(0, 0, 0, 0.7)",F.fillRect(0,0,S.width,S.height),F.strokeStyle="#ffffff",F.lineWidth=2,F.strokeRect(2,2,S.width-4,S.height-4),F.fillStyle=D,F.font="bold 32px Arial",F.textAlign="center",F.textBaseline="middle",F.fillText(v,256,64);const te=new Ze(S),Z=new Je({map:te,transparent:!0,alphaTest:.1}),r=new Qe(Z);return r.scale.set(20,5,1),r};s.useEffect(()=>{const v=D=>{D.key==="Escape"&&L&&oe()};return L&&me(d),document.addEventListener("solar-system-close-fullscreen",oe),document.addEventListener("keydown",v),()=>{document.removeEventListener("solar-system-close-fullscreen",oe),document.removeEventListener("keydown",v)}},[L,d]),s.useEffect(()=>{if(L&&h){const v=setTimeout(()=>{W(!1)},50);return()=>clearTimeout(v)}},[L,h]),s.useEffect(()=>{if(ie||!H||(window.tonnirLoggedInSystem=!1,!E.current))return;const v=E.current,D=v.clientWidth,S=D<640,F=new Ge;F.background=new Oe(17),z.current=F;const te=new Ve(45,D/120,.1,1e4);te.position.set(0,80,120),te.lookAt(0,0,0);const Z=new _e({antialias:!0,alpha:!0});Z.setSize(D,120),Z.setClearColor(17,1),k.current=Z,v.appendChild(Z.domElement);const r={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},T={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},V=new $e;H.stars.forEach((a,p)=>{const i=parseFloat(a.Size)*3,j=new he(i,16,16),N=T[a.Color]||"#FFFF44",Q=new xe({color:N,transparent:!0,opacity:.9}),G=new pe(j,Q);H.stars.length===1?G.position.set(0,0,0):H.stars.length===2?G.position.set(p===0?-i*2:i*2,0,0):p===0?G.position.set(-i*2,0,0):p===1?G.position.set(i*2,0,0):G.position.set(0,i*2,0);const Y=new he(i*1.5,16,16),O=new xe({color:N,transparent:!0,opacity:.3}),ee=new pe(Y,O);G.add(ee),V.add(G)}),F.add(V);const t=H.timing.max_orbital_radius,x=80;window.systemMaxOrbitalRadius=t,H.planets.forEach((a,p)=>{const j=20+a.orbital_radius/t*x,N=a.eccentricity_factor,Q=j,G=Q*Math.sqrt(1-N*N),Y=360,O=2,ee=4;for(let Fe=0;Fe<Y;Fe+=O+ee){const Ce=[];for(let ge=Fe;ge<Math.min(Fe+O,Y-1);ge++){const je=ge/Y*2*Math.PI,Ne=Q*Math.cos(je),Pe=G*Math.sin(je);Ce.push(new Me(Ne,0,Pe))}if(Ce.length>1){const ge=new Be().setFromPoints(Ce),je=new We({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Ne=new Ye(ge,je);F.add(Ne),A.current.push(Ne)}}const ue=a.diameter/15e3,ve=Math.max(Math.min(ue,4),1.5),Le=new he(ve,16,16),Re=r[a.planet_type]||"#FFFFFF",De=new xe({color:Re,transparent:!0,opacity:.9}),fe=new pe(Le,De),Ae=new pe(new he(ve*1.5,16,16),new xe({color:Re,transparent:!0,opacity:.2}));fe.add(Ae),F.add(fe),l.current.push(fe),fe.planetData=a,fe.orbitRadius=j,fe.semiMajorAxis=Q,fe.semiMinorAxis=G;const ye=a.name.replace(/_/g," "),Se=we(ye,"#ffffff");Se&&(Se.position.copy(fe.position),Se.position.y+=ve+6,Se.planetData=a,F.add(Se),P.current.push(Se))});const c=new He(4210752,.4);F.add(c);const o=new Ue(16777215,1,1e3);o.position.set(0,0,0),F.add(o);let J=!1,X=0,u=0;const b=a=>{J=!0,X=a.clientX,u=a.clientY},$=a=>{if(!J)return;const p=a.clientX-X,i=a.clientY-u,j=new Ie;j.setFromVector3(te.position),j.theta-=p*.01,j.phi+=i*.01,j.phi=Math.max(.1,Math.min(Math.PI-.1,j.phi)),te.position.setFromSpherical(j),te.lookAt(0,0,0),X=a.clientX,u=a.clientY},q=()=>{J=!1,setTimeout(()=>{},3e3)},se=a=>{if(a.ctrlKey)a.preventDefault(),a.deltaY>0?B(p=>p+604800):B(p=>p-604800);else{a.preventDefault();const p=.1,i=te.position.distanceTo(new Me(0,0,0));a.deltaY>0&&i<500?te.position.multiplyScalar(1+p):a.deltaY<0&&i>20&&te.position.multiplyScalar(1-p)}},f=Z.domElement;f.style.cursor="grab",f.style.borderRadius="8px",f.addEventListener("mousedown",a=>{f.style.cursor="grabbing",b(a)}),f.addEventListener("mousemove",$),f.addEventListener("mouseup",()=>{f.style.cursor="grab",q()}),f.addEventListener("mouseleave",()=>{f.style.cursor="grab",q()}),f.addEventListener("wheel",se);const de=()=>{y.current=requestAnimationFrame(de),l.current.forEach((a,p)=>{const i=a.planetData,j=a.semiMajorAxis,N=a.semiMinorAxis,Q=i.orbital_period_seconds,G=2*Math.PI/Q,Y=(i.initial_orbital_angle+I.current*G)%(2*Math.PI);a.position.x=j*Math.cos(Y),a.position.z=N*Math.sin(Y),a.position.y=0;const O=i.rotation_period_seconds,ee=2*Math.PI/O;if(a.rotation.y=I.current*ee%(2*Math.PI),P.current[p]){const ue=a.geometry.parameters?.radius||2;P.current[p].position.copy(a.position),P.current[p].position.y+=ue+6}}),Z.render(F,te)};de();const re=()=>{const a=v.clientWidth,p=(a<640,120);te.aspect=a/p,te.updateProjectionMatrix(),Z.setSize(a,p)};return window.addEventListener("resize",re),()=>{window.removeEventListener("resize",re),f.removeEventListener("mousedown",b),f.removeEventListener("mousemove",$),f.removeEventListener("mouseup",q),f.removeEventListener("mouseleave",q),f.removeEventListener("wheel",se),y.current&&cancelAnimationFrame(y.current),v&&Z.domElement&&v.removeChild(Z.domElement),Z.dispose(),l.current=[],A.current=[],P.current=[]}},[n,m,C,H]);const Ee=v=>{if(v<=0)return"Cosmic Origin Time";const D=Math.floor(v/(365.25*24*3600)),S=Math.floor(v%(365.25*24*3600)/(24*3600)),F=Math.floor(v%(24*3600)/3600);return D>0?`${D}y ${S}d ${F}h`:S>0?`${S}d ${F}h`:`${F}h`},ne=v=>v.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Solar System Perspective"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{ref:E,className:"w-full border border-white/20 rounded bg-black/20",style:{height:"auto"}}),!ie&&!U&&g&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:g})}),e.jsx("button",{onClick:()=>{ae(!0),W(!0)},className:"absolute top-2 right-2 p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg z-10",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-[10px]",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-[10px]",children:[H?.planets?.length||n.length," Planets"]})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Time: ",Ee(ce)]})]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View"})]})]}),L&&qe.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${_||h?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${_||h?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:ne(g)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:ne(g)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[H?.planets?.length||n.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",Ee(R-C+K)]})]})]}),e.jsx("button",{onClick:oe,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-100y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-100*365.25*24*3600,max:100*365.25*24*3600,step:604800,value:K,onChange:v=>{const D=Number(v.target.value),S=-(R-C);me(Math.max(D,S))},className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded",style:{left:`${(0- -100*365.25*24*3600)/(100*365.25*24*3600- -100*365.25*24*3600)*100}%`}})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+100y"}),e.jsx("button",{onClick:()=>me(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",K===0?"Present":K>0?`+${Math.abs(K/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(K/(365.25*24*3600)).toFixed(1)} years`," • Range: 200 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(et,{planets:H?.planets||n,stars:H?.stars||m,systemName:g,cosmicOriginTime:C,currentTime:R-C+K,onTimeOffsetChange:v=>me(D=>D+v)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},Ct=({system:n,galaxy:m,systemIndex:g,cosmicOriginTime:C})=>{const[E,z]=s.useState({isOnCooldown:!1,isSaved:!1,isCollecting:!1,timeUntilNext:0});s.useEffect(()=>{let y;const l=()=>{const R=Te.generateLocationId("system",m.coordinates.join(","),g,void 0),d=Te.canCollectFromLocation(R),B=Te.getTimeUntilNextCollection(R),L=m.coordinates,ae=Xe.generateSystemUrl(L,g,Xe.getCurrentPage()),w=rt.getLocations().some(h=>h.stargateUrl===ae);z(h=>({isOnCooldown:!d&&B>0,isSaved:w,isCollecting:h.isCollecting,timeUntilNext:B}))},A=()=>{z(R=>({...R,isCollecting:!0})),y=setTimeout(()=>{z(R=>({...R,isCollecting:!1}))},1e3)};l();const P=setInterval(l,1e3),I=Ke.subscribe("mining_completed",A);return()=>{clearInterval(P),y&&clearTimeout(y),I()}},[n.name,g,m.coordinates]);const k=y=>y.replace(/_/g," ");return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[e.jsx(mt,{locationType:"system",locationId:n.name,coordinates:m.coordinates.join(","),systemIndex:g,className:"text-xs"}),e.jsx(ut,{type:"system",name:n.name,coordinates:m.coordinates.join(","),systemIndex:g,className:"text-xs"}),e.jsx("div",{className:"inline-flex items-center bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] font-medium px-1.5 py-0.5 rounded h-[21px] box-border",children:"VISITED"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ht,{isOnCooldown:E.isOnCooldown,isSaved:E.isSaved,isCollecting:E.isCollecting}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Details"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"System Type"}),e.jsx("div",{className:"text-sm font-bold text-blue-300 capitalize",children:n.star_system_type})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Planets"}),e.jsx("div",{className:"text-sm font-bold text-purple-300",children:n.num_planets})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-orange-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Stars"}),e.jsx("div",{className:"text-sm font-bold text-orange-300",children:n.stars.length})]})]}),e.jsx("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-3",children:e.jsx(St,{planets:n.planets,stars:n.stars,systemName:n.name,cosmicOriginTime:C})}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-yellow-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Stellar Composition"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1",children:n.stars.map((y,l)=>e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-yellow-500/20",children:[e.jsxs("div",{className:"text-xs text-gray-300 flex items-center gap-2",children:[e.jsxs("span",{children:["Star ",l+1]}),e.jsx("span",{className:"font-bold text-yellow-300",children:y.Type})]}),e.jsxs("div",{className:"text-xs text-gray-300",children:[y.Color," • ",y.Size]})]},l))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System:"}),e.jsx("div",{className:"text-white truncate font-medium",children:k(n.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System ID:"}),e.jsxs("div",{className:"text-white font-medium",children:["#",g+1]})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),e.jsx("div",{className:"text-white truncate font-medium",children:k(m.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),e.jsx("div",{className:"text-white font-medium",children:m.coordinates.join(", ")})]})]})]})]})},tt=s.forwardRef(({planets:n,stars:m,systemName:g,cosmicOriginTime:C,systemUrl:E},z)=>{const k=s.useRef(null),y=s.useRef(null),l=s.useRef(null),A=s.useRef(null),P=s.useRef([]),I=s.useRef([]),R=s.useRef([]),d=s.useRef(null),B=s.useRef(0),L=s.useRef(null),ae=Math.floor(Date.now()/1e3),[_,w]=s.useState(0),[h,W]=s.useState(!1),[K,me]=s.useState(!1),[H,be]=s.useState(!1),[ie,M]=s.useState(0),[U,le]=s.useState(null),[ce,oe]=s.useState(!0),[we,Ee]=s.useState(null),[ne,v]=s.useState(!1);s.useImperativeHandle(z,()=>({captureScreenshot:()=>F(),isGeneratingImage:ne}));const D=ae-C+_;B.current=D,s.useEffect(()=>{(async()=>{try{oe(!0),Ee(null);const T=await fetch("/api/system/rendering-data");if(!T.ok)throw new Error(`HTTP error! status: ${T.status}`);const V=await T.json();if(V.success)le(V.system_data);else throw new Error(V.error||"Failed to fetch system data")}catch(T){Ee(T instanceof Error?T.message:"Unknown error")}finally{oe(!1)}})()},[]);const S=()=>{me(!0),setTimeout(()=>{W(!1),me(!1)},300)};s.useEffect(()=>{const r=T=>{T.key==="Escape"&&h&&S()};return h&&M(_),document.addEventListener("solar-system-close-fullscreen",S),document.addEventListener("keydown",r),()=>{document.removeEventListener("solar-system-close-fullscreen",S),document.removeEventListener("keydown",r)}},[h,_]),s.useEffect(()=>{if(h&&H){const r=setTimeout(()=>{be(!1)},50);return()=>clearTimeout(r)}},[h,H]),s.useEffect(()=>{if(ce||!U||(window.tonnirLoggedInSystem=!1,!k.current))return;const r=k.current,T=r.clientWidth,V=r.clientHeight,t=Math.min(T,V),x=new Ge;x.background=new Oe(17),y.current=x;const c=new Ve(45,1,.1,1e4);c.position.set(0,300,0),c.lookAt(0,0,0),L.current=c;const o=new _e({antialias:!0,alpha:!0});o.setSize(t,t),o.setClearColor(17,1),l.current=o,o.domElement.className="",r.appendChild(o.domElement);const J={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},X={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},u=new $e;U.stars.forEach((i,j)=>{const N=parseFloat(i.Size)*3,Q=new he(N,16,16),G=X[i.Color]||"#FFFF44",Y=new xe({color:G,transparent:!0,opacity:.9}),O=new pe(Q,Y);U.stars.length===1?O.position.set(0,0,0):U.stars.length===2?O.position.set(j===0?-N*2:N*2,0,0):j===0?O.position.set(-N*2,0,0):j===1?O.position.set(N*2,0,0):O.position.set(0,N*2,0);const ee=new he(N*1.5,16,16),ue=new xe({color:G,transparent:!0,opacity:.3}),ve=new pe(ee,ue);O.add(ve),u.add(O)}),x.add(u);const b=U.timing.max_orbital_radius,$=80;window.systemMaxOrbitalRadius=b,U.planets.forEach((i,j)=>{const Q=20+i.orbital_radius/b*$,G=i.eccentricity_factor,Y=Q,O=Y*Math.sqrt(1-G*G),ee=360,ue=2,ve=4;for(let Fe=0;Fe<ee;Fe+=ue+ve){const Ce=[];for(let ge=Fe;ge<Math.min(Fe+ue,ee-1);ge++){const je=ge/ee*2*Math.PI,Ne=Y*Math.cos(je),Pe=O*Math.sin(je);Ce.push(new Me(Ne,0,Pe))}if(Ce.length>1){const ge=new Be().setFromPoints(Ce),je=new We({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Ne=new Ye(ge,je);x.add(Ne),I.current.push(Ne)}}const Le=i.diameter/15e3,Re=Math.max(Math.min(Le,4),1.5),De=new he(Re,16,16),fe=J[i.planet_type]||"#FFFFFF",Ae=new xe({color:fe,transparent:!0,opacity:.9}),ye=new pe(De,Ae),Se=new pe(new he(Re*1.5,16,16),new xe({color:fe,transparent:!0,opacity:.2}));ye.add(Se),x.add(ye),P.current.push(ye),ye.planetData=i,ye.orbitRadius=Q,ye.semiMajorAxis=Y,ye.semiMinorAxis=O,R.current.push(null)});const q=new He(4210752,.4);x.add(q);const se=new Ue(16777215,1,1e3);se.position.set(0,0,0),x.add(se);const f=new vt(c,o.domElement);f.enableDamping=!0,f.dampingFactor=.05,f.minDistance=50,f.maxDistance=800,f.autoRotate=!1,f.autoRotateSpeed=.5,f.enablePan=!0,f.enableZoom=!0,f.target.set(0,0,0),d.current=f;const de=i=>{if(i.ctrlKey)i.preventDefault(),i.deltaY>0?w(j=>j+604800):w(j=>j-604800);else{i.preventDefault();const j=.1,N=c.position.distanceTo(new Me(0,0,0));i.deltaY>0&&N<500?c.position.multiplyScalar(1+j):i.deltaY<0&&N>20&&c.position.multiplyScalar(1-j)}},re=o.domElement;re.style.borderRadius="8px",re.addEventListener("wheel",de);const a=()=>{A.current=requestAnimationFrame(a),P.current.forEach((i,j)=>{const N=i.planetData,Q=i.semiMajorAxis,G=i.semiMinorAxis,Y=N.orbital_period_seconds,O=2*Math.PI/Y,ee=(N.initial_orbital_angle+B.current*O)%(2*Math.PI);i.position.x=Q*Math.cos(ee),i.position.z=G*Math.sin(ee),i.position.y=0;const ue=N.rotation_period_seconds,ve=2*Math.PI/ue;i.rotation.y=B.current*ve%(2*Math.PI)}),d.current&&d.current.update(),o.render(x,c)};a();const p=()=>{if(!k.current||!o)return;const i=k.current,j=Math.min(i.clientWidth,i.clientHeight);o.setSize(j,j),c.aspect=1,c.updateProjectionMatrix()};return window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p),re.removeEventListener("wheel",de),d.current&&d.current.dispose(),A.current&&cancelAnimationFrame(A.current),r&&o.domElement&&r.removeChild(o.domElement),o.dispose(),P.current=[],I.current=[],R.current=[]}},[n,m,C,U,_]);const F=()=>{if(!l.current||!y.current||!L.current||ne)return;v(!0),d.current&&(d.current.enabled=!1);const r=l.current,T=y.current,V=L.current,t=r.domElement.width,x=r.domElement.height,c=3840/t,o=[];T.traverse(u=>{if(u.isPoints&&u.material){const b=u.material;if(b.size!==void 0&&(o.push({material:b,originalSize:b.size}),b.size=b.size*c*1),u.geometry&&u.geometry.attributes.size){const $=u.geometry.attributes.size,q=$.array.slice();o.push({geometry:u.geometry,originalSizeArray:q});for(let se=0;se<$.array.length;se++)$.array[se]*=c*1;$.needsUpdate=!0}}if(u.isSprite&&(o.push({object:u,originalScale:u.scale.clone()}),u.scale.multiplyScalar(c*1)),u.isLine&&u.material){const b=u.material;b.linewidth!==void 0&&(o.push({material:b,originalLinewidth:b.linewidth}),b.linewidth=b.linewidth*c*1)}});const J=3840,X=3840;r.setSize(J,X),V.aspect=1,V.updateProjectionMatrix(),r.render(T,V),r.domElement.toBlob(u=>{if(u){const b=document.createElement("canvas"),$=b.getContext("2d");if(b.width=J,b.height=X,$){const q=new Image;q.onload=async()=>{$.drawImage(q,0,0),gt($,{imageWidth:J,imageHeight:X}),E&&await bt($,J,X,{type:"system",stargateUrl:E}),b.toBlob(f=>{if(f){const de=URL.createObjectURL(f),re=document.createElement("a");re.href=de,re.download=`system_${g}_${Date.now()}.jpg`,re.click(),URL.revokeObjectURL(de)}},"image/jpeg",1)};const se=URL.createObjectURL(u);q.src=se}}o.forEach(({material:b,object:$,originalSize:q,originalScale:se,originalLinewidth:f,geometry:de,originalSizeArray:re})=>{if(q!==void 0&&(b.size=q),se!==void 0&&$.scale.copy(se),f!==void 0&&(b.linewidth=f),de&&re){const a=de.attributes.size;for(let p=0;p<re.length;p++)a.array[p]=re[p];a.needsUpdate=!0}}),r.setSize(t,x),V.aspect=1,V.updateProjectionMatrix(),d.current&&(d.current.enabled=!0),v(!1)},"image/jpeg",1)},te=r=>{const T=Math.floor(r/31557600),V=Math.floor(r%(365.25*24*3600)/(24*3600)),t=Math.floor(r%(24*3600)/3600);return T>0?`${T}y ${V}d ${t}h`:V>0?`${V}d ${t}h`:`${t}h`},Z=r=>r.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center w-full h-full",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{ref:k,className:"w-full h-full border border-white/20 rounded bg-black/20"}),e.jsx(wt,{isVisible:ne}),!ce&&!we&&g&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:Z(g)})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 z-10",children:[e.jsx("button",{onClick:F,disabled:ne,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${ne?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:ne?"Generating image...":"Download 4K screenshot",children:ne?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(xt,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>{ne||(W(!0),be(!0))},disabled:ne,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${ne?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:ne?"Please wait...":"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})]})}),h&&qe.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${K||H?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${K||H?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:Z(g)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:Z(g)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[U?.planets?.length||n.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",te(ae-C+ie)]})]})]}),e.jsx("button",{onClick:S,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-100y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-100*365.25*24*3600,max:100*365.25*24*3600,step:604800,value:ie,onChange:r=>{const T=Number(r.target.value),V=-(ae-C);M(Math.max(T,V))},className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded",style:{left:`${(0- -100*365.25*24*3600)/(100*365.25*24*3600- -100*365.25*24*3600)*100}%`}})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+100y"}),e.jsx("button",{onClick:()=>M(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",ie===0?"Present":ie>0?`+${Math.abs(ie/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(ie/(365.25*24*3600)).toFixed(1)} years`," • Range: 200 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(et,{planets:U?.planets||n,stars:U?.stars||m,systemName:g,cosmicOriginTime:C,currentTime:ae-C+ie,onTimeOffsetChange:r=>M(T=>T+r)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})});tt.displayName="SolarSystem3DViewerLeft";const Mt=({systemUrl:n,system:m,cosmicOriginTime:g})=>{const C=s.useRef(null),[E,z]=s.useState(!1),[k,y]=s.useState(!1),[l,A]=s.useState(!1),[P,I]=s.useState(!1),R=s.useRef(null);return s.useEffect(()=>{const d=C.current;if(!d)return;const B=d.getContext("2d");if(!B)return;let L=[];const ae=800;let _,w;const h=800;let W,K=.5;function me(){const M=d?.parentElement;if(!M||!d)return;const U=M.clientWidth,le=M.clientHeight;d.width=Math.min(U,h),d.height=Math.min(le,h),_=d.width/2,w=d.height/2}function H(){me(),L=[];for(let M=0;M<ae;M++)L.push({x:Math.random()*(d?.width||800),y:Math.random()*(d?.height||800),z:Math.random()*(d?.width||800),o:Math.random()});be()}function be(){!d||!B||(B.clearRect(0,0,d.width,d.height),L.forEach(M=>{M.z-=K,M.z<=0&&(M.z=d.width,M.x=Math.random()*d.width,M.y=Math.random()*d.height,M.o=Math.random());const U=d.width/M.z,le=(M.x-_)*U+_,ce=(M.y-w)*U+w,oe=2*U;B.beginPath(),B.fillStyle=`rgba(255, 255, 255, ${M.o})`,B.arc(le,ce,oe,0,2*Math.PI),B.fill()}),K<60&&(K+=1),W=requestAnimationFrame(be))}H();const ie=()=>me();return window.addEventListener("resize",ie),()=>{window.removeEventListener("resize",ie),W&&cancelAnimationFrame(W)}},[]),s.useEffect(()=>{z(!0),setTimeout(()=>{y(!0)},800)},[]),s.useEffect(()=>{const d=setInterval(()=>{R.current&&l&&!R.current.isGeneratingImage&&l&&A(!1)},50);return()=>clearInterval(d)},[l]),s.useEffect(()=>{const d=()=>{I(!0)},B=Ke.subscribe("mining_completed",d);return()=>{B()}},[]),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"System Visualization"})}),e.jsxs("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:[e.jsx("canvas",{ref:C,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${k?"opacity-0":"opacity-100"}`,style:{filter:k?"blur(50px)":"none"}}),E&&m&&e.jsx("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${E&&k?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:e.jsx(tt,{ref:R,planets:m.planets,stars:m.stars,systemName:m.name,cosmicOriginTime:g||0,systemUrl:n})}),e.jsx(pt,{isActive:P,onAnimationComplete:()=>{I(!1)}})]}),e.jsxs("div",{className:"text-center mt-auto",children:[e.jsx(ft,{href:n,onTakeScreenshot:()=>{R.current&&!l&&(A(!0),R.current.captureScreenshot())},isGeneratingImage:l}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]})]})},kt=({planets:n,coordinates:m,systemIndex:g})=>{const[C,E]=s.useState(new Set),z=l=>({"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"})[l]||"#FFFFFF";s.useEffect(()=>{(()=>{try{const A=at(m,g,n),P=new Set;A.forEach(I=>{P.add(I.toLowerCase())}),E(P)}catch{}})()},[m,g,n]);const k=l=>l.replace(/_/g," "),y=l=>{try{ot(m,g,l,n)}catch{}window.location.href=`/planet/${l.toLowerCase()}`};return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3",children:n.map(l=>e.jsxs("div",{className:"relative bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 hover:border-white/40 transition-all duration-300 group overflow-hidden",children:[C.has(l.name.toLowerCase())&&e.jsx("div",{className:"absolute top-1 right-1 bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] px-1.5 py-0.5 rounded z-10",children:"VISITED"}),e.jsx("div",{className:"absolute -top-3 -left-3 w-8 h-8 rounded-full border border-white/40 shadow-sm z-20 animate-pulse",style:{backgroundColor:z(l.planet_type)}}),e.jsxs("button",{onClick:()=>y(l.name),className:"w-full text-left block p-2 sm:p-3 text-gray-200 hover:text-white transition-colors duration-300 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Planet"}),e.jsx("div",{className:"text-sm font-semibold text-white truncate group-hover:text-blue-300 transition-colors duration-300",children:k(l.name)})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]},l.name))}),n.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No planets found"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This system appears to be empty"})]})]})},Rt=({currentSystem:n,galaxy:m})=>{const[g,C]=s.useState(!1),[E,z]=s.useState(!1),[k,y]=s.useState(!0);s.useEffect(()=>{C(n.index>0),z(!0),y(!1)},[n.index]);const l=async()=>{if(n.index>0){if(!ke.canAffordTravel("system",1)){ke.executeTravel("system",1);return}if(!ke.executeTravel("system",1))return;const I=m.coordinates.join(",");ze(I,n.index-1),window.location.href=`/system/${n.index-1}`}},A=async()=>{if(!ke.canAffordTravel("system",1)){ke.executeTravel("system",1);return}if(!ke.executeTravel("system",1))return;const I=m.coordinates.join(",");ze(I,n.index+1),window.location.href=`/system/${n.index+1}`};return k?null:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:l,disabled:!g,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${g?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:A,disabled:!E,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${E?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})},Lt=({system:n,galaxy:m,system_url:g,version:C,system_index:E,image_url:z,page:k,cosmic_origin_time:y})=>{const[l]=s.useState(m.coordinates.join(","));s.useEffect(()=>{document.body.setAttribute("data-coordinates",l),document.body.setAttribute("data-system-index",E.toString()),ze(l,E)},[l,E]);const A=I=>I.replace(/_/g," "),P=I=>I.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsx(it,{}),e.jsxs("div",{className:"w-full min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(lt,{}),e.jsxs("div",{className:"relative z-10 pt-1 flex-1 flex flex-col",children:[e.jsx(ct,{}),e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8 flex-1",children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["System '",A(n.name),"'"]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-300 flex items-center justify-center gap-x-4 gap-y-1 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Et,{size:15,color:"#ffffffff"}),P(m.name)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(yt,{size:15,color:"#ffffffff"}),m.coordinates.join(", ")]})]})]}),e.jsx(Rt,{currentSystem:{name:n.name,index:E},galaxy:m}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[e.jsx("div",{className:"order-1 lg:order-1",children:e.jsx(Mt,{systemUrl:g,system:n,cosmicOriginTime:y})}),e.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),e.jsx("div",{className:"order-2 lg:order-2",children:e.jsx(Ct,{system:n,galaxy:m,systemIndex:E,cosmicOriginTime:y})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:["Planets in '",A(n.name),"'"]}),e.jsx(kt,{planets:n.planets,coordinates:l,systemIndex:E})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${k}`,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:e.jsxs("span",{className:"text-base sm:text-lg",children:["← Back to Galaxy '",P(m.name),"'"]})})})]}),e.jsx(Ft,{version:C})]}),e.jsx(jt,{}),e.jsx(dt,{currentLocation:{type:"system",name:n.name,coordinates:m.coordinates.join(","),systemIndex:n.index}}),e.jsx(Nt,{currentView:"system"})]})]})};document.addEventListener("DOMContentLoaded",async()=>{try{const n=document.getElementById("system-data"),m=document.getElementById("galaxy-data"),g=document.getElementById("meta-data");if(!n||!m||!g)return;const C=JSON.parse(n.textContent||"{}"),E=JSON.parse(m.textContent||"{}"),z=JSON.parse(g.textContent||"{}"),k={system:C,galaxy:E,system_url:z.system_url,version:z.version,system_index:z.system_index,image_url:z.image_url,page:z.page||1,cosmic_origin_time:z.cosmic_origin_time},y=document.getElementById("atlas-react-root");y&&st.createRoot(y).render(nt.createElement(Lt,k))}catch{}});
