import{r as a,j as e,a as Je,U as Ze,c as Ue,R as Qe}from"./atlas_Bv5zr7cG9joXJ1l7Eo-6s.js";import{b as et,c as tt,a as me,d as ke,F as st,H as at,S as nt}from"./atlas_BaXi1fL9krZc5NIhr0Ma9.js";import{W as De}from"./atlas_CNuRMyx4gH271S-qfMS5_.js";import{I as Ae,C as Te,J as _e,G as Pe,b as oe,u as ie,M as le,V as ye,B as ze,s as Ie,L as Ge,Y as Ve,cE as Ye,r as Be,cC as $e,cD as We,a0 as Le}from"./atlas_CqUMNY_RyRklhCsbOI68T.js";import{R as rt,S as ot}from"./atlas_XIVztJR3QrwXhTniM5vOF.js";import{V as it}from"./atlas_D1RtXGjFSAWW01vFUnxaN.js";import"./atlas_SPyfQU6Spv1u19LNdvRDW.js";const lt=({planets:s,stars:o,systemName:y,cosmicOriginTime:j,currentTime:w,onTimeOffsetChange:i})=>{const k=a.useRef(null),x=a.useRef(null),N=a.useRef(null),R=a.useRef(null),M=a.useRef([]),P=a.useRef([]),r=a.useRef([]),L=a.useRef(0),$=(v,z="#ffffff")=>{const g=document.createElement("canvas"),l=g.getContext("2d");if(!l)return null;g.width=768,g.height=192,l.fillStyle="rgba(0, 0, 0, 0.8)",l.fillRect(0,0,g.width,g.height),l.strokeStyle="#ffffff",l.lineWidth=3,l.strokeRect(3,3,g.width-6,g.height-6),l.fillStyle=z,l.font="bold 48px Arial",l.textAlign="center",l.textBaseline="middle",l.fillText(v,384,96);const c=new Be(g),F=new $e({map:c,transparent:!0,alphaTest:.1}),_=new We(F);return _.scale.set(30,7.5,1),_};return L.current=w,a.useEffect(()=>{if(!k.current)return;const v=k.current,z=v.clientWidth,g=v.clientHeight,l=new Ae;l.background=new Te(17),x.current=l;const c=new _e(60,z/g,.1,1e4);c.position.set(0,120,180),c.lookAt(0,0,0);const F=new De({antialias:!0,alpha:!0});F.setSize(z,g),F.setClearColor(17,1),N.current=F,v.appendChild(F.domElement);const _={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},ne={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},V=new Pe;o.forEach((t,p)=>{const h=parseFloat(t.Size)*4,f=new oe(h,32,32),H=ne[t.Color]||"#FFFF44",W=new ie({color:H,transparent:!0,opacity:.9}),D=new le(f,W);o.length===1?D.position.set(0,0,0):o.length===2?D.position.set(p===0?-h*2:h*2,0,0):p===0?D.position.set(-h*2,0,0):p===1?D.position.set(h*2,0,0):D.position.set(0,h*2,0);const U=new oe(h*1.5,32,32),ae=new ie({color:H,transparent:!0,opacity:.3}),te=new le(U,ae);D.add(te),V.add(D)}),l.add(V);const ue=Math.max(...s.map(t=>t.orbital_radius)),C=150;s.forEach((t,p)=>{const f=30+t.orbital_radius/ue*C,H=t.eccentricity_factor,W=f,D=W*Math.sqrt(1-H*H),U=360,ae=2,te=4;for(let q=0;q<U;q+=ae+te){const G=[];for(let O=q;O<Math.min(q+ae,U-1);O++){const Q=O/U*2*Math.PI,se=W*Math.cos(Q),we=D*Math.sin(Q);G.push(new ye(se,0,we))}if(G.length>1){const O=new ze().setFromPoints(G),Q=new Ie({color:7372944,transparent:!0,opacity:.8,linewidth:2}),se=new Ge(O,Q);l.add(se),P.current.push(se)}}const he=t.diameter/8e3,A=Math.max(Math.min(he,8),2.5),Fe=new oe(A,32,32),be=_[t.planet_type]||"#FFFFFF",n=new ie({color:be,transparent:!0,opacity:.9}),d=new le(Fe,n),T=new le(new oe(A*1.5,32,32),new ie({color:be,transparent:!0,opacity:.2}));d.add(T),l.add(d),M.current.push(d),d.planetData=t,d.orbitRadius=f,d.semiMajorAxis=W,d.semiMinorAxis=D;const B=t.name.replace(/_/g," "),X=$(B,"#ffffff");X&&(X.position.copy(d.position),X.position.y+=A+10,X.planetData=t,l.add(X),r.current.push(X))});const ee=new Ve(4210752,.4);l.add(ee);const ce=new Ye(16777215,1,2e3);ce.position.set(0,0,0),l.add(ce);let K=!1,J=0,Z=0,de=0;const pe=t=>{K=!0,J=t.clientX,Z=t.clientY},fe=t=>{if(!K)return;const p=t.clientX-J,h=t.clientY-Z,f=new Le;f.setFromVector3(c.position),f.theta-=p*.01,f.phi+=h*.01,f.phi=Math.max(.1,Math.min(Math.PI-.1,f.phi)),c.position.setFromSpherical(f),c.lookAt(0,0,0),J=t.clientX,Z=t.clientY},m=()=>{K=!1,setTimeout(()=>{},3e3)},E=t=>{if(t.ctrlKey)t.preventDefault(),t.deltaY>0?i(604800):i(-604800);else{t.preventDefault();const p=.1,h=c.position.distanceTo(new ye(0,0,0));t.deltaY>0&&h<800?c.position.multiplyScalar(1+p):t.deltaY<0&&h>50&&c.position.multiplyScalar(1-p)}},S=t=>{t.key==="Escape"&&document.dispatchEvent(new CustomEvent("solar-system-close-fullscreen"))},u=t=>{if(t.preventDefault(),t.touches.length===1)K=!0,J=t.touches[0].clientX,Z=t.touches[0].clientY;else if(t.touches.length===2){const p=t.touches[0].clientX-t.touches[1].clientX,h=t.touches[0].clientY-t.touches[1].clientY;de=Math.sqrt(p*p+h*h)}},I=t=>{if(t.preventDefault(),t.touches.length===1&&K){const p=t.touches[0].clientX-J,h=t.touches[0].clientY-Z,f=new Le;f.setFromVector3(c.position),f.theta-=p*.01,f.phi+=h*.01,f.phi=Math.max(.1,Math.min(Math.PI-.1,f.phi)),c.position.setFromSpherical(f),c.lookAt(0,0,0),J=t.touches[0].clientX,Z=t.touches[0].clientY}else if(t.touches.length===2){const p=t.touches[0].clientX-t.touches[1].clientX,h=t.touches[0].clientY-t.touches[1].clientY,f=Math.sqrt(p*p+h*h);if(de>0){const W=f/de,D=c.position.distanceTo(new ye(0,0,0));W>1&&D>50?c.position.multiplyScalar(1-.01):W<1&&D<800&&c.position.multiplyScalar(1+.01)}de=f}},Y=t=>{t.preventDefault(),K=!1,de=0,setTimeout(()=>{},3e3)},b=F.domElement;b.style.cursor="grab",b.addEventListener("mousedown",t=>{b.style.cursor="grabbing",pe(t)}),b.addEventListener("mousemove",fe),b.addEventListener("mouseup",()=>{b.style.cursor="grab",m()}),b.addEventListener("mouseleave",()=>{b.style.cursor="grab",m()}),b.addEventListener("wheel",E),b.addEventListener("touchstart",u,{passive:!1}),b.addEventListener("touchmove",I,{passive:!1}),b.addEventListener("touchend",Y,{passive:!1}),document.addEventListener("keydown",S);const je=()=>{R.current=requestAnimationFrame(je),M.current.forEach((t,p)=>{const h=t.planetData,f=t.semiMajorAxis,H=t.semiMinorAxis,W=h.orbital_period_seconds,D=2*Math.PI/W,U=(h.initial_orbital_angle+L.current*D)%(2*Math.PI);t.position.x=f*Math.cos(U),t.position.z=H*Math.sin(U),t.position.y=0;const ae=h.rotation_period_seconds,te=2*Math.PI/ae;if(t.rotation.y=L.current*te%(2*Math.PI),r.current[p]){const he=t.geometry.parameters?.radius||2;r.current[p].position.copy(t.position),r.current[p].position.y+=he+10}}),F.render(l,c)};je();const ge=()=>{const t=v.clientWidth,p=v.clientHeight;c.aspect=t/p,c.updateProjectionMatrix(),F.setSize(t,p)};return window.addEventListener("resize",ge),()=>{window.removeEventListener("resize",ge),document.removeEventListener("keydown",S),b.removeEventListener("mousedown",pe),b.removeEventListener("mousemove",fe),b.removeEventListener("mouseup",m),b.removeEventListener("mouseleave",m),b.removeEventListener("wheel",E),b.removeEventListener("touchstart",u),b.removeEventListener("touchmove",I),b.removeEventListener("touchend",Y),R.current&&cancelAnimationFrame(R.current),v&&F.domElement&&v.removeChild(F.domElement),F.dispose(),M.current=[],P.current=[],r.current=[]}},[s,o,j]),e.jsx("div",{ref:k,className:"w-full h-full"})},ct=({planets:s,stars:o,systemName:y,cosmicOriginTime:j})=>{const w=a.useRef(null),i=a.useRef(null),k=a.useRef(null),x=a.useRef(null),N=a.useRef([]),R=a.useRef([]),M=a.useRef([]),P=a.useRef(0),r=Math.floor(Date.now()/1e3),[L,$]=a.useState(0),[v,z]=a.useState(!1),[g,l]=a.useState(!1),[c,F]=a.useState(!1),[_,ne]=a.useState(0),[V,ue]=a.useState(null),[C,ee]=a.useState(!0),[ce,K]=a.useState(null),J=r-j+L;P.current=J,a.useEffect(()=>{(async()=>{try{ee(!0),K(null);const E=await fetch("/api/system/rendering-data");if(!E.ok)throw new Error(`HTTP error! status: ${E.status}`);const S=await E.json();if(S.success)ue(S.system_data);else throw new Error(S.error||"Failed to fetch system data")}catch(E){K(E instanceof Error?E.message:"Unknown error")}finally{ee(!1)}})()},[]);const Z=()=>{l(!0),setTimeout(()=>{z(!1),l(!1)},300)},de=(m,E="#ffffff")=>{const S=document.createElement("canvas"),u=S.getContext("2d");if(!u)return null;S.width=512,S.height=128,u.fillStyle="rgba(0, 0, 0, 0.7)",u.fillRect(0,0,S.width,S.height),u.strokeStyle="#ffffff",u.lineWidth=2,u.strokeRect(2,2,S.width-4,S.height-4),u.fillStyle=E,u.font="bold 32px Arial",u.textAlign="center",u.textBaseline="middle",u.fillText(m,256,64);const I=new Be(S),Y=new $e({map:I,transparent:!0,alphaTest:.1}),b=new We(Y);return b.scale.set(20,5,1),b};a.useEffect(()=>{const m=E=>{E.key==="Escape"&&v&&Z()};return v&&ne(L),document.addEventListener("solar-system-close-fullscreen",Z),document.addEventListener("keydown",m),()=>{document.removeEventListener("solar-system-close-fullscreen",Z),document.removeEventListener("keydown",m)}},[v,L]),a.useEffect(()=>{if(v&&c){const m=setTimeout(()=>{F(!1)},50);return()=>clearTimeout(m)}},[v,c]),a.useEffect(()=>{if(C||!V||(window.tonnirLoggedInSystem=!1,!w.current))return;const m=w.current,E=m.clientWidth,S=E<640,u=new Ae;u.background=new Te(17),i.current=u;const I=new _e(45,E/(S?120:140),.1,1e4);I.position.set(0,80,120),I.lookAt(0,0,0);const Y=new De({antialias:!0,alpha:!0});Y.setSize(E,S?120:140),Y.setClearColor(17,1),k.current=Y,m.appendChild(Y.domElement);const b={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},je={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},ge=new Pe;V.stars.forEach((n,d)=>{const T=parseFloat(n.Size)*3,B=new oe(T,16,16),X=je[n.Color]||"#FFFF44",q=new ie({color:X,transparent:!0,opacity:.9}),G=new le(B,q);V.stars.length===1?G.position.set(0,0,0):V.stars.length===2?G.position.set(d===0?-T*2:T*2,0,0):d===0?G.position.set(-T*2,0,0):d===1?G.position.set(T*2,0,0):G.position.set(0,T*2,0);const O=new oe(T*1.5,16,16),Q=new ie({color:X,transparent:!0,opacity:.3}),se=new le(O,Q);G.add(se),ge.add(G)}),u.add(ge);const t=V.timing.max_orbital_radius,p=80;window.systemMaxOrbitalRadius=t,V.planets.forEach((n,d)=>{const B=20+n.orbital_radius/t*p,X=n.eccentricity_factor,q=B,G=q*Math.sqrt(1-X*X),O=360,Q=2,se=4;for(let Ne=0;Ne<O;Ne+=Q+se){const Ce=[];for(let ve=Ne;ve<Math.min(Ne+Q,O-1);ve++){const Ee=ve/O*2*Math.PI,Se=q*Math.cos(Ee),Ke=G*Math.sin(Ee);Ce.push(new ye(Se,0,Ke))}if(Ce.length>1){const ve=new ze().setFromPoints(Ce),Ee=new Ie({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Se=new Ge(ve,Ee);u.add(Se),R.current.push(Se)}}const we=n.diameter/15e3,Me=Math.max(Math.min(we,4),1.5),Xe=new oe(Me,16,16),Re=b[n.planet_type]||"#FFFFFF",Oe=new ie({color:Re,transparent:!0,opacity:.9}),re=new le(Xe,Oe),He=new le(new oe(Me*1.5,16,16),new ie({color:Re,transparent:!0,opacity:.2}));re.add(He),u.add(re),N.current.push(re),re.planetData=n,re.orbitRadius=B,re.semiMajorAxis=q,re.semiMinorAxis=G;const qe=n.name.replace(/_/g," "),xe=de(qe,"#ffffff");xe&&(xe.position.copy(re.position),xe.position.y+=Me+6,xe.planetData=n,u.add(xe),M.current.push(xe))});const h=new Ve(4210752,.4);u.add(h);const f=new Ye(16777215,1,1e3);f.position.set(0,0,0),u.add(f);let H=!1,W=0,D=0;const U=n=>{H=!0,W=n.clientX,D=n.clientY},ae=n=>{if(!H)return;const d=n.clientX-W,T=n.clientY-D,B=new Le;B.setFromVector3(I.position),B.theta-=d*.01,B.phi+=T*.01,B.phi=Math.max(.1,Math.min(Math.PI-.1,B.phi)),I.position.setFromSpherical(B),I.lookAt(0,0,0),W=n.clientX,D=n.clientY},te=()=>{H=!1,setTimeout(()=>{},3e3)},he=n=>{if(n.ctrlKey)n.preventDefault(),n.deltaY>0?$(d=>d+604800):$(d=>d-604800);else{n.preventDefault();const d=.1,T=I.position.distanceTo(new ye(0,0,0));n.deltaY>0&&T<500?I.position.multiplyScalar(1+d):n.deltaY<0&&T>20&&I.position.multiplyScalar(1-d)}},A=Y.domElement;A.style.cursor="grab",A.style.borderRadius="8px",A.addEventListener("mousedown",n=>{A.style.cursor="grabbing",U(n)}),A.addEventListener("mousemove",ae),A.addEventListener("mouseup",()=>{A.style.cursor="grab",te()}),A.addEventListener("mouseleave",()=>{A.style.cursor="grab",te()}),A.addEventListener("wheel",he);const Fe=()=>{x.current=requestAnimationFrame(Fe),N.current.forEach((n,d)=>{const T=n.planetData,B=n.semiMajorAxis,X=n.semiMinorAxis,q=T.orbital_period_seconds,G=2*Math.PI/q,O=(T.initial_orbital_angle+P.current*G)%(2*Math.PI);n.position.x=B*Math.cos(O),n.position.z=X*Math.sin(O),n.position.y=0;const Q=T.rotation_period_seconds,se=2*Math.PI/Q;if(n.rotation.y=P.current*se%(2*Math.PI),M.current[d]){const we=n.geometry.parameters?.radius||2;M.current[d].position.copy(n.position),M.current[d].position.y+=we+6}}),Y.render(u,I)};Fe();const be=()=>{const n=m.clientWidth,d=n<640?120:140;I.aspect=n/d,I.updateProjectionMatrix(),Y.setSize(n,d)};return window.addEventListener("resize",be),()=>{window.removeEventListener("resize",be),A.removeEventListener("mousedown",U),A.removeEventListener("mousemove",ae),A.removeEventListener("mouseup",te),A.removeEventListener("mouseleave",te),A.removeEventListener("wheel",he),x.current&&cancelAnimationFrame(x.current),m&&Y.domElement&&m.removeChild(Y.domElement),Y.dispose(),N.current=[],R.current=[],M.current=[]}},[s,o,j,V]);const pe=m=>{const E=Math.floor(m/31557600),S=Math.floor(m%(365.25*24*3600)/(24*3600)),u=Math.floor(m%(24*3600)/3600);return E>0?`${E}y ${S}d ${u}h`:S>0?`${S}d ${u}h`:`${u}h`},fe=m=>m.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Solar System Simulation"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{ref:w,className:"w-full border border-white/20 rounded bg-black/20",style:{height:"auto"}}),e.jsxs("button",{onClick:()=>{z(!0),F(!0)},className:"absolute top-2 right-2 p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 flex items-center gap-1 backdrop-blur-sm shadow-lg z-10",title:"Expand to fullscreen",children:[e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),e.jsx("span",{className:"text-xs text-white hidden sm:inline",children:"Expand"})]})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-[10px]",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-[10px]",children:[V?.planets?.length||s.length," Planets"]})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Time: ",pe(J)]})]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View"})]})]}),v&&Je.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${g||c?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${g||c?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:fe(y)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:fe(y)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[V?.planets?.length||s.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",pe(r-j+_)]})]})]}),e.jsx("button",{onClick:Z,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:_,onChange:m=>ne(Number(m.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>ne(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",_===0?"Present":_>0?`+${Math.abs(_/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(_/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(lt,{planets:s,stars:o,systemName:y,cosmicOriginTime:j,currentTime:r-j+_,onTimeOffsetChange:m=>ne(E=>E+m)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},dt=({system:s,galaxy:o,systemIndex:y,cosmicOriginTime:j})=>{const w=i=>i.replace(/_/g," ");return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[e.jsx(rt,{locationType:"system",locationId:s.name,coordinates:o.coordinates.join(","),systemIndex:y,className:"text-xs"}),e.jsx(ot,{type:"system",name:s.name,coordinates:o.coordinates.join(","),systemIndex:y,className:"text-xs"}),e.jsx("div",{className:"bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] px-1.5 py-0.5 rounded",children:"VISITED"})]}),e.jsx("div",{className:"mb-3",children:e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"System Information"})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"System Type"}),e.jsx("div",{className:"text-sm font-bold text-blue-300 capitalize",children:s.star_system_type})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Planets"}),e.jsx("div",{className:"text-sm font-bold text-purple-300",children:s.num_planets})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-orange-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Stars"}),e.jsx("div",{className:"text-sm font-bold text-orange-300",children:s.stars.length})]})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-3",children:[(()=>{if(!window.domDataLogged){const i=s.planets.find(k=>k.name.toLowerCase().includes("tonnir"));i&&console.log("📄 DOM DATA - Tonnir_MD-1420:",{name:i.name,planet_type:i.planet_type,orbital_radius:i.orbital_radius,initial_orbital_angle:i.initial_orbital_angle,orbital_period_seconds:i.orbital_period_seconds,rotation_period_seconds:i.rotation_period_seconds,eccentricity_factor:i.eccentricity_factor,axial_tilt:i.axial_tilt,cosmicOriginTime:j}),window.domDataLogged=!0}return null})(),e.jsx(ct,{planets:s.planets,stars:s.stars,systemName:s.name,cosmicOriginTime:j})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-yellow-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Stellar Composition"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1",children:s.stars.map((i,k)=>e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-yellow-500/20",children:[e.jsxs("div",{className:"text-xs text-gray-300",children:["Star ",k+1]}),e.jsx("div",{className:"text-xs font-bold text-yellow-300",children:i.Type}),e.jsxs("div",{className:"text-xs text-gray-300",children:[i.Color," • ",i.Size]})]},k))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System:"}),e.jsx("div",{className:"text-white truncate font-medium",children:w(s.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System ID:"}),e.jsxs("div",{className:"text-white font-medium",children:["#",y+1]})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),e.jsx("div",{className:"text-white truncate font-medium",children:w(o.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),e.jsx("div",{className:"text-white font-medium",children:o.coordinates.join(", ")})]})]})]})]})},mt=({systemUrl:s,imageUrl:o})=>{const y=a.useRef(null),j=a.useRef(null),[w,i]=a.useState("Aligning Stargate..."),[k,x]=a.useState(!1),[N,R]=a.useState(!1),[M,P]=a.useState(!1);return a.useEffect(()=>{const r=document.createElement("style");return r.textContent=`
      [data-rmiz-modal-overlay="visible"] {
        background-color: rgba(0, 0, 0, 0.8) !important;
        backdrop-filter: blur(20px) !important;
        -webkit-backdrop-filter: blur(20px) !important;
        transition: backdrop-filter 0.3s ease-in-out !important;
      }
      
      [data-rmiz-modal-img] {
        border-radius: 1rem !important;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8) !important;
      }
      
      [data-rmiz-modal-overlay="hidden"] {
        backdrop-filter: blur(0px) !important;
        -webkit-backdrop-filter: blur(0px) !important;
        transition: backdrop-filter 0.3s ease-in-out !important;
      }
    `,document.head.appendChild(r),()=>{document.head.removeChild(r)}},[]),a.useEffect(()=>{const r=y.current;if(!r)return;const L=r.getContext("2d");if(!L)return;let $=[];const v=800;let z,g;const l=800;let c,F=.5;function _(){const C=r?.parentElement;if(!C||!r)return;const ee=C.clientWidth,ce=C.clientHeight;r.width=Math.min(ee,l),r.height=Math.min(ce,l),z=r.width/2,g=r.height/2}function ne(){_(),$=[];for(let C=0;C<v;C++)$.push({x:Math.random()*(r?.width||800),y:Math.random()*(r?.height||800),z:Math.random()*(r?.width||800),o:Math.random()});V()}function V(){!r||!L||(L.clearRect(0,0,r.width,r.height),$.forEach(C=>{C.z-=F,C.z<=0&&(C.z=r.width,C.x=Math.random()*r.width,C.y=Math.random()*r.height,C.o=Math.random());const ee=r.width/C.z,ce=(C.x-z)*ee+z,K=(C.y-g)*ee+g,J=2*ee;L.beginPath(),L.fillStyle=`rgba(255, 255, 255, ${C.o})`,L.arc(ce,K,J,0,2*Math.PI),L.fill()}),F<60&&(F+=1),c=requestAnimationFrame(V))}ne();const ue=()=>_();return window.addEventListener("resize",ue),()=>{window.removeEventListener("resize",ue),c&&cancelAnimationFrame(c)}},[]),a.useEffect(()=>{if(o){const r=new Image;r.onload=()=>{j.current&&(j.current.src=o,R(!0),P(!0))},r.onerror=()=>{console.error("Failed to load system image:",o),setTimeout(()=>{R(!0),P(!0)},1500)},r.src=o}else setTimeout(()=>{R(!0),P(!0)},1500)},[o]),a.useEffect(()=>{if(sessionStorage.getItem("stargateAnimationShown")){i("Stargate system aligned");return}sessionStorage.setItem("stargateAnimationShown","true"),x(!0);const L=(l,c)=>Array.from({length:c},()=>l[Math.floor(Math.random()*l.length)]).join(""),$=[{chars:"01",duration:40,iterations:20},{chars:"0123456789",duration:25,iterations:30},{chars:"0123456789ABCDEF",duration:20,iterations:40},{chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}|;:\\'\",.<>?/`~",duration:10,iterations:100}];let v=0,z=0;const g=()=>{if(v>=$.length){const c="Stargate system aligned";let F=0;i("");const _=()=>{F<c.length?(i(c.substring(0,F+1)),F++,setTimeout(_,30)):x(!1)};_();return}const l=$[v];i(L(l.chars,32)),z++,z>=l.iterations&&(v++,z=0),setTimeout(g,l.duration)};g()},[]),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white mb-3",children:"System Visualization"}),e.jsxs("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black/50 flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:[e.jsx("canvas",{ref:y,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${M?"opacity-0":"opacity-100"}`,style:{filter:M?"blur(50px)":"none"}}),e.jsx("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${N?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:N&&o?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Ze,{zoomMargin:20,classDialog:"backdrop-blur-3xl",children:e.jsx("img",{ref:j,className:"max-w-full max-h-full object-contain rounded-xl shadow-2xl shadow-blue-500/20",src:o,alt:"System visualization",style:{width:"100%",height:"100%",objectFit:"contain",backgroundColor:"transparent"}})})}):e.jsx("img",{ref:j,className:"w-full h-full object-cover",src:"/static/images/placeholder-min.jpg",alt:"System visualization"})})]}),e.jsxs("div",{className:"text-center mt-auto",children:[e.jsxs("a",{href:s,className:`inline-block px-4 py-2 bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 text-gray-200 font-medium text-sm rounded-lg border border-slate-600 hover:border-slate-500 shadow-md hover:shadow-lg transition-all duration-300 relative overflow-hidden group ${k?"animate-pulse":""}`,style:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("span",{className:"relative z-10 font-mono flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6s.792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95a1 1 0 001.715 1.029zM8.5 10a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM10 14c-.304 0-.792-.193-1.264-.979a1 1 0 00-1.715 1.029C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 00-1.715-1.029C10.792 13.807 10.304 14 10 14z",clipRule:"evenodd"})}),w]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-slate-600/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]})]})},ut=({planets:s,coordinates:o,systemIndex:y})=>{const[j,w]=a.useState(new Set);a.useEffect(()=>{(()=>{try{const N=et(o,y,s),R=new Set;N.forEach(M=>{R.add(M.toLowerCase())}),w(R)}catch(N){console.error("Error loading historical data:",N)}})()},[o,y,s]);const i=x=>x.replace(/_/g," "),k=x=>{try{tt(o,y,x,s)}catch(N){console.error("Error marking planet as visited:",N)}window.location.href=`/planet/${x.toLowerCase()}`};return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3",children:s.map(x=>e.jsxs("div",{className:"relative bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 hover:border-white/40 transition-all duration-300 group",children:[j.has(x.name.toLowerCase())&&e.jsx("div",{className:"absolute top-1 right-1 bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] px-1.5 py-0.5 rounded z-10",children:"VISITED"}),e.jsxs("button",{onClick:()=>k(x.name),className:"w-full text-left block p-2 sm:p-3 text-gray-200 hover:text-white transition-colors duration-300 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Planet"}),e.jsx("div",{className:"text-sm font-semibold text-white truncate group-hover:text-blue-300 transition-colors duration-300",children:i(x.name)})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]},x.name))}),s.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No planets found"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This system appears to be empty"})]})]})},ht=({currentSystem:s,galaxy:o})=>{const[y,j]=a.useState(!1),[w,i]=a.useState(!1),[k,x]=a.useState(!0),[N,R]=a.useState(!1),[M,P]=a.useState(null);a.useEffect(()=>{j(s.index>0),i(!0),x(!1)},[s.index]);const r=()=>me.previewTravelCost("system",1),L=g=>{P(g),R(!0)},$=()=>{R(!1),P(null)},v=async()=>{if(s.index>0){if(!me.canAffordTravel("system",1)){me.executeTravel("system",1);return}if(!me.executeTravel("system",1))return;const l=o.coordinates.join(",");ke(l,s.index-1),window.location.href=`/system/${s.index-1}`}},z=async()=>{if(!me.canAffordTravel("system",1)){me.executeTravel("system",1);return}if(!me.executeTravel("system",1))return;const l=o.coordinates.join(",");ke(l,s.index+1),window.location.href=`/system/${s.index+1}`};return k?null:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:v,onMouseEnter:()=>L("prev"),onMouseLeave:$,disabled:!y,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${y?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:z,onMouseEnter:()=>L("next"),onMouseLeave:$,disabled:!w,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${w?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),N&&M&&e.jsxs("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 z-50 bg-black/90 backdrop-blur-xl rounded-lg border border-blue-400/30 p-3 shadow-2xl min-w-max",children:[e.jsx("div",{className:"text-xs text-blue-300 font-semibold mb-1",children:"🚀 System Travel Cost"}),e.jsx("div",{className:"text-xs text-white",children:r()}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:[M==="prev"&&`← System ${s.index-1}`,M==="next"&&`System ${s.index+1} →`]})]})]})},xt=({system:s,galaxy:o,system_url:y,version:j,system_index:w,image_url:i,page:k,cosmic_origin_time:x})=>{const[N]=a.useState(o.coordinates.join(","));a.useEffect(()=>{document.body.setAttribute("data-coordinates",N),document.body.setAttribute("data-system-index",w.toString()),ke(N,w)},[N,w]);const R=P=>P.replace(/_/g," "),M=P=>P.replace(/_/g," ");return e.jsxs("div",{className:"w-full h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white overflow-auto",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(st,{}),e.jsxs("div",{className:"relative z-10 pt-1",children:[e.jsx(at,{}),e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["System '",R(s.name),"'"]}),e.jsxs("p",{className:"text-lg sm:text-xl text-gray-300",children:["at Galaxy '",M(o.name),"' - Coordinates ",o.coordinates.join(", ")]})]}),e.jsx(ht,{currentSystem:{name:s.name,index:w},galaxy:o}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[e.jsx("div",{className:"order-1 lg:order-1",children:e.jsx(mt,{systemUrl:y,imageUrl:i})}),e.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),e.jsx("div",{className:"order-2 lg:order-2",children:e.jsx(dt,{system:s,galaxy:o,systemIndex:w,cosmicOriginTime:x})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:["Planets in '",R(s.name),"'"]}),e.jsx(ut,{planets:s.planets,coordinates:N,systemIndex:w})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${k}`,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:e.jsxs("span",{className:"text-base sm:text-lg",children:["← Back to Galaxy '",M(o.name),"'"]})})})]}),e.jsx(it,{version:j})]}),e.jsx(nt,{currentLocation:{type:"system",name:s.name,coordinates:o.coordinates.join(","),systemIndex:s.index}})]})};document.addEventListener("DOMContentLoaded",async()=>{try{const s=document.getElementById("system-data"),o=document.getElementById("galaxy-data"),y=document.getElementById("meta-data");if(!s||!o||!y){console.error("Missing required data elements");return}const j=JSON.parse(s.textContent||"{}"),w=JSON.parse(o.textContent||"{}"),i=JSON.parse(y.textContent||"{}"),k={system:j,galaxy:w,system_url:i.system_url,version:i.version,system_index:i.system_index,image_url:i.image_url,page:i.page||1,cosmic_origin_time:i.cosmic_origin_time},x=document.getElementById("atlas-react-root");x&&Ue.createRoot(x).render(Qe.createElement(xt,k))}catch(s){console.error("Error initializing System React app:",s)}});
