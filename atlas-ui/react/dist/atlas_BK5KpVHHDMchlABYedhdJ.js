import{S as M}from"./atlas_CtOhIAiNHzSpXytHIyKwk.js";import{C as c,G as g,V as f,Q as T,n as O,T as x,z as S,D as N,M as E,i as G}from"./atlas_pGQiCQeTD5l6dMUXRRcYJ.js";const i={RIVER_COUNT:{min:20,max:30},OPACITY:{min:.01,max:.04},ELEVATION:{min:-.015,max:-.01},THICKNESS:{min:4,max:12},SEGMENTS:{min:40,max:80},CURVE_AMOUNT:{min:.05,max:.25},STEP_SIZE:{min:.02,max:.08}};class L{riverGroup;riverLines=[];params;rng;constructor(e,t={}){const r=t.seed||Math.floor(Math.random()*1e6);this.rng=new M(r),this.params={riverCount:t.riverCount||this.rng.randint(i.RIVER_COUNT.min,i.RIVER_COUNT.max),color:t.color||null,opacity:t.opacity||this.rng.uniform(i.OPACITY.min,i.OPACITY.max),elevation:t.elevation||this.rng.uniform(i.ELEVATION.min,i.ELEVATION.max),seed:r},this.riverGroup=new g,this.generateBasicRivers(e)}generateBasicRivers(e){const t=e+e*this.params.elevation;for(let r=0;r<this.params.riverCount;r++){const n=this.createSingleRiver(t,r);n&&(this.riverLines.push(n),this.riverGroup.add(n))}}createSingleRiver(e,t){const r=this.rng.uniform(-.6,.6),n=this.rng.uniform(0,Math.PI*2);let o=new f(Math.cos(n)*Math.cos(r)*e,Math.sin(r)*e,Math.sin(n)*Math.cos(r)*e);const a=[o.clone()];let s=this.getRandomTangentDirection(o,e);const h=this.rng.randint(i.SEGMENTS.min,i.SEGMENTS.max);for(let u=1;u<h;u++){const l=u/h,m=this.rng.uniform(i.CURVE_AMOUNT.min,i.CURVE_AMOUNT.max),v=this.rng.uniform(0,1);let p=0;v<.3?p=Math.sin(l*Math.PI*4)*m*.7:v<.6?p=Math.sin(l*Math.PI)*m:v<.8?p=(this.rng.uniform(-1,1)+Math.sin(l*Math.PI*3)*.5)*m:p=(l*8%2>1?1:-1)*m*(1-Math.abs(.5-l)*2);const R=this.rng.uniform(-.05,.05),C=(p+R)*.3,I=o.clone().normalize(),y=new T().setFromAxisAngle(I,C);s.applyQuaternion(y).normalize();const A=e*this.rng.uniform(i.STEP_SIZE.min,i.STEP_SIZE.max);o=o.clone().add(s.clone().multiplyScalar(A)),o.normalize().multiplyScalar(e),s=this.keepDirectionTangent(s,o,e),a.push(o.clone())}return this.createLineFromPoints(a,t)}getRandomTangentDirection(e,t){const r=e.clone().normalize(),n=Math.abs(r.y)<.9?new f(0,1,0):new f(1,0,0),o=new f().crossVectors(r,n).normalize(),a=this.rng.uniform(0,Math.PI*2),s=new T().setFromAxisAngle(r,a);return o.applyQuaternion(s)}keepDirectionTangent(e,t,r){const n=t.clone().normalize(),o=e.dot(n);return e.clone().sub(n.clone().multiplyScalar(o)).normalize()}createLineFromPoints(e,t){if(e.length<2)return null;const r=new g;let n;this.params.color?n=this.params.color instanceof c?this.params.color.clone():new c().setRGB(this.params.color[0],this.params.color[1],this.params.color[2]):n=new c(.3,.25,.2);const o=t*.05;n.multiplyScalar(1-o*.2);const s=this.rng.uniform(i.THICKNESS.min,i.THICKNESS.max)*.005,h=new O(e),u=new x(h,e.length-1,s,8,!1),l=new S({color:n,opacity:this.params.opacity,transparent:!0,depthWrite:!1,depthTest:!0,side:N}),m=new E(u,l);return m.renderOrder=1e3,r.add(m),r}addToScene(e,t){t&&this.riverGroup.position.copy(t),e.add(this.riverGroup)}update(e){}updateParams(e){this.params={...this.params,...e},(e.color||e.opacity)&&this.riverLines.forEach(t=>{t.children.forEach(r=>{if(r instanceof E&&r.material instanceof S){if(e.color){const n=e.color instanceof c?e.color:new c().setRGB(e.color[0],e.color[1],e.color[2]);r.material.color=n}e.opacity!==void 0&&(r.material.opacity=e.opacity,r.material.transparent=e.opacity<1)}})})}getObject3D(){return this.riverGroup}dispose(){this.riverLines.forEach(e=>{e.children.forEach(t=>{t instanceof E&&(t.geometry.dispose(),t.material instanceof G&&t.material.dispose())})}),this.riverLines=[],this.riverGroup.clear()}}function U(d,e,t){const n=(t||Math.floor(Math.random()*1e6))+8e3,o=e.river_data||e.dried_rivers||{},a=new M(n);let s=null;o.color?s=o.color instanceof c?o.color:new c().fromArray(o.color):s=new c(0,0,0);const h={riverCount:o.count||a.randint(i.RIVER_COUNT.min,i.RIVER_COUNT.max),color:s,opacity:o.opacity||a.uniform(i.OPACITY.min,i.OPACITY.max),elevation:o.elevation||a.uniform(i.ELEVATION.min,i.ELEVATION.max),seed:n};return new L(d,h)}export{L as R,U as c};
