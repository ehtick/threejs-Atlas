import{r as s,j as e,a as Xe,c as et,R as tt}from"./atlas_BiACxVxc6cO5okV5F68Rd.js";import{R as st,L as nt,c as at,d as rt,S as Ee,e as Pe,F as ot,H as it,a as lt}from"./atlas_BAqEsQWQ_MCEaSfE85tyi.js";import{W as Ie}from"./atlas_hV4YbJX4LmBeaYZmYRF0y.js";import{a2 as _e,C as Ge,a3 as Oe,G as $e,b as de,z as me,M as ue,V as Ne,B as Be,W as Ve,n as Ye,a8 as We,y as He,v as qe,cK as Ke,cL as Ze,I as ze}from"./atlas_BOOzg5XYrrU1N4SZySfRd.js";import{R as ct,S as dt,M as mt,a as Te,b as Ue,D as ut,T as ht}from"./atlas_JNmU8gMIa1SHExpBzTLAF.js";import{O as xt}from"./atlas_BJLzboHTaSIGvKgNbvLUr.js";import{V as ft}from"./atlas_DrLTn8mjMle6vK3_h1E1S.js";import"./atlas_5StMBQg7EZ_DcUhMgqODi.js";const Je=({planets:a,stars:c,systemName:g,cosmicOriginTime:D,currentTime:F,onTimeOffsetChange:E})=>{const U=s.useRef(null),w=s.useRef(null),d=s.useRef(null),B=s.useRef(null),A=s.useRef([]),T=s.useRef([]),m=s.useRef([]),V=s.useRef(0),ee=(S,Z="#ffffff")=>{const M=document.createElement("canvas"),h=M.getContext("2d");if(!h)return null;M.width=768,M.height=192,h.fillStyle="rgba(0, 0, 0, 0.8)",h.fillRect(0,0,M.width,M.height),h.strokeStyle="#ffffff",h.lineWidth=3,h.strokeRect(3,3,M.width-6,M.height-6),h.fillStyle=Z,h.font="bold 48px Arial",h.textAlign="center",h.textBaseline="middle",h.fillText(S,384,96);const u=new qe(M),P=new Ke({map:u,transparent:!0,alphaTest:.1}),Y=new Ze(P);return Y.scale.set(30,7.5,1),Y};return V.current=F,s.useEffect(()=>{if(!U.current)return;const S=U.current,Z=S.clientWidth,M=S.clientHeight,h=new _e;h.background=new Ge(17),w.current=h;const u=new Oe(60,Z/M,.1,1e4);u.position.set(0,120,180),u.lookAt(0,0,0);const P=new Ie({antialias:!0,alpha:!0});P.setSize(Z,M),P.setClearColor(17,1),d.current=P,S.appendChild(P.domElement);const Y={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},he={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},_=new $e;c.forEach((t,y)=>{const i=parseFloat(t.Size)*4,o=new de(i,32,32),k=he[t.Color]||"#FFFF44",O=new me({color:k,transparent:!0,opacity:.9}),j=new ue(o,O);c.length===1?j.position.set(0,0,0):c.length===2?j.position.set(y===0?-i*2:i*2,0,0):y===0?j.position.set(-i*2,0,0):y===1?j.position.set(i*2,0,0):j.position.set(0,i*2,0);const I=new de(i*1.5,32,32),te=new me({color:k,transparent:!0,opacity:.3}),X=new ue(I,te);j.add(X),_.add(j)}),h.add(_);const xe=Math.max(...a.map(t=>t.orbital_radius)),b=150;a.forEach((t,y)=>{const o=30+t.orbital_radius/xe*b,k=t.eccentricity_factor,O=o,j=O*Math.sqrt(1-k*k),I=360,te=2,X=4;for(let K=0;K<I;K+=te+X){const H=[];for(let Q=K;Q<Math.min(K+te,I-1);Q++){const oe=Q/I*2*Math.PI,ie=O*Math.cos(oe),Fe=j*Math.sin(oe);H.push(new Ne(ie,0,Fe))}if(H.length>1){const Q=new Be().setFromPoints(H),oe=new Ve({color:7372944,transparent:!0,opacity:.8,linewidth:2}),ie=new Ye(Q,oe);h.add(ie),T.current.push(ie)}}const se=t.diameter/8e3,C=Math.max(Math.min(se,8),2.5),p=new de(C,32,32),q=Y[t.planet_type]||"#FFFFFF",n=new me({color:q,transparent:!0,opacity:.9}),f=new ue(p,n),R=new ue(new de(C*1.5,32,32),new me({color:q,transparent:!0,opacity:.2}));f.add(R),h.add(f),A.current.push(f),f.planetData=t,f.orbitRadius=o,f.semiMajorAxis=O,f.semiMinorAxis=j;const W=t.name.replace(/_/g," "),L=ee(W,"#ffffff");L&&(L.position.copy(f.position),L.position.y+=C+10,L.planetData=t,h.add(L),m.current.push(L))});const ce=new We(4210752,.4);h.add(ce);const fe=new He(16777215,1,2e3);fe.position.set(0,0,0),h.add(fe);let ne=!1,re=0,ae=0,we=0;const ge=t=>{ne=!0,re=t.clientX,ae=t.clientY},ye=t=>{if(!ne)return;const y=t.clientX-re,i=t.clientY-ae,o=new ze;o.setFromVector3(u.position),o.theta-=y*.01,o.phi+=i*.01,o.phi=Math.max(.1,Math.min(Math.PI-.1,o.phi)),u.position.setFromSpherical(o),u.lookAt(0,0,0),re=t.clientX,ae=t.clientY},N=()=>{ne=!1,setTimeout(()=>{},3e3)},z=t=>{if(t.ctrlKey)t.preventDefault(),t.deltaY>0?E(604800):E(-604800);else{t.preventDefault();const y=.1,i=u.position.distanceTo(new Ne(0,0,0));t.deltaY>0&&i<800?u.position.multiplyScalar(1+y):t.deltaY<0&&i>50&&u.position.multiplyScalar(1-y)}},r=t=>{t.key==="Escape"&&document.dispatchEvent(new CustomEvent("solar-system-close-fullscreen"))},l=t=>{if(t.preventDefault(),t.touches.length===1)ne=!0,re=t.touches[0].clientX,ae=t.touches[0].clientY;else if(t.touches.length===2){const y=t.touches[0].clientX-t.touches[1].clientX,i=t.touches[0].clientY-t.touches[1].clientY;we=Math.sqrt(y*y+i*i)}},v=t=>{if(t.preventDefault(),t.touches.length===1&&ne){const y=t.touches[0].clientX-re,i=t.touches[0].clientY-ae,o=new ze;o.setFromVector3(u.position),o.theta-=y*.01,o.phi+=i*.01,o.phi=Math.max(.1,Math.min(Math.PI-.1,o.phi)),u.position.setFromSpherical(o),u.lookAt(0,0,0),re=t.touches[0].clientX,ae=t.touches[0].clientY}else if(t.touches.length===2){const y=t.touches[0].clientX-t.touches[1].clientX,i=t.touches[0].clientY-t.touches[1].clientY,o=Math.sqrt(y*y+i*i);if(we>0){const O=o/we,j=u.position.distanceTo(new Ne(0,0,0));O>1&&j>50?u.position.multiplyScalar(1-.01):O<1&&j<800&&u.position.multiplyScalar(1+.01)}we=o}},G=t=>{t.preventDefault(),ne=!1,we=0,setTimeout(()=>{},3e3)},x=P.domElement;x.style.cursor="grab",x.addEventListener("mousedown",t=>{x.style.cursor="grabbing",ge(t)}),x.addEventListener("mousemove",ye),x.addEventListener("mouseup",()=>{x.style.cursor="grab",N()}),x.addEventListener("mouseleave",()=>{x.style.cursor="grab",N()}),x.addEventListener("wheel",z),x.addEventListener("touchstart",l,{passive:!1}),x.addEventListener("touchmove",v,{passive:!1}),x.addEventListener("touchend",G,{passive:!1}),document.addEventListener("keydown",r);const J=()=>{B.current=requestAnimationFrame(J),A.current.forEach((t,y)=>{const i=t.planetData,o=t.semiMajorAxis,k=t.semiMinorAxis,O=i.orbital_period_seconds,j=2*Math.PI/O,I=(i.initial_orbital_angle+V.current*j)%(2*Math.PI);t.position.x=o*Math.cos(I),t.position.z=k*Math.sin(I),t.position.y=0;const te=i.rotation_period_seconds,X=2*Math.PI/te;if(t.rotation.y=V.current*X%(2*Math.PI),m.current[y]){const se=t.geometry.parameters?.radius||2;m.current[y].position.copy(t.position),m.current[y].position.y+=se+10}}),P.render(h,u)};J();const $=()=>{const t=S.clientWidth,y=S.clientHeight;u.aspect=t/y,u.updateProjectionMatrix(),P.setSize(t,y)};return window.addEventListener("resize",$),()=>{window.removeEventListener("resize",$),document.removeEventListener("keydown",r),x.removeEventListener("mousedown",ge),x.removeEventListener("mousemove",ye),x.removeEventListener("mouseup",N),x.removeEventListener("mouseleave",N),x.removeEventListener("wheel",z),x.removeEventListener("touchstart",l),x.removeEventListener("touchmove",v),x.removeEventListener("touchend",G),B.current&&cancelAnimationFrame(B.current),S&&P.domElement&&S.removeChild(P.domElement),P.dispose(),A.current=[],T.current=[],m.current=[]}},[a,c,D]),e.jsx("div",{ref:U,className:"w-full h-full"})},pt=({planets:a,stars:c,systemName:g,cosmicOriginTime:D})=>{const F=s.useRef(null),E=s.useRef(null),U=s.useRef(null),w=s.useRef(null),d=s.useRef([]),B=s.useRef([]),A=s.useRef([]),T=s.useRef(0),m=Math.floor(Date.now()/1e3),[V,ee]=s.useState(0),[S,Z]=s.useState(!1),[M,h]=s.useState(!1),[u,P]=s.useState(!1),[Y,he]=s.useState(0),[_,xe]=s.useState(null),[b,ce]=s.useState(!0),[fe,ne]=s.useState(null),re=m-D+V;T.current=re,s.useEffect(()=>{(async()=>{try{ce(!0),ne(null);const z=await fetch("/api/system/rendering-data");if(!z.ok)throw new Error(`HTTP error! status: ${z.status}`);const r=await z.json();if(r.success)xe(r.system_data);else throw new Error(r.error||"Failed to fetch system data")}catch(z){ne(z instanceof Error?z.message:"Unknown error")}finally{ce(!1)}})()},[]);const ae=()=>{h(!0),setTimeout(()=>{Z(!1),h(!1)},300)},we=(N,z="#ffffff")=>{const r=document.createElement("canvas"),l=r.getContext("2d");if(!l)return null;r.width=512,r.height=128,l.fillStyle="rgba(0, 0, 0, 0.7)",l.fillRect(0,0,r.width,r.height),l.strokeStyle="#ffffff",l.lineWidth=2,l.strokeRect(2,2,r.width-4,r.height-4),l.fillStyle=z,l.font="bold 32px Arial",l.textAlign="center",l.textBaseline="middle",l.fillText(N,256,64);const v=new qe(r),G=new Ke({map:v,transparent:!0,alphaTest:.1}),x=new Ze(G);return x.scale.set(20,5,1),x};s.useEffect(()=>{const N=z=>{z.key==="Escape"&&S&&ae()};return S&&he(V),document.addEventListener("solar-system-close-fullscreen",ae),document.addEventListener("keydown",N),()=>{document.removeEventListener("solar-system-close-fullscreen",ae),document.removeEventListener("keydown",N)}},[S,V]),s.useEffect(()=>{if(S&&u){const N=setTimeout(()=>{P(!1)},50);return()=>clearTimeout(N)}},[S,u]),s.useEffect(()=>{if(b||!_||(window.tonnirLoggedInSystem=!1,!F.current))return;const N=F.current,z=N.clientWidth,r=z<640,l=new _e;l.background=new Ge(17),E.current=l;const v=new Oe(45,z/(r?120:140),.1,1e4);v.position.set(0,80,120),v.lookAt(0,0,0);const G=new Ie({antialias:!0,alpha:!0});G.setSize(z,r?120:140),G.setClearColor(17,1),U.current=G,N.appendChild(G.domElement);const x={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},J={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},$=new $e;_.stars.forEach((n,f)=>{const R=parseFloat(n.Size)*3,W=new de(R,16,16),L=J[n.Color]||"#FFFF44",K=new me({color:L,transparent:!0,opacity:.9}),H=new ue(W,K);_.stars.length===1?H.position.set(0,0,0):_.stars.length===2?H.position.set(f===0?-R*2:R*2,0,0):f===0?H.position.set(-R*2,0,0):f===1?H.position.set(R*2,0,0):H.position.set(0,R*2,0);const Q=new de(R*1.5,16,16),oe=new me({color:L,transparent:!0,opacity:.3}),ie=new ue(Q,oe);H.add(ie),$.add(H)}),l.add($);const t=_.timing.max_orbital_radius,y=80;window.systemMaxOrbitalRadius=t,_.planets.forEach((n,f)=>{const W=20+n.orbital_radius/t*y,L=n.eccentricity_factor,K=W,H=K*Math.sqrt(1-L*L),Q=360,oe=2,ie=4;for(let ve=0;ve<Q;ve+=oe+ie){const Me=[];for(let ke=ve;ke<Math.min(ve+oe,Q-1);ke++){const Re=ke/Q*2*Math.PI,Le=K*Math.cos(Re),Qe=H*Math.sin(Re);Me.push(new Ne(Le,0,Qe))}if(Me.length>1){const ke=new Be().setFromPoints(Me),Re=new Ve({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Le=new Ye(ke,Re);l.add(Le),B.current.push(Le)}}const Fe=n.diameter/15e3,Ce=Math.max(Math.min(Fe,4),1.5),De=new de(Ce,16,16),be=x[n.planet_type]||"#FFFFFF",Ae=new me({color:be,transparent:!0,opacity:.9}),le=new ue(De,Ae),Se=new ue(new de(Ce*1.5,16,16),new me({color:be,transparent:!0,opacity:.2}));le.add(Se),l.add(le),d.current.push(le),le.planetData=n,le.orbitRadius=W,le.semiMajorAxis=K,le.semiMinorAxis=H;const je=n.name.replace(/_/g," "),pe=we(je,"#ffffff");pe&&(pe.position.copy(le.position),pe.position.y+=Ce+6,pe.planetData=n,l.add(pe),A.current.push(pe))});const i=new We(4210752,.4);l.add(i);const o=new He(16777215,1,1e3);o.position.set(0,0,0),l.add(o);let k=!1,O=0,j=0;const I=n=>{k=!0,O=n.clientX,j=n.clientY},te=n=>{if(!k)return;const f=n.clientX-O,R=n.clientY-j,W=new ze;W.setFromVector3(v.position),W.theta-=f*.01,W.phi+=R*.01,W.phi=Math.max(.1,Math.min(Math.PI-.1,W.phi)),v.position.setFromSpherical(W),v.lookAt(0,0,0),O=n.clientX,j=n.clientY},X=()=>{k=!1,setTimeout(()=>{},3e3)},se=n=>{if(n.ctrlKey)n.preventDefault(),n.deltaY>0?ee(f=>f+604800):ee(f=>f-604800);else{n.preventDefault();const f=.1,R=v.position.distanceTo(new Ne(0,0,0));n.deltaY>0&&R<500?v.position.multiplyScalar(1+f):n.deltaY<0&&R>20&&v.position.multiplyScalar(1-f)}},C=G.domElement;C.style.cursor="grab",C.style.borderRadius="8px",C.addEventListener("mousedown",n=>{C.style.cursor="grabbing",I(n)}),C.addEventListener("mousemove",te),C.addEventListener("mouseup",()=>{C.style.cursor="grab",X()}),C.addEventListener("mouseleave",()=>{C.style.cursor="grab",X()}),C.addEventListener("wheel",se);const p=()=>{w.current=requestAnimationFrame(p),d.current.forEach((n,f)=>{const R=n.planetData,W=n.semiMajorAxis,L=n.semiMinorAxis,K=R.orbital_period_seconds,H=2*Math.PI/K,Q=(R.initial_orbital_angle+T.current*H)%(2*Math.PI);n.position.x=W*Math.cos(Q),n.position.z=L*Math.sin(Q),n.position.y=0;const oe=R.rotation_period_seconds,ie=2*Math.PI/oe;if(n.rotation.y=T.current*ie%(2*Math.PI),A.current[f]){const Fe=n.geometry.parameters?.radius||2;A.current[f].position.copy(n.position),A.current[f].position.y+=Fe+6}}),G.render(l,v)};p();const q=()=>{const n=N.clientWidth,f=n<640?120:140;v.aspect=n/f,v.updateProjectionMatrix(),G.setSize(n,f)};return window.addEventListener("resize",q),()=>{window.removeEventListener("resize",q),C.removeEventListener("mousedown",I),C.removeEventListener("mousemove",te),C.removeEventListener("mouseup",X),C.removeEventListener("mouseleave",X),C.removeEventListener("wheel",se),w.current&&cancelAnimationFrame(w.current),N&&G.domElement&&N.removeChild(G.domElement),G.dispose(),d.current=[],B.current=[],A.current=[]}},[a,c,D,_]);const ge=N=>{const z=Math.floor(N/31557600),r=Math.floor(N%(365.25*24*3600)/(24*3600)),l=Math.floor(N%(24*3600)/3600);return z>0?`${z}y ${r}d ${l}h`:r>0?`${r}d ${l}h`:`${l}h`},ye=N=>N.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Solar System Perspective"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{ref:F,className:"w-full border border-white/20 rounded bg-black/20",style:{height:"auto"}}),!b&&!fe&&g&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:g})}),e.jsx("button",{onClick:()=>{Z(!0),P(!0)},className:"absolute top-2 right-2 p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg z-10",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-[10px]",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-[10px]",children:[_?.planets?.length||a.length," Planets"]})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Time: ",ge(re)]})]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View"})]})]}),S&&Xe.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${M||u?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${M||u?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:ye(g)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:ye(g)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[_?.planets?.length||a.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",ge(m-D+Y)]})]})]}),e.jsx("button",{onClick:ae,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:Y,onChange:N=>he(Number(N.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>he(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",Y===0?"Present":Y>0?`+${Math.abs(Y/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(Y/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Je,{planets:_?.planets||a,stars:_?.stars||c,systemName:g,cosmicOriginTime:D,currentTime:m-D+Y,onTimeOffsetChange:N=>he(z=>z+N)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},gt=({system:a,galaxy:c,systemIndex:g,cosmicOriginTime:D})=>{const[F,E]=s.useState({isOnCooldown:!1,isSaved:!1,isCollecting:!1,timeUntilNext:0});s.useEffect(()=>{let w;const d=()=>{const m=Te.generateLocationId("system",c.coordinates.join(","),g,void 0),V=Te.canCollectFromLocation(m),ee=Te.getTimeUntilNextCollection(m),S=c.coordinates,Z=Ue.generateSystemUrl(S,g,Ue.getCurrentPage()),h=nt.getLocations().some(u=>u.stargateUrl===Z);E(u=>({isOnCooldown:!V&&ee>0,isSaved:h,isCollecting:u.isCollecting,timeUntilNext:ee}))},B=()=>{E(m=>({...m,isCollecting:!0})),w=setTimeout(()=>{E(m=>({...m,isCollecting:!1}))},1e3)};d();const A=setInterval(d,1e3),T=st.subscribe("mining_completed",B);return()=>{clearInterval(A),w&&clearTimeout(w),T()}},[a.name,g,c.coordinates]);const U=w=>w.replace(/_/g," ");return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[e.jsx(ct,{locationType:"system",locationId:a.name,coordinates:c.coordinates.join(","),systemIndex:g,className:"text-xs"}),e.jsx(dt,{type:"system",name:a.name,coordinates:c.coordinates.join(","),systemIndex:g,className:"text-xs"}),e.jsx("div",{className:"inline-flex items-center bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] font-medium px-1.5 py-0.5 rounded h-[21px] box-border",children:"VISITED"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(mt,{isOnCooldown:F.isOnCooldown,isSaved:F.isSaved,isCollecting:F.isCollecting}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Details"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"System Type"}),e.jsx("div",{className:"text-sm font-bold text-blue-300 capitalize",children:a.star_system_type})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Planets"}),e.jsx("div",{className:"text-sm font-bold text-purple-300",children:a.num_planets})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-orange-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Stars"}),e.jsx("div",{className:"text-sm font-bold text-orange-300",children:a.stars.length})]})]}),e.jsx("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-3",children:e.jsx(pt,{planets:a.planets,stars:a.stars,systemName:a.name,cosmicOriginTime:D})}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-yellow-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Stellar Composition"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1",children:a.stars.map((w,d)=>e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-yellow-500/20",children:[e.jsxs("div",{className:"text-xs text-gray-300",children:["Star ",d+1]}),e.jsx("div",{className:"text-xs font-bold text-yellow-300",children:w.Type}),e.jsxs("div",{className:"text-xs text-gray-300",children:[w.Color," • ",w.Size]})]},d))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System:"}),e.jsx("div",{className:"text-white truncate font-medium",children:U(a.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System ID:"}),e.jsxs("div",{className:"text-white font-medium",children:["#",g+1]})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),e.jsx("div",{className:"text-white truncate font-medium",children:U(c.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),e.jsx("div",{className:"text-white font-medium",children:c.coordinates.join(", ")})]})]})]})]})},bt=({planets:a,stars:c,systemName:g,cosmicOriginTime:D})=>{const F=s.useRef(null),E=s.useRef(null),U=s.useRef(null),w=s.useRef(null),d=s.useRef([]),B=s.useRef([]),A=s.useRef([]),T=s.useRef(null),m=s.useRef(0),V=s.useRef(null),ee=Math.floor(Date.now()/1e3),[S,Z]=s.useState(0),[M,h]=s.useState(!1),[u,P]=s.useState(!1),[Y,he]=s.useState(!1),[_,xe]=s.useState(0),[b,ce]=s.useState(null),[fe,ne]=s.useState(!0),[re,ae]=s.useState(null),we=ee-D+S;m.current=we,s.useEffect(()=>{(async()=>{try{ne(!0),ae(null);const l=await fetch("/api/system/rendering-data");if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const v=await l.json();if(v.success)ce(v.system_data);else throw new Error(v.error||"Failed to fetch system data")}catch(l){ae(l instanceof Error?l.message:"Unknown error")}finally{ne(!1)}})()},[]);const ge=()=>{P(!0),setTimeout(()=>{h(!1),P(!1)},300)};s.useEffect(()=>{const r=l=>{l.key==="Escape"&&M&&ge()};return M&&xe(S),document.addEventListener("solar-system-close-fullscreen",ge),document.addEventListener("keydown",r),()=>{document.removeEventListener("solar-system-close-fullscreen",ge),document.removeEventListener("keydown",r)}},[M,S]),s.useEffect(()=>{if(M&&Y){const r=setTimeout(()=>{he(!1)},50);return()=>clearTimeout(r)}},[M,Y]),s.useEffect(()=>{if(fe||!b||(window.tonnirLoggedInSystem=!1,!F.current))return;const r=F.current,l=r.clientWidth,v=r.clientHeight,G=Math.min(l,v),x=new _e;x.background=new Ge(17),E.current=x;const J=new Oe(45,1,.1,1e4);J.position.set(0,300,0),J.lookAt(0,0,0),V.current=J;const $=new Ie({antialias:!0,alpha:!0});$.setSize(G,G),$.setClearColor(17,1),U.current=$,r.appendChild($.domElement);const t={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},y={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},i=new $e;b.stars.forEach((p,q)=>{const n=parseFloat(p.Size)*3,f=new de(n,16,16),R=y[p.Color]||"#FFFF44",W=new me({color:R,transparent:!0,opacity:.9}),L=new ue(f,W);b.stars.length===1?L.position.set(0,0,0):b.stars.length===2?L.position.set(q===0?-n*2:n*2,0,0):q===0?L.position.set(-n*2,0,0):q===1?L.position.set(n*2,0,0):L.position.set(0,n*2,0);const K=new de(n*1.5,16,16),H=new me({color:R,transparent:!0,opacity:.3}),Q=new ue(K,H);L.add(Q),i.add(L)}),x.add(i);const o=b.timing.max_orbital_radius,k=80;window.systemMaxOrbitalRadius=o,b.planets.forEach((p,q)=>{const f=20+p.orbital_radius/o*k,R=p.eccentricity_factor,W=f,L=W*Math.sqrt(1-R*R),K=360,H=2,Q=4;for(let le=0;le<K;le+=H+Q){const Se=[];for(let je=le;je<Math.min(le+H,K-1);je++){const pe=je/K*2*Math.PI,ve=W*Math.cos(pe),Me=L*Math.sin(pe);Se.push(new Ne(ve,0,Me))}if(Se.length>1){const je=new Be().setFromPoints(Se),pe=new Ve({color:7372944,transparent:!0,opacity:.8,linewidth:2}),ve=new Ye(je,pe);x.add(ve),B.current.push(ve)}}const oe=p.diameter/15e3,ie=Math.max(Math.min(oe,4),1.5),Fe=new de(ie,16,16),Ce=t[p.planet_type]||"#FFFFFF",De=new me({color:Ce,transparent:!0,opacity:.9}),be=new ue(Fe,De),Ae=new ue(new de(ie*1.5,16,16),new me({color:Ce,transparent:!0,opacity:.2}));be.add(Ae),x.add(be),d.current.push(be),be.planetData=p,be.orbitRadius=f,be.semiMajorAxis=W,be.semiMinorAxis=L,A.current.push(null)});const O=new We(4210752,.4);x.add(O);const j=new He(16777215,1,1e3);j.position.set(0,0,0),x.add(j);const I=new xt(J,$.domElement);I.enableDamping=!0,I.dampingFactor=.05,I.minDistance=50,I.maxDistance=800,I.autoRotate=!1,I.autoRotateSpeed=.5,I.enablePan=!0,I.enableZoom=!0,I.target.set(0,0,0),T.current=I;const te=p=>{if(p.ctrlKey)p.preventDefault(),p.deltaY>0?Z(q=>q+604800):Z(q=>q-604800);else{p.preventDefault();const q=.1,n=J.position.distanceTo(new Ne(0,0,0));p.deltaY>0&&n<500?J.position.multiplyScalar(1+q):p.deltaY<0&&n>20&&J.position.multiplyScalar(1-q)}},X=$.domElement;X.style.borderRadius="8px",X.addEventListener("wheel",te);const se=()=>{w.current=requestAnimationFrame(se),d.current.forEach((p,q)=>{const n=p.planetData,f=p.semiMajorAxis,R=p.semiMinorAxis,W=n.orbital_period_seconds,L=2*Math.PI/W,K=(n.initial_orbital_angle+m.current*L)%(2*Math.PI);p.position.x=f*Math.cos(K),p.position.z=R*Math.sin(K),p.position.y=0;const H=n.rotation_period_seconds,Q=2*Math.PI/H;p.rotation.y=m.current*Q%(2*Math.PI)}),T.current&&T.current.update(),$.render(x,J)};se();const C=()=>{if(!F.current||!$)return;const p=F.current,q=Math.min(p.clientWidth,p.clientHeight);$.setSize(q,q),J.aspect=1,J.updateProjectionMatrix()};return window.addEventListener("resize",C),()=>{window.removeEventListener("resize",C),X.removeEventListener("wheel",te),T.current&&T.current.dispose(),w.current&&cancelAnimationFrame(w.current),r&&$.domElement&&r.removeChild($.domElement),$.dispose(),d.current=[],B.current=[],A.current=[]}},[a,c,D,b,S]);const ye=()=>{if(!U.current||!E.current||!V.current)return;const r=U.current,l=E.current,v=V.current,G=r.domElement.width,x=r.domElement.height,J=3840/G,$=[];l.traverse(i=>{if(i.isPoints&&i.material){const o=i.material;if(o.size!==void 0&&($.push({material:o,originalSize:o.size}),o.size=o.size*J*1),i.geometry&&i.geometry.attributes.size){const k=i.geometry.attributes.size,O=k.array.slice();$.push({geometry:i.geometry,originalSizeArray:O});for(let j=0;j<k.array.length;j++)k.array[j]*=J*1;k.needsUpdate=!0}}if(i.isSprite&&($.push({object:i,originalScale:i.scale.clone()}),i.scale.multiplyScalar(J*1)),i.isLine&&i.material){const o=i.material;o.linewidth!==void 0&&($.push({material:o,originalLinewidth:o.linewidth}),o.linewidth=o.linewidth*J*1)}});const t=3840,y=3840;r.setSize(t,y),v.aspect=1,v.updateProjectionMatrix(),r.render(l,v),r.domElement.toBlob(i=>{if(i){const o=document.createElement("canvas"),k=o.getContext("2d");if(o.width=t,o.height=y,k){const O=new Image;O.onload=()=>{k.drawImage(O,0,0);const te=`Copyright Banshee - 2023-${new Date().getFullYear()}`;k.fillStyle="rgba(255, 255, 255, 0.5)",k.font=`${Math.floor(t/80)}px Arial`,k.textAlign="left",k.textBaseline="bottom";const X=Math.floor(t/100);k.fillText(te,X,y-X),o.toBlob(se=>{if(se){const C=URL.createObjectURL(se),p=document.createElement("a");p.href=C,p.download=`system_${g}_${Date.now()}.png`,p.click(),URL.revokeObjectURL(C)}},"image/png",1)};const j=URL.createObjectURL(i);O.src=j}}$.forEach(({material:o,object:k,originalSize:O,originalScale:j,originalLinewidth:I,geometry:te,originalSizeArray:X})=>{if(O!==void 0&&(o.size=O),j!==void 0&&k.scale.copy(j),I!==void 0&&(o.linewidth=I),te&&X){const se=te.attributes.size;for(let C=0;C<X.length;C++)se.array[C]=X[C];se.needsUpdate=!0}}),r.setSize(G,x),v.aspect=1,v.updateProjectionMatrix()},"image/png",1)},N=r=>{const l=Math.floor(r/31557600),v=Math.floor(r%(365.25*24*3600)/(24*3600)),G=Math.floor(r%(24*3600)/3600);return l>0?`${l}y ${v}d ${G}h`:v>0?`${v}d ${G}h`:`${G}h`},z=r=>r.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center w-full h-full",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{ref:F,className:"w-full h-full border border-white/20 rounded bg-black/20"}),!fe&&!re&&g&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:z(g)})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 z-10",children:[e.jsx("button",{onClick:ye,className:"p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg",title:"Download screenshot",children:e.jsx(ut,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>{h(!0),he(!0)},className:"p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})]})}),M&&Xe.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${u||Y?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${u||Y?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:z(g)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:z(g)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[b?.planets?.length||a.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",N(ee-D+_)]})]})]}),e.jsx("button",{onClick:ge,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:_,onChange:r=>xe(Number(r.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>xe(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",_===0?"Present":_>0?`+${Math.abs(_/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(_/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Je,{planets:b?.planets||a,stars:b?.stars||c,systemName:g,cosmicOriginTime:D,currentTime:ee-D+_,onTimeOffsetChange:r=>xe(l=>l+r)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},wt=({systemUrl:a,system:c,cosmicOriginTime:g})=>{const D=s.useRef(null),[F,E]=s.useState("Aligning Stargate..."),[U,w]=s.useState(!1),[d,B]=s.useState(!1),[A,T]=s.useState(!1);return s.useEffect(()=>{const m=D.current;if(!m)return;const V=m.getContext("2d");if(!V)return;let ee=[];const S=800;let Z,M;const h=800;let u,P=.5;function Y(){const b=m?.parentElement;if(!b||!m)return;const ce=b.clientWidth,fe=b.clientHeight;m.width=Math.min(ce,h),m.height=Math.min(fe,h),Z=m.width/2,M=m.height/2}function he(){Y(),ee=[];for(let b=0;b<S;b++)ee.push({x:Math.random()*(m?.width||800),y:Math.random()*(m?.height||800),z:Math.random()*(m?.width||800),o:Math.random()});_()}function _(){!m||!V||(V.clearRect(0,0,m.width,m.height),ee.forEach(b=>{b.z-=P,b.z<=0&&(b.z=m.width,b.x=Math.random()*m.width,b.y=Math.random()*m.height,b.o=Math.random());const ce=m.width/b.z,fe=(b.x-Z)*ce+Z,ne=(b.y-M)*ce+M,re=2*ce;V.beginPath(),V.fillStyle=`rgba(255, 255, 255, ${b.o})`,V.arc(fe,ne,re,0,2*Math.PI),V.fill()}),P<60&&(P+=1),u=requestAnimationFrame(_))}he();const xe=()=>Y();return window.addEventListener("resize",xe),()=>{window.removeEventListener("resize",xe),u&&cancelAnimationFrame(u)}},[]),s.useEffect(()=>{B(!0),setTimeout(()=>{T(!0)},800)},[]),s.useEffect(()=>{if(sessionStorage.getItem("stargateAnimationShown")){E("Stargate system aligned");return}sessionStorage.setItem("stargateAnimationShown","true"),w(!0);const V=(h,u)=>Array.from({length:u},()=>h[Math.floor(Math.random()*h.length)]).join(""),ee=[{chars:"01",duration:40,iterations:20},{chars:"0123456789",duration:25,iterations:30},{chars:"0123456789ABCDEF",duration:20,iterations:40},{chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}|;:\\'\",.<>?/`~",duration:10,iterations:100}];let S=0,Z=0;const M=()=>{if(S>=ee.length){const u="Stargate system aligned";let P=0;E("");const Y=()=>{P<u.length?(E(u.substring(0,P+1)),P++,setTimeout(Y,30)):w(!1)};Y();return}const h=ee[S];E(V(h.chars,32)),Z++,Z>=h.iterations&&(S++,Z=0),setTimeout(M,h.duration)};M()},[]),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h3",{className:"text-sm font-medium text-white",children:c?.name||"System"})}),e.jsxs("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:[e.jsx("canvas",{ref:D,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${A?"opacity-0":"opacity-100"}`,style:{filter:A?"blur(50px)":"none"}}),d&&c&&e.jsx("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${d&&A?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:e.jsx(bt,{planets:c.planets,stars:c.stars,systemName:c.name,cosmicOriginTime:g||0})})]}),e.jsxs("div",{className:"text-center mt-auto",children:[e.jsxs("a",{href:a,className:`inline-block px-4 py-2 bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 text-gray-200 font-medium text-sm rounded-lg border border-slate-600 hover:border-slate-500 shadow-md hover:shadow-lg transition-all duration-300 relative overflow-hidden group ${U?"animate-pulse":""}`,style:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("span",{className:"relative z-10 font-mono flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6s.792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95a1 1 0 001.715 1.029zM8.5 10a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM10 14c-.304 0-.792-.193-1.264-.979a1 1 0 00-1.715 1.029C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 00-1.715-1.029C10.792 13.807 10.304 14 10 14z",clipRule:"evenodd"})}),F]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-slate-600/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]})]})},vt=({planets:a,coordinates:c,systemIndex:g})=>{const[D,F]=s.useState(new Set),E=d=>({"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"})[d]||"#FFFFFF";s.useEffect(()=>{(()=>{try{const B=at(c,g,a),A=new Set;B.forEach(T=>{A.add(T.toLowerCase())}),F(A)}catch{}})()},[c,g,a]);const U=d=>d.replace(/_/g," "),w=d=>{try{rt(c,g,d,a)}catch{}window.location.href=`/planet/${d.toLowerCase()}`};return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3",children:a.map(d=>e.jsxs("div",{className:"relative bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 hover:border-white/40 transition-all duration-300 group overflow-hidden",children:[D.has(d.name.toLowerCase())&&e.jsx("div",{className:"absolute top-1 right-1 bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] px-1.5 py-0.5 rounded z-10",children:"VISITED"}),e.jsx("div",{className:"absolute -top-3 -left-3 w-8 h-8 rounded-full border border-white/40 shadow-sm z-20 animate-pulse",style:{backgroundColor:E(d.planet_type)}}),e.jsxs("button",{onClick:()=>w(d.name),className:"w-full text-left block p-2 sm:p-3 text-gray-200 hover:text-white transition-colors duration-300 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Planet"}),e.jsx("div",{className:"text-sm font-semibold text-white truncate group-hover:text-blue-300 transition-colors duration-300",children:U(d.name)})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]},d.name))}),a.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No planets found"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This system appears to be empty"})]})]})},yt=({currentSystem:a,galaxy:c})=>{const[g,D]=s.useState(!1),[F,E]=s.useState(!1),[U,w]=s.useState(!0);s.useEffect(()=>{D(a.index>0),E(!0),w(!1)},[a.index]);const d=async()=>{if(a.index>0){if(!Ee.canAffordTravel("system",1)){Ee.executeTravel("system",1);return}if(!Ee.executeTravel("system",1))return;const T=c.coordinates.join(",");Pe(T,a.index-1),window.location.href=`/system/${a.index-1}`}},B=async()=>{if(!Ee.canAffordTravel("system",1)){Ee.executeTravel("system",1);return}if(!Ee.executeTravel("system",1))return;const T=c.coordinates.join(",");Pe(T,a.index+1),window.location.href=`/system/${a.index+1}`};return U?null:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:d,disabled:!g,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${g?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:B,disabled:!F,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${F?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})},Ft=({system:a,galaxy:c,system_url:g,version:D,system_index:F,image_url:E,page:U,cosmic_origin_time:w})=>{const[d]=s.useState(c.coordinates.join(","));s.useEffect(()=>{document.body.setAttribute("data-coordinates",d),document.body.setAttribute("data-system-index",F.toString()),Pe(d,F)},[d,F]);const B=T=>T.replace(/_/g," "),A=T=>T.replace(/_/g," ");return e.jsxs("div",{className:"w-full h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white overflow-auto",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(ot,{}),e.jsxs("div",{className:"relative z-10 pt-1",children:[e.jsx(it,{}),e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["System '",B(a.name),"'"]}),e.jsxs("p",{className:"text-lg sm:text-xl text-gray-300",children:["at Galaxy '",A(c.name),"' - Coordinates ",c.coordinates.join(", ")]})]}),e.jsx(yt,{currentSystem:{name:a.name,index:F},galaxy:c}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[e.jsx("div",{className:"order-1 lg:order-1",children:e.jsx(wt,{systemUrl:g,system:a,cosmicOriginTime:w})}),e.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),e.jsx("div",{className:"order-2 lg:order-2",children:e.jsx(gt,{system:a,galaxy:c,systemIndex:F,cosmicOriginTime:w})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:["Planets in '",B(a.name),"'"]}),e.jsx(vt,{planets:a.planets,coordinates:d,systemIndex:F})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${U}`,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:e.jsxs("span",{className:"text-base sm:text-lg",children:["← Back to Galaxy '",A(c.name),"'"]})})})]}),e.jsx(ft,{version:D})]}),e.jsx(ht,{}),e.jsx(lt,{currentLocation:{type:"system",name:a.name,coordinates:c.coordinates.join(","),systemIndex:a.index}})]})};document.addEventListener("DOMContentLoaded",async()=>{try{const a=document.getElementById("system-data"),c=document.getElementById("galaxy-data"),g=document.getElementById("meta-data");if(!a||!c||!g)return;const D=JSON.parse(a.textContent||"{}"),F=JSON.parse(c.textContent||"{}"),E=JSON.parse(g.textContent||"{}"),U={system:D,galaxy:F,system_url:E.system_url,version:E.version,system_index:E.system_index,image_url:E.image_url,page:E.page||1,cosmic_origin_time:E.cosmic_origin_time},w=document.getElementById("atlas-react-root");w&&et.createRoot(w).render(tt.createElement(Ft,U))}catch{}});
