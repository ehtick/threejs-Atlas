import{r as s,j as e,a as qe,c as tt,R as st}from"./atlas_C3xj8MG9oH9uC54MklkAb.js";import{R as nt,L as rt,c as at,d as ot,S as ke,e as ze,F as it,H as lt,a as ct}from"./atlas_i1DR7KrB-xunyzpDEnG-m.js";import{W as _e}from"./atlas_jwQDkDgkbYrDf9CRKibQy.js";import{a4 as Ge,C as Oe,a5 as $e,G as Ve,b as xe,z as pe,M as fe,V as Me,B as We,a2 as Be,o as Ye,aa as He,y as Ue,v as Ke,cL as Ze,cM as Je,I as Ie}from"./atlas_pGQiCQeTD5l6dMUXRRcYJ.js";import{R as dt,S as mt,M as ut,a as Pe,D as ht,b as xt,T as pt}from"./atlas_BNmZdVxd96FSoxfgh6N8D.js";import{S as Xe,a as ft,b as gt,E as bt}from"./atlas_D9WDsCw0X8TduftsoVtNe.js";import{O as wt}from"./atlas_D0eA6tgysic-V8oq2dTta.js";import{V as vt}from"./atlas_DwvSdObFEIQcgn4zq5yYd.js";import"./atlas_C0q7_QgoBkw_1ECio0nFC.js";import"./atlas_VCubJKDOL5Jc0RUG-uxb-.js";import"./atlas_CtOhIAiNHzSpXytHIyKwk.js";import"./atlas_DJ7i7UfL_c0UysIQfk_Wq.js";import"./atlas_CwYcokoa2i6NGa8CMcVH-.js";import"./atlas_CDmCjAbKL2BudWSRsmj9N.js";import"./atlas_MjNYrLc1c4EY8hYLeoBxW.js";import"./atlas_BJ_QDdZoUPjYT-9n_I4Gp.js";import"./atlas_HiFslN68N6WR8NcVQRQp7.js";import"./atlas_ChinNMIx15I-x-zfb2cxc.js";import"./atlas_BK5KpVHHDMchlABYedhdJ.js";import"./atlas_D1CR0bARAX433mi1gofoX.js";import"./atlas_k2E4Oa2ZTr-ShzFQV4yGe.js";import"./atlas_C6pdp7ZaYdLNQa3nKe66N.js";import"./atlas_CCCB6wayl60uvstX_VV1b.js";import"./atlas_CuSf8Ux199dN5TQGANNsL.js";import"./atlas_B-7ciEeDInNr7ubvXaM1p.js";import"./atlas_QIlGLcqC1yx-yIj5WPE_2.js";import"./atlas_BrtSY9WI0jnpWr8b8l2p0.js";import"./atlas_DozMyZz-MgtutptlVtnXw.js";import"./atlas_DSMMIt__RfTLlDwy5o46G.js";import"./atlas_FvuaiM6ukQxncYDnO-LRN.js";import"./atlas_AcePMkcyOwGOfjKIaBXr7.js";import"./atlas_qLVe_rIPJrOk-heQF9xYK.js";import"./atlas_CVSIdj3IKNuZh1Tc9MWju.js";import"./atlas_DEVVBRTll3E69js2-hd6f.js";import"./atlas_DJS6mCG7iAKygTFzFyy0q.js";import"./atlas_CXqOkCPqDZlFOooak3r6p.js";import"./atlas_CXGNRo_qmRRLtYwZjj9MN.js";import"./atlas_B-8_xMAZUXFU3ijFjimI-.js";import"./atlas_ZZwvv2NOfM75V8EKAgXHJ.js";import"./atlas_CNSvMCCms-TRWdl5PfLso.js";import"./atlas_DNAC-xK9EjNtVKbqCBrWr.js";import"./atlas_DleynCheRNz9nOtzxamBI.js";import"./atlas_DRk1PRoP8HUsgl6w7XFKV.js";import"./atlas_DuNAKdzbUSGhCUnfjh5BO.js";import"./atlas_D7m96u8GNCAETXWneOccD.js";import"./atlas_DDAIyn7FrSglShWFzRYs6.js";import"./atlas_CUZqEERRQBivhH-lGjb0z.js";import"./atlas_B3jNgK3wg_91IYqexUq2H.js";import"./atlas_M0UXn4YDKB4xcqAMdAR2c.js";import"./atlas_cDvRyMmiFrWDA_rD6LEQ8.js";import"./atlas_CsENJmsgVSKbIkIORp0De.js";import"./atlas_3xd9BqPYYnkrfh-Kzp59J.js";import"./atlas_B55frdK5FY4jYv3eL7WSF.js";import"./atlas_GBC17wBCdVuY879Mt3pV2.js";import"./atlas_EMT4MQkZxhiCjMEXcl8lu.js";import"./atlas_CNSwdXAEZgA__qIDxXEVA.js";import"./atlas_C3o773RrkB_QrrdANyLLX.js";import"./atlas_fEdukK2Ek4bJoqmXZLuoQ.js";import"./atlas_vhwV7nEeimrmal9rEu7B6.js";import"./atlas_BBGO3sthS_o2yDU3NQGQW.js";import"./atlas_DsAFxLjqd-fdDTXvXH8ER.js";import"./atlas_D31v7Al7eqV3B0M2QxzuG.js";import"./atlas_DHEyh2PRya1CVc9B_tQzq.js";import"./atlas_Cs0We1NVUxzA8UwJU4DMq.js";import"./atlas_4Br5bcXbvuWUmKa_tm5wr.js";const Qe=({planets:n,stars:d,systemName:g,cosmicOriginTime:k,currentTime:E,onTimeOffsetChange:A})=>{const R=s.useRef(null),v=s.useRef(null),l=s.useRef(null),D=s.useRef(null),S=s.useRef([]),m=s.useRef([]),C=s.useRef([]),_=s.useRef(0),ie=(L,te="#ffffff")=>{const G=document.createElement("canvas"),w=G.getContext("2d");if(!w)return null;G.width=768,G.height=192,w.fillStyle="rgba(0, 0, 0, 0.8)",w.fillRect(0,0,G.width,G.height),w.strokeStyle="#ffffff",w.lineWidth=3,w.strokeRect(3,3,G.width-6,G.height-6),w.fillStyle=te,w.font="bold 48px Arial",w.textAlign="center",w.textBaseline="middle",w.fillText(L,384,96);const h=new Ke(G),B=new Ze({map:h,transparent:!0,alphaTest:.1}),se=new Je(B);return se.scale.set(30,7.5,1),se};return _.current=E,s.useEffect(()=>{if(!R.current)return;const L=R.current,te=L.clientWidth,G=L.clientHeight,w=new Ge;w.background=new Oe(17),v.current=w;const h=new $e(60,te/G,.1,1e4);h.position.set(0,120,180),h.lookAt(0,0,0);const B=new _e({antialias:!0,alpha:!0});B.setSize(te,G),B.setClearColor(17,1),l.current=B,L.appendChild(B.domElement);const se={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},me={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},V=new Ve;d.forEach((t,x)=>{const c=parseFloat(t.Size)*4,o=new xe(c,32,32),q=me[t.Color]||"#FFFF44",H=new pe({color:q,transparent:!0,opacity:.9}),u=new fe(o,H);d.length===1?u.position.set(0,0,0):d.length===2?u.position.set(x===0?-c*2:c*2,0,0):x===0?u.position.set(-c*2,0,0):x===1?u.position.set(c*2,0,0):u.position.set(0,c*2,0);const b=new xe(c*1.5,32,32),$=new pe({color:q,transparent:!0,opacity:.3}),U=new fe(b,$);u.add(U),V.add(u)}),w.add(V);const T=Math.max(...n.map(t=>t.orbital_radius)),J=150;n.forEach((t,x)=>{const o=30+t.orbital_radius/T*J,q=t.eccentricity_factor,H=o,u=H*Math.sqrt(1-q*q),b=360,$=2,U=4;for(let K=0;K<b;K+=$+U){const z=[];for(let W=K;W<Math.min(K+$,b-1);W++){const I=W/b*2*Math.PI,Z=H*Math.cos(I),he=u*Math.sin(I);z.push(new Me(Z,0,he))}if(z.length>1){const W=new We().setFromPoints(z),I=new Be({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Z=new Ye(W,I);w.add(Z),m.current.push(Z)}}const ee=t.diameter/8e3,f=Math.max(Math.min(ee,8),2.5),de=new xe(f,32,32),ae=se[t.planet_type]||"#FFFFFF",a=new pe({color:ae,transparent:!0,opacity:.9}),p=new fe(de,a),i=new fe(new xe(f*1.5,32,32),new pe({color:ae,transparent:!0,opacity:.2}));p.add(i),w.add(p),S.current.push(p),p.planetData=t,p.orbitRadius=o,p.semiMajorAxis=H,p.semiMinorAxis=u;const j=t.name.replace(/_/g," "),N=ie(j,"#ffffff");N&&(N.position.copy(p.position),N.position.y+=f+10,N.planetData=t,w.add(N),C.current.push(N))});const le=new He(4210752,.4);w.add(le);const ne=new Ue(16777215,1,2e3);ne.position.set(0,0,0),w.add(ne);let ce=!1,ue=0,oe=0,we=0;const Ee=t=>{ce=!0,ue=t.clientX,oe=t.clientY},re=t=>{if(!ce)return;const x=t.clientX-ue,c=t.clientY-oe,o=new Ie;o.setFromVector3(h.position),o.theta-=x*.01,o.phi+=c*.01,o.phi=Math.max(.1,Math.min(Math.PI-.1,o.phi)),h.position.setFromSpherical(o),h.lookAt(0,0,0),ue=t.clientX,oe=t.clientY},y=()=>{ce=!1,setTimeout(()=>{},3e3)},P=t=>{if(t.ctrlKey)t.preventDefault(),t.deltaY>0?A(604800):A(-604800);else{t.preventDefault();const x=.1,c=h.position.distanceTo(new Me(0,0,0));t.deltaY>0&&c<800?h.position.multiplyScalar(1+x):t.deltaY<0&&c>50&&h.position.multiplyScalar(1-x)}},M=t=>{t.key==="Escape"&&document.dispatchEvent(new CustomEvent("solar-system-close-fullscreen"))},F=t=>{if(t.preventDefault(),t.touches.length===1)ce=!0,ue=t.touches[0].clientX,oe=t.touches[0].clientY;else if(t.touches.length===2){const x=t.touches[0].clientX-t.touches[1].clientX,c=t.touches[0].clientY-t.touches[1].clientY;we=Math.sqrt(x*x+c*c)}},Q=t=>{if(t.preventDefault(),t.touches.length===1&&ce){const x=t.touches[0].clientX-ue,c=t.touches[0].clientY-oe,o=new Ie;o.setFromVector3(h.position),o.theta-=x*.01,o.phi+=c*.01,o.phi=Math.max(.1,Math.min(Math.PI-.1,o.phi)),h.position.setFromSpherical(o),h.lookAt(0,0,0),ue=t.touches[0].clientX,oe=t.touches[0].clientY}else if(t.touches.length===2){const x=t.touches[0].clientX-t.touches[1].clientX,c=t.touches[0].clientY-t.touches[1].clientY,o=Math.sqrt(x*x+c*c);if(we>0){const H=o/we,u=h.position.distanceTo(new Me(0,0,0));H>1&&u>50?h.position.multiplyScalar(1-.01):H<1&&u<800&&h.position.multiplyScalar(1+.01)}we=o}},X=t=>{t.preventDefault(),ce=!1,we=0,setTimeout(()=>{},3e3)},r=B.domElement;r.style.cursor="grab",r.addEventListener("mousedown",t=>{r.style.cursor="grabbing",Ee(t)}),r.addEventListener("mousemove",re),r.addEventListener("mouseup",()=>{r.style.cursor="grab",y()}),r.addEventListener("mouseleave",()=>{r.style.cursor="grab",y()}),r.addEventListener("wheel",P),r.addEventListener("touchstart",F,{passive:!1}),r.addEventListener("touchmove",Q,{passive:!1}),r.addEventListener("touchend",X,{passive:!1}),document.addEventListener("keydown",M);const O=()=>{D.current=requestAnimationFrame(O),S.current.forEach((t,x)=>{const c=t.planetData,o=t.semiMajorAxis,q=t.semiMinorAxis,H=c.orbital_period_seconds,u=2*Math.PI/H,b=(c.initial_orbital_angle+_.current*u)%(2*Math.PI);t.position.x=o*Math.cos(b),t.position.z=q*Math.sin(b),t.position.y=0;const $=c.rotation_period_seconds,U=2*Math.PI/$;if(t.rotation.y=_.current*U%(2*Math.PI),C.current[x]){const ee=t.geometry.parameters?.radius||2;C.current[x].position.copy(t.position),C.current[x].position.y+=ee+10}}),B.render(w,h)};O();const Y=()=>{const t=L.clientWidth,x=L.clientHeight;h.aspect=t/x,h.updateProjectionMatrix(),B.setSize(t,x)};return window.addEventListener("resize",Y),()=>{window.removeEventListener("resize",Y),document.removeEventListener("keydown",M),r.removeEventListener("mousedown",Ee),r.removeEventListener("mousemove",re),r.removeEventListener("mouseup",y),r.removeEventListener("mouseleave",y),r.removeEventListener("wheel",P),r.removeEventListener("touchstart",F),r.removeEventListener("touchmove",Q),r.removeEventListener("touchend",X),D.current&&cancelAnimationFrame(D.current),L&&B.domElement&&L.removeChild(B.domElement),B.dispose(),S.current=[],m.current=[],C.current=[]}},[n,d,k]),e.jsx("div",{ref:R,className:"w-full h-full"})},yt=({planets:n,stars:d,systemName:g,cosmicOriginTime:k})=>{const E=s.useRef(null),A=s.useRef(null),R=s.useRef(null),v=s.useRef(null),l=s.useRef([]),D=s.useRef([]),S=s.useRef([]),m=s.useRef(0),C=Math.floor(Date.now()/1e3),[_,ie]=s.useState(0),[L,te]=s.useState(!1),[G,w]=s.useState(!1),[h,B]=s.useState(!1),[se,me]=s.useState(0),[V,T]=s.useState(null),[J,le]=s.useState(!0),[ne,ce]=s.useState(null),ue=C-k+_;m.current=ue,s.useEffect(()=>{(async()=>{try{le(!0),ce(null);const P=await fetch("/api/system/rendering-data");if(!P.ok)throw new Error(`HTTP error! status: ${P.status}`);const M=await P.json();if(M.success)T(M.system_data);else throw new Error(M.error||"Failed to fetch system data")}catch(P){ce(P instanceof Error?P.message:"Unknown error")}finally{le(!1)}})()},[]);const oe=()=>{w(!0),setTimeout(()=>{te(!1),w(!1)},300)},we=(y,P="#ffffff")=>{const M=document.createElement("canvas"),F=M.getContext("2d");if(!F)return null;M.width=512,M.height=128,F.fillStyle="rgba(0, 0, 0, 0.7)",F.fillRect(0,0,M.width,M.height),F.strokeStyle="#ffffff",F.lineWidth=2,F.strokeRect(2,2,M.width-4,M.height-4),F.fillStyle=P,F.font="bold 32px Arial",F.textAlign="center",F.textBaseline="middle",F.fillText(y,256,64);const Q=new Ke(M),X=new Ze({map:Q,transparent:!0,alphaTest:.1}),r=new Je(X);return r.scale.set(20,5,1),r};s.useEffect(()=>{const y=P=>{P.key==="Escape"&&L&&oe()};return L&&me(_),document.addEventListener("solar-system-close-fullscreen",oe),document.addEventListener("keydown",y),()=>{document.removeEventListener("solar-system-close-fullscreen",oe),document.removeEventListener("keydown",y)}},[L,_]),s.useEffect(()=>{if(L&&h){const y=setTimeout(()=>{B(!1)},50);return()=>clearTimeout(y)}},[L,h]),s.useEffect(()=>{if(J||!V||(window.tonnirLoggedInSystem=!1,!E.current))return;const y=E.current,P=y.clientWidth,M=P<640,F=new Ge;F.background=new Oe(17),A.current=F;const Q=new $e(45,P/(M?120:140),.1,1e4);Q.position.set(0,80,120),Q.lookAt(0,0,0);const X=new _e({antialias:!0,alpha:!0});X.setSize(P,M?120:140),X.setClearColor(17,1),R.current=X,y.appendChild(X.domElement);const r={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},O={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},Y=new Ve;V.stars.forEach((a,p)=>{const i=parseFloat(a.Size)*3,j=new xe(i,16,16),N=O[a.Color]||"#FFFF44",K=new pe({color:N,transparent:!0,opacity:.9}),z=new fe(j,K);V.stars.length===1?z.position.set(0,0,0):V.stars.length===2?z.position.set(p===0?-i*2:i*2,0,0):p===0?z.position.set(-i*2,0,0):p===1?z.position.set(i*2,0,0):z.position.set(0,i*2,0);const W=new xe(i*1.5,16,16),I=new pe({color:N,transparent:!0,opacity:.3}),Z=new fe(W,I);z.add(Z),Y.add(z)}),F.add(Y);const t=V.timing.max_orbital_radius,x=80;window.systemMaxOrbitalRadius=t,V.planets.forEach((a,p)=>{const j=20+a.orbital_radius/t*x,N=a.eccentricity_factor,K=j,z=K*Math.sqrt(1-N*N),W=360,I=2,Z=4;for(let Fe=0;Fe<W;Fe+=I+Z){const Ce=[];for(let be=Fe;be<Math.min(Fe+I,W-1);be++){const je=be/W*2*Math.PI,Ne=K*Math.cos(je),Te=z*Math.sin(je);Ce.push(new Me(Ne,0,Te))}if(Ce.length>1){const be=new We().setFromPoints(Ce),je=new Be({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Ne=new Ye(be,je);F.add(Ne),D.current.push(Ne)}}const he=a.diameter/15e3,ve=Math.max(Math.min(he,4),1.5),Le=new xe(ve,16,16),Re=r[a.planet_type]||"#FFFFFF",De=new pe({color:Re,transparent:!0,opacity:.9}),ge=new fe(Le,De),Ae=new fe(new xe(ve*1.5,16,16),new pe({color:Re,transparent:!0,opacity:.2}));ge.add(Ae),F.add(ge),l.current.push(ge),ge.planetData=a,ge.orbitRadius=j,ge.semiMajorAxis=K,ge.semiMinorAxis=z;const ye=a.name.replace(/_/g," "),Se=we(ye,"#ffffff");Se&&(Se.position.copy(ge.position),Se.position.y+=ve+6,Se.planetData=a,F.add(Se),S.current.push(Se))});const c=new He(4210752,.4);F.add(c);const o=new Ue(16777215,1,1e3);o.position.set(0,0,0),F.add(o);let q=!1,H=0,u=0;const b=a=>{q=!0,H=a.clientX,u=a.clientY},$=a=>{if(!q)return;const p=a.clientX-H,i=a.clientY-u,j=new Ie;j.setFromVector3(Q.position),j.theta-=p*.01,j.phi+=i*.01,j.phi=Math.max(.1,Math.min(Math.PI-.1,j.phi)),Q.position.setFromSpherical(j),Q.lookAt(0,0,0),H=a.clientX,u=a.clientY},U=()=>{q=!1,setTimeout(()=>{},3e3)},ee=a=>{if(a.ctrlKey)a.preventDefault(),a.deltaY>0?ie(p=>p+604800):ie(p=>p-604800);else{a.preventDefault();const p=.1,i=Q.position.distanceTo(new Me(0,0,0));a.deltaY>0&&i<500?Q.position.multiplyScalar(1+p):a.deltaY<0&&i>20&&Q.position.multiplyScalar(1-p)}},f=X.domElement;f.style.cursor="grab",f.style.borderRadius="8px",f.addEventListener("mousedown",a=>{f.style.cursor="grabbing",b(a)}),f.addEventListener("mousemove",$),f.addEventListener("mouseup",()=>{f.style.cursor="grab",U()}),f.addEventListener("mouseleave",()=>{f.style.cursor="grab",U()}),f.addEventListener("wheel",ee);const de=()=>{v.current=requestAnimationFrame(de),l.current.forEach((a,p)=>{const i=a.planetData,j=a.semiMajorAxis,N=a.semiMinorAxis,K=i.orbital_period_seconds,z=2*Math.PI/K,W=(i.initial_orbital_angle+m.current*z)%(2*Math.PI);a.position.x=j*Math.cos(W),a.position.z=N*Math.sin(W),a.position.y=0;const I=i.rotation_period_seconds,Z=2*Math.PI/I;if(a.rotation.y=m.current*Z%(2*Math.PI),S.current[p]){const he=a.geometry.parameters?.radius||2;S.current[p].position.copy(a.position),S.current[p].position.y+=he+6}}),X.render(F,Q)};de();const ae=()=>{const a=y.clientWidth,p=a<640?120:140;Q.aspect=a/p,Q.updateProjectionMatrix(),X.setSize(a,p)};return window.addEventListener("resize",ae),()=>{window.removeEventListener("resize",ae),f.removeEventListener("mousedown",b),f.removeEventListener("mousemove",$),f.removeEventListener("mouseup",U),f.removeEventListener("mouseleave",U),f.removeEventListener("wheel",ee),v.current&&cancelAnimationFrame(v.current),y&&X.domElement&&y.removeChild(X.domElement),X.dispose(),l.current=[],D.current=[],S.current=[]}},[n,d,k,V]);const Ee=y=>{const P=Math.floor(y/31557600),M=Math.floor(y%(365.25*24*3600)/(24*3600)),F=Math.floor(y%(24*3600)/3600);return P>0?`${P}y ${M}d ${F}h`:M>0?`${M}d ${F}h`:`${F}h`},re=y=>y.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Solar System Perspective"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{ref:E,className:"w-full border border-white/20 rounded bg-black/20",style:{height:"auto"}}),!J&&!ne&&g&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:g})}),e.jsx("button",{onClick:()=>{te(!0),B(!0)},className:"absolute top-2 right-2 p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg z-10",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-[10px]",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-[10px]",children:[V?.planets?.length||n.length," Planets"]})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Time: ",Ee(ue)]})]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View"})]})]}),L&&qe.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${G||h?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${G||h?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:re(g)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:re(g)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[V?.planets?.length||n.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",Ee(C-k+se)]})]})]}),e.jsx("button",{onClick:oe,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:se,onChange:y=>me(Number(y.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>me(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",se===0?"Present":se>0?`+${Math.abs(se/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(se/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Qe,{planets:V?.planets||n,stars:V?.stars||d,systemName:g,cosmicOriginTime:k,currentTime:C-k+se,onTimeOffsetChange:y=>me(P=>P+y)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},Ft=({system:n,galaxy:d,systemIndex:g,cosmicOriginTime:k})=>{const[E,A]=s.useState({isOnCooldown:!1,isSaved:!1,isCollecting:!1,timeUntilNext:0});s.useEffect(()=>{let v;const l=()=>{const C=Pe.generateLocationId("system",d.coordinates.join(","),g,void 0),_=Pe.canCollectFromLocation(C),ie=Pe.getTimeUntilNextCollection(C),L=d.coordinates,te=Xe.generateSystemUrl(L,g,Xe.getCurrentPage()),w=rt.getLocations().some(h=>h.stargateUrl===te);A(h=>({isOnCooldown:!_&&ie>0,isSaved:w,isCollecting:h.isCollecting,timeUntilNext:ie}))},D=()=>{A(C=>({...C,isCollecting:!0})),v=setTimeout(()=>{A(C=>({...C,isCollecting:!1}))},1e3)};l();const S=setInterval(l,1e3),m=nt.subscribe("mining_completed",D);return()=>{clearInterval(S),v&&clearTimeout(v),m()}},[n.name,g,d.coordinates]);const R=v=>v.replace(/_/g," ");return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[e.jsx(dt,{locationType:"system",locationId:n.name,coordinates:d.coordinates.join(","),systemIndex:g,className:"text-xs"}),e.jsx(mt,{type:"system",name:n.name,coordinates:d.coordinates.join(","),systemIndex:g,className:"text-xs"}),e.jsx("div",{className:"inline-flex items-center bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] font-medium px-1.5 py-0.5 rounded h-[21px] box-border",children:"VISITED"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ut,{isOnCooldown:E.isOnCooldown,isSaved:E.isSaved,isCollecting:E.isCollecting}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Details"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"System Type"}),e.jsx("div",{className:"text-sm font-bold text-blue-300 capitalize",children:n.star_system_type})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Planets"}),e.jsx("div",{className:"text-sm font-bold text-purple-300",children:n.num_planets})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-orange-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Stars"}),e.jsx("div",{className:"text-sm font-bold text-orange-300",children:n.stars.length})]})]}),e.jsx("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-3",children:e.jsx(yt,{planets:n.planets,stars:n.stars,systemName:n.name,cosmicOriginTime:k})}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-yellow-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Stellar Composition"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1",children:n.stars.map((v,l)=>e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-yellow-500/20",children:[e.jsxs("div",{className:"text-xs text-gray-300",children:["Star ",l+1]}),e.jsx("div",{className:"text-xs font-bold text-yellow-300",children:v.Type}),e.jsxs("div",{className:"text-xs text-gray-300",children:[v.Color," • ",v.Size]})]},l))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System:"}),e.jsx("div",{className:"text-white truncate font-medium",children:R(n.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System ID:"}),e.jsxs("div",{className:"text-white font-medium",children:["#",g+1]})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),e.jsx("div",{className:"text-white truncate font-medium",children:R(d.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),e.jsx("div",{className:"text-white font-medium",children:d.coordinates.join(", ")})]})]})]})]})},et=s.forwardRef(({planets:n,stars:d,systemName:g,cosmicOriginTime:k,systemUrl:E},A)=>{const R=s.useRef(null),v=s.useRef(null),l=s.useRef(null),D=s.useRef(null),S=s.useRef([]),m=s.useRef([]),C=s.useRef([]),_=s.useRef(null),ie=s.useRef(0),L=s.useRef(null),te=Math.floor(Date.now()/1e3),[G,w]=s.useState(0),[h,B]=s.useState(!1),[se,me]=s.useState(!1),[V,T]=s.useState(!1),[J,le]=s.useState(0),[ne,ce]=s.useState(null),[ue,oe]=s.useState(!0),[we,Ee]=s.useState(null),[re,y]=s.useState(!1);s.useImperativeHandle(A,()=>({captureScreenshot:()=>F(),isGeneratingImage:re}));const P=te-k+G;ie.current=P,s.useEffect(()=>{(async()=>{try{oe(!0),Ee(null);const O=await fetch("/api/system/rendering-data");if(!O.ok)throw new Error(`HTTP error! status: ${O.status}`);const Y=await O.json();if(Y.success)ce(Y.system_data);else throw new Error(Y.error||"Failed to fetch system data")}catch(O){Ee(O instanceof Error?O.message:"Unknown error")}finally{oe(!1)}})()},[]);const M=()=>{me(!0),setTimeout(()=>{B(!1),me(!1)},300)};s.useEffect(()=>{const r=O=>{O.key==="Escape"&&h&&M()};return h&&le(G),document.addEventListener("solar-system-close-fullscreen",M),document.addEventListener("keydown",r),()=>{document.removeEventListener("solar-system-close-fullscreen",M),document.removeEventListener("keydown",r)}},[h,G]),s.useEffect(()=>{if(h&&V){const r=setTimeout(()=>{T(!1)},50);return()=>clearTimeout(r)}},[h,V]),s.useEffect(()=>{if(ue||!ne||(window.tonnirLoggedInSystem=!1,!R.current))return;const r=R.current,O=r.clientWidth,Y=r.clientHeight,t=Math.min(O,Y),x=new Ge;x.background=new Oe(17),v.current=x;const c=new $e(45,1,.1,1e4);c.position.set(0,300,0),c.lookAt(0,0,0),L.current=c;const o=new _e({antialias:!0,alpha:!0});o.setSize(t,t),o.setClearColor(17,1),l.current=o,o.domElement.className="",r.appendChild(o.domElement);const q={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},H={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},u=new Ve;ne.stars.forEach((i,j)=>{const N=parseFloat(i.Size)*3,K=new xe(N,16,16),z=H[i.Color]||"#FFFF44",W=new pe({color:z,transparent:!0,opacity:.9}),I=new fe(K,W);ne.stars.length===1?I.position.set(0,0,0):ne.stars.length===2?I.position.set(j===0?-N*2:N*2,0,0):j===0?I.position.set(-N*2,0,0):j===1?I.position.set(N*2,0,0):I.position.set(0,N*2,0);const Z=new xe(N*1.5,16,16),he=new pe({color:z,transparent:!0,opacity:.3}),ve=new fe(Z,he);I.add(ve),u.add(I)}),x.add(u);const b=ne.timing.max_orbital_radius,$=80;window.systemMaxOrbitalRadius=b,ne.planets.forEach((i,j)=>{const K=20+i.orbital_radius/b*$,z=i.eccentricity_factor,W=K,I=W*Math.sqrt(1-z*z),Z=360,he=2,ve=4;for(let Fe=0;Fe<Z;Fe+=he+ve){const Ce=[];for(let be=Fe;be<Math.min(Fe+he,Z-1);be++){const je=be/Z*2*Math.PI,Ne=W*Math.cos(je),Te=I*Math.sin(je);Ce.push(new Me(Ne,0,Te))}if(Ce.length>1){const be=new We().setFromPoints(Ce),je=new Be({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Ne=new Ye(be,je);x.add(Ne),m.current.push(Ne)}}const Le=i.diameter/15e3,Re=Math.max(Math.min(Le,4),1.5),De=new xe(Re,16,16),ge=q[i.planet_type]||"#FFFFFF",Ae=new pe({color:ge,transparent:!0,opacity:.9}),ye=new fe(De,Ae),Se=new fe(new xe(Re*1.5,16,16),new pe({color:ge,transparent:!0,opacity:.2}));ye.add(Se),x.add(ye),S.current.push(ye),ye.planetData=i,ye.orbitRadius=K,ye.semiMajorAxis=W,ye.semiMinorAxis=I,C.current.push(null)});const U=new He(4210752,.4);x.add(U);const ee=new Ue(16777215,1,1e3);ee.position.set(0,0,0),x.add(ee);const f=new wt(c,o.domElement);f.enableDamping=!0,f.dampingFactor=.05,f.minDistance=50,f.maxDistance=800,f.autoRotate=!1,f.autoRotateSpeed=.5,f.enablePan=!0,f.enableZoom=!0,f.target.set(0,0,0),_.current=f;const de=i=>{if(i.ctrlKey)i.preventDefault(),i.deltaY>0?w(j=>j+604800):w(j=>j-604800);else{i.preventDefault();const j=.1,N=c.position.distanceTo(new Me(0,0,0));i.deltaY>0&&N<500?c.position.multiplyScalar(1+j):i.deltaY<0&&N>20&&c.position.multiplyScalar(1-j)}},ae=o.domElement;ae.style.borderRadius="8px",ae.addEventListener("wheel",de);const a=()=>{D.current=requestAnimationFrame(a),S.current.forEach((i,j)=>{const N=i.planetData,K=i.semiMajorAxis,z=i.semiMinorAxis,W=N.orbital_period_seconds,I=2*Math.PI/W,Z=(N.initial_orbital_angle+ie.current*I)%(2*Math.PI);i.position.x=K*Math.cos(Z),i.position.z=z*Math.sin(Z),i.position.y=0;const he=N.rotation_period_seconds,ve=2*Math.PI/he;i.rotation.y=ie.current*ve%(2*Math.PI)}),_.current&&_.current.update(),o.render(x,c)};a();const p=()=>{if(!R.current||!o)return;const i=R.current,j=Math.min(i.clientWidth,i.clientHeight);o.setSize(j,j),c.aspect=1,c.updateProjectionMatrix()};return window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p),ae.removeEventListener("wheel",de),_.current&&_.current.dispose(),D.current&&cancelAnimationFrame(D.current),r&&o.domElement&&r.removeChild(o.domElement),o.dispose(),S.current=[],m.current=[],C.current=[]}},[n,d,k,ne,G]);const F=()=>{if(!l.current||!v.current||!L.current||re)return;y(!0),_.current&&(_.current.enabled=!1);const r=l.current,O=v.current,Y=L.current,t=r.domElement.width,x=r.domElement.height,c=3840/t,o=[];O.traverse(u=>{if(u.isPoints&&u.material){const b=u.material;if(b.size!==void 0&&(o.push({material:b,originalSize:b.size}),b.size=b.size*c*1),u.geometry&&u.geometry.attributes.size){const $=u.geometry.attributes.size,U=$.array.slice();o.push({geometry:u.geometry,originalSizeArray:U});for(let ee=0;ee<$.array.length;ee++)$.array[ee]*=c*1;$.needsUpdate=!0}}if(u.isSprite&&(o.push({object:u,originalScale:u.scale.clone()}),u.scale.multiplyScalar(c*1)),u.isLine&&u.material){const b=u.material;b.linewidth!==void 0&&(o.push({material:b,originalLinewidth:b.linewidth}),b.linewidth=b.linewidth*c*1)}});const q=3840,H=3840;r.setSize(q,H),Y.aspect=1,Y.updateProjectionMatrix(),r.render(O,Y),r.domElement.toBlob(u=>{if(u){const b=document.createElement("canvas"),$=b.getContext("2d");if(b.width=q,b.height=H,$){const U=new Image;U.onload=async()=>{$.drawImage(U,0,0),ft($,{imageWidth:q,imageHeight:H}),E&&await gt($,q,H,{type:"system",stargateUrl:E}),b.toBlob(f=>{if(f){const de=URL.createObjectURL(f),ae=document.createElement("a");ae.href=de,ae.download=`system_${g}_${Date.now()}.png`,ae.click(),URL.revokeObjectURL(de)}},"image/png",1)};const ee=URL.createObjectURL(u);U.src=ee}}o.forEach(({material:b,object:$,originalSize:U,originalScale:ee,originalLinewidth:f,geometry:de,originalSizeArray:ae})=>{if(U!==void 0&&(b.size=U),ee!==void 0&&$.scale.copy(ee),f!==void 0&&(b.linewidth=f),de&&ae){const a=de.attributes.size;for(let p=0;p<ae.length;p++)a.array[p]=ae[p];a.needsUpdate=!0}}),r.setSize(t,x),Y.aspect=1,Y.updateProjectionMatrix(),_.current&&(_.current.enabled=!0),y(!1)},"image/png",1)},Q=r=>{const O=Math.floor(r/31557600),Y=Math.floor(r%(365.25*24*3600)/(24*3600)),t=Math.floor(r%(24*3600)/3600);return O>0?`${O}y ${Y}d ${t}h`:Y>0?`${Y}d ${t}h`:`${t}h`},X=r=>r.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center w-full h-full",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{ref:R,className:"w-full h-full border border-white/20 rounded bg-black/20"}),e.jsx(bt,{isVisible:re}),!ue&&!we&&g&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:X(g)})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 z-10",children:[e.jsx("button",{onClick:F,disabled:re,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${re?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:re?"Generating image...":"Download 4K screenshot",children:re?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(ht,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>{re||(B(!0),T(!0))},disabled:re,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${re?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:re?"Please wait...":"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})]})}),h&&qe.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${se||V?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${se||V?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:X(g)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:X(g)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[ne?.planets?.length||n.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",Q(te-k+J)]})]})]}),e.jsx("button",{onClick:M,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:J,onChange:r=>le(Number(r.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>le(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",J===0?"Present":J>0?`+${Math.abs(J/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(J/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Qe,{planets:ne?.planets||n,stars:ne?.stars||d,systemName:g,cosmicOriginTime:k,currentTime:te-k+J,onTimeOffsetChange:r=>le(O=>O+r)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})});et.displayName="SolarSystem3DViewerLeft";const jt=({systemUrl:n,system:d,cosmicOriginTime:g})=>{const k=s.useRef(null),[E,A]=s.useState(!1),[R,v]=s.useState(!1),[l,D]=s.useState(!1),S=s.useRef(null);return s.useEffect(()=>{const m=k.current;if(!m)return;const C=m.getContext("2d");if(!C)return;let _=[];const ie=800;let L,te;const G=800;let w,h=.5;function B(){const T=m?.parentElement;if(!T||!m)return;const J=T.clientWidth,le=T.clientHeight;m.width=Math.min(J,G),m.height=Math.min(le,G),L=m.width/2,te=m.height/2}function se(){B(),_=[];for(let T=0;T<ie;T++)_.push({x:Math.random()*(m?.width||800),y:Math.random()*(m?.height||800),z:Math.random()*(m?.width||800),o:Math.random()});me()}function me(){!m||!C||(C.clearRect(0,0,m.width,m.height),_.forEach(T=>{T.z-=h,T.z<=0&&(T.z=m.width,T.x=Math.random()*m.width,T.y=Math.random()*m.height,T.o=Math.random());const J=m.width/T.z,le=(T.x-L)*J+L,ne=(T.y-te)*J+te,ce=2*J;C.beginPath(),C.fillStyle=`rgba(255, 255, 255, ${T.o})`,C.arc(le,ne,ce,0,2*Math.PI),C.fill()}),h<60&&(h+=1),w=requestAnimationFrame(me))}se();const V=()=>B();return window.addEventListener("resize",V),()=>{window.removeEventListener("resize",V),w&&cancelAnimationFrame(w)}},[]),s.useEffect(()=>{A(!0),setTimeout(()=>{v(!0)},800)},[]),s.useEffect(()=>{const m=setInterval(()=>{S.current&&l&&!S.current.isGeneratingImage&&l&&D(!1)},50);return()=>clearInterval(m)},[l]),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h3",{className:"text-sm font-medium text-white",children:d?.name||"System"})}),e.jsxs("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:[e.jsx("canvas",{ref:k,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${R?"opacity-0":"opacity-100"}`,style:{filter:R?"blur(50px)":"none"}}),E&&d&&e.jsx("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${E&&R?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:e.jsx(et,{ref:S,planets:d.planets,stars:d.stars,systemName:d.name,cosmicOriginTime:g||0,systemUrl:n})})]}),e.jsxs("div",{className:"text-center mt-auto",children:[e.jsx(xt,{href:n,onTakeScreenshot:()=>{S.current&&!l&&(D(!0),S.current.captureScreenshot())},isGeneratingImage:l}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]})]})},Nt=({planets:n,coordinates:d,systemIndex:g})=>{const[k,E]=s.useState(new Set),A=l=>({"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"})[l]||"#FFFFFF";s.useEffect(()=>{(()=>{try{const D=at(d,g,n),S=new Set;D.forEach(m=>{S.add(m.toLowerCase())}),E(S)}catch{}})()},[d,g,n]);const R=l=>l.replace(/_/g," "),v=l=>{try{ot(d,g,l,n)}catch{}window.location.href=`/planet/${l.toLowerCase()}`};return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3",children:n.map(l=>e.jsxs("div",{className:"relative bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 hover:border-white/40 transition-all duration-300 group overflow-hidden",children:[k.has(l.name.toLowerCase())&&e.jsx("div",{className:"absolute top-1 right-1 bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] px-1.5 py-0.5 rounded z-10",children:"VISITED"}),e.jsx("div",{className:"absolute -top-3 -left-3 w-8 h-8 rounded-full border border-white/40 shadow-sm z-20 animate-pulse",style:{backgroundColor:A(l.planet_type)}}),e.jsxs("button",{onClick:()=>v(l.name),className:"w-full text-left block p-2 sm:p-3 text-gray-200 hover:text-white transition-colors duration-300 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Planet"}),e.jsx("div",{className:"text-sm font-semibold text-white truncate group-hover:text-blue-300 transition-colors duration-300",children:R(l.name)})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]},l.name))}),n.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No planets found"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This system appears to be empty"})]})]})},Et=({currentSystem:n,galaxy:d})=>{const[g,k]=s.useState(!1),[E,A]=s.useState(!1),[R,v]=s.useState(!0);s.useEffect(()=>{k(n.index>0),A(!0),v(!1)},[n.index]);const l=async()=>{if(n.index>0){if(!ke.canAffordTravel("system",1)){ke.executeTravel("system",1);return}if(!ke.executeTravel("system",1))return;const m=d.coordinates.join(",");ze(m,n.index-1),window.location.href=`/system/${n.index-1}`}},D=async()=>{if(!ke.canAffordTravel("system",1)){ke.executeTravel("system",1);return}if(!ke.executeTravel("system",1))return;const m=d.coordinates.join(",");ze(m,n.index+1),window.location.href=`/system/${n.index+1}`};return R?null:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:l,disabled:!g,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${g?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:D,disabled:!E,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${E?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})},St=({system:n,galaxy:d,system_url:g,version:k,system_index:E,image_url:A,page:R,cosmic_origin_time:v})=>{const[l]=s.useState(d.coordinates.join(","));s.useEffect(()=>{document.body.setAttribute("data-coordinates",l),document.body.setAttribute("data-system-index",E.toString()),ze(l,E)},[l,E]);const D=m=>m.replace(/_/g," "),S=m=>m.replace(/_/g," ");return e.jsxs("div",{className:"w-full h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white overflow-auto",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(it,{}),e.jsxs("div",{className:"relative z-10 pt-1",children:[e.jsx(lt,{}),e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["System '",D(n.name),"'"]}),e.jsxs("p",{className:"text-lg sm:text-xl text-gray-300",children:["at Galaxy '",S(d.name),"' - Coordinates ",d.coordinates.join(", ")]})]}),e.jsx(Et,{currentSystem:{name:n.name,index:E},galaxy:d}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[e.jsx("div",{className:"order-1 lg:order-1",children:e.jsx(jt,{systemUrl:g,system:n,cosmicOriginTime:v})}),e.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),e.jsx("div",{className:"order-2 lg:order-2",children:e.jsx(Ft,{system:n,galaxy:d,systemIndex:E,cosmicOriginTime:v})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:["Planets in '",D(n.name),"'"]}),e.jsx(Nt,{planets:n.planets,coordinates:l,systemIndex:E})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${R}`,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:e.jsxs("span",{className:"text-base sm:text-lg",children:["← Back to Galaxy '",S(d.name),"'"]})})})]}),e.jsx(vt,{version:k})]}),e.jsx(pt,{}),e.jsx(ct,{currentLocation:{type:"system",name:n.name,coordinates:d.coordinates.join(","),systemIndex:n.index}})]})};document.addEventListener("DOMContentLoaded",async()=>{try{const n=document.getElementById("system-data"),d=document.getElementById("galaxy-data"),g=document.getElementById("meta-data");if(!n||!d||!g)return;const k=JSON.parse(n.textContent||"{}"),E=JSON.parse(d.textContent||"{}"),A=JSON.parse(g.textContent||"{}"),R={system:k,galaxy:E,system_url:A.system_url,version:A.version,system_index:A.system_index,image_url:A.image_url,page:A.page||1,cosmic_origin_time:A.cosmic_origin_time},v=document.getElementById("atlas-react-root");v&&tt.createRoot(v).render(st.createElement(St,R))}catch{}});
