import{r as s,j as e,a as Ue,c as et,R as tt}from"./atlas_BiACxVxc6cO5okV5F68Rd.js";import{R as st,L as nt,c as at,d as rt,S as Ce,e as Pe,F as ot,H as it,a as lt}from"./atlas_BAqEsQWQ_MCEaSfE85tyi.js";import{W as Ie}from"./atlas_hV4YbJX4LmBeaYZmYRF0y.js";import{a2 as _e,C as Ge,a3 as Oe,G as $e,b as ce,z as de,M as me,V as Ne,B as Ve,W as Be,n as We,a8 as Ye,y as He,v as qe,cK as Ke,cL as Ze,I as ze}from"./atlas_BOOzg5XYrrU1N4SZySfRd.js";import{R as ct,S as dt,M as mt,a as Te,b as Xe,D as ut,T as ht}from"./atlas_JNmU8gMIa1SHExpBzTLAF.js";import{O as xt}from"./atlas_BJLzboHTaSIGvKgNbvLUr.js";import{V as pt}from"./atlas_DrLTn8mjMle6vK3_h1E1S.js";import"./atlas_5StMBQg7EZ_DcUhMgqODi.js";const Je=({planets:a,stars:i,systemName:x,cosmicOriginTime:k,currentTime:w,onTimeOffsetChange:j})=>{const $=s.useRef(null),g=s.useRef(null),l=s.useRef(null),z=s.useRef(null),R=s.useRef([]),L=s.useRef([]),c=s.useRef([]),I=s.useRef(0),K=(N,X="#ffffff")=>{const E=document.createElement("canvas"),m=E.getContext("2d");if(!m)return null;E.width=768,E.height=192,m.fillStyle="rgba(0, 0, 0, 0.8)",m.fillRect(0,0,E.width,E.height),m.strokeStyle="#ffffff",m.lineWidth=3,m.strokeRect(3,3,E.width-6,E.height-6),m.fillStyle=X,m.font="bold 48px Arial",m.textAlign="center",m.textBaseline="middle",m.fillText(N,384,96);const d=new qe(E),D=new Ke({map:d,transparent:!0,alphaTest:.1}),_=new Ze(D);return _.scale.set(30,7.5,1),_};return I.current=w,s.useEffect(()=>{if(!$.current)return;const N=$.current,X=N.clientWidth,E=N.clientHeight,m=new _e;m.background=new Ge(17),g.current=m;const d=new Oe(60,X/E,.1,1e4);d.position.set(0,120,180),d.lookAt(0,0,0);const D=new Ie({antialias:!0,alpha:!0});D.setSize(X,E),D.setClearColor(17,1),l.current=D,N.appendChild(D.domElement);const _={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},ue={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},T=new $e;i.forEach((t,v)=>{const p=parseFloat(t.Size)*4,C=new ce(p,32,32),te=ue[t.Color]||"#FFFF44",J=new de({color:te,transparent:!0,opacity:.9}),V=new me(C,J);i.length===1?V.position.set(0,0,0):i.length===2?V.position.set(v===0?-p*2:p*2,0,0):v===0?V.position.set(-p*2,0,0):v===1?V.position.set(p*2,0,0):V.position.set(0,p*2,0);const B=new ce(p*1.5,32,32),le=new de({color:te,transparent:!0,opacity:.3}),se=new me(B,le);V.add(se),T.add(V)}),m.add(T);const he=Math.max(...a.map(t=>t.orbital_radius)),f=150;a.forEach((t,v)=>{const C=30+t.orbital_radius/he*f,te=t.eccentricity_factor,J=C,V=J*Math.sqrt(1-te*te),B=360,le=2,se=4;for(let H=0;H<B;H+=le+se){const O=[];for(let U=H;U<Math.min(H+le,B-1);U++){const ae=U/B*2*Math.PI,re=J*Math.cos(ae),Fe=V*Math.sin(ae);O.push(new Ne(re,0,Fe))}if(O.length>1){const U=new Ve().setFromPoints(O),ae=new Be({color:7372944,transparent:!0,opacity:.8,linewidth:2}),re=new We(U,ae);m.add(re),L.current.push(re)}}const we=t.diameter/8e3,W=Math.max(Math.min(we,8),2.5),y=new ce(W,32,32),Y=_[t.planet_type]||"#FFFFFF",n=new de({color:Y,transparent:!0,opacity:.9}),h=new me(y,n),S=new me(new ce(W*1.5,32,32),new de({color:Y,transparent:!0,opacity:.2}));h.add(S),m.add(h),R.current.push(h),h.planetData=t,h.orbitRadius=C,h.semiMajorAxis=J,h.semiMinorAxis=V;const G=t.name.replace(/_/g," "),M=K(G,"#ffffff");M&&(M.position.copy(h.position),M.position.y+=W+10,M.planetData=t,m.add(M),c.current.push(M))});const ie=new Ye(4210752,.4);m.add(ie);const xe=new He(16777215,1,2e3);xe.position.set(0,0,0),m.add(xe);let Q=!1,ne=0,ee=0,be=0;const fe=t=>{Q=!0,ne=t.clientX,ee=t.clientY},ye=t=>{if(!Q)return;const v=t.clientX-ne,p=t.clientY-ee,C=new ze;C.setFromVector3(d.position),C.theta-=v*.01,C.phi+=p*.01,C.phi=Math.max(.1,Math.min(Math.PI-.1,C.phi)),d.position.setFromSpherical(C),d.lookAt(0,0,0),ne=t.clientX,ee=t.clientY},F=()=>{Q=!1,setTimeout(()=>{},3e3)},A=t=>{if(t.ctrlKey)t.preventDefault(),t.deltaY>0?j(604800):j(-604800);else{t.preventDefault();const v=.1,p=d.position.distanceTo(new Ne(0,0,0));t.deltaY>0&&p<800?d.position.multiplyScalar(1+v):t.deltaY<0&&p>50&&d.position.multiplyScalar(1-v)}},r=t=>{t.key==="Escape"&&document.dispatchEvent(new CustomEvent("solar-system-close-fullscreen"))},o=t=>{if(t.preventDefault(),t.touches.length===1)Q=!0,ne=t.touches[0].clientX,ee=t.touches[0].clientY;else if(t.touches.length===2){const v=t.touches[0].clientX-t.touches[1].clientX,p=t.touches[0].clientY-t.touches[1].clientY;be=Math.sqrt(v*v+p*p)}},b=t=>{if(t.preventDefault(),t.touches.length===1&&Q){const v=t.touches[0].clientX-ne,p=t.touches[0].clientY-ee,C=new ze;C.setFromVector3(d.position),C.theta-=v*.01,C.phi+=p*.01,C.phi=Math.max(.1,Math.min(Math.PI-.1,C.phi)),d.position.setFromSpherical(C),d.lookAt(0,0,0),ne=t.touches[0].clientX,ee=t.touches[0].clientY}else if(t.touches.length===2){const v=t.touches[0].clientX-t.touches[1].clientX,p=t.touches[0].clientY-t.touches[1].clientY,C=Math.sqrt(v*v+p*p);if(be>0){const J=C/be,V=d.position.distanceTo(new Ne(0,0,0));J>1&&V>50?d.position.multiplyScalar(1-.01):J<1&&V<800&&d.position.multiplyScalar(1+.01)}be=C}},P=t=>{t.preventDefault(),Q=!1,be=0,setTimeout(()=>{},3e3)},u=D.domElement;u.style.cursor="grab",u.addEventListener("mousedown",t=>{u.style.cursor="grabbing",fe(t)}),u.addEventListener("mousemove",ye),u.addEventListener("mouseup",()=>{u.style.cursor="grab",F()}),u.addEventListener("mouseleave",()=>{u.style.cursor="grab",F()}),u.addEventListener("wheel",A),u.addEventListener("touchstart",o,{passive:!1}),u.addEventListener("touchmove",b,{passive:!1}),u.addEventListener("touchend",P,{passive:!1}),document.addEventListener("keydown",r);const Z=()=>{z.current=requestAnimationFrame(Z),R.current.forEach((t,v)=>{const p=t.planetData,C=t.semiMajorAxis,te=t.semiMinorAxis,J=p.orbital_period_seconds,V=2*Math.PI/J,B=(p.initial_orbital_angle+I.current*V)%(2*Math.PI);t.position.x=C*Math.cos(B),t.position.z=te*Math.sin(B),t.position.y=0;const le=p.rotation_period_seconds,se=2*Math.PI/le;if(t.rotation.y=I.current*se%(2*Math.PI),c.current[v]){const we=t.geometry.parameters?.radius||2;c.current[v].position.copy(t.position),c.current[v].position.y+=we+10}}),D.render(m,d)};Z();const q=()=>{const t=N.clientWidth,v=N.clientHeight;d.aspect=t/v,d.updateProjectionMatrix(),D.setSize(t,v)};return window.addEventListener("resize",q),()=>{window.removeEventListener("resize",q),document.removeEventListener("keydown",r),u.removeEventListener("mousedown",fe),u.removeEventListener("mousemove",ye),u.removeEventListener("mouseup",F),u.removeEventListener("mouseleave",F),u.removeEventListener("wheel",A),u.removeEventListener("touchstart",o),u.removeEventListener("touchmove",b),u.removeEventListener("touchend",P),z.current&&cancelAnimationFrame(z.current),N&&D.domElement&&N.removeChild(D.domElement),D.dispose(),R.current=[],L.current=[],c.current=[]}},[a,i,k]),e.jsx("div",{ref:$,className:"w-full h-full"})},ft=({planets:a,stars:i,systemName:x,cosmicOriginTime:k})=>{const w=s.useRef(null),j=s.useRef(null),$=s.useRef(null),g=s.useRef(null),l=s.useRef([]),z=s.useRef([]),R=s.useRef([]),L=s.useRef(0),c=Math.floor(Date.now()/1e3),[I,K]=s.useState(0),[N,X]=s.useState(!1),[E,m]=s.useState(!1),[d,D]=s.useState(!1),[_,ue]=s.useState(0),[T,he]=s.useState(null),[f,ie]=s.useState(!0),[xe,Q]=s.useState(null),ne=c-k+I;L.current=ne,s.useEffect(()=>{(async()=>{try{ie(!0),Q(null);const A=await fetch("/api/system/rendering-data");if(!A.ok)throw new Error(`HTTP error! status: ${A.status}`);const r=await A.json();if(r.success)he(r.system_data);else throw new Error(r.error||"Failed to fetch system data")}catch(A){Q(A instanceof Error?A.message:"Unknown error")}finally{ie(!1)}})()},[]);const ee=()=>{m(!0),setTimeout(()=>{X(!1),m(!1)},300)},be=(F,A="#ffffff")=>{const r=document.createElement("canvas"),o=r.getContext("2d");if(!o)return null;r.width=512,r.height=128,o.fillStyle="rgba(0, 0, 0, 0.7)",o.fillRect(0,0,r.width,r.height),o.strokeStyle="#ffffff",o.lineWidth=2,o.strokeRect(2,2,r.width-4,r.height-4),o.fillStyle=A,o.font="bold 32px Arial",o.textAlign="center",o.textBaseline="middle",o.fillText(F,256,64);const b=new qe(r),P=new Ke({map:b,transparent:!0,alphaTest:.1}),u=new Ze(P);return u.scale.set(20,5,1),u};s.useEffect(()=>{const F=A=>{A.key==="Escape"&&N&&ee()};return N&&ue(I),document.addEventListener("solar-system-close-fullscreen",ee),document.addEventListener("keydown",F),()=>{document.removeEventListener("solar-system-close-fullscreen",ee),document.removeEventListener("keydown",F)}},[N,I]),s.useEffect(()=>{if(N&&d){const F=setTimeout(()=>{D(!1)},50);return()=>clearTimeout(F)}},[N,d]),s.useEffect(()=>{if(f||!T||(window.tonnirLoggedInSystem=!1,!w.current))return;const F=w.current,A=F.clientWidth,r=A<640,o=new _e;o.background=new Ge(17),j.current=o;const b=new Oe(45,A/(r?120:140),.1,1e4);b.position.set(0,80,120),b.lookAt(0,0,0);const P=new Ie({antialias:!0,alpha:!0});P.setSize(A,r?120:140),P.setClearColor(17,1),$.current=P,F.appendChild(P.domElement);const u={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},Z={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},q=new $e;T.stars.forEach((n,h)=>{const S=parseFloat(n.Size)*3,G=new ce(S,16,16),M=Z[n.Color]||"#FFFF44",H=new de({color:M,transparent:!0,opacity:.9}),O=new me(G,H);T.stars.length===1?O.position.set(0,0,0):T.stars.length===2?O.position.set(h===0?-S*2:S*2,0,0):h===0?O.position.set(-S*2,0,0):h===1?O.position.set(S*2,0,0):O.position.set(0,S*2,0);const U=new ce(S*1.5,16,16),ae=new de({color:M,transparent:!0,opacity:.3}),re=new me(U,ae);O.add(re),q.add(O)}),o.add(q);const t=T.timing.max_orbital_radius,v=80;window.systemMaxOrbitalRadius=t,T.planets.forEach((n,h)=>{const G=20+n.orbital_radius/t*v,M=n.eccentricity_factor,H=G,O=H*Math.sqrt(1-M*M),U=360,ae=2,re=4;for(let ve=0;ve<U;ve+=ae+re){const Me=[];for(let ke=ve;ke<Math.min(ve+ae,U-1);ke++){const Re=ke/U*2*Math.PI,Le=H*Math.cos(Re),Qe=O*Math.sin(Re);Me.push(new Ne(Le,0,Qe))}if(Me.length>1){const ke=new Ve().setFromPoints(Me),Re=new Be({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Le=new We(ke,Re);o.add(Le),z.current.push(Le)}}const Fe=n.diameter/15e3,Ee=Math.max(Math.min(Fe,4),1.5),De=new ce(Ee,16,16),ge=u[n.planet_type]||"#FFFFFF",Ae=new de({color:ge,transparent:!0,opacity:.9}),oe=new me(De,Ae),Se=new me(new ce(Ee*1.5,16,16),new de({color:ge,transparent:!0,opacity:.2}));oe.add(Se),o.add(oe),l.current.push(oe),oe.planetData=n,oe.orbitRadius=G,oe.semiMajorAxis=H,oe.semiMinorAxis=O;const je=n.name.replace(/_/g," "),pe=be(je,"#ffffff");pe&&(pe.position.copy(oe.position),pe.position.y+=Ee+6,pe.planetData=n,o.add(pe),R.current.push(pe))});const p=new Ye(4210752,.4);o.add(p);const C=new He(16777215,1,1e3);C.position.set(0,0,0),o.add(C);let te=!1,J=0,V=0;const B=n=>{te=!0,J=n.clientX,V=n.clientY},le=n=>{if(!te)return;const h=n.clientX-J,S=n.clientY-V,G=new ze;G.setFromVector3(b.position),G.theta-=h*.01,G.phi+=S*.01,G.phi=Math.max(.1,Math.min(Math.PI-.1,G.phi)),b.position.setFromSpherical(G),b.lookAt(0,0,0),J=n.clientX,V=n.clientY},se=()=>{te=!1,setTimeout(()=>{},3e3)},we=n=>{if(n.ctrlKey)n.preventDefault(),n.deltaY>0?K(h=>h+604800):K(h=>h-604800);else{n.preventDefault();const h=.1,S=b.position.distanceTo(new Ne(0,0,0));n.deltaY>0&&S<500?b.position.multiplyScalar(1+h):n.deltaY<0&&S>20&&b.position.multiplyScalar(1-h)}},W=P.domElement;W.style.cursor="grab",W.style.borderRadius="8px",W.addEventListener("mousedown",n=>{W.style.cursor="grabbing",B(n)}),W.addEventListener("mousemove",le),W.addEventListener("mouseup",()=>{W.style.cursor="grab",se()}),W.addEventListener("mouseleave",()=>{W.style.cursor="grab",se()}),W.addEventListener("wheel",we);const y=()=>{g.current=requestAnimationFrame(y),l.current.forEach((n,h)=>{const S=n.planetData,G=n.semiMajorAxis,M=n.semiMinorAxis,H=S.orbital_period_seconds,O=2*Math.PI/H,U=(S.initial_orbital_angle+L.current*O)%(2*Math.PI);n.position.x=G*Math.cos(U),n.position.z=M*Math.sin(U),n.position.y=0;const ae=S.rotation_period_seconds,re=2*Math.PI/ae;if(n.rotation.y=L.current*re%(2*Math.PI),R.current[h]){const Fe=n.geometry.parameters?.radius||2;R.current[h].position.copy(n.position),R.current[h].position.y+=Fe+6}}),P.render(o,b)};y();const Y=()=>{const n=F.clientWidth,h=n<640?120:140;b.aspect=n/h,b.updateProjectionMatrix(),P.setSize(n,h)};return window.addEventListener("resize",Y),()=>{window.removeEventListener("resize",Y),W.removeEventListener("mousedown",B),W.removeEventListener("mousemove",le),W.removeEventListener("mouseup",se),W.removeEventListener("mouseleave",se),W.removeEventListener("wheel",we),g.current&&cancelAnimationFrame(g.current),F&&P.domElement&&F.removeChild(P.domElement),P.dispose(),l.current=[],z.current=[],R.current=[]}},[a,i,k,T]);const fe=F=>{const A=Math.floor(F/31557600),r=Math.floor(F%(365.25*24*3600)/(24*3600)),o=Math.floor(F%(24*3600)/3600);return A>0?`${A}y ${r}d ${o}h`:r>0?`${r}d ${o}h`:`${o}h`},ye=F=>F.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Solar System Perspective"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{ref:w,className:"w-full border border-white/20 rounded bg-black/20",style:{height:"auto"}}),!f&&!xe&&x&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:x})}),e.jsx("button",{onClick:()=>{X(!0),D(!0)},className:"absolute top-2 right-2 p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg z-10",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-[10px]",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-[10px]",children:[T?.planets?.length||a.length," Planets"]})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Time: ",fe(ne)]})]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View"})]})]}),N&&Ue.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${E||d?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${E||d?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:ye(x)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:ye(x)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[T?.planets?.length||a.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",fe(c-k+_)]})]})]}),e.jsx("button",{onClick:ee,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:_,onChange:F=>ue(Number(F.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>ue(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",_===0?"Present":_>0?`+${Math.abs(_/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(_/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Je,{planets:T?.planets||a,stars:T?.stars||i,systemName:x,cosmicOriginTime:k,currentTime:c-k+_,onTimeOffsetChange:F=>ue(A=>A+F)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},gt=({system:a,galaxy:i,systemIndex:x,cosmicOriginTime:k})=>{const[w,j]=s.useState({isOnCooldown:!1,isSaved:!1,isCollecting:!1,timeUntilNext:0});s.useEffect(()=>{let g;const l=()=>{const c=Te.generateLocationId("system",i.coordinates.join(","),x,void 0),I=Te.canCollectFromLocation(c),K=Te.getTimeUntilNextCollection(c),N=i.coordinates,X=Xe.generateSystemUrl(N,x,Xe.getCurrentPage()),m=nt.getLocations().some(d=>d.stargateUrl===X);j(d=>({isOnCooldown:!I&&K>0,isSaved:m,isCollecting:d.isCollecting,timeUntilNext:K}))},z=()=>{j(c=>({...c,isCollecting:!0})),g=setTimeout(()=>{j(c=>({...c,isCollecting:!1}))},1e3)};l();const R=setInterval(l,1e3),L=st.subscribe("mining_completed",z);return()=>{clearInterval(R),g&&clearTimeout(g),L()}},[a.name,x,i.coordinates]);const $=g=>g.replace(/_/g," ");return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[e.jsx(ct,{locationType:"system",locationId:a.name,coordinates:i.coordinates.join(","),systemIndex:x,className:"text-xs"}),e.jsx(dt,{type:"system",name:a.name,coordinates:i.coordinates.join(","),systemIndex:x,className:"text-xs"}),e.jsx("div",{className:"inline-flex items-center bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] font-medium px-1.5 py-0.5 rounded h-[21px] box-border",children:"VISITED"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(mt,{isOnCooldown:w.isOnCooldown,isSaved:w.isSaved,isCollecting:w.isCollecting}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Details"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"System Type"}),e.jsx("div",{className:"text-sm font-bold text-blue-300 capitalize",children:a.star_system_type})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Planets"}),e.jsx("div",{className:"text-sm font-bold text-purple-300",children:a.num_planets})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-orange-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Stars"}),e.jsx("div",{className:"text-sm font-bold text-orange-300",children:a.stars.length})]})]}),e.jsx("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-3",children:e.jsx(ft,{planets:a.planets,stars:a.stars,systemName:a.name,cosmicOriginTime:k})}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-yellow-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Stellar Composition"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1",children:a.stars.map((g,l)=>e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-yellow-500/20",children:[e.jsxs("div",{className:"text-xs text-gray-300",children:["Star ",l+1]}),e.jsx("div",{className:"text-xs font-bold text-yellow-300",children:g.Type}),e.jsxs("div",{className:"text-xs text-gray-300",children:[g.Color," • ",g.Size]})]},l))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System:"}),e.jsx("div",{className:"text-white truncate font-medium",children:$(a.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System ID:"}),e.jsxs("div",{className:"text-white font-medium",children:["#",x+1]})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),e.jsx("div",{className:"text-white truncate font-medium",children:$(i.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),e.jsx("div",{className:"text-white font-medium",children:i.coordinates.join(", ")})]})]})]})]})},bt=({planets:a,stars:i,systemName:x,cosmicOriginTime:k})=>{const w=s.useRef(null),j=s.useRef(null),$=s.useRef(null),g=s.useRef(null),l=s.useRef([]),z=s.useRef([]),R=s.useRef([]),L=s.useRef(null),c=s.useRef(0),I=s.useRef(null),K=Math.floor(Date.now()/1e3),[N,X]=s.useState(0),[E,m]=s.useState(!1),[d,D]=s.useState(!1),[_,ue]=s.useState(!1),[T,he]=s.useState(0),[f,ie]=s.useState(null),[xe,Q]=s.useState(!0),[ne,ee]=s.useState(null),be=K-k+N;c.current=be,s.useEffect(()=>{(async()=>{try{Q(!0),ee(null);const o=await fetch("/api/system/rendering-data");if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const b=await o.json();if(b.success)ie(b.system_data);else throw new Error(b.error||"Failed to fetch system data")}catch(o){ee(o instanceof Error?o.message:"Unknown error")}finally{Q(!1)}})()},[]);const fe=()=>{D(!0),setTimeout(()=>{m(!1),D(!1)},300)};s.useEffect(()=>{const r=o=>{o.key==="Escape"&&E&&fe()};return E&&he(N),document.addEventListener("solar-system-close-fullscreen",fe),document.addEventListener("keydown",r),()=>{document.removeEventListener("solar-system-close-fullscreen",fe),document.removeEventListener("keydown",r)}},[E,N]),s.useEffect(()=>{if(E&&_){const r=setTimeout(()=>{ue(!1)},50);return()=>clearTimeout(r)}},[E,_]),s.useEffect(()=>{if(xe||!f||(window.tonnirLoggedInSystem=!1,!w.current))return;const r=w.current,o=r.clientWidth,b=r.clientHeight,P=Math.min(o,b),u=new _e;u.background=new Ge(17),j.current=u;const Z=new Oe(45,1,.1,1e4);Z.position.set(0,300,0),Z.lookAt(0,0,0),I.current=Z;const q=new Ie({antialias:!0,alpha:!0});q.setSize(P,P),q.setClearColor(17,1),$.current=q,r.appendChild(q.domElement);const t={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},v={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},p=new $e;f.stars.forEach((y,Y)=>{const n=parseFloat(y.Size)*3,h=new ce(n,16,16),S=v[y.Color]||"#FFFF44",G=new de({color:S,transparent:!0,opacity:.9}),M=new me(h,G);f.stars.length===1?M.position.set(0,0,0):f.stars.length===2?M.position.set(Y===0?-n*2:n*2,0,0):Y===0?M.position.set(-n*2,0,0):Y===1?M.position.set(n*2,0,0):M.position.set(0,n*2,0);const H=new ce(n*1.5,16,16),O=new de({color:S,transparent:!0,opacity:.3}),U=new me(H,O);M.add(U),p.add(M)}),u.add(p);const C=f.timing.max_orbital_radius,te=80;window.systemMaxOrbitalRadius=C,f.planets.forEach((y,Y)=>{const h=20+y.orbital_radius/C*te,S=y.eccentricity_factor,G=h,M=G*Math.sqrt(1-S*S),H=360,O=2,U=4;for(let oe=0;oe<H;oe+=O+U){const Se=[];for(let je=oe;je<Math.min(oe+O,H-1);je++){const pe=je/H*2*Math.PI,ve=G*Math.cos(pe),Me=M*Math.sin(pe);Se.push(new Ne(ve,0,Me))}if(Se.length>1){const je=new Ve().setFromPoints(Se),pe=new Be({color:7372944,transparent:!0,opacity:.8,linewidth:2}),ve=new We(je,pe);u.add(ve),z.current.push(ve)}}const ae=y.diameter/15e3,re=Math.max(Math.min(ae,4),1.5),Fe=new ce(re,16,16),Ee=t[y.planet_type]||"#FFFFFF",De=new de({color:Ee,transparent:!0,opacity:.9}),ge=new me(Fe,De),Ae=new me(new ce(re*1.5,16,16),new de({color:Ee,transparent:!0,opacity:.2}));ge.add(Ae),u.add(ge),l.current.push(ge),ge.planetData=y,ge.orbitRadius=h,ge.semiMajorAxis=G,ge.semiMinorAxis=M,R.current.push(null)});const J=new Ye(4210752,.4);u.add(J);const V=new He(16777215,1,1e3);V.position.set(0,0,0),u.add(V);const B=new xt(Z,q.domElement);B.enableDamping=!0,B.dampingFactor=.05,B.minDistance=50,B.maxDistance=800,B.autoRotate=!1,B.autoRotateSpeed=.5,B.enablePan=!0,B.enableZoom=!0,B.target.set(0,0,0),L.current=B;const le=y=>{if(y.ctrlKey)y.preventDefault(),y.deltaY>0?X(Y=>Y+604800):X(Y=>Y-604800);else{y.preventDefault();const Y=.1,n=Z.position.distanceTo(new Ne(0,0,0));y.deltaY>0&&n<500?Z.position.multiplyScalar(1+Y):y.deltaY<0&&n>20&&Z.position.multiplyScalar(1-Y)}},se=q.domElement;se.style.borderRadius="8px",se.addEventListener("wheel",le);const we=()=>{g.current=requestAnimationFrame(we),l.current.forEach((y,Y)=>{const n=y.planetData,h=y.semiMajorAxis,S=y.semiMinorAxis,G=n.orbital_period_seconds,M=2*Math.PI/G,H=(n.initial_orbital_angle+c.current*M)%(2*Math.PI);y.position.x=h*Math.cos(H),y.position.z=S*Math.sin(H),y.position.y=0;const O=n.rotation_period_seconds,U=2*Math.PI/O;y.rotation.y=c.current*U%(2*Math.PI)}),L.current&&L.current.update(),q.render(u,Z)};we();const W=()=>{if(!w.current||!q)return;const y=w.current,Y=Math.min(y.clientWidth,y.clientHeight);q.setSize(Y,Y),Z.aspect=1,Z.updateProjectionMatrix()};return window.addEventListener("resize",W),()=>{window.removeEventListener("resize",W),se.removeEventListener("wheel",le),L.current&&L.current.dispose(),g.current&&cancelAnimationFrame(g.current),r&&q.domElement&&r.removeChild(q.domElement),q.dispose(),l.current=[],z.current=[],R.current=[]}},[a,i,k,f,N]);const ye=()=>{if(!$.current||!j.current||!I.current)return;const r=$.current,o=j.current,b=I.current,P=r.domElement.width,u=r.domElement.height;r.setSize(3840,3840),b.aspect=1,b.updateProjectionMatrix(),r.render(o,b),r.domElement.toBlob(t=>{if(t){const v=URL.createObjectURL(t),p=document.createElement("a");p.href=v,p.download=`system_${x}_${Date.now()}.png`,p.click(),URL.revokeObjectURL(v)}r.setSize(P,u),b.aspect=1,b.updateProjectionMatrix()},"image/png",1)},F=r=>{const o=Math.floor(r/31557600),b=Math.floor(r%(365.25*24*3600)/(24*3600)),P=Math.floor(r%(24*3600)/3600);return o>0?`${o}y ${b}d ${P}h`:b>0?`${b}d ${P}h`:`${P}h`},A=r=>r.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center w-full h-full",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{ref:w,className:"w-full h-full border border-white/20 rounded bg-black/20"}),!xe&&!ne&&x&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:A(x)})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 z-10",children:[e.jsx("button",{onClick:ye,className:"p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg",title:"Download screenshot",children:e.jsx(ut,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>{m(!0),ue(!0)},className:"p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})]})}),E&&Ue.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${d||_?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${d||_?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:A(x)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:A(x)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[f?.planets?.length||a.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",F(K-k+T)]})]})]}),e.jsx("button",{onClick:fe,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:T,onChange:r=>he(Number(r.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>he(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",T===0?"Present":T>0?`+${Math.abs(T/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(T/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Je,{planets:f?.planets||a,stars:f?.stars||i,systemName:x,cosmicOriginTime:k,currentTime:K-k+T,onTimeOffsetChange:r=>he(o=>o+r)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},wt=({systemUrl:a,system:i,cosmicOriginTime:x})=>{const k=s.useRef(null),[w,j]=s.useState("Aligning Stargate..."),[$,g]=s.useState(!1),[l,z]=s.useState(!1),[R,L]=s.useState(!1);return s.useEffect(()=>{const c=k.current;if(!c)return;const I=c.getContext("2d");if(!I)return;let K=[];const N=800;let X,E;const m=800;let d,D=.5;function _(){const f=c?.parentElement;if(!f||!c)return;const ie=f.clientWidth,xe=f.clientHeight;c.width=Math.min(ie,m),c.height=Math.min(xe,m),X=c.width/2,E=c.height/2}function ue(){_(),K=[];for(let f=0;f<N;f++)K.push({x:Math.random()*(c?.width||800),y:Math.random()*(c?.height||800),z:Math.random()*(c?.width||800),o:Math.random()});T()}function T(){!c||!I||(I.clearRect(0,0,c.width,c.height),K.forEach(f=>{f.z-=D,f.z<=0&&(f.z=c.width,f.x=Math.random()*c.width,f.y=Math.random()*c.height,f.o=Math.random());const ie=c.width/f.z,xe=(f.x-X)*ie+X,Q=(f.y-E)*ie+E,ne=2*ie;I.beginPath(),I.fillStyle=`rgba(255, 255, 255, ${f.o})`,I.arc(xe,Q,ne,0,2*Math.PI),I.fill()}),D<60&&(D+=1),d=requestAnimationFrame(T))}ue();const he=()=>_();return window.addEventListener("resize",he),()=>{window.removeEventListener("resize",he),d&&cancelAnimationFrame(d)}},[]),s.useEffect(()=>{z(!0),setTimeout(()=>{L(!0)},800)},[]),s.useEffect(()=>{if(sessionStorage.getItem("stargateAnimationShown")){j("Stargate system aligned");return}sessionStorage.setItem("stargateAnimationShown","true"),g(!0);const I=(m,d)=>Array.from({length:d},()=>m[Math.floor(Math.random()*m.length)]).join(""),K=[{chars:"01",duration:40,iterations:20},{chars:"0123456789",duration:25,iterations:30},{chars:"0123456789ABCDEF",duration:20,iterations:40},{chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}|;:\\'\",.<>?/`~",duration:10,iterations:100}];let N=0,X=0;const E=()=>{if(N>=K.length){const d="Stargate system aligned";let D=0;j("");const _=()=>{D<d.length?(j(d.substring(0,D+1)),D++,setTimeout(_,30)):g(!1)};_();return}const m=K[N];j(I(m.chars,32)),X++,X>=m.iterations&&(N++,X=0),setTimeout(E,m.duration)};E()},[]),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h3",{className:"text-sm font-medium text-white",children:i?.name||"System"})}),e.jsxs("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:[e.jsx("canvas",{ref:k,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${R?"opacity-0":"opacity-100"}`,style:{filter:R?"blur(50px)":"none"}}),l&&i&&e.jsx("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${l&&R?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:e.jsx(bt,{planets:i.planets,stars:i.stars,systemName:i.name,cosmicOriginTime:x||0})})]}),e.jsxs("div",{className:"text-center mt-auto",children:[e.jsxs("a",{href:a,className:`inline-block px-4 py-2 bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 text-gray-200 font-medium text-sm rounded-lg border border-slate-600 hover:border-slate-500 shadow-md hover:shadow-lg transition-all duration-300 relative overflow-hidden group ${$?"animate-pulse":""}`,style:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("span",{className:"relative z-10 font-mono flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6s.792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95a1 1 0 001.715 1.029zM8.5 10a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM10 14c-.304 0-.792-.193-1.264-.979a1 1 0 00-1.715 1.029C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 00-1.715-1.029C10.792 13.807 10.304 14 10 14z",clipRule:"evenodd"})}),w]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-slate-600/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]})]})},vt=({planets:a,coordinates:i,systemIndex:x})=>{const[k,w]=s.useState(new Set),j=l=>({"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"})[l]||"#FFFFFF";s.useEffect(()=>{(()=>{try{const z=at(i,x,a),R=new Set;z.forEach(L=>{R.add(L.toLowerCase())}),w(R)}catch{}})()},[i,x,a]);const $=l=>l.replace(/_/g," "),g=l=>{try{rt(i,x,l,a)}catch{}window.location.href=`/planet/${l.toLowerCase()}`};return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3",children:a.map(l=>e.jsxs("div",{className:"relative bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 hover:border-white/40 transition-all duration-300 group overflow-hidden",children:[k.has(l.name.toLowerCase())&&e.jsx("div",{className:"absolute top-1 right-1 bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] px-1.5 py-0.5 rounded z-10",children:"VISITED"}),e.jsx("div",{className:"absolute -top-3 -left-3 w-8 h-8 rounded-full border border-white/40 shadow-sm z-20 animate-pulse",style:{backgroundColor:j(l.planet_type)}}),e.jsxs("button",{onClick:()=>g(l.name),className:"w-full text-left block p-2 sm:p-3 text-gray-200 hover:text-white transition-colors duration-300 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Planet"}),e.jsx("div",{className:"text-sm font-semibold text-white truncate group-hover:text-blue-300 transition-colors duration-300",children:$(l.name)})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]},l.name))}),a.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No planets found"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This system appears to be empty"})]})]})},yt=({currentSystem:a,galaxy:i})=>{const[x,k]=s.useState(!1),[w,j]=s.useState(!1),[$,g]=s.useState(!0);s.useEffect(()=>{k(a.index>0),j(!0),g(!1)},[a.index]);const l=async()=>{if(a.index>0){if(!Ce.canAffordTravel("system",1)){Ce.executeTravel("system",1);return}if(!Ce.executeTravel("system",1))return;const L=i.coordinates.join(",");Pe(L,a.index-1),window.location.href=`/system/${a.index-1}`}},z=async()=>{if(!Ce.canAffordTravel("system",1)){Ce.executeTravel("system",1);return}if(!Ce.executeTravel("system",1))return;const L=i.coordinates.join(",");Pe(L,a.index+1),window.location.href=`/system/${a.index+1}`};return $?null:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:l,disabled:!x,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${x?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:z,disabled:!w,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${w?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})},Ft=({system:a,galaxy:i,system_url:x,version:k,system_index:w,image_url:j,page:$,cosmic_origin_time:g})=>{const[l]=s.useState(i.coordinates.join(","));s.useEffect(()=>{document.body.setAttribute("data-coordinates",l),document.body.setAttribute("data-system-index",w.toString()),Pe(l,w)},[l,w]);const z=L=>L.replace(/_/g," "),R=L=>L.replace(/_/g," ");return e.jsxs("div",{className:"w-full h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white overflow-auto",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(ot,{}),e.jsxs("div",{className:"relative z-10 pt-1",children:[e.jsx(it,{}),e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["System '",z(a.name),"'"]}),e.jsxs("p",{className:"text-lg sm:text-xl text-gray-300",children:["at Galaxy '",R(i.name),"' - Coordinates ",i.coordinates.join(", ")]})]}),e.jsx(yt,{currentSystem:{name:a.name,index:w},galaxy:i}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[e.jsx("div",{className:"order-1 lg:order-1",children:e.jsx(wt,{systemUrl:x,system:a,cosmicOriginTime:g})}),e.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),e.jsx("div",{className:"order-2 lg:order-2",children:e.jsx(gt,{system:a,galaxy:i,systemIndex:w,cosmicOriginTime:g})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:["Planets in '",z(a.name),"'"]}),e.jsx(vt,{planets:a.planets,coordinates:l,systemIndex:w})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${$}`,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:e.jsxs("span",{className:"text-base sm:text-lg",children:["← Back to Galaxy '",R(i.name),"'"]})})})]}),e.jsx(pt,{version:k})]}),e.jsx(ht,{}),e.jsx(lt,{currentLocation:{type:"system",name:a.name,coordinates:i.coordinates.join(","),systemIndex:a.index}})]})};document.addEventListener("DOMContentLoaded",async()=>{try{const a=document.getElementById("system-data"),i=document.getElementById("galaxy-data"),x=document.getElementById("meta-data");if(!a||!i||!x)return;const k=JSON.parse(a.textContent||"{}"),w=JSON.parse(i.textContent||"{}"),j=JSON.parse(x.textContent||"{}"),$={system:k,galaxy:w,system_url:j.system_url,version:j.version,system_index:j.system_index,image_url:j.image_url,page:j.page||1,cosmic_origin_time:j.cosmic_origin_time},g=document.getElementById("atlas-react-root");g&&et.createRoot(g).render(tt.createElement(Ft,$))}catch{}});
