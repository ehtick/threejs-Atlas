import{r as n,j as e,a as Ze,U as Qe,c as et,R as tt}from"./atlas_BGo7KNTC_D9rNHeIOnwpB.js";import{R as st,L as nt,c as at,d as ot,S as xe,e as Le,F as rt,H as it,a as lt}from"./atlas_CQG0J1Hzb9-l41LgZXskL.js";import{W as Te}from"./atlas_CNuRMyx4gH271S-qfMS5_.js";import{I as _e,C as Pe,J as ze,G as Ie,b as re,u as ie,M as le,V as ye,B as Ge,s as Ve,L as Ye,Y as Be,cE as Oe,r as $e,cC as We,cD as Xe,a0 as Re}from"./atlas_CqUMNY_RyRklhCsbOI68T.js";import{R as ct,S as dt,M as mt,a as ke,b as Ae,T as ut}from"./atlas_CeIENfxHhCZGVWxn83HVF.js";import{V as ht}from"./atlas_BC--f3teBajIZvYzpPvMJ.js";import"./atlas_5StMBQg7EZ_DcUhMgqODi.js";const xt=({planets:s,stars:i,systemName:p,cosmicOriginTime:j,currentTime:w,onTimeOffsetChange:f})=>{const _=n.useRef(null),a=n.useRef(null),d=n.useRef(null),k=n.useRef(null),C=n.useRef([]),L=n.useRef([]),o=n.useRef([]),R=n.useRef(0),O=(y,z="#ffffff")=>{const N=document.createElement("canvas"),c=N.getContext("2d");if(!c)return null;N.width=768,N.height=192,c.fillStyle="rgba(0, 0, 0, 0.8)",c.fillRect(0,0,N.width,N.height),c.strokeStyle="#ffffff",c.lineWidth=3,c.strokeRect(3,3,N.width-6,N.height-6),c.fillStyle=z,c.font="bold 48px Arial",c.textAlign="center",c.textBaseline="middle",c.fillText(y,384,96);const l=new $e(N),F=new We({map:l,transparent:!0,alphaTest:.1}),P=new Xe(F);return P.scale.set(30,7.5,1),P};return R.current=w,n.useEffect(()=>{if(!_.current)return;const y=_.current,z=y.clientWidth,N=y.clientHeight,c=new _e;c.background=new Pe(17),a.current=c;const l=new ze(60,z/N,.1,1e4);l.position.set(0,120,180),l.lookAt(0,0,0);const F=new Te({antialias:!0,alpha:!0});F.setSize(z,N),F.setClearColor(17,1),d.current=F,y.appendChild(F.domElement);const P={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},ae={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},V=new Ie;i.forEach((t,g)=>{const x=parseFloat(t.Size)*4,b=new re(x,32,32),H=ae[t.Color]||"#FFFF44",$=new ie({color:H,transparent:!0,opacity:.9}),D=new le(b,$);i.length===1?D.position.set(0,0,0):i.length===2?D.position.set(g===0?-x*2:x*2,0,0):g===0?D.position.set(-x*2,0,0):g===1?D.position.set(x*2,0,0):D.position.set(0,x*2,0);const Z=new re(x*1.5,32,32),ne=new ie({color:H,transparent:!0,opacity:.3}),te=new le(Z,ne);D.add(te),V.add(D)}),c.add(V);const me=Math.max(...s.map(t=>t.orbital_radius)),M=150;s.forEach((t,g)=>{const b=30+t.orbital_radius/me*M,H=t.eccentricity_factor,$=b,D=$*Math.sqrt(1-H*H),Z=360,ne=2,te=4;for(let q=0;q<Z;q+=ne+te){const G=[];for(let X=q;X<Math.min(q+ne,Z-1);X++){const Q=X/Z*2*Math.PI,se=$*Math.cos(Q),we=D*Math.sin(Q);G.push(new ye(se,0,we))}if(G.length>1){const X=new Ge().setFromPoints(G),Q=new Ve({color:7372944,transparent:!0,opacity:.8,linewidth:2}),se=new Ye(X,Q);c.add(se),L.current.push(se)}}const ue=t.diameter/8e3,A=Math.max(Math.min(ue,8),2.5),Fe=new re(A,32,32),be=P[t.planet_type]||"#FFFFFF",r=new ie({color:be,transparent:!0,opacity:.9}),m=new le(Fe,r),T=new le(new re(A*1.5,32,32),new ie({color:be,transparent:!0,opacity:.2}));m.add(T),c.add(m),C.current.push(m),m.planetData=t,m.orbitRadius=b,m.semiMajorAxis=$,m.semiMinorAxis=D;const B=t.name.replace(/_/g," "),W=O(B,"#ffffff");W&&(W.position.copy(m.position),W.position.y+=A+10,W.planetData=t,c.add(W),o.current.push(W))});const ee=new Be(4210752,.4);c.add(ee);const ce=new Oe(16777215,1,2e3);ce.position.set(0,0,0),c.add(ce);let U=!1,K=0,J=0,de=0;const pe=t=>{U=!0,K=t.clientX,J=t.clientY},fe=t=>{if(!U)return;const g=t.clientX-K,x=t.clientY-J,b=new Re;b.setFromVector3(l.position),b.theta-=g*.01,b.phi+=x*.01,b.phi=Math.max(.1,Math.min(Math.PI-.1,b.phi)),l.position.setFromSpherical(b),l.lookAt(0,0,0),K=t.clientX,J=t.clientY},u=()=>{U=!1,setTimeout(()=>{},3e3)},S=t=>{if(t.ctrlKey)t.preventDefault(),t.deltaY>0?f(604800):f(-604800);else{t.preventDefault();const g=.1,x=l.position.distanceTo(new ye(0,0,0));t.deltaY>0&&x<800?l.position.multiplyScalar(1+g):t.deltaY<0&&x>50&&l.position.multiplyScalar(1-g)}},E=t=>{t.key==="Escape"&&document.dispatchEvent(new CustomEvent("solar-system-close-fullscreen"))},h=t=>{if(t.preventDefault(),t.touches.length===1)U=!0,K=t.touches[0].clientX,J=t.touches[0].clientY;else if(t.touches.length===2){const g=t.touches[0].clientX-t.touches[1].clientX,x=t.touches[0].clientY-t.touches[1].clientY;de=Math.sqrt(g*g+x*x)}},I=t=>{if(t.preventDefault(),t.touches.length===1&&U){const g=t.touches[0].clientX-K,x=t.touches[0].clientY-J,b=new Re;b.setFromVector3(l.position),b.theta-=g*.01,b.phi+=x*.01,b.phi=Math.max(.1,Math.min(Math.PI-.1,b.phi)),l.position.setFromSpherical(b),l.lookAt(0,0,0),K=t.touches[0].clientX,J=t.touches[0].clientY}else if(t.touches.length===2){const g=t.touches[0].clientX-t.touches[1].clientX,x=t.touches[0].clientY-t.touches[1].clientY,b=Math.sqrt(g*g+x*x);if(de>0){const $=b/de,D=l.position.distanceTo(new ye(0,0,0));$>1&&D>50?l.position.multiplyScalar(1-.01):$<1&&D<800&&l.position.multiplyScalar(1+.01)}de=b}},Y=t=>{t.preventDefault(),U=!1,de=0,setTimeout(()=>{},3e3)},v=F.domElement;v.style.cursor="grab",v.addEventListener("mousedown",t=>{v.style.cursor="grabbing",pe(t)}),v.addEventListener("mousemove",fe),v.addEventListener("mouseup",()=>{v.style.cursor="grab",u()}),v.addEventListener("mouseleave",()=>{v.style.cursor="grab",u()}),v.addEventListener("wheel",S),v.addEventListener("touchstart",h,{passive:!1}),v.addEventListener("touchmove",I,{passive:!1}),v.addEventListener("touchend",Y,{passive:!1}),document.addEventListener("keydown",E);const je=()=>{k.current=requestAnimationFrame(je),C.current.forEach((t,g)=>{const x=t.planetData,b=t.semiMajorAxis,H=t.semiMinorAxis,$=x.orbital_period_seconds,D=2*Math.PI/$,Z=(x.initial_orbital_angle+R.current*D)%(2*Math.PI);t.position.x=b*Math.cos(Z),t.position.z=H*Math.sin(Z),t.position.y=0;const ne=x.rotation_period_seconds,te=2*Math.PI/ne;if(t.rotation.y=R.current*te%(2*Math.PI),o.current[g]){const ue=t.geometry.parameters?.radius||2;o.current[g].position.copy(t.position),o.current[g].position.y+=ue+10}}),F.render(c,l)};je();const ge=()=>{const t=y.clientWidth,g=y.clientHeight;l.aspect=t/g,l.updateProjectionMatrix(),F.setSize(t,g)};return window.addEventListener("resize",ge),()=>{window.removeEventListener("resize",ge),document.removeEventListener("keydown",E),v.removeEventListener("mousedown",pe),v.removeEventListener("mousemove",fe),v.removeEventListener("mouseup",u),v.removeEventListener("mouseleave",u),v.removeEventListener("wheel",S),v.removeEventListener("touchstart",h),v.removeEventListener("touchmove",I),v.removeEventListener("touchend",Y),k.current&&cancelAnimationFrame(k.current),y&&F.domElement&&y.removeChild(F.domElement),F.dispose(),C.current=[],L.current=[],o.current=[]}},[s,i,j]),e.jsx("div",{ref:_,className:"w-full h-full"})},pt=({planets:s,stars:i,systemName:p,cosmicOriginTime:j})=>{const w=n.useRef(null),f=n.useRef(null),_=n.useRef(null),a=n.useRef(null),d=n.useRef([]),k=n.useRef([]),C=n.useRef([]),L=n.useRef(0),o=Math.floor(Date.now()/1e3),[R,O]=n.useState(0),[y,z]=n.useState(!1),[N,c]=n.useState(!1),[l,F]=n.useState(!1),[P,ae]=n.useState(0),[V,me]=n.useState(null),[M,ee]=n.useState(!0),[ce,U]=n.useState(null),K=o-j+R;L.current=K,n.useEffect(()=>{(async()=>{try{ee(!0),U(null);const S=await fetch("/api/system/rendering-data");if(!S.ok)throw new Error(`HTTP error! status: ${S.status}`);const E=await S.json();if(E.success)me(E.system_data);else throw new Error(E.error||"Failed to fetch system data")}catch(S){U(S instanceof Error?S.message:"Unknown error")}finally{ee(!1)}})()},[]);const J=()=>{c(!0),setTimeout(()=>{z(!1),c(!1)},300)},de=(u,S="#ffffff")=>{const E=document.createElement("canvas"),h=E.getContext("2d");if(!h)return null;E.width=512,E.height=128,h.fillStyle="rgba(0, 0, 0, 0.7)",h.fillRect(0,0,E.width,E.height),h.strokeStyle="#ffffff",h.lineWidth=2,h.strokeRect(2,2,E.width-4,E.height-4),h.fillStyle=S,h.font="bold 32px Arial",h.textAlign="center",h.textBaseline="middle",h.fillText(u,256,64);const I=new $e(E),Y=new We({map:I,transparent:!0,alphaTest:.1}),v=new Xe(Y);return v.scale.set(20,5,1),v};n.useEffect(()=>{const u=S=>{S.key==="Escape"&&y&&J()};return y&&ae(R),document.addEventListener("solar-system-close-fullscreen",J),document.addEventListener("keydown",u),()=>{document.removeEventListener("solar-system-close-fullscreen",J),document.removeEventListener("keydown",u)}},[y,R]),n.useEffect(()=>{if(y&&l){const u=setTimeout(()=>{F(!1)},50);return()=>clearTimeout(u)}},[y,l]),n.useEffect(()=>{if(M||!V||(window.tonnirLoggedInSystem=!1,!w.current))return;const u=w.current,S=u.clientWidth,E=S<640,h=new _e;h.background=new Pe(17),f.current=h;const I=new ze(45,S/(E?120:140),.1,1e4);I.position.set(0,80,120),I.lookAt(0,0,0);const Y=new Te({antialias:!0,alpha:!0});Y.setSize(S,E?120:140),Y.setClearColor(17,1),_.current=Y,u.appendChild(Y.domElement);const v={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},je={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},ge=new Ie;V.stars.forEach((r,m)=>{const T=parseFloat(r.Size)*3,B=new re(T,16,16),W=je[r.Color]||"#FFFF44",q=new ie({color:W,transparent:!0,opacity:.9}),G=new le(B,q);V.stars.length===1?G.position.set(0,0,0):V.stars.length===2?G.position.set(m===0?-T*2:T*2,0,0):m===0?G.position.set(-T*2,0,0):m===1?G.position.set(T*2,0,0):G.position.set(0,T*2,0);const X=new re(T*1.5,16,16),Q=new ie({color:W,transparent:!0,opacity:.3}),se=new le(X,Q);G.add(se),ge.add(G)}),h.add(ge);const t=V.timing.max_orbital_radius,g=80;window.systemMaxOrbitalRadius=t,V.planets.forEach((r,m)=>{const B=20+r.orbital_radius/t*g,W=r.eccentricity_factor,q=B,G=q*Math.sqrt(1-W*W),X=360,Q=2,se=4;for(let Ne=0;Ne<X;Ne+=Q+se){const Me=[];for(let ve=Ne;ve<Math.min(Ne+Q,X-1);ve++){const Se=ve/X*2*Math.PI,Ee=q*Math.cos(Se),Je=G*Math.sin(Se);Me.push(new ye(Ee,0,Je))}if(Me.length>1){const ve=new Ge().setFromPoints(Me),Se=new Ve({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Ee=new Ye(ve,Se);h.add(Ee),k.current.push(Ee)}}const we=r.diameter/15e3,Ce=Math.max(Math.min(we,4),1.5),He=new re(Ce,16,16),De=v[r.planet_type]||"#FFFFFF",qe=new ie({color:De,transparent:!0,opacity:.9}),oe=new le(He,qe),Ue=new le(new re(Ce*1.5,16,16),new ie({color:De,transparent:!0,opacity:.2}));oe.add(Ue),h.add(oe),d.current.push(oe),oe.planetData=r,oe.orbitRadius=B,oe.semiMajorAxis=q,oe.semiMinorAxis=G;const Ke=r.name.replace(/_/g," "),he=de(Ke,"#ffffff");he&&(he.position.copy(oe.position),he.position.y+=Ce+6,he.planetData=r,h.add(he),C.current.push(he))});const x=new Be(4210752,.4);h.add(x);const b=new Oe(16777215,1,1e3);b.position.set(0,0,0),h.add(b);let H=!1,$=0,D=0;const Z=r=>{H=!0,$=r.clientX,D=r.clientY},ne=r=>{if(!H)return;const m=r.clientX-$,T=r.clientY-D,B=new Re;B.setFromVector3(I.position),B.theta-=m*.01,B.phi+=T*.01,B.phi=Math.max(.1,Math.min(Math.PI-.1,B.phi)),I.position.setFromSpherical(B),I.lookAt(0,0,0),$=r.clientX,D=r.clientY},te=()=>{H=!1,setTimeout(()=>{},3e3)},ue=r=>{if(r.ctrlKey)r.preventDefault(),r.deltaY>0?O(m=>m+604800):O(m=>m-604800);else{r.preventDefault();const m=.1,T=I.position.distanceTo(new ye(0,0,0));r.deltaY>0&&T<500?I.position.multiplyScalar(1+m):r.deltaY<0&&T>20&&I.position.multiplyScalar(1-m)}},A=Y.domElement;A.style.cursor="grab",A.style.borderRadius="8px",A.addEventListener("mousedown",r=>{A.style.cursor="grabbing",Z(r)}),A.addEventListener("mousemove",ne),A.addEventListener("mouseup",()=>{A.style.cursor="grab",te()}),A.addEventListener("mouseleave",()=>{A.style.cursor="grab",te()}),A.addEventListener("wheel",ue);const Fe=()=>{a.current=requestAnimationFrame(Fe),d.current.forEach((r,m)=>{const T=r.planetData,B=r.semiMajorAxis,W=r.semiMinorAxis,q=T.orbital_period_seconds,G=2*Math.PI/q,X=(T.initial_orbital_angle+L.current*G)%(2*Math.PI);r.position.x=B*Math.cos(X),r.position.z=W*Math.sin(X),r.position.y=0;const Q=T.rotation_period_seconds,se=2*Math.PI/Q;if(r.rotation.y=L.current*se%(2*Math.PI),C.current[m]){const we=r.geometry.parameters?.radius||2;C.current[m].position.copy(r.position),C.current[m].position.y+=we+6}}),Y.render(h,I)};Fe();const be=()=>{const r=u.clientWidth,m=r<640?120:140;I.aspect=r/m,I.updateProjectionMatrix(),Y.setSize(r,m)};return window.addEventListener("resize",be),()=>{window.removeEventListener("resize",be),A.removeEventListener("mousedown",Z),A.removeEventListener("mousemove",ne),A.removeEventListener("mouseup",te),A.removeEventListener("mouseleave",te),A.removeEventListener("wheel",ue),a.current&&cancelAnimationFrame(a.current),u&&Y.domElement&&u.removeChild(Y.domElement),Y.dispose(),d.current=[],k.current=[],C.current=[]}},[s,i,j,V]);const pe=u=>{const S=Math.floor(u/31557600),E=Math.floor(u%(365.25*24*3600)/(24*3600)),h=Math.floor(u%(24*3600)/3600);return S>0?`${S}y ${E}d ${h}h`:E>0?`${E}d ${h}h`:`${h}h`},fe=u=>u.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Solar System Simulation"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{ref:w,className:"w-full border border-white/20 rounded bg-black/20",style:{height:"auto"}}),e.jsxs("button",{onClick:()=>{z(!0),F(!0)},className:"absolute top-2 right-2 p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 flex items-center gap-1 backdrop-blur-sm shadow-lg z-10",title:"Expand to fullscreen",children:[e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),e.jsx("span",{className:"text-xs text-white hidden sm:inline",children:"Expand"})]})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-[10px]",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-[10px]",children:[V?.planets?.length||s.length," Planets"]})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Time: ",pe(K)]})]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500",children:"Scroll: Zoom â€¢ Ctrl+Scroll: +1week/-1week â€¢ Drag: Rotate View"})]})]}),y&&Ze.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${N||l?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${N||l?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:fe(p)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:fe(p)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[V?.planets?.length||s.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",pe(o-j+P)]})]})]}),e.jsx("button",{onClick:J,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:P,onChange:u=>ae(Number(u.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>ae(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",P===0?"Present":P>0?`+${Math.abs(P/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(P/(365.25*24*3600)).toFixed(1)} years`," â€¢ Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(xt,{planets:s,stars:i,systemName:p,cosmicOriginTime:j,currentTime:o-j+P,onTimeOffsetChange:u=>ae(S=>S+u)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom â€¢ Ctrl+Scroll: +1week/-1week â€¢ Drag: Rotate View â€¢ ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom â€¢ Drag: Rotate â€¢ ESC: Close"})]})]})}),document.body)]})},ft=({system:s,galaxy:i,systemIndex:p,cosmicOriginTime:j})=>{const[w,f]=n.useState({isOnCooldown:!1,isSaved:!1,isCollecting:!1,timeUntilNext:0});n.useEffect(()=>{let a;const d=()=>{const o=ke.generateLocationId("system",i.coordinates.join(","),p,void 0),R=ke.canCollectFromLocation(o),O=ke.getTimeUntilNextCollection(o),y=i.coordinates,z=Ae.generateSystemUrl(y,p,Ae.getCurrentPage()),c=nt.getLocations().some(l=>l.stargateUrl===z);f(l=>({isOnCooldown:!R&&O>0,isSaved:c,isCollecting:l.isCollecting,timeUntilNext:O}))},k=()=>{f(o=>({...o,isCollecting:!0})),a=setTimeout(()=>{f(o=>({...o,isCollecting:!1}))},1e3)};d();const C=setInterval(d,1e3),L=st.subscribe("mining_completed",k);return()=>{clearInterval(C),a&&clearTimeout(a),L()}},[s.name,p,i.coordinates]);const _=a=>a.replace(/_/g," ");return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[e.jsx(ct,{locationType:"system",locationId:s.name,coordinates:i.coordinates.join(","),systemIndex:p,className:"text-xs"}),e.jsx(dt,{type:"system",name:s.name,coordinates:i.coordinates.join(","),systemIndex:p,className:"text-xs"}),e.jsx("div",{className:"inline-flex items-center bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] font-medium px-1.5 py-0.5 rounded h-[21px] box-border",children:"VISITED"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(mt,{isOnCooldown:w.isOnCooldown,isSaved:w.isSaved,isCollecting:w.isCollecting}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Details"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"System Type"}),e.jsx("div",{className:"text-sm font-bold text-blue-300 capitalize",children:s.star_system_type})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Planets"}),e.jsx("div",{className:"text-sm font-bold text-purple-300",children:s.num_planets})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-orange-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Stars"}),e.jsx("div",{className:"text-sm font-bold text-orange-300",children:s.stars.length})]})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-3",children:[(()=>{if(!window.domDataLogged){const a=s.planets.find(d=>d.name.toLowerCase().includes("tonnir"));a&&console.log("ðŸ“„ DOM DATA - Tonnir_MD-1420:",{name:a.name,planet_type:a.planet_type,orbital_radius:a.orbital_radius,initial_orbital_angle:a.initial_orbital_angle,orbital_period_seconds:a.orbital_period_seconds,rotation_period_seconds:a.rotation_period_seconds,eccentricity_factor:a.eccentricity_factor,axial_tilt:a.axial_tilt,cosmicOriginTime:j}),window.domDataLogged=!0}return null})(),e.jsx(pt,{planets:s.planets,stars:s.stars,systemName:s.name,cosmicOriginTime:j})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-yellow-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Stellar Composition"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1",children:s.stars.map((a,d)=>e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-yellow-500/20",children:[e.jsxs("div",{className:"text-xs text-gray-300",children:["Star ",d+1]}),e.jsx("div",{className:"text-xs font-bold text-yellow-300",children:a.Type}),e.jsxs("div",{className:"text-xs text-gray-300",children:[a.Color," â€¢ ",a.Size]})]},d))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System:"}),e.jsx("div",{className:"text-white truncate font-medium",children:_(s.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System ID:"}),e.jsxs("div",{className:"text-white font-medium",children:["#",p+1]})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),e.jsx("div",{className:"text-white truncate font-medium",children:_(i.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),e.jsx("div",{className:"text-white font-medium",children:i.coordinates.join(", ")})]})]})]})]})},gt=({systemUrl:s,imageUrl:i})=>{const p=n.useRef(null),j=n.useRef(null),[w,f]=n.useState("Aligning Stargate..."),[_,a]=n.useState(!1),[d,k]=n.useState(!1),[C,L]=n.useState(!1);return n.useEffect(()=>{const o=document.createElement("style");return o.textContent=`
      [data-rmiz-modal-overlay="visible"] {
        background-color: rgba(0, 0, 0, 0.8) !important;
        backdrop-filter: blur(20px) !important;
        -webkit-backdrop-filter: blur(20px) !important;
        transition: backdrop-filter 0.3s ease-in-out !important;
      }
      
      [data-rmiz-modal-img] {
        border-radius: 1rem !important;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8) !important;
      }
      
      [data-rmiz-modal-overlay="hidden"] {
        backdrop-filter: blur(0px) !important;
        -webkit-backdrop-filter: blur(0px) !important;
        transition: backdrop-filter 0.3s ease-in-out !important;
      }
    `,document.head.appendChild(o),()=>{document.head.removeChild(o)}},[]),n.useEffect(()=>{const o=p.current;if(!o)return;const R=o.getContext("2d");if(!R)return;let O=[];const y=800;let z,N;const c=800;let l,F=.5;function P(){const M=o?.parentElement;if(!M||!o)return;const ee=M.clientWidth,ce=M.clientHeight;o.width=Math.min(ee,c),o.height=Math.min(ce,c),z=o.width/2,N=o.height/2}function ae(){P(),O=[];for(let M=0;M<y;M++)O.push({x:Math.random()*(o?.width||800),y:Math.random()*(o?.height||800),z:Math.random()*(o?.width||800),o:Math.random()});V()}function V(){!o||!R||(R.clearRect(0,0,o.width,o.height),O.forEach(M=>{M.z-=F,M.z<=0&&(M.z=o.width,M.x=Math.random()*o.width,M.y=Math.random()*o.height,M.o=Math.random());const ee=o.width/M.z,ce=(M.x-z)*ee+z,U=(M.y-N)*ee+N,K=2*ee;R.beginPath(),R.fillStyle=`rgba(255, 255, 255, ${M.o})`,R.arc(ce,U,K,0,2*Math.PI),R.fill()}),F<60&&(F+=1),l=requestAnimationFrame(V))}ae();const me=()=>P();return window.addEventListener("resize",me),()=>{window.removeEventListener("resize",me),l&&cancelAnimationFrame(l)}},[]),n.useEffect(()=>{if(i){const o=new Image;o.onload=()=>{j.current&&(j.current.src=i,k(!0),L(!0))},o.onerror=()=>{console.error("Failed to load system image:",i),setTimeout(()=>{k(!0),L(!0)},1500)},o.src=i}else setTimeout(()=>{k(!0),L(!0)},1500)},[i]),n.useEffect(()=>{if(sessionStorage.getItem("stargateAnimationShown")){f("Stargate system aligned");return}sessionStorage.setItem("stargateAnimationShown","true"),a(!0);const R=(c,l)=>Array.from({length:l},()=>c[Math.floor(Math.random()*c.length)]).join(""),O=[{chars:"01",duration:40,iterations:20},{chars:"0123456789",duration:25,iterations:30},{chars:"0123456789ABCDEF",duration:20,iterations:40},{chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}|;:\\'\",.<>?/`~",duration:10,iterations:100}];let y=0,z=0;const N=()=>{if(y>=O.length){const l="Stargate system aligned";let F=0;f("");const P=()=>{F<l.length?(f(l.substring(0,F+1)),F++,setTimeout(P,30)):a(!1)};P();return}const c=O[y];f(R(c.chars,32)),z++,z>=c.iterations&&(y++,z=0),setTimeout(N,c.duration)};N()},[]),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white mb-3",children:"System Visualization"}),e.jsxs("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black/50 flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:[e.jsx("canvas",{ref:p,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${C?"opacity-0":"opacity-100"}`,style:{filter:C?"blur(50px)":"none"}}),e.jsx("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${d?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:d&&i?e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx(Qe,{zoomMargin:20,classDialog:"backdrop-blur-3xl",children:e.jsx("img",{ref:j,className:"max-w-full max-h-full object-contain rounded-xl shadow-2xl shadow-blue-500/20",src:i,alt:"System visualization",style:{width:"100%",height:"100%",objectFit:"contain",backgroundColor:"transparent"}})})}):e.jsx("img",{ref:j,className:"w-full h-full object-cover",src:"/static/images/placeholder-min.jpg",alt:"System visualization"})})]}),e.jsxs("div",{className:"text-center mt-auto",children:[e.jsxs("a",{href:s,className:`inline-block px-4 py-2 bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 text-gray-200 font-medium text-sm rounded-lg border border-slate-600 hover:border-slate-500 shadow-md hover:shadow-lg transition-all duration-300 relative overflow-hidden group ${_?"animate-pulse":""}`,style:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("span",{className:"relative z-10 font-mono flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6s.792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95a1 1 0 001.715 1.029zM8.5 10a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM10 14c-.304 0-.792-.193-1.264-.979a1 1 0 00-1.715 1.029C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 00-1.715-1.029C10.792 13.807 10.304 14 10 14z",clipRule:"evenodd"})}),w]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-slate-600/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]})]})},bt=({planets:s,coordinates:i,systemIndex:p})=>{const[j,w]=n.useState(new Set);n.useEffect(()=>{(()=>{try{const d=at(i,p,s),k=new Set;d.forEach(C=>{k.add(C.toLowerCase())}),w(k)}catch(d){console.error("Error loading historical data:",d)}})()},[i,p,s]);const f=a=>a.replace(/_/g," "),_=a=>{try{ot(i,p,a,s)}catch(d){console.error("Error marking planet as visited:",d)}window.location.href=`/planet/${a.toLowerCase()}`};return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3",children:s.map(a=>e.jsxs("div",{className:"relative bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 hover:border-white/40 transition-all duration-300 group",children:[j.has(a.name.toLowerCase())&&e.jsx("div",{className:"absolute top-1 right-1 bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] px-1.5 py-0.5 rounded z-10",children:"VISITED"}),e.jsxs("button",{onClick:()=>_(a.name),className:"w-full text-left block p-2 sm:p-3 text-gray-200 hover:text-white transition-colors duration-300 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Planet"}),e.jsx("div",{className:"text-sm font-semibold text-white truncate group-hover:text-blue-300 transition-colors duration-300",children:f(a.name)})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]},a.name))}),s.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No planets found"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This system appears to be empty"})]})]})},wt=({currentSystem:s,galaxy:i})=>{const[p,j]=n.useState(!1),[w,f]=n.useState(!1),[_,a]=n.useState(!0);n.useEffect(()=>{j(s.index>0),f(!0),a(!1)},[s.index]);const d=async()=>{if(s.index>0){if(!xe.canAffordTravel("system",1)){xe.executeTravel("system",1);return}if(!xe.executeTravel("system",1))return;const L=i.coordinates.join(",");Le(L,s.index-1),window.location.href=`/system/${s.index-1}`}},k=async()=>{if(!xe.canAffordTravel("system",1)){xe.executeTravel("system",1);return}if(!xe.executeTravel("system",1))return;const L=i.coordinates.join(",");Le(L,s.index+1),window.location.href=`/system/${s.index+1}`};return _?null:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:d,disabled:!p,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${p?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:k,disabled:!w,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${w?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})},vt=({system:s,galaxy:i,system_url:p,version:j,system_index:w,image_url:f,page:_,cosmic_origin_time:a})=>{const[d]=n.useState(i.coordinates.join(","));n.useEffect(()=>{document.body.setAttribute("data-coordinates",d),document.body.setAttribute("data-system-index",w.toString()),Le(d,w)},[d,w]);const k=L=>L.replace(/_/g," "),C=L=>L.replace(/_/g," ");return e.jsxs("div",{className:"w-full h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white overflow-auto",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(rt,{}),e.jsxs("div",{className:"relative z-10 pt-1",children:[e.jsx(it,{}),e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["System '",k(s.name),"'"]}),e.jsxs("p",{className:"text-lg sm:text-xl text-gray-300",children:["at Galaxy '",C(i.name),"' - Coordinates ",i.coordinates.join(", ")]})]}),e.jsx(wt,{currentSystem:{name:s.name,index:w},galaxy:i}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[e.jsx("div",{className:"order-1 lg:order-1",children:e.jsx(gt,{systemUrl:p,imageUrl:f})}),e.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),e.jsx("div",{className:"order-2 lg:order-2",children:e.jsx(ft,{system:s,galaxy:i,systemIndex:w,cosmicOriginTime:a})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:["Planets in '",k(s.name),"'"]}),e.jsx(bt,{planets:s.planets,coordinates:d,systemIndex:w})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${_}`,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:e.jsxs("span",{className:"text-base sm:text-lg",children:["â† Back to Galaxy '",C(i.name),"'"]})})})]}),e.jsx(ht,{version:j})]}),e.jsx(ut,{}),e.jsx(lt,{currentLocation:{type:"system",name:s.name,coordinates:i.coordinates.join(","),systemIndex:s.index}})]})};document.addEventListener("DOMContentLoaded",async()=>{try{const s=document.getElementById("system-data"),i=document.getElementById("galaxy-data"),p=document.getElementById("meta-data");if(!s||!i||!p){console.error("Missing required data elements");return}const j=JSON.parse(s.textContent||"{}"),w=JSON.parse(i.textContent||"{}"),f=JSON.parse(p.textContent||"{}"),_={system:j,galaxy:w,system_url:f.system_url,version:f.version,system_index:f.system_index,image_url:f.image_url,page:f.page||1,cosmic_origin_time:f.cosmic_origin_time},a=document.getElementById("atlas-react-root");a&&et.createRoot(a).render(tt.createElement(vt,_))}catch(s){console.error("Error initializing System React app:",s)}});
