import{r as b,j as e,a as ot,c as et,R as tt}from"./atlas_BiACxVxc6cO5okV5F68Rd.js";import{R as Mt,L as jt,g as St,S as Fe,m as Nt,F as zt,H as Rt,a as Ct}from"./atlas_BAqEsQWQ_MCEaSfE85tyi.js";import{W as We}from"./atlas_hV4YbJX4LmBeaYZmYRF0y.js";import{a2 as Xe,C as Ge,a3 as Oe,G as Pe,q as it,cG as at,W as He,cH as De,cI as Be,b as je,z as ke,M as H,V as _e,B as Ae,cJ as rt,n as ct,a8 as Ze,a7 as lt,v as dt,cK as ut,cL as mt,S as Ie,c as ht,A as Re,g as Me,x as $e,D as Te,H as pt,t as Ue,m as Le,P as Ye,X as ft,y as xt}from"./atlas_BOOzg5XYrrU1N4SZySfRd.js";import{R as Et,S as kt,M as Pt,a as Ke,b as nt,D as Lt,T as Gt}from"./atlas_JNmU8gMIa1SHExpBzTLAF.js";import{O as gt}from"./atlas_BJLzboHTaSIGvKgNbvLUr.js";import{V as It}from"./atlas_DrLTn8mjMle6vK3_h1E1S.js";import"./atlas_5StMBQg7EZ_DcUhMgqODi.js";const Dt=({coordinates:r,galaxyName:D})=>{const A=b.useRef(null),$=b.useRef(null),k=b.useRef(null),C=b.useRef(null);return b.useEffect(()=>{if(!A.current)return;const T=A.current,L=T.clientWidth,we=T.clientHeight,ce=new Xe;ce.background=new Ge(657930),$.current=ce;const U=new Oe(45,L/we,.1,1e3);U.position.set(20,15,20),U.lookAt(0,0,0);const q=new We({antialias:!0,alpha:!0});q.setSize(L,we),q.setClearColor(0,.2),k.current=q,T.appendChild(q.domElement);const V=0,Y=1e7,J=5e6,[Q,_,me]=r,M=((Q-V)/(Y-V)-.5)*16,se=((_-V)/(Y-V)-.5)*16,ye=((me-V)/(Y-V)-.5)*16,x=new Pe;ce.add(x);const S=new it(16,16,16),j=new at(S),N=new He({color:16777215,opacity:.4,transparent:!0,linewidth:2}),W=new De(j,N);x.add(W);const F=new Be(16,16,16777215,16777215);F.material.opacity=.1,F.material.transparent=!0,F.position.y=-8,x.add(F);const ee=new Be(16,16,16777215,16777215);ee.material.opacity=.05,ee.material.transparent=!0,ee.rotation.z=Math.PI/2,ee.position.x=-8,x.add(ee);const g=new Be(16,16,16777215,16777215);g.material.opacity=.05,g.material.transparent=!0,g.rotation.x=Math.PI/2,g.position.z=-8,x.add(g);const X=new je(.5,32,32),xe=new ke({color:16777215,transparent:!0,opacity:.9}),O=new H(X,xe);O.position.set(0,0,0),x.add(O);const v=new H(new je(.8,32,32),new ke({color:16777215,transparent:!0,opacity:.2}));O.add(v);const P=new je(.4,32,32),oe=new ke({color:6605055,transparent:!0,opacity:1}),ue=new H(P,oe);ue.position.set(M,se,ye),x.add(ue);const s=new H(new je(.7,32,32),new ke({color:6605055,transparent:!0,opacity:.3}));if(ue.add(s),Math.sqrt(Math.pow(Q-J,2)+Math.pow(_-J,2)+Math.pow(me-J,2))<2e6){const o=[new _e(0,0,0),new _e(M,se,ye)],u=new Ae().setFromPoints(o),h=new rt({color:16762980,dashSize:.6,gapSize:.6,opacity:.4,transparent:!0,linewidth:2}),te=new ct(u,h);te.computeLineDistances(),x.add(te)}const n=new Ze(4210752,.6);ce.add(n);const d=new lt(16777215,.8);d.position.set(10,10,10),ce.add(d);const le=(o,u)=>{const h=document.createElement("canvas"),te=h.getContext("2d");if(!te)return null;h.width=64,h.height=64,te.fillStyle=`#${u.toString(16).padStart(6,"0")}`,te.font="bold 48px Arial",te.textAlign="center",te.textBaseline="middle",te.fillText(o,32,32);const R=new dt(h),pe=new ut({map:R,transparent:!0,opacity:.8}),fe=new mt(pe);return fe.scale.set(1.6,1.6,1),fe},Z=le("X",16739179);Z&&(Z.position.set(8.4,-7.6,-7.6),x.add(Z));const ie=le("Y",7077739);ie&&(ie.position.set(-7.6,8.4,-7.6),x.add(ie));const K=le("Z",7039999);K&&(K.position.set(-7.6,-7.6,8.4),x.add(K));let G=!1,l=0,i=0,t=!0,c=0;const y=o=>{G=!0,t=!1,l=o.clientX,i=o.clientY},E=o=>{if(!G)return;const u=o.clientX-l,h=o.clientY-i;x.rotation.y+=u*.01,x.rotation.x+=h*.01,l=o.clientX,i=o.clientY},z=()=>{G=!1,setTimeout(()=>{G||(t=!0)},3e3)},p=o=>{o.preventDefault();const u=.1,h=U.position.distanceTo(new _e(0,0,0));o.deltaY>0&&h<50?U.position.multiplyScalar(1+u):o.deltaY<0&&h>10&&U.position.multiplyScalar(1-u)},f=o=>{o.key==="Escape"&&document.dispatchEvent(new CustomEvent("universe-close-fullscreen"))},ae=o=>{if(o.preventDefault(),o.touches.length===1)G=!0,t=!1,l=o.touches[0].clientX,i=o.touches[0].clientY;else if(o.touches.length===2){const u=o.touches[0].clientX-o.touches[1].clientX,h=o.touches[0].clientY-o.touches[1].clientY;c=Math.sqrt(u*u+h*h)}},he=o=>{if(o.preventDefault(),o.touches.length===1&&G){const u=o.touches[0].clientX-l,h=o.touches[0].clientY-i;x.rotation.y+=u*.01,x.rotation.x+=h*.01,l=o.touches[0].clientX,i=o.touches[0].clientY}else if(o.touches.length===2){const u=o.touches[0].clientX-o.touches[1].clientX,h=o.touches[0].clientY-o.touches[1].clientY,te=Math.sqrt(u*u+h*h);if(c>0){const pe=te/c,fe=U.position.distanceTo(new _e(0,0,0));pe>1&&fe>10?U.position.multiplyScalar(1-.01):pe<1&&fe<50&&U.position.multiplyScalar(1+.01)}c=te}},w=o=>{o.preventDefault(),G=!1,c=0,setTimeout(()=>{G||(t=!0)},3e3)},m=q.domElement;m.style.cursor="grab",m.addEventListener("mousedown",o=>{m.style.cursor="grabbing",y(o)}),m.addEventListener("mousemove",E),m.addEventListener("mouseup",()=>{m.style.cursor="grab",z()}),m.addEventListener("mouseleave",()=>{m.style.cursor="grab",z()}),m.addEventListener("wheel",p),m.addEventListener("touchstart",ae,{passive:!1}),m.addEventListener("touchmove",he,{passive:!1}),m.addEventListener("touchend",w,{passive:!1}),document.addEventListener("keydown",f);const I=()=>{C.current=requestAnimationFrame(I),t&&(x.rotation.y+=.002,x.rotation.x+=.001);const o=Date.now()*.005;O.scale.setScalar(1+Math.sin(o)*.1),ue.rotation.y+=.01,q.render(ce,U)};I();const ge=()=>{const o=T.clientWidth,u=T.clientHeight;U.aspect=o/u,U.updateProjectionMatrix(),q.setSize(o,u)};return window.addEventListener("resize",ge),()=>{window.removeEventListener("resize",ge),document.removeEventListener("keydown",f),m.removeEventListener("mousedown",y),m.removeEventListener("mousemove",E),m.removeEventListener("mouseup",z),m.removeEventListener("mouseleave",z),m.removeEventListener("wheel",p),m.removeEventListener("touchstart",ae),m.removeEventListener("touchmove",he),m.removeEventListener("touchend",w),C.current&&cancelAnimationFrame(C.current),T&&q.domElement&&T.removeChild(q.domElement),q.dispose(),S.dispose(),j.dispose(),N.dispose(),X.dispose(),xe.dispose(),P.dispose(),oe.dispose()}},[r,D]),e.jsx("div",{ref:A,className:"w-full h-full"})},At=({coordinates:r,galaxyName:D})=>{const A=b.useRef(null),$=b.useRef(null),k=b.useRef(null),C=b.useRef(null),[T,L]=b.useState(!1),[we,ce]=b.useState(!1),[U,q]=b.useState(!1),V=()=>{ce(!0),setTimeout(()=>{L(!1),ce(!1)},300)};b.useEffect(()=>{const M=se=>{se.key==="Escape"&&T&&V()};return document.addEventListener("universe-close-fullscreen",V),document.addEventListener("keydown",M),()=>{document.removeEventListener("universe-close-fullscreen",V),document.removeEventListener("keydown",M)}},[T]),b.useEffect(()=>{if(T&&U){const M=setTimeout(()=>{q(!1)},50);return()=>clearTimeout(M)}},[T,U]),b.useEffect(()=>{if(!A.current)return;const M=A.current,se=M.clientWidth,ye=se<640,x=new Xe;x.background=new Ge(657930),$.current=x;const S=new Oe(30,se/120,.1,1e3);S.position.set(12,8,12),S.lookAt(0,0,0);const j=new We({antialias:!0,alpha:!0});j.setSize(se,120),j.setClearColor(0,.2),k.current=j,M.appendChild(j.domElement);const N=0,W=1e7,F=5e6,[ee,g,X]=r,xe=((ee-N)/(W-N)-.5)*8,O=((g-N)/(W-N)-.5)*8,v=((X-N)/(W-N)-.5)*8,P=new Pe;x.add(P);const oe=new it(8,8,8),ue=new at(oe),s=new He({color:16777215,opacity:.4,transparent:!0}),a=new De(ue,s);P.add(a);const n=new Be(8,8,16777215,16777215);n.material.opacity=.1,n.material.transparent=!0,n.position.y=-4,P.add(n);const d=new Be(8,8,16777215,16777215);d.material.opacity=.05,d.material.transparent=!0,d.rotation.z=Math.PI/2,d.position.x=-4,P.add(d);const le=new Be(8,8,16777215,16777215);le.material.opacity=.05,le.material.transparent=!0,le.rotation.x=Math.PI/2,le.position.z=-4,P.add(le);const Z=new je(.25,16,16),ie=new ke({color:16777215,transparent:!0,opacity:.9}),K=new H(Z,ie);K.position.set(0,0,0),P.add(K);const G=new H(new je(.45,16,16),new ke({color:16777215,transparent:!0,opacity:.2}));K.add(G);const l=new je(.2,16,16),i=new ke({color:6605055,transparent:!0,opacity:1}),t=new H(l,i);t.position.set(xe,O,v),P.add(t);const c=new H(new je(.35,16,16),new ke({color:6605055,transparent:!0,opacity:.3}));if(t.add(c),Math.sqrt(Math.pow(ee-F,2)+Math.pow(g-F,2)+Math.pow(X-F,2))<2e6){const B=[new _e(0,0,0),new _e(xe,O,v)],ne=new Ae().setFromPoints(B),re=new rt({color:16762980,dashSize:.3,gapSize:.3,opacity:.4,transparent:!0}),de=new ct(ne,re);de.computeLineDistances(),P.add(de)}const E=new Ze(4210752,.6);x.add(E);const z=new lt(16777215,.8);z.position.set(5,5,5),x.add(z);const p=(B,ne)=>{const re=document.createElement("canvas"),de=re.getContext("2d");if(!de)return null;re.width=32,re.height=32,de.fillStyle=`#${ne.toString(16).padStart(6,"0")}`,de.font="bold 24px Arial",de.textAlign="center",de.textBaseline="middle",de.fillText(B,16,16);const be=new dt(re),Ne=new ut({map:be,transparent:!0,opacity:.8}),ve=new mt(Ne);return ve.scale.set(.8,.8,1),ve},f=p("X",16739179);f&&(f.position.set(4.2,-3.8,-3.8),P.add(f));const ae=p("Y",7077739);ae&&(ae.position.set(-3.8,4.2,-3.8),P.add(ae));const he=p("Z",7039999);he&&(he.position.set(-3.8,-3.8,4.2),P.add(he));let w=!1,m=0,I=0,ge=!0;const o=B=>{w=!0,ge=!1,m=B.clientX,I=B.clientY},u=B=>{if(!w)return;const ne=B.clientX-m,re=B.clientY-I;P.rotation.y+=ne*.01,P.rotation.x+=re*.01,m=B.clientX,I=B.clientY},h=()=>{w=!1,setTimeout(()=>{w||(ge=!0)},3e3)},te=B=>{B.preventDefault();const ne=.1,re=S.position.distanceTo(new _e(0,0,0));B.deltaY>0&&re<25?S.position.multiplyScalar(1+ne):B.deltaY<0&&re>5&&S.position.multiplyScalar(1-ne)},R=j.domElement;R.style.cursor="grab",R.style.borderRadius="8px",R.addEventListener("mousedown",B=>{R.style.cursor="grabbing",o(B)}),R.addEventListener("mousemove",u),R.addEventListener("mouseup",()=>{R.style.cursor="grab",h()}),R.addEventListener("mouseleave",()=>{R.style.cursor="grab",h()}),R.addEventListener("wheel",te);const pe=()=>{C.current=requestAnimationFrame(pe),ge&&(P.rotation.y+=.002,P.rotation.x+=.001);const B=Date.now()*.005;K.scale.setScalar(1+Math.sin(B)*.1),t.rotation.y+=.01,j.render(x,S)};pe();const fe=()=>{const B=M.clientWidth,ne=B<640?150:160;S.aspect=B/ne,S.updateProjectionMatrix(),j.setSize(B,ne)};return window.addEventListener("resize",fe),()=>{window.removeEventListener("resize",fe),R.removeEventListener("mousedown",o),R.removeEventListener("mousemove",u),R.removeEventListener("mouseup",h),R.removeEventListener("mouseleave",h),R.removeEventListener("wheel",te),C.current&&cancelAnimationFrame(C.current),M&&j.domElement&&M.removeChild(j.domElement),j.dispose(),oe.dispose(),ue.dispose(),s.dispose(),Z.dispose(),ie.dispose(),l.dispose(),i.dispose()}},[r,D]);const Y=M=>M.replace(/_/g," "),J=M=>M>=1e6?`${(M/1e6).toFixed(1)}M`:M>=1e3?`${(M/1e3).toFixed(1)}K`:M.toString(),[Q,_,me]=r;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Galaxy Location"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{ref:A,className:"w-full border border-white/20 rounded bg-black/20",style:{height:"auto"}}),e.jsx("button",{onClick:()=>{L(!0),q(!0)},className:"absolute top-2 right-2 p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg z-10",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full opacity-90"}),e.jsx("span",{className:"text-[10px]",children:"Bit Bang"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsx("span",{className:"text-[10px]",children:Y(D)})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:[J(Q),", ",J(_),", ",J(me)]})]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500",children:"Scroll: Zoom • Drag: Rotate View"})]})]}),T&&ot.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${we||U?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${we||U?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:Y(D)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsxs("h2",{className:"text-xl font-bold text-white",children:[Y(D)," - Galaxy Location"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-white rounded-full opacity-90"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Bit Bang"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Galaxy"})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:[J(Q),", ",J(_),", ",J(me)]})]})]}),e.jsx("button",{onClick:V,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Dt,{coordinates:r,galaxyName:D})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},_t=({galaxy:r})=>{const[D,A]=b.useState({isOnCooldown:!1,isSaved:!1,isCollecting:!1,timeUntilNext:0});b.useEffect(()=>{let k;const C=()=>{const ce=Ke.generateLocationId("galaxy",r.coordinates.join(","),void 0,void 0),U=Ke.canCollectFromLocation(ce),q=Ke.getTimeUntilNextCollection(ce),V=r.coordinates,Y=nt.generateGalaxyUrl(V,nt.getCurrentPage()),Q=jt.getLocations().some(_=>_.stargateUrl===Y);A(_=>({isOnCooldown:!U&&q>0,isSaved:Q,isCollecting:_.isCollecting,timeUntilNext:q}))},T=()=>{A(ce=>({...ce,isCollecting:!0})),k=setTimeout(()=>{A(ce=>({...ce,isCollecting:!1}))},1e3)};C();const L=setInterval(C,1e3),we=Mt.subscribe("mining_completed",T);return()=>{clearInterval(L),k&&clearTimeout(k),we()}},[r.name,r.coordinates]);const $=k=>k.replace(/_/g," ");return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[e.jsx(Et,{locationType:"galaxy",locationId:r.name,coordinates:r.coordinates.join(","),className:"text-xs"}),e.jsx(kt,{type:"galaxy",name:r.name,coordinates:r.coordinates.join(","),className:"text-xs"}),e.jsx("div",{className:"inline-flex items-center bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] font-medium px-1.5 py-0.5 rounded h-[21px] box-border",children:"VISITED"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Pt,{isOnCooldown:D.isOnCooldown,isSaved:D.isSaved,isCollecting:D.isCollecting}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Details"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Type"}),e.jsx("div",{className:"text-sm font-bold text-blue-300",children:r.galaxy_type})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Solar Systems"}),e.jsx("div",{className:"text-sm font-bold text-purple-300",children:r.num_systems.toLocaleString()})]})]}),e.jsx("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-2",children:e.jsx(At,{coordinates:r.coordinates,galaxyName:r.name})}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-gray-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Cosmic Objects"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-pink-500/20",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"Black Holes"}),e.jsx("div",{className:"text-xs font-bold text-pink-300",children:r.black_holes.toLocaleString()})]}),e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-cyan-500/20",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"Pulsars"}),e.jsx("div",{className:"text-xs font-bold text-cyan-300",children:r.pulsars.toLocaleString()})]}),e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-indigo-500/20",children:[e.jsx("div",{className:"text-xs text-gray-300",children:"Quasars"}),e.jsx("div",{className:"text-xs font-bold text-indigo-300",children:r.quasars.toLocaleString()})]})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),e.jsx("div",{className:"text-white truncate font-medium",children:$(r.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),e.jsx("div",{className:"text-white font-medium",children:r.coordinates.join(", ")})]})]})]})]})},Ft=({galaxyType:r,numSystems:D,blackHoles:A,pulsars:$,quasars:k,seed:C=12345,onExpandClick:T,galaxyName:L})=>{const we=b.useRef(null),ce=b.useRef(null),U=b.useRef(null),q=b.useRef(null),V=b.useRef(null),Y=b.useRef(null),J=b.useRef(null),Q=b.useRef(!1),[_,me]=b.useState(!1),[M,se]=b.useState(!1),ye=b.useRef(null);class x{seed;constructor(N){this.seed=N}random(){const N=Math.sin(this.seed++)*1e4;return N-Math.floor(N)}uniform(N,W){return N+this.random()*(W-N)}gauss(N,W){let F=0,ee=0;for(;F===0;)F=this.random();for(;ee===0;)ee=this.random();const g=Math.sqrt(-2*Math.log(F))*Math.cos(2*Math.PI*ee);return N+W*g}randint(N,W){return Math.floor(this.uniform(N,W+1))}}b.useEffect(()=>{const j=J.current;if(!j)return;const N=j.getContext("2d");if(!N)return;let W=[];const F=800;let ee,g;const X=800;let xe,O=.5;function v(){const s=j?.parentElement;if(!s||!j)return;const a=s.clientWidth,n=s.clientHeight;j.width=Math.min(a,X),j.height=Math.min(n,X),ee=j.width/2,g=j.height/2}function P(){v(),W=[];for(let s=0;s<F;s++)W.push({x:Math.random()*(j?.width||800),y:Math.random()*(j?.height||800),z:Math.random()*(j?.width||800),o:Math.random()});oe()}function oe(){!j||!N||(N.clearRect(0,0,j.width,j.height),W.forEach(s=>{s.z-=O,s.z<=0&&(s.z=j.width,s.x=Math.random()*j.width,s.y=Math.random()*j.height,s.o=Math.random());const a=j.width/s.z,n=(s.x-ee)*a+ee,d=(s.y-g)*a+g,le=2*a;N.beginPath(),N.fillStyle=`rgba(255, 255, 255, ${s.o})`,N.arc(n,d,le,0,2*Math.PI),N.fill()}),!Q.current&&O<60&&(O+=1),Q.current&&O>2&&(O-=2),xe=requestAnimationFrame(oe))}P();const ue=()=>v();return window.addEventListener("resize",ue),()=>{window.removeEventListener("resize",ue),xe&&cancelAnimationFrame(xe)}},[]),b.useEffect(()=>{if(!we.current)return;const j=we.current,N=j.clientWidth,W=j.clientHeight,F=Math.min(N,W),ee=new Xe;ee.background=new Ge(17),ce.current=ee;const g=new Oe(45,1,.1,1e4);g.position.set(0,200,400),g.lookAt(0,0,0),ye.current=g;const X=new We({antialias:!0,alpha:!0});X.setSize(F,F),X.setClearColor(17,1),U.current=X,j.appendChild(X.domElement);const xe=new gt(g,X.domElement);xe.enableDamping=!0,xe.dampingFactor=.05,xe.minDistance=50,xe.maxDistance=800,xe.autoRotate=!0,xe.autoRotateSpeed=.5,xe.enablePan=!0,xe.enableZoom=!0,xe.target.set(0,0,0),V.current=xe;const O=new Pe;Y.current=O,ee.add(O);const v=new x(C),P=v.uniform(0,2*Math.PI),oe=new Ae,ue=[],s=[],a=[],n=200;let d=D;if(r==="Spiral"){d=Math.min(D,5e4);const l=4,i=2*Math.PI/l,t=.15,c=.5,y=.1;for(let E=0;E<d*y;E++){const z=v.uniform(0,2*Math.PI),p=v.gauss(n*.1,n*.05),f=v.gauss(0,5),ae=p*Math.cos(z),he=p*Math.sin(z);ue.push(ae,f,he),s.push(1,1,1);const w=C+E*1337,m=new x(w),I=m.gauss(1,.3),ge=m.random()<.05,o=m.random()<.3;let u=Math.max(.3,I);ge&&(u*=3+m.uniform(0,2)),o&&(u*=.5+m.uniform(0,.3)),p<n*.2&&(u*=1.8+m.uniform(0,.7),s[s.length-3]=1.2,s[s.length-2]=1.1,s[s.length-1]=.9),a.push(Math.min(u*1.5,12))}for(let E=0;E<d;E++){const z=c*Math.sqrt(E/d)*2*Math.PI,p=E%l*i,f=n*Math.sqrt(E/d),ae=f*Math.cos(z+p+P)+v.uniform(-t*f,t*f),he=f*Math.sin(z+p+P)+v.uniform(-t*f,t*f),w=v.gauss(0,3);ue.push(ae,w,he),s.push(1,1,.8);const m=C+E*1337,I=new x(m),ge=I.gauss(.8,.25),o=I.random()<.03,u=I.random()<.4;let h=Math.max(.2,ge);o&&(h*=2.5+I.uniform(0,1.5)),u&&(h*=.4+I.uniform(0,.2)),f>n*.7&&(h*=.8),a.push(Math.min(h*1.3,8))}}else if(r==="Elliptical"){d=Math.min(D,1e5);for(let l=0;l<d;l++){const i=v.uniform(0,2*Math.PI),t=v.uniform(-1,1),c=Math.sqrt(1-t*t),y=v.random(),E=Math.pow(y,.6),z=-Math.log(1-E*.98)*n*.35,p=z*c*Math.cos(i),f=z*t*.6,ae=z*c*Math.sin(i);ue.push(p,f,ae),s.push(1,.9,.7);const he=C+l*1337,w=new x(he),m=w.gauss(.6,.2),I=w.random()<.08,ge=w.random()<.25;let o=Math.max(.2,m);I&&(o*=2+w.uniform(0,1)),ge&&(o*=.6+w.uniform(0,.2)),Math.sqrt(p*p+f*f+ae*ae)<n*.3&&(o*=1.5+w.uniform(0,.5)),a.push(Math.min(o*1.4,7))}}else if(r==="Dwarf"){d=Math.min(D/100,1e4);for(let l=0;l<d;l++){const i=v.uniform(0,2*Math.PI),t=v.uniform(0,Math.PI),c=v.gauss(n/3,n*.3),y=c*Math.sin(t)*Math.cos(i),E=c*Math.cos(t)*.5,z=c*Math.sin(t)*Math.sin(i);ue.push(y,E,z),s.push(.8,.8,1);const p=C+l*1337,f=new x(p),ae=f.gauss(.7,.3),he=f.random()<.02,w=f.random()<.6;let m=Math.max(.3,ae);he&&(m*=2.5+f.uniform(0,1)),w&&(m*=.5+f.uniform(0,.3)),a.push(Math.min(m*1.2,5))}}else if(r==="Singularity Void"){d=1e4;for(let re=0;re<d;re++){const de=re/d,be=de*30*Math.PI,Ne=n*(1-de*.8)+v.uniform(-10,10),ve=(de-.5)*300+Math.sin(be*.5)*20,Ce=Ne*Math.cos(be)+Math.sin(de*20)*10,Ee=Ne*Math.sin(be)+Math.cos(de*20)*10;ue.push(Ce,ve,Ee);const ze=(de+Math.sin(be*.1))%1,Se=new Ge;Se.setHSL(ze,1,.5+Math.sin(de*10)*.3),s.push(Se.r,Se.g,Se.b),a.push(v.uniform(.3,2)*(1+Math.sin(de*50)*.5))}const l=(re,de,be=1)=>{const Ne=new je(re,64,64),ve=`
          varying vec2 vUv;
          varying vec3 vPosition;
          varying vec3 vNormal;
          void main() {
            vUv = uv;
            vPosition = position;
            vNormal = normalize(normalMatrix * normal);
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,Ce=`
          varying vec2 vUv;
          varying vec3 vPosition;
          varying vec3 vNormal;
          uniform float time;
          uniform float speed;

          void main() {
            float theta = atan(vPosition.z, vPosition.x);
            float phi = acos(vPosition.y / length(vPosition));
            vec2 p = vec2(theta / 3.14159, phi / 3.14159);

            float a = time * 40.0 * speed;
            float d, e, f, g = 1.0 / 40.0, h, i, r, q;

            e = 400.0 * (p.x * 0.5 + 0.5);
            f = 400.0 * (p.y * 0.5 + 0.5);
            i = 200.0 + sin(e * g + a / 150.0) * 20.0;
            d = 200.0 + cos(f * g / 2.0) * 18.0 + cos(e * g) * 7.0;
            r = sqrt(pow(abs(i - e), 2.0) + pow(abs(d - f), 2.0));
            q = f / r;
            e = (r * cos(q)) - a / 2.0;
            f = (r * sin(q)) - a / 2.0;
            d = sin(e * g) * 176.0 + sin(e * g) * 164.0 + r;
            h = ((f + d) + a / 2.0) * g;
            i = cos(h + r * p.x / 1.3) * (e + e + a) + cos(q * g * 6.0) * (r + h / 3.0);
            h = sin(f * g) * 144.0 - sin(e * g) * 212.0 * p.x;
            h = (h + (f - e) * q + sin(r - (a + h) / 7.0) * 10.0 + i / 4.0) * g;
            i += cos(h * 2.3 * sin(a / 350.0 - q)) * 184.0 * sin(q - (r * 4.3 + a / 12.0) * g) + tan(r * g + h) * 184.0 * cos(r * g + h);
            i = mod(i / 5.6, 256.0) / 64.0;
            if (i < 0.0) i += 4.0;
            if (i >= 2.0) i = 4.0 - i;
            d = r / 350.0;
            d += sin(d * d * 8.0) * 0.52;
            f = (sin(a * g) + 1.0) / 2.0;

            vec3 color = vec3(f * i / 1.6, i / 2.0 + d / 13.0, i) * d * p.x +
                         vec3(i / 1.3 + d / 8.0, i / 2.0 + d / 18.0, i) * d * (1.0 - p.x);

            float depth = dot(vNormal, vec3(0.0, 0.0, 1.0));
            color *= 0.7 + depth * 0.3;

            color = mix(color, vec3(0.5, 0.0, 1.0), 0.3);

            float edgeFactor = pow(1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0))), 2.0);
            color += vec3(0.5, 0.0, 1.0) * edgeFactor * 0.5;

            gl_FragColor = vec4(color, ${de});
          }
        `,Ee=new Ie({uniforms:{time:{value:0},speed:{value:be}},vertexShader:ve,fragmentShader:Ce,transparent:!0,blending:Re,side:Te,depthWrite:!1}),ze=new H(Ne,Ee);return ze.isSingularityShader=!0,ze.shaderSpeed=be,ze},i=l(250,.3,1);O.add(i);const t=l(180,.4,-.7);O.add(t);const c=l(120,.5,1.5);O.add(c);const y=l(300,.2,.5);y.scale.set(-1,1,1),O.add(y);const E=new je(350,32,32),z=new Ie({uniforms:{time:{value:0}},vertexShader:`
          varying vec3 vPosition;
          varying vec3 vNormal;
          uniform float time;
          void main() {
            vPosition = position;
            vNormal = normalize(normalMatrix * normal);


            vec3 distortedPosition = position;
            float distortion = sin(time * 0.5 + length(position) * 0.01) * 5.0;
            distortedPosition += normal * distortion;

            gl_Position = projectionMatrix * modelViewMatrix * vec4(distortedPosition, 1.0);
          }
        `,fragmentShader:`
          varying vec3 vPosition;
          varying vec3 vNormal;
          uniform float time;

          void main() {

            float fresnel = pow(1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0))), 3.0);
            float wave = sin(time * 2.0 + length(vPosition) * 0.05) * 0.5 + 0.5;

            vec3 color = vec3(0.1, 0.0, 0.3) * fresnel * wave;
            float alpha = fresnel * 0.1 * wave;

            gl_FragColor = vec4(color, alpha);
          }
        `,transparent:!0,blending:Re,side:ht,depthWrite:!1}),p=new H(E,z);p.isSingularityShader=!0,p.shaderSpeed=.3,O.add(p);const f=new Ae,ae=[],he=[];for(let re=0;re<1e3;re++){const de=v.uniform(-n,n),be=v.uniform(-n/2,n/2),Ne=v.uniform(-n,n),ve=v.uniform(-50,50),Ce=v.uniform(-30,30),Ee=v.uniform(-50,50);ae.push(de,be,Ne),ae.push(de+ve,be+Ce,Ne+Ee);const ze=v.random(),Se=new Ge;Se.setHSL(ze,1,.6),he.push(Se.r,Se.g,Se.b),he.push(Se.r*.5,Se.g*.5,Se.b*.5)}f.setAttribute("position",new Me(ae,3)),f.setAttribute("color",new Me(he,3));const w=new He({vertexColors:!0,transparent:!0,opacity:.4,blending:Re}),m=new De(f,w);m.isGlitchLines=!0,O.add(m);const I=new Pe,ge=new je(20,32,32),o=new ke({color:0,transparent:!0,opacity:.95}),u=new H(ge,o);I.add(u);const h=new $e(25,80,64),te=new Ie({uniforms:{time:{value:0},innerRadius:{value:25},outerRadius:{value:80}},vertexShader:`
          varying vec2 vUv;
          varying float vRadius;
          void main() {
            vUv = uv;
            vec4 worldPosition = modelMatrix * vec4(position, 1.0);
            vRadius = length(worldPosition.xy);
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,fragmentShader:`
          uniform float time;
          uniform float innerRadius;
          uniform float outerRadius;
          varying vec2 vUv;
          varying float vRadius;

          void main() {
            float normalizedRadius = (vRadius - innerRadius) / (outerRadius - innerRadius);
            float angle = atan(vUv.y - 0.5, vUv.x - 0.5);


            float swirl = sin(angle * 5.0 - time * 2.0 + normalizedRadius * 10.0) * 0.5 + 0.5;
            float intensity = 1.0 - normalizedRadius;


            vec3 hotColor = vec3(1.0, 0.5, 0.0);
            vec3 coldColor = vec3(0.0, 0.3, 1.0);
            vec3 color = mix(coldColor, hotColor, intensity);


            color *= (0.7 + swirl * 0.3);


            float alpha = intensity * 0.8;

            gl_FragColor = vec4(color, alpha);
          }
        `,transparent:!0,blending:Re,side:Te}),R=new H(h,te);R.rotation.x=Math.PI/2,R.isAccretionDisk=!0,I.add(R);for(let re=0;re<8;re++){const de=30+re*20,be=new pt(de,1+re*.5,8,64),Ne=new ke({color:new Ge().setHSL((.7+re*.05)%1,1,.5),transparent:!0,opacity:.3-re*.03,wireframe:!0}),ve=new H(be,Ne);ve.rotation.x=v.uniform(0,Math.PI),ve.rotation.y=v.uniform(0,Math.PI),ve.isDistortionRing=!0,ve.rotationSpeed=v.uniform(.001,.005)*(re%2===0?1:-1),I.add(ve)}O.add(I);const pe=new Ue(5,100,8),fe=new Le({color:16711935,transparent:!0,opacity:.6,emissive:16711935,emissiveIntensity:1,blending:Re}),B=new H(pe,fe);B.position.y=50,O.add(B);const ne=new H(pe,fe);ne.position.y=-50,ne.rotation.z=Math.PI,O.add(ne)}if(r!=="Singularity Void"){const l=[],i=new x(C+999);for(let w=0;w<A;w++){const m=i.uniform(-50,50),I=i.uniform(-20,20),ge=i.uniform(-50,50);l.push({x:m,y:I,z:ge})}const t=[],c=[],y=[],E=[],z=[],p=.4,f=p*25;for(let w=0;w<ue.length;w+=3){const m=ue[w],I=ue[w+1],ge=ue[w+2];let o=1/0,u=null;for(const h of l){const te=Math.sqrt(Math.pow(m-h.x,2)+Math.pow(I-h.y,2)+Math.pow(ge-h.z,2));te<o&&(o=te,u=h)}if(!(o<p))if(o<f&&u){const h=1-(o-p)/(f-p);u.x-m,u.y-I,u.z-ge;const te=Math.atan2(ge-u.z,m-u.x),R=h*.8,pe=8;for(let ve=0;ve<pe-1;ve++){const Ce=ve/(pe-1),Ee=(ve+1)/(pe-1),ze=o*(1-Ce*R*.7),Se=te+Ce*R*1.5,qe=u.x+ze*Math.cos(Se),Ve=I+(u.y-I)*Ce*.3,vt=u.z+ze*Math.sin(Se),Je=o*(1-Ee*R*.7),Qe=te+Ee*R*1.5,wt=u.x+Je*Math.cos(Qe),yt=I+(u.y-I)*Ee*.3,bt=u.z+Je*Math.sin(Qe);E.push(qe,Ve,vt),E.push(wt,yt,bt)}const fe=h*1.5,B=s[w],ne=s[w+1],re=s[w+2],de=Math.min(B+fe,2),be=Math.max(ne*(1-fe*.6),.1),Ne=Math.max(re*(1-fe*.8),.1);for(let ve=0;ve<pe-1;ve++){const Ce=ve/(pe-1),Ee=(ve+1)/(pe-1),ze=1-Ce*h*.6,Se=1-Ee*h*.6,qe=fe*(.5+Ce*.5),Ve=fe*(.5+Ee*.5);z.push(Math.min(de+qe*.3,2)*ze,Math.max(be*(1-qe*.2),.1)*ze,Math.max(Ne*(1-qe*.4),.1)*ze),z.push(Math.min(de+Ve*.3,2)*Se,Math.max(be*(1-Ve*.2),.1)*Se,Math.max(Ne*(1-Ve*.4),.1)*Se)}t.push(m,I,ge),c.push(de,be,Ne),y.push(Math.max(a[w/3]*(1-h*.5),.3))}else t.push(m,I,ge),c.push(s[w],s[w+1],s[w+2]),y.push(a[w/3])}oe.setAttribute("position",new Me(t,3)),oe.setAttribute("color",new Me(c,3)),oe.setAttribute("size",new Me(y,1));const ae=new Ie({uniforms:{},vertexShader:`
          attribute float size;
          varying vec3 vColor;
          void main() {
            vColor = color;
            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
            gl_PointSize = size * (400.0 / -mvPosition.z);
            gl_Position = projectionMatrix * mvPosition;
          }
        `,fragmentShader:`
          varying vec3 vColor;
          void main() {

            vec2 center = gl_PointCoord - vec2(0.5);
            float distanceFromCenter = length(center);

            if (distanceFromCenter > 0.5) {
              discard;
            }


            float alpha = 1.0 - (distanceFromCenter / 0.5);
            alpha = pow(alpha, 2.0);

            gl_FragColor = vec4(vColor, alpha * 0.8);
          }
        `,transparent:!0,blending:Re,vertexColors:!0,depthWrite:!1}),he=new Ye(oe,ae);if(O.add(he),E.length>0){const w=new Ae;w.setAttribute("position",new Me(E,3)),w.setAttribute("color",new Me(z,3));const m=new He({vertexColors:!0,transparent:!0,opacity:.8,linewidth:2,blending:Re}),I=new De(w,m);O.add(I)}}else{oe.setAttribute("position",new Me(ue,3)),oe.setAttribute("color",new Me(s,3)),oe.setAttribute("size",new Me(a,1));const l=new ft({size:2,vertexColors:!0,transparent:!0,opacity:.8,blending:Re,sizeAttenuation:!0}),i=new Ye(oe,l);O.add(i)}const le=new x(C+999);for(let l=0;l<A;l++){const i=new Pe,t=le.uniform(-50,50),c=le.uniform(-20,20),y=le.uniform(-50,50),E=new je(1.5,16,16),z=new ke({color:0,transparent:!0,opacity:.9}),p=new H(E,z);i.add(p),[{innerRadius:2,outerRadius:2.3,color:16777215,opacity:.8,emissive:16777164},{innerRadius:2.3,outerRadius:2.7,color:16755200,opacity:.7,emissive:16746496},{innerRadius:2.7,outerRadius:3.2,color:16729088,opacity:.6,emissive:16720384},{innerRadius:3.2,outerRadius:4,color:11141120,opacity:.5,emissive:6684672},{innerRadius:4,outerRadius:5,color:4456448,opacity:.3,emissive:2228224}].forEach((ae,he)=>{const w=new $e(ae.innerRadius,ae.outerRadius,32),m=new Le({color:ae.color,transparent:!0,opacity:ae.opacity,emissive:ae.emissive,emissiveIntensity:.3,side:Te}),I=new H(w,m);I.rotation.x=Math.PI/2,I.rotation.z=v.uniform(0,Math.PI*2),I.isAccretionRing=!0,I.rotationSpeed=.002+he*5e-4,i.add(I)}),i.position.set(t,c,y),O.add(i)}for(let l=0;l<$;l++){const i=new je(1.5,8,8),t=new Le({color:16776960,emissive:16776960,emissiveIntensity:1}),c=new H(i,t);c.position.set(v.uniform(-n,n),v.uniform(-n/4,n/4),v.uniform(-n,n)),c.isPulsar=!0,c.pulseSpeed=v.uniform(1,3),O.add(c)}for(let l=0;l<k;l++){const i=new Pe,t=new je(2,16,16),c=new Le({color:16777215,emissive:16777215,emissiveIntensity:2}),y=new H(t,c);i.add(y);const E=new Ue(1,20,8),z=new Le({color:16711680,transparent:!0,opacity:.6,emissive:16711680,emissiveIntensity:.5}),p=new H(E,z);p.position.y=10,i.add(p);const f=new H(E,z);f.position.y=-10,f.rotation.z=Math.PI,i.add(f),i.position.set(v.uniform(-n,n),v.uniform(-n/4,n/4),v.uniform(-n,n)),O.add(i)}const Z=new Ze(4210752,.5);ee.add(Z);const ie=new xt(16777215,.5,1e3);ie.position.set(0,100,0),ee.add(ie);const K=()=>{q.current=requestAnimationFrame(K);const l=performance.now()/1e3;Y.current&&(Y.current.rotation.y+=.001),O.children.forEach(i=>{if(i.isPulsar){const t=i.pulseSpeed||1;i.scale.setScalar(1+Math.sin(Date.now()*.001*t)*.3)}if(i.isSingularityShader&&i instanceof H){const t=i.material;t.uniforms&&t.uniforms.time&&(t.uniforms.time.value=l);const c=i.shaderSpeed||1;i.rotation.y+=.001*c,i.rotation.x+=5e-4*c}if(i.isAccretionDisk&&i instanceof H){const t=i.material;t.uniforms&&t.uniforms.time&&(t.uniforms.time.value=l),i.rotation.z+=.002}if(i.isDistortionRing){const t=i.rotationSpeed||.001;i.rotation.x+=t,i.rotation.y+=t*.7,i.scale.setScalar(1+Math.sin(l*2)*.1)}if(i.isGlitchLines&&i instanceof De){const t=i.material;t.opacity=.2+Math.sin(l*3)*.2,i.rotation.z+=5e-4}i instanceof Pe&&i.children.forEach(t=>{if(t.isAccretionDisk&&t instanceof H){const c=t.material;c.uniforms&&c.uniforms.time&&(c.uniforms.time.value=l),t.rotation.z+=.002}if(t.isAccretionRing&&t instanceof H){const c=t.rotationSpeed||.002;t.rotation.z+=c}if(t.isDistortionRing){const c=t.rotationSpeed||.001;t.rotation.x+=c,t.rotation.y+=c*.7,t.scale.setScalar(1+Math.sin(l*2)*.1)}})}),V.current&&V.current.update(),X.render(ee,g)};K(),setTimeout(()=>{me(!0),se(!0),Q.current=!0},800);const G=()=>{if(!we.current||!X)return;const l=we.current,i=Math.min(l.clientWidth,l.clientHeight);X.setSize(i,i),g.aspect=1,g.updateProjectionMatrix()};return window.addEventListener("resize",G),()=>{window.removeEventListener("resize",G),V.current&&V.current.dispose(),q.current&&cancelAnimationFrame(q.current),j&&X.domElement&&j.removeChild(X.domElement),X.dispose()}},[r,D,A,$,k,C]);const S=()=>{if(!U.current||!ce.current||!ye.current)return;const j=U.current,N=ce.current,W=ye.current,F=j.domElement.width,ee=j.domElement.height,g=3840/F,X=[];N.traverse(v=>{if(v.isPoints&&v.material){const P=v.material;if(P.size!==void 0&&(X.push({material:P,originalSize:P.size}),P.size=P.size*g*1),P.uniforms&&P.uniforms.scale&&(X.push({material:P,originalScale:P.uniforms.scale.value}),P.uniforms.scale.value=P.uniforms.scale.value*g*1),v.geometry&&v.geometry.attributes.size){const oe=v.geometry.attributes.size,ue=oe.array.slice();X.push({geometry:v.geometry,originalSizeArray:ue});for(let s=0;s<oe.array.length;s++)oe.array[s]*=g*1;oe.needsUpdate=!0}}});const xe=3840,O=3840;j.setSize(xe,O),W.aspect=1,W.updateProjectionMatrix(),j.render(N,W),j.domElement.toBlob(v=>{if(v){const P=document.createElement("canvas"),oe=P.getContext("2d");if(P.width=xe,P.height=O,oe){const ue=new Image;ue.onload=()=>{oe.drawImage(ue,0,0);const n=`Copyright Banshee - 2023-${new Date().getFullYear()}`;oe.fillStyle="rgba(255, 255, 255, 0.5)",oe.font=`${Math.floor(xe/80)}px Arial`,oe.textAlign="left",oe.textBaseline="bottom";const d=Math.floor(xe/100);oe.fillText(n,d,O-d),P.toBlob(le=>{if(le){const Z=URL.createObjectURL(le),ie=document.createElement("a");ie.href=Z,ie.download=`galaxy_${L||r}_${Date.now()}.png`,ie.click(),URL.revokeObjectURL(Z)}},"image/png",1)};const s=URL.createObjectURL(v);ue.src=s}}X.forEach(({material:P,originalSize:oe,originalScale:ue,geometry:s,originalSizeArray:a})=>{if(oe!==void 0&&(P.size=oe),ue!==void 0&&(P.uniforms.scale.value=ue),s&&a){const n=s.attributes.size;for(let d=0;d<a.length;d++)n.array[d]=a[d];n.needsUpdate=!0}}),j.setSize(F,ee),W.aspect=1,W.updateProjectionMatrix()},"image/png",1)};return e.jsxs("div",{className:"relative w-full h-full bg-black rounded",children:[e.jsx("canvas",{ref:J,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${M?"opacity-0":"opacity-100"}`,style:{filter:M?"blur(50px)":"none"}}),e.jsxs("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${_?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:[e.jsx("div",{ref:we,className:"w-full h-full border border-white/20 rounded bg-black/20"}),_&&L&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:L})}),_&&e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 z-10",children:[e.jsx("button",{onClick:S,className:"p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg",title:"Download screenshot",children:e.jsx(Lt,{className:"w-4 h-4 text-white"})}),T&&e.jsx("button",{onClick:T,className:"p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})]})]})},Bt=({galaxyType:r,numSystems:D,blackHoles:A,pulsars:$,quasars:k,seed:C=12345,galaxyName:T})=>{const L=b.useRef(null),we=b.useRef(null),ce=b.useRef(null),U=b.useRef(null),q=b.useRef(null),V=b.useRef(null);class Y{seed;constructor(Q){this.seed=Q}random(){const Q=Math.sin(this.seed++)*1e4;return Q-Math.floor(Q)}uniform(Q,_){return Q+this.random()*(_-Q)}gauss(Q,_){let me=0,M=0;for(;me===0;)me=this.random();for(;M===0;)M=this.random();const se=Math.sqrt(-2*Math.log(me))*Math.cos(2*Math.PI*M);return Q+_*se}randint(Q,_){return Math.floor(this.uniform(Q,_+1))}}return b.useEffect(()=>{if(!L.current)return;const J=L.current,Q=J.clientWidth,_=J.clientHeight,me=new Xe;me.background=new Ge(17),we.current=me;const M=new Oe(45,Q/_,.1,1e4);M.position.set(0,200,400),M.lookAt(0,0,0);const se=new We({antialias:!0,alpha:!0});se.setSize(Q,_),se.setClearColor(17,1),ce.current=se,J.appendChild(se.domElement);const ye=new gt(M,se.domElement);ye.enableDamping=!0,ye.dampingFactor=.05,ye.minDistance=50,ye.maxDistance=1200,ye.autoRotate=!0,ye.autoRotateSpeed=.5,ye.enablePan=!0,ye.enableZoom=!0,ye.target.set(0,0,0),q.current=ye;const x=new Pe;V.current=x,me.add(x);const S=new Y(C),j=S.uniform(0,2*Math.PI),N=new Ae,W=[],F=[],ee=[],g=200;let X=D;if(r==="Spiral"){X=Math.min(D,5e4);const s=4,a=2*Math.PI/s,n=.15,d=.5,le=.1;for(let Z=0;Z<X*le;Z++){const ie=S.uniform(0,2*Math.PI),K=S.gauss(g*.1,g*.05),G=S.gauss(0,5),l=K*Math.cos(ie),i=K*Math.sin(ie);W.push(l,G,i),F.push(1,1,1);const t=C+Z*1337,c=new Y(t),y=c.gauss(1,.3),E=c.random()<.05,z=c.random()<.3;let p=Math.max(.3,y);E&&(p*=3+c.uniform(0,2)),z&&(p*=.5+c.uniform(0,.3)),K<g*.2&&(p*=1.8+c.uniform(0,.7),F[F.length-3]=1.2,F[F.length-2]=1.1,F[F.length-1]=.9),ee.push(Math.min(p*1.5,12))}for(let Z=0;Z<X;Z++){const ie=d*Math.sqrt(Z/X)*2*Math.PI,K=Z%s*a,G=g*Math.sqrt(Z/X),l=G*Math.cos(ie+K+j)+S.uniform(-n*G,n*G),i=G*Math.sin(ie+K+j)+S.uniform(-n*G,n*G),t=S.gauss(0,3);W.push(l,t,i),F.push(1,1,.8);const c=C+Z*1337,y=new Y(c),E=y.gauss(.8,.25),z=y.random()<.03,p=y.random()<.4;let f=Math.max(.2,E);z&&(f*=2.5+y.uniform(0,1.5)),p&&(f*=.4+y.uniform(0,.2)),G>g*.7&&(f*=.8),ee.push(Math.min(f*1.3,8))}}else if(r==="Elliptical"){X=Math.min(D,1e5);for(let s=0;s<X;s++){const a=S.uniform(0,2*Math.PI),n=S.uniform(-1,1),d=Math.sqrt(1-n*n),le=S.random(),Z=Math.pow(le,.6),ie=-Math.log(1-Z*.98)*g*.35,K=ie*d*Math.cos(a),G=ie*n*.6,l=ie*d*Math.sin(a);W.push(K,G,l),F.push(1,.9,.7);const i=C+s*1337,t=new Y(i),c=t.gauss(.6,.2),y=t.random()<.08,E=t.random()<.25;let z=Math.max(.2,c);y&&(z*=2+t.uniform(0,1)),E&&(z*=.6+t.uniform(0,.2)),Math.sqrt(K*K+G*G+l*l)<g*.3&&(z*=1.5+t.uniform(0,.5)),ee.push(Math.min(z*1.4,7))}}else if(r==="Dwarf"){X=Math.min(D/100,1e4);for(let s=0;s<X;s++){const a=S.uniform(0,2*Math.PI),n=S.uniform(0,Math.PI),d=S.gauss(g/3,g*.3),le=d*Math.sin(n)*Math.cos(a),Z=d*Math.cos(n)*.5,ie=d*Math.sin(n)*Math.sin(a);W.push(le,Z,ie),F.push(.8,.8,1);const K=C+s*1337,G=new Y(K),l=G.gauss(.7,.3),i=G.random()<.02,t=G.random()<.6;let c=Math.max(.3,l);i&&(c*=2.5+G.uniform(0,1)),t&&(c*=.5+G.uniform(0,.3)),ee.push(Math.min(c*1.2,5))}}else if(r==="Singularity Void"){X=1e4;for(let o=0;o<X;o++){const u=o/X,h=u*30*Math.PI,te=g*(1-u*.8)+S.uniform(-10,10),R=(u-.5)*300+Math.sin(h*.5)*20,pe=te*Math.cos(h)+Math.sin(u*20)*10,fe=te*Math.sin(h)+Math.cos(u*20)*10;W.push(pe,R,fe);const B=(u+Math.sin(h*.1))%1,ne=new Ge;ne.setHSL(B,1,.5+Math.sin(u*10)*.3),F.push(ne.r,ne.g,ne.b),ee.push(S.uniform(.3,2)*(1+Math.sin(u*50)*.5))}const s=(o,u,h=1)=>{const te=new je(o,64,64),R=`
          varying vec2 vUv;
          varying vec3 vPosition;
          varying vec3 vNormal;
          void main() {
            vUv = uv;
            vPosition = position;
            vNormal = normalize(normalMatrix * normal);
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,pe=`
          varying vec2 vUv;
          varying vec3 vPosition;
          varying vec3 vNormal;
          uniform float time;
          uniform float speed;
          
          void main() {
            float theta = atan(vPosition.z, vPosition.x);
            float phi = acos(vPosition.y / length(vPosition));
            vec2 p = vec2(theta / 3.14159, phi / 3.14159);
            
            float a = time * 40.0 * speed;
            float d, e, f, g = 1.0 / 40.0, h, i, r, q;
            
            e = 400.0 * (p.x * 0.5 + 0.5);
            f = 400.0 * (p.y * 0.5 + 0.5);
            i = 200.0 + sin(e * g + a / 150.0) * 20.0;
            d = 200.0 + cos(f * g / 2.0) * 18.0 + cos(e * g) * 7.0;
            r = sqrt(pow(abs(i - e), 2.0) + pow(abs(d - f), 2.0));
            q = f / r;
            e = (r * cos(q)) - a / 2.0;
            f = (r * sin(q)) - a / 2.0;
            d = sin(e * g) * 176.0 + sin(e * g) * 164.0 + r;
            h = ((f + d) + a / 2.0) * g;
            i = cos(h + r * p.x / 1.3) * (e + e + a) + cos(q * g * 6.0) * (r + h / 3.0);
            h = sin(f * g) * 144.0 - sin(e * g) * 212.0 * p.x;
            h = (h + (f - e) * q + sin(r - (a + h) / 7.0) * 10.0 + i / 4.0) * g;
            i += cos(h * 2.3 * sin(a / 350.0 - q)) * 184.0 * sin(q - (r * 4.3 + a / 12.0) * g) + tan(r * g + h) * 184.0 * cos(r * g + h);
            i = mod(i / 5.6, 256.0) / 64.0;
            if (i < 0.0) i += 4.0;
            if (i >= 2.0) i = 4.0 - i;
            d = r / 350.0;
            d += sin(d * d * 8.0) * 0.52;
            f = (sin(a * g) + 1.0) / 2.0;
            
            vec3 color = vec3(f * i / 1.6, i / 2.0 + d / 13.0, i) * d * p.x + 
                         vec3(i / 1.3 + d / 8.0, i / 2.0 + d / 18.0, i) * d * (1.0 - p.x);
            
            float depth = dot(vNormal, vec3(0.0, 0.0, 1.0));
            color *= 0.7 + depth * 0.3;
            
            color = mix(color, vec3(0.5, 0.0, 1.0), 0.3);
            
            float edgeFactor = pow(1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0))), 2.0);
            color += vec3(0.5, 0.0, 1.0) * edgeFactor * 0.5;
            
            gl_FragColor = vec4(color, ${u});
          }
        `,fe=new Ie({uniforms:{time:{value:0},speed:{value:h}},vertexShader:R,fragmentShader:pe,transparent:!0,blending:Re,side:Te,depthWrite:!1}),B=new H(te,fe);return B.isSingularityShader=!0,B.shaderSpeed=h,B},a=s(250,.3,1);x.add(a);const n=s(180,.4,-.7);x.add(n);const d=s(120,.5,1.5);x.add(d);const le=s(300,.2,.5);le.scale.set(-1,1,1),x.add(le);const Z=new je(350,32,32),ie=new Ie({uniforms:{time:{value:0}},vertexShader:`
          varying vec3 vPosition;
          varying vec3 vNormal;
          uniform float time;
          void main() {
            vPosition = position;
            vNormal = normalize(normalMatrix * normal);
            
            vec3 distortedPosition = position;
            float distortion = sin(time * 0.5 + length(position) * 0.01) * 5.0;
            distortedPosition += normal * distortion;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4(distortedPosition, 1.0);
          }
        `,fragmentShader:`
          varying vec3 vPosition;
          varying vec3 vNormal;
          uniform float time;
          
          void main() {
            float fresnel = pow(1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0))), 3.0);
            float wave = sin(time * 2.0 + length(vPosition) * 0.05) * 0.5 + 0.5;
            
            vec3 color = vec3(0.1, 0.0, 0.3) * fresnel * wave;
            float alpha = fresnel * 0.1 * wave;
            
            gl_FragColor = vec4(color, alpha);
          }
        `,transparent:!0,blending:Re,side:ht,depthWrite:!1}),K=new H(Z,ie);K.isSingularityShader=!0,K.shaderSpeed=.3,x.add(K);const G=new Ae,l=[],i=[];for(let o=0;o<1e3;o++){const u=S.uniform(-g,g),h=S.uniform(-g/2,g/2),te=S.uniform(-g,g),R=S.uniform(-50,50),pe=S.uniform(-30,30),fe=S.uniform(-50,50);l.push(u,h,te),l.push(u+R,h+pe,te+fe);const B=S.random(),ne=new Ge;ne.setHSL(B,1,.6),i.push(ne.r,ne.g,ne.b),i.push(ne.r*.5,ne.g*.5,ne.b*.5)}G.setAttribute("position",new Me(l,3)),G.setAttribute("color",new Me(i,3));const t=new He({vertexColors:!0,transparent:!0,opacity:.4,blending:Re}),c=new De(G,t);c.isGlitchLines=!0,x.add(c);const y=new Pe,E=new je(20,32,32),z=new ke({color:0,transparent:!0,opacity:.95}),p=new H(E,z);y.add(p);const f=new $e(25,80,64),ae=new Ie({uniforms:{time:{value:0},innerRadius:{value:25},outerRadius:{value:80}},vertexShader:`
          varying vec2 vUv;
          varying float vRadius;
          void main() {
            vUv = uv;
            vec4 worldPosition = modelMatrix * vec4(position, 1.0);
            vRadius = length(worldPosition.xy);
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
        `,fragmentShader:`
          uniform float time;
          uniform float innerRadius;
          uniform float outerRadius;
          varying vec2 vUv;
          varying float vRadius;
          
          void main() {
            float normalizedRadius = (vRadius - innerRadius) / (outerRadius - innerRadius);
            float angle = atan(vUv.y - 0.5, vUv.x - 0.5);
            
            // Swirling pattern
            float swirl = sin(angle * 5.0 - time * 2.0 + normalizedRadius * 10.0) * 0.5 + 0.5;
            float intensity = 1.0 - normalizedRadius;
            
            // Colors from hot (inner) to cold (outer)
            vec3 hotColor = vec3(1.0, 0.5, 0.0); // Orange
            vec3 coldColor = vec3(0.0, 0.3, 1.0); // Blue
            vec3 color = mix(coldColor, hotColor, intensity);
            
            // Add swirl variation
            color *= (0.7 + swirl * 0.3);
            
            // Fade out at edges
            float alpha = intensity * 0.8;
            
            gl_FragColor = vec4(color, alpha);
          }
        `,transparent:!0,blending:Re,side:Te}),he=new H(f,ae);he.rotation.x=Math.PI/2,he.isAccretionDisk=!0,y.add(he);for(let o=0;o<8;o++){const u=30+o*20,h=new pt(u,1+o*.5,8,64),te=new ke({color:new Ge().setHSL((.7+o*.05)%1,1,.5),transparent:!0,opacity:.3-o*.03,wireframe:!0}),R=new H(h,te);R.rotation.x=S.uniform(0,Math.PI),R.rotation.y=S.uniform(0,Math.PI),R.isDistortionRing=!0,R.rotationSpeed=S.uniform(.001,.005)*(o%2===0?1:-1),y.add(R)}x.add(y);const w=new Ue(5,100,8),m=new Le({color:16711935,transparent:!0,opacity:.6,emissive:16711935,emissiveIntensity:1,blending:Re}),I=new H(w,m);I.position.y=50,x.add(I);const ge=new H(w,m);ge.position.y=-50,ge.rotation.z=Math.PI,x.add(ge)}if(r!=="Singularity Void"){const s=[],a=new Y(C+999);for(let t=0;t<A;t++){const c=a.uniform(-50,50),y=a.uniform(-20,20),E=a.uniform(-50,50);s.push({x:c,y,z:E})}const n=[],d=[],le=[],Z=[],ie=[],K=.4,G=K*25;for(let t=0;t<W.length;t+=3){const c=W[t],y=W[t+1],E=W[t+2];let z=1/0,p=null;for(const f of s){const ae=Math.sqrt(Math.pow(c-f.x,2)+Math.pow(y-f.y,2)+Math.pow(E-f.z,2));ae<z&&(z=ae,p=f)}if(!(z<K))if(z<G&&p){const f=1-(z-K)/(G-K);p.x-c,p.y-y,p.z-E;const ae=Math.atan2(E-p.z,c-p.x),he=f*.8,w=8;for(let R=0;R<w-1;R++){const pe=R/(w-1),fe=(R+1)/(w-1),B=z*(1-pe*he*.7),ne=ae+pe*he*1.5,re=p.x+B*Math.cos(ne),de=y+(p.y-y)*pe*.3,be=p.z+B*Math.sin(ne),Ne=z*(1-fe*he*.7),ve=ae+fe*he*1.5,Ce=p.x+Ne*Math.cos(ve),Ee=y+(p.y-y)*fe*.3,ze=p.z+Ne*Math.sin(ve);Z.push(re,de,be),Z.push(Ce,Ee,ze)}const m=f*1.5,I=F[t],ge=F[t+1],o=F[t+2],u=Math.min(I+m,2),h=Math.max(ge*(1-m*.6),.1),te=Math.max(o*(1-m*.8),.1);for(let R=0;R<w-1;R++){const pe=R/(w-1),fe=(R+1)/(w-1),B=1-pe*f*.6,ne=1-fe*f*.6,re=m*(.5+pe*.5),de=m*(.5+fe*.5);ie.push(Math.min(u+re*.3,2)*B,Math.max(h*(1-re*.2),.1)*B,Math.max(te*(1-re*.4),.1)*B),ie.push(Math.min(u+de*.3,2)*ne,Math.max(h*(1-de*.2),.1)*ne,Math.max(te*(1-de*.4),.1)*ne)}n.push(c,y,E),d.push(u,h,te),le.push(Math.max(ee[t/3]*(1-f*.5),.3))}else n.push(c,y,E),d.push(F[t],F[t+1],F[t+2]),le.push(ee[t/3])}N.setAttribute("position",new Me(n,3)),N.setAttribute("color",new Me(d,3)),N.setAttribute("size",new Me(le,1));const l=new Ie({uniforms:{},vertexShader:`
          attribute float size;
          varying vec3 vColor;
          void main() {
            vColor = color;
            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
            gl_PointSize = size * (400.0 / -mvPosition.z);
            gl_Position = projectionMatrix * mvPosition;
          }
        `,fragmentShader:`
          varying vec3 vColor;
          void main() {
            vec2 center = gl_PointCoord - vec2(0.5);
            float distanceFromCenter = length(center);
            
            if (distanceFromCenter > 0.5) {
              discard;
            }
            
            float alpha = 1.0 - (distanceFromCenter / 0.5);
            alpha = pow(alpha, 2.0);
            
            gl_FragColor = vec4(vColor, alpha * 0.8);
          }
        `,transparent:!0,blending:Re,vertexColors:!0,depthWrite:!1}),i=new Ye(N,l);if(x.add(i),Z.length>0){const t=new Ae;t.setAttribute("position",new Me(Z,3)),t.setAttribute("color",new Me(ie,3));const c=new He({vertexColors:!0,transparent:!0,opacity:.8,linewidth:2,blending:Re}),y=new De(t,c);x.add(y)}}else{N.setAttribute("position",new Me(W,3)),N.setAttribute("color",new Me(F,3)),N.setAttribute("size",new Me(ee,1));const s=new ft({size:2,vertexColors:!0,transparent:!0,opacity:.8,blending:Re,sizeAttenuation:!0}),a=new Ye(N,s);x.add(a)}const xe=new Y(C+999);for(let s=0;s<A;s++){const a=new Pe,n=xe.uniform(-50,50),d=xe.uniform(-20,20),le=xe.uniform(-50,50),Z=new je(1.5,16,16),ie=new ke({color:0,transparent:!0,opacity:.9}),K=new H(Z,ie);a.add(K),[{innerRadius:2,outerRadius:2.3,color:16777215,opacity:.8,emissive:16777164},{innerRadius:2.3,outerRadius:2.7,color:16755200,opacity:.7,emissive:16746496},{innerRadius:2.7,outerRadius:3.2,color:16729088,opacity:.6,emissive:16720384},{innerRadius:3.2,outerRadius:4,color:11141120,opacity:.5,emissive:6684672},{innerRadius:4,outerRadius:5,color:4456448,opacity:.3,emissive:2228224}].forEach((l,i)=>{const t=new $e(l.innerRadius,l.outerRadius,32),c=new Le({color:l.color,transparent:!0,opacity:l.opacity,emissive:l.emissive,emissiveIntensity:.3,side:Te}),y=new H(t,c);y.rotation.x=Math.PI/2,y.rotation.z=S.uniform(0,Math.PI*2),y.isAccretionRing=!0,y.rotationSpeed=.002+i*5e-4,a.add(y)}),a.position.set(n,d,le),x.add(a)}for(let s=0;s<$;s++){const a=new je(1.5,8,8),n=new Le({color:16776960,emissive:16776960,emissiveIntensity:1}),d=new H(a,n);d.position.set(S.uniform(-g,g),S.uniform(-g/4,g/4),S.uniform(-g,g)),d.isPulsar=!0,d.pulseSpeed=S.uniform(1,3),x.add(d)}for(let s=0;s<k;s++){const a=new Pe,n=new je(2,16,16),d=new Le({color:16777215,emissive:16777215,emissiveIntensity:2}),le=new H(n,d);a.add(le);const Z=new Ue(1,20,8),ie=new Le({color:16711680,transparent:!0,opacity:.6,emissive:16711680,emissiveIntensity:.5}),K=new H(Z,ie);K.position.y=10,a.add(K);const G=new H(Z,ie);G.position.y=-10,G.rotation.z=Math.PI,a.add(G),a.position.set(S.uniform(-g,g),S.uniform(-g/4,g/4),S.uniform(-g,g)),x.add(a)}const O=new Ze(4210752,.5);me.add(O);const v=new xt(16777215,.5,1e3);v.position.set(0,100,0),me.add(v);const P=s=>{s.key==="Escape"&&document.dispatchEvent(new CustomEvent("galaxy-close-fullscreen"))};document.addEventListener("keydown",P);const oe=()=>{U.current=requestAnimationFrame(oe);const s=performance.now()/1e3;V.current&&(V.current.rotation.y+=.001),x.children.forEach(a=>{if(a.isPulsar){const n=a.pulseSpeed||1;a.scale.setScalar(1+Math.sin(Date.now()*.001*n)*.3)}if(a.isSingularityShader&&a instanceof H){const n=a.material;n.uniforms&&n.uniforms.time&&(n.uniforms.time.value=s);const d=a.shaderSpeed||1;a.rotation.y+=.001*d,a.rotation.x+=5e-4*d}if(a.isAccretionDisk&&a instanceof H){const n=a.material;n.uniforms&&n.uniforms.time&&(n.uniforms.time.value=s),a.rotation.z+=.002}if(a.isDistortionRing){const n=a.rotationSpeed||.001;a.rotation.x+=n,a.rotation.y+=n*.7,a.scale.setScalar(1+Math.sin(s*2)*.1)}if(a.isGlitchLines&&a instanceof De){const n=a.material;n.opacity=.2+Math.sin(s*3)*.2,a.rotation.z+=5e-4}a instanceof Pe&&a.children.forEach(n=>{if(n.isAccretionDisk&&n instanceof H){const d=n.material;d.uniforms&&d.uniforms.time&&(d.uniforms.time.value=s),n.rotation.z+=.002}if(n.isAccretionRing&&n instanceof H){const d=n.rotationSpeed||.002;n.rotation.z+=d}if(n.isDistortionRing){const d=n.rotationSpeed||.001;n.rotation.x+=d,n.rotation.y+=d*.7,n.scale.setScalar(1+Math.sin(s*2)*.1)}})}),q.current&&q.current.update(),se.render(me,M)};oe();const ue=()=>{if(!L.current||!se)return;const s=L.current,a=s.clientWidth,n=s.clientHeight;se.setSize(a,n),M.aspect=a/n,M.updateProjectionMatrix()};return window.addEventListener("resize",ue),()=>{window.removeEventListener("resize",ue),document.removeEventListener("keydown",P),q.current&&q.current.dispose(),U.current&&cancelAnimationFrame(U.current),J&&se.domElement&&J.removeChild(se.domElement),se.dispose()}},[r,D,A,$,k,C]),e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{ref:L,className:"w-full h-full"}),T&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:T})})]})},Tt=({galaxyUrl:r,galaxyType:D="Spiral",numSystems:A=1e4,blackHoles:$=5,pulsars:k=10,quasars:C=3,galaxyName:T})=>{const[L,we]=b.useState("Aligning Stargate..."),[ce,U]=b.useState(!1),[q,V]=b.useState(!1),[Y,J]=b.useState(!1),[Q,_]=b.useState(!1);b.useEffect(()=>{if(sessionStorage.getItem("stargateAnimationShown")){we("Stargate system aligned");return}sessionStorage.setItem("stargateAnimationShown","true"),U(!0);const se=(N,W)=>Array.from({length:W},()=>N[Math.floor(Math.random()*N.length)]).join(""),ye=[{chars:"01",duration:40,iterations:20},{chars:"0123456789",duration:25,iterations:35},{chars:"0123456789ABCDEF",duration:20,iterations:50},{chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}|;:'\",.<>?/`~",duration:15,iterations:100}];let x=0,S=0;const j=()=>{if(x>=ye.length){const W="Stargate system aligned";let F=0;we("");const ee=()=>{F<W.length?(we(W.substring(0,F+1)),F++,setTimeout(ee,30)):U(!1)};ee();return}const N=ye[x];we(se(N.chars,32)),S++,S>=N.iterations&&(x++,S=0),setTimeout(j,N.duration)};j()},[]),b.useEffect(()=>{const M=document.createElement("style");return M.textContent=`
      [data-rmiz-modal-overlay="visible"] {
        background-color: rgba(0, 0, 0, 0.8) !important;
        backdrop-filter: blur(20px) !important;
        -webkit-backdrop-filter: blur(20px) !important;
        transition: backdrop-filter 0.3s ease-in-out !important;
      }
      
      [data-rmiz-modal-img] {
        border-radius: 1rem !important;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8) !important;
      }
      
      [data-rmiz-modal-overlay="hidden"] {
        backdrop-filter: blur(0px) !important;
        -webkit-backdrop-filter: blur(0px) !important;
        transition: backdrop-filter 0.3s ease-in-out !important;
      }
    `,document.head.appendChild(M),()=>{document.head.removeChild(M)}},[]);const me=()=>{J(!0),setTimeout(()=>{V(!1),J(!1)},300)};return b.useEffect(()=>(document.addEventListener("galaxy-close-fullscreen",me),()=>{document.removeEventListener("galaxy-close-fullscreen",me)}),[]),b.useEffect(()=>{if(Q){const M=setTimeout(()=>_(!1),50);return()=>clearTimeout(M)}},[Q]),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Galaxy Visualization"})}),e.jsx("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black/50 flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:e.jsx(Ft,{galaxyType:D,numSystems:A,blackHoles:$,pulsars:k,quasars:C,galaxyName:T,onExpandClick:()=>{V(!0),_(!0)}})}),e.jsxs("div",{className:"text-center mt-auto",children:[e.jsxs("a",{href:r,className:`inline-block px-4 py-2 bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 text-gray-200 font-medium text-sm rounded-lg border border-slate-600 hover:border-slate-500 shadow-md hover:shadow-lg transition-all duration-300 relative overflow-hidden group ${ce?"animate-pulse":""}`,style:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("span",{className:"relative z-10 font-mono flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6s.792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95a1 1 0 001.715 1.029zM8.5 10a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM10 14c-.304 0-.792-.193-1.264-.979a1 1 0 00-1.715 1.029C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 00-1.715-1.029C10.792 13.807 10.304 14 10 14z",clipRule:"evenodd"})}),L]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-slate-600/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]}),q&&ot.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${Y||Q?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${Y||Q?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:"Galaxy View"})}),e.jsx("div",{className:"hidden sm:block",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Galaxy Visualization"}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Type: ",D," • Systems: ",A.toLocaleString()]})]})}),e.jsx("button",{onClick:me,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Bt,{galaxyType:D,numSystems:A,blackHoles:$,pulsars:k,quasars:C,galaxyName:T})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},Ht=({systems:r,coordinates:D})=>{const[A,$]=b.useState(new Map);return b.useEffect(()=>{(()=>{try{const C=new Map;r.forEach(T=>{const L=St(D,T.index,T.num_planets||1);C.set(T.index,L)}),$(C)}catch{}})()},[D,r]),e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3",children:r.map(k=>e.jsxs("div",{className:"relative bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 hover:border-white/40 transition-all duration-300 group",children:[(()=>{const C=A.get(k.index)||"none";return C==="complete"?e.jsx("div",{className:"absolute top-1 right-1 bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] px-1.5 py-0.5 rounded z-10",children:"VISITED"}):C==="partial"?e.jsx("div",{className:"absolute top-1 right-1 bg-yellow-500/20 border border-yellow-500/50 text-yellow-400 text-[10px] px-1.5 py-0.5 rounded z-10",children:"PARTIAL"}):null})(),e.jsxs("button",{onClick:()=>window.location.href=`/system/${k.index}`,className:"w-full text-left block p-2 sm:p-3 text-gray-200 hover:text-white transition-colors duration-300 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-xs text-gray-400 mb-1",children:["#",k.number]}),e.jsx("div",{className:"text-sm font-semibold text-white truncate group-hover:text-blue-300 transition-colors duration-300",children:k.name})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]},k.index))}),r.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No systems found"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This galaxy appears to be empty"})]})]})},qt=({currentGalaxy:r})=>{const[D,A]=b.useState(!1),[$,k]=b.useState(!1),[C,T]=b.useState(!0),L=1e7;b.useEffect(()=>{const[V,Y,J]=r.coordinates,Q=!(V===0&&Y===0&&J===0),_=!(V===L&&Y===L&&J===L);A(Q),k(_),T(!1)},[r.coordinates]);const we=()=>{const[V,Y,J]=r.coordinates;return J>0?[V,Y,J-1]:Y>0?[V,Y-1,L]:V>0?[V-1,L,L]:[0,0,0]},ce=()=>{const[V,Y,J]=r.coordinates;return J<L?[V,Y,J+1]:Y<L?[V,Y+1,0]:V<L?[V+1,0,0]:[L,L,L]},U=()=>{if(D){if(!Fe.canAffordTravel("galaxy",1)){Fe.executeTravel("galaxy",1);return}if(!Fe.executeTravel("galaxy",1))return;const[Y,J,Q]=we(),_=document.createElement("form");_.method="POST",_.action="/navigate";const me=document.createElement("input");me.type="hidden",me.name="x",me.value=Y.toString();const M=document.createElement("input");M.type="hidden",M.name="y",M.value=J.toString();const se=document.createElement("input");se.type="hidden",se.name="z",se.value=Q.toString(),_.appendChild(me),_.appendChild(M),_.appendChild(se),document.body.appendChild(_),_.submit()}},q=()=>{if($){if(!Fe.canAffordTravel("galaxy",1)){Fe.executeTravel("galaxy",1);return}if(!Fe.executeTravel("galaxy",1))return;const[Y,J,Q]=ce(),_=document.createElement("form");_.method="POST",_.action="/navigate";const me=document.createElement("input");me.type="hidden",me.name="x",me.value=Y.toString();const M=document.createElement("input");M.type="hidden",M.name="y",M.value=J.toString();const se=document.createElement("input");se.type="hidden",se.name="z",se.value=Q.toString(),_.appendChild(me),_.appendChild(M),_.appendChild(se),document.body.appendChild(_),_.submit()}};return C?null:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:U,disabled:!D,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${D?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:q,disabled:!$,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${$?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})},Vt=({page:r,prevPage:D,nextPage:A,finish:$})=>{const k="px-4 py-2 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105",C="bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-lg",T="bg-white/10 text-gray-300 hover:bg-white/20 hover:text-white border border-white/20";return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6 mb-8",children:[e.jsxs("div",{className:"flex justify-center items-center gap-2 sm:gap-4 flex-wrap",children:[r!==1&&e.jsxs("button",{onClick:()=>window.location.href="/galaxy/1",className:`${k} ${T}`,title:"First page",children:[e.jsx("span",{className:"hidden sm:inline",children:"First"}),e.jsx("span",{className:"sm:hidden",children:"«"})]}),D&&e.jsxs("button",{onClick:()=>window.location.href=`/galaxy/${D}`,className:`${k} ${T}`,title:"Previous page",children:[e.jsx("span",{className:"hidden sm:inline",children:"Previous"}),e.jsx("span",{className:"sm:hidden",children:"‹"})]}),(()=>{const L=[],ce=Math.max(1,r-2),U=Math.min($,r+2);ce>1&&(L.push(e.jsx("button",{onClick:()=>window.location.href="/galaxy/1",className:`${k} ${T}`,children:"1"},1)),ce>2&&L.push(e.jsx("span",{className:"px-2 text-gray-400",children:"..."},"start-ellipsis")));for(let q=ce;q<=U;q++)q===r?L.push(e.jsx("span",{className:`${k} ${C} cursor-default`,children:q},q)):L.push(e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${q}`,className:`${k} ${T} cursor-pointer`,children:q},q));return U<$&&(U<$-1&&L.push(e.jsx("span",{className:"px-2 text-gray-400",children:"..."},"end-ellipsis")),L.push(e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${$}`,className:`${k} ${T}`,children:$},$))),L})(),A&&e.jsxs("button",{onClick:()=>window.location.href=`/galaxy/${A}`,className:`${k} ${T}`,title:"Next page",children:[e.jsx("span",{className:"hidden sm:inline",children:"Next"}),e.jsx("span",{className:"sm:hidden",children:"›"})]}),r!==$&&e.jsxs("button",{onClick:()=>window.location.href=`/galaxy/${$}`,className:`${k} ${T}`,title:"Last page",children:[e.jsx("span",{className:"hidden sm:inline",children:"Last"}),e.jsx("span",{className:"sm:hidden",children:"»"})]})]}),e.jsxs("div",{className:"text-center mt-4 text-sm text-gray-400",children:["Page ",r," of ",$]})]})},st=({galaxy:r,systems:D,galaxy_url:A,version:$,page:k,prev_page:C,next_page:T,finish:L,image_url:we})=>{const[ce]=b.useState(r.coordinates.join(","));b.useEffect(()=>{document.body.setAttribute("data-coordinates",ce),Nt(ce)},[ce]);const U=q=>q.replace(/_/g," ");return e.jsxs("div",{className:"w-full h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white overflow-auto",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(zt,{}),e.jsxs("div",{className:"relative z-10 pt-1",children:[e.jsx(Rt,{}),e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["Galaxy '",U(r.name),"'"]}),e.jsxs("p",{className:"text-lg sm:text-xl text-gray-300",children:["at Coordinates ",r.coordinates.join(", ")]})]}),e.jsx(qt,{currentGalaxy:r}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[e.jsx("div",{className:"order-1 lg:order-1",children:e.jsx(Tt,{galaxyUrl:A,galaxyType:r.galaxy_type,numSystems:r.num_systems,blackHoles:r.black_holes,pulsars:r.pulsars,quasars:r.quasars,galaxyName:U(r.name)})}),e.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),e.jsx("div",{className:"order-2 lg:order-2",children:e.jsx(_t,{galaxy:r})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:["Systems in '",U(r.name),"'"]}),e.jsx(Ht,{systems:D,coordinates:ce})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:e.jsx("button",{onClick:()=>window.location.href="/",className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:e.jsx("span",{className:"text-base sm:text-lg",children:"← Go Back to Planetary Index"})})}),e.jsx(Vt,{page:k,prevPage:C,nextPage:T,finish:L})]}),e.jsx(It,{version:$})]}),e.jsx(Gt,{}),e.jsx(Ct,{currentLocation:{type:"galaxy",name:r.name,coordinates:r.coordinates.join(",")}})]})};document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("atlas-react-root");if(!r)return;const D=A=>{const $=document.getElementById(A);if(!$||!$.textContent)return null;try{return JSON.parse($.textContent.trim())}catch{return null}};try{const A=D("data-galaxy")||{},$=D("data-systems")||[],k=D("data-navigation")||{},C=D("data-common")||{},T={galaxy:{name:A.name||"Unknown Galaxy",coordinates:A.coordinates||[0,0,0],galaxy_type:A.galaxy_type||"Unknown",num_systems:A.num_systems||0,black_holes:A.black_holes||0,pulsars:A.pulsars||0,quasars:A.quasars||0},systems:$,galaxy_url:k.galaxy_url||"#",version:C.version||"1.0.0",page:k.page||1,prev_page:k.prev_page,next_page:k.next_page,finish:k.finish||1,image_url:C.image_url||""};et.createRoot(r).render(tt.createElement(st,T))}catch{const $={galaxy:{name:"Unknown Galaxy",coordinates:[0,0,0],galaxy_type:"Unknown",num_systems:0,black_holes:0,pulsars:0,quasars:0},systems:[],galaxy_url:"#",version:"1.0.0",page:1,finish:1,image_url:""};et.createRoot(r).render(tt.createElement(st,$))}});
