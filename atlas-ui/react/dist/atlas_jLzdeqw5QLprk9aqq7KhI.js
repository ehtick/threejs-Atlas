import{r as s,j as e,a as qe,c as st,R as nt}from"./atlas_DztNjO7RDBVhWZ-y1bcy1.js";import{R as Ke,F as rt,H as at}from"./atlas_CFvrqjCIkUZMq6ldifKJt.js";import{W as _e}from"./atlas_CNNsKKRnDph5he9UgPFsB.js";import{a4 as Ge,C as Oe,a5 as $e,G as Ve,b as he,z as pe,M as xe,V as Me,B as We,a2 as Ye,o as Be,aa as He,y as Ue,v as Ze,cL as Je,cM as Qe,I as ze}from"./atlas_DhOIq2w9B2IVYJei_u5Oy.js";import{R as ot,S as it,M as lt,a as Pe,D as ct,b as dt,c as mt,T as ut,d as ht}from"./atlas_Cig6op6A5Gk5rVbgCKKGK.js";import{L as pt,b as xt,c as ft,S as ke,d as Ie,a as gt}from"./atlas_DkCoMU2kwFZw9Fo3-XNuQ.js";import{S as Xe,a as bt,b as wt,E as vt}from"./atlas_Df-mY_9OcikJb_9_39Edu.js";import{O as yt}from"./atlas_BoK0l091h33yJvR0wUQBE.js";import{V as Ft}from"./atlas_DkhYSJBHjNj1C82pPhqOg.js";import"./atlas_NcbMusH95geV1bEYmniMW.js";import"./atlas_BJn1KVDhumYaTlGXGL7XT.js";import"./atlas_DxIUfhfJiL6S17-iYXL6q.js";import"./atlas_BFvFdKvKQnUzz3Gg5PSxE.js";import"./atlas_d393i3P_gU7cf_t9ksUIa.js";import"./atlas_B7xFfkoB-pyudjIGWqHni.js";import"./atlas_DJV1k8lRAROjSpMZlkqZh.js";import"./atlas_6JpIs0-3nN0nPLeQzSXxY.js";import"./atlas_BzVSbJ0zEOCA5o-RDZVw2.js";import"./atlas_ezemXvq4borWtXyCuqr-L.js";import"./atlas_B_BLM6UgDDBEnL87EVpCI.js";import"./atlas_DAVwTTtXibv4_bf9Dqo8m.js";import"./atlas_DD1exT2qcnrdbi5dKUlZS.js";import"./atlas_Ci3cuY-0B-YxySl2wMlbs.js";import"./atlas_CFVx_YRxJ8NC8rOxNIXhB.js";import"./atlas_Eyhp3fqMVqjjyR4x3stbi.js";import"./atlas_DDfeMaHAdncMTmgmY8kCL.js";import"./atlas_CQFtV8zpZKX5zUN4X_Ue2.js";import"./atlas_D5VmrBd4Fj__D_3eMJ6wx.js";import"./atlas_CKOL3vcdiA4O_yoRDQaDg.js";import"./atlas_BkZ51YJmfRxVR3MkLU9fM.js";import"./atlas_CWJj-HUQTNsWkCgCF1aRd.js";import"./atlas_BB8-hNLj8dKGIQM2IGW84.js";import"./atlas_BtX3tPx98jjGnT_QRO983.js";import"./atlas_C2WW3kH2tZ05qa1m0BqqF.js";import"./atlas_CyHUUu_lHArpnjQKPFCZS.js";import"./atlas_DONHe0NdXYzMEVCuN2oUX.js";import"./atlas_BWTDcwTJ6p6bfpoDgmJ5B.js";import"./atlas_DRIT08Xxn5GJjdDENonxp.js";import"./atlas_CG1kNbT4idQ3IiuSKG7A7.js";import"./atlas_CMYBc6pa9td9pQl_IHNvj.js";import"./atlas_Bunc722YEQQFOOb6J5v9z.js";import"./atlas_B0U7mX_TJbqyBotc8_gK7.js";import"./atlas_D-YZDkmVgEPCfBQ8jZ5rn.js";import"./atlas_Drd3wAQo-LsiTSN-O0DKV.js";import"./atlas_DqxZNQePenXrq6gTXxX7n.js";import"./atlas_C_kGEm8Ez4Op83oCl1XHY.js";import"./atlas_Dh0pIVTheTDbh_TqdZ39_.js";import"./atlas_C61lyw4-BkNWSBMhe9lZx.js";import"./atlas_D75sLNZG94vFCx4HsBsK0.js";import"./atlas_nxnrdNXaIRNzOt1c5IPFk.js";import"./atlas_CLouSl7xbCQC8P44VCFmk.js";import"./atlas_DiwFX1fPx-F4ivtB_OTc2.js";import"./atlas_Du-oDUnGyg4EkLVRC_zXp.js";import"./atlas_B9tMYicJIqdCO05Ukcybi.js";import"./atlas_vK4wqH_yeWWuLNRZD7ZqB.js";import"./atlas_DpkirJkf9mdtQZ30AWl76.js";import"./atlas_B0zHL1RwzGEqa3sUOcOsz.js";import"./atlas_Ea6drPmm9yvH8_i2PpZP1.js";import"./atlas_D87oUt0iAN0VRTmXDmVK8.js";import"./atlas_BgAxMpjCFmWbXYUotNJlg.js";import"./atlas_BeCUP0wSKpvFbrJ36jwrm.js";import"./atlas_CxDLlY3nVnjC00Upl-hD9.js";import"./atlas_Cq9uA9J_EoZVLRmoDsgbD.js";import"./atlas_Exd4ElkfL-hifzFFrg6UL.js";import"./atlas_CZ7OzCNRtHnIp16N7TKtz.js";import"./atlas_D_BIM6gikjgOAV96xXsFL.js";const et=({planets:n,stars:d,systemName:g,cosmicOriginTime:M,currentTime:E,onTimeOffsetChange:T})=>{const k=s.useRef(null),v=s.useRef(null),l=s.useRef(null),L=s.useRef(null),D=s.useRef([]),P=s.useRef([]),A=s.useRef([]),m=s.useRef(0),V=(R,oe="#ffffff")=>{const z=document.createElement("canvas"),w=z.getContext("2d");if(!w)return null;z.width=768,z.height=192,w.fillStyle="rgba(0, 0, 0, 0.8)",w.fillRect(0,0,z.width,z.height),w.strokeStyle="#ffffff",w.lineWidth=3,w.strokeRect(3,3,z.width-6,z.height-6),w.fillStyle=oe,w.font="bold 48px Arial",w.textAlign="center",w.textBaseline="middle",w.fillText(R,384,96);const h=new Ze(z),W=new Je({map:h,transparent:!0,alphaTest:.1}),K=new Qe(W);return K.scale.set(30,7.5,1),K};return m.current=E,s.useEffect(()=>{if(!k.current)return;const R=k.current,oe=R.clientWidth,z=R.clientHeight,w=new Ge;w.background=new Oe(17),v.current=w;const h=new $e(60,oe/z,.1,1e4);h.position.set(0,120,180),h.lookAt(0,0,0);const W=new _e({antialias:!0,alpha:!0});W.setSize(oe,z),W.setClearColor(17,1),l.current=W,R.appendChild(W.domElement);const K={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},me={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},B=new Ve;d.forEach((t,p)=>{const c=parseFloat(t.Size)*4,o=new he(c,32,32),J=me[t.Color]||"#FFFF44",X=new pe({color:J,transparent:!0,opacity:.9}),u=new xe(o,X);d.length===1?u.position.set(0,0,0):d.length===2?u.position.set(p===0?-c*2:c*2,0,0):p===0?u.position.set(-c*2,0,0):p===1?u.position.set(c*2,0,0):u.position.set(0,c*2,0);const b=new he(c*1.5,32,32),$=new pe({color:J,transparent:!0,opacity:.3}),q=new xe(b,$);u.add(q),B.add(u)}),w.add(B);const be=Math.max(...n.map(t=>t.orbital_radius)),ie=150;n.forEach((t,p)=>{const o=30+t.orbital_radius/be*ie,J=t.eccentricity_factor,X=o,u=X*Math.sqrt(1-J*J),b=360,$=2,q=4;for(let Q=0;Q<b;Q+=$+q){const _=[];for(let Y=Q;Y<Math.min(Q+$,b-1);Y++){const G=Y/b*2*Math.PI,ee=X*Math.cos(G),ue=u*Math.sin(G);_.push(new Me(ee,0,ue))}if(_.length>1){const Y=new We().setFromPoints(_),G=new Ye({color:7372944,transparent:!0,opacity:.8,linewidth:2}),ee=new Be(Y,G);w.add(ee),P.current.push(ee)}}const se=t.diameter/8e3,f=Math.max(Math.min(se,8),2.5),de=new he(f,32,32),re=K[t.planet_type]||"#FFFFFF",a=new pe({color:re,transparent:!0,opacity:.9}),x=new xe(de,a),i=new xe(new he(f*1.5,32,32),new pe({color:re,transparent:!0,opacity:.2}));x.add(i),w.add(x),D.current.push(x),x.planetData=t,x.orbitRadius=o,x.semiMajorAxis=X,x.semiMinorAxis=u;const j=t.name.replace(/_/g," "),N=V(j,"#ffffff");N&&(N.position.copy(x.position),N.position.y+=f+10,N.planetData=t,w.add(N),A.current.push(N))});const S=new He(4210752,.4);w.add(S);const H=new Ue(16777215,1,2e3);H.position.set(0,0,0),w.add(H);let le=!1,ce=0,ae=0,we=0;const Ee=t=>{le=!0,ce=t.clientX,ae=t.clientY},ne=t=>{if(!le)return;const p=t.clientX-ce,c=t.clientY-ae,o=new ze;o.setFromVector3(h.position),o.theta-=p*.01,o.phi+=c*.01,o.phi=Math.max(.1,Math.min(Math.PI-.1,o.phi)),h.position.setFromSpherical(o),h.lookAt(0,0,0),ce=t.clientX,ae=t.clientY},y=()=>{le=!1,setTimeout(()=>{},3e3)},I=t=>{if(t.ctrlKey)t.preventDefault(),t.deltaY>0?T(604800):T(-604800);else{t.preventDefault();const p=.1,c=h.position.distanceTo(new Me(0,0,0));t.deltaY>0&&c<800?h.position.multiplyScalar(1+p):t.deltaY<0&&c>50&&h.position.multiplyScalar(1-p)}},C=t=>{t.key==="Escape"&&document.dispatchEvent(new CustomEvent("solar-system-close-fullscreen"))},F=t=>{if(t.preventDefault(),t.touches.length===1)le=!0,ce=t.touches[0].clientX,ae=t.touches[0].clientY;else if(t.touches.length===2){const p=t.touches[0].clientX-t.touches[1].clientX,c=t.touches[0].clientY-t.touches[1].clientY;we=Math.sqrt(p*p+c*c)}},te=t=>{if(t.preventDefault(),t.touches.length===1&&le){const p=t.touches[0].clientX-ce,c=t.touches[0].clientY-ae,o=new ze;o.setFromVector3(h.position),o.theta-=p*.01,o.phi+=c*.01,o.phi=Math.max(.1,Math.min(Math.PI-.1,o.phi)),h.position.setFromSpherical(o),h.lookAt(0,0,0),ce=t.touches[0].clientX,ae=t.touches[0].clientY}else if(t.touches.length===2){const p=t.touches[0].clientX-t.touches[1].clientX,c=t.touches[0].clientY-t.touches[1].clientY,o=Math.sqrt(p*p+c*c);if(we>0){const X=o/we,u=h.position.distanceTo(new Me(0,0,0));X>1&&u>50?h.position.multiplyScalar(1-.01):X<1&&u<800&&h.position.multiplyScalar(1+.01)}we=o}},Z=t=>{t.preventDefault(),le=!1,we=0,setTimeout(()=>{},3e3)},r=W.domElement;r.style.cursor="grab",r.addEventListener("mousedown",t=>{r.style.cursor="grabbing",Ee(t)}),r.addEventListener("mousemove",ne),r.addEventListener("mouseup",()=>{r.style.cursor="grab",y()}),r.addEventListener("mouseleave",()=>{r.style.cursor="grab",y()}),r.addEventListener("wheel",I),r.addEventListener("touchstart",F,{passive:!1}),r.addEventListener("touchmove",te,{passive:!1}),r.addEventListener("touchend",Z,{passive:!1}),document.addEventListener("keydown",C);const O=()=>{L.current=requestAnimationFrame(O),D.current.forEach((t,p)=>{const c=t.planetData,o=t.semiMajorAxis,J=t.semiMinorAxis,X=c.orbital_period_seconds,u=2*Math.PI/X,b=(c.initial_orbital_angle+m.current*u)%(2*Math.PI);t.position.x=o*Math.cos(b),t.position.z=J*Math.sin(b),t.position.y=0;const $=c.rotation_period_seconds,q=2*Math.PI/$;if(t.rotation.y=m.current*q%(2*Math.PI),A.current[p]){const se=t.geometry.parameters?.radius||2;A.current[p].position.copy(t.position),A.current[p].position.y+=se+10}}),W.render(w,h)};O();const U=()=>{const t=R.clientWidth,p=R.clientHeight;h.aspect=t/p,h.updateProjectionMatrix(),W.setSize(t,p)};return window.addEventListener("resize",U),()=>{window.removeEventListener("resize",U),document.removeEventListener("keydown",C),r.removeEventListener("mousedown",Ee),r.removeEventListener("mousemove",ne),r.removeEventListener("mouseup",y),r.removeEventListener("mouseleave",y),r.removeEventListener("wheel",I),r.removeEventListener("touchstart",F),r.removeEventListener("touchmove",te),r.removeEventListener("touchend",Z),L.current&&cancelAnimationFrame(L.current),R&&W.domElement&&R.removeChild(W.domElement),W.dispose(),D.current=[],P.current=[],A.current=[]}},[n,d,M]),e.jsx("div",{ref:k,className:"w-full h-full"})},jt=({planets:n,stars:d,systemName:g,cosmicOriginTime:M})=>{const E=s.useRef(null),T=s.useRef(null),k=s.useRef(null),v=s.useRef(null),l=s.useRef([]),L=s.useRef([]),D=s.useRef([]),P=s.useRef(0),A=Math.floor(Date.now()/1e3),[m,V]=s.useState(0),[R,oe]=s.useState(!1),[z,w]=s.useState(!1),[h,W]=s.useState(!1),[K,me]=s.useState(0),[B,be]=s.useState(null),[ie,S]=s.useState(!0),[H,le]=s.useState(null),ce=A-M+m;P.current=ce,s.useEffect(()=>{(async()=>{try{S(!0),le(null);const I=await fetch("/api/system/rendering-data");if(!I.ok)throw new Error(`HTTP error! status: ${I.status}`);const C=await I.json();if(C.success)be(C.system_data);else throw new Error(C.error||"Failed to fetch system data")}catch(I){le(I instanceof Error?I.message:"Unknown error")}finally{S(!1)}})()},[]);const ae=()=>{w(!0),setTimeout(()=>{oe(!1),w(!1)},300)},we=(y,I="#ffffff")=>{const C=document.createElement("canvas"),F=C.getContext("2d");if(!F)return null;C.width=512,C.height=128,F.fillStyle="rgba(0, 0, 0, 0.7)",F.fillRect(0,0,C.width,C.height),F.strokeStyle="#ffffff",F.lineWidth=2,F.strokeRect(2,2,C.width-4,C.height-4),F.fillStyle=I,F.font="bold 32px Arial",F.textAlign="center",F.textBaseline="middle",F.fillText(y,256,64);const te=new Ze(C),Z=new Je({map:te,transparent:!0,alphaTest:.1}),r=new Qe(Z);return r.scale.set(20,5,1),r};s.useEffect(()=>{const y=I=>{I.key==="Escape"&&R&&ae()};return R&&me(m),document.addEventListener("solar-system-close-fullscreen",ae),document.addEventListener("keydown",y),()=>{document.removeEventListener("solar-system-close-fullscreen",ae),document.removeEventListener("keydown",y)}},[R,m]),s.useEffect(()=>{if(R&&h){const y=setTimeout(()=>{W(!1)},50);return()=>clearTimeout(y)}},[R,h]),s.useEffect(()=>{if(ie||!B||(window.tonnirLoggedInSystem=!1,!E.current))return;const y=E.current,I=y.clientWidth,C=I<640,F=new Ge;F.background=new Oe(17),T.current=F;const te=new $e(45,I/(C?120:140),.1,1e4);te.position.set(0,80,120),te.lookAt(0,0,0);const Z=new _e({antialias:!0,alpha:!0});Z.setSize(I,C?120:140),Z.setClearColor(17,1),k.current=Z,y.appendChild(Z.domElement);const r={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},O={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},U=new Ve;B.stars.forEach((a,x)=>{const i=parseFloat(a.Size)*3,j=new he(i,16,16),N=O[a.Color]||"#FFFF44",Q=new pe({color:N,transparent:!0,opacity:.9}),_=new xe(j,Q);B.stars.length===1?_.position.set(0,0,0):B.stars.length===2?_.position.set(x===0?-i*2:i*2,0,0):x===0?_.position.set(-i*2,0,0):x===1?_.position.set(i*2,0,0):_.position.set(0,i*2,0);const Y=new he(i*1.5,16,16),G=new pe({color:N,transparent:!0,opacity:.3}),ee=new xe(Y,G);_.add(ee),U.add(_)}),F.add(U);const t=B.timing.max_orbital_radius,p=80;window.systemMaxOrbitalRadius=t,B.planets.forEach((a,x)=>{const j=20+a.orbital_radius/t*p,N=a.eccentricity_factor,Q=j,_=Q*Math.sqrt(1-N*N),Y=360,G=2,ee=4;for(let Fe=0;Fe<Y;Fe+=G+ee){const Ce=[];for(let ge=Fe;ge<Math.min(Fe+G,Y-1);ge++){const je=ge/Y*2*Math.PI,Ne=Q*Math.cos(je),Te=_*Math.sin(je);Ce.push(new Me(Ne,0,Te))}if(Ce.length>1){const ge=new We().setFromPoints(Ce),je=new Ye({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Ne=new Be(ge,je);F.add(Ne),L.current.push(Ne)}}const ue=a.diameter/15e3,ve=Math.max(Math.min(ue,4),1.5),Le=new he(ve,16,16),Re=r[a.planet_type]||"#FFFFFF",De=new pe({color:Re,transparent:!0,opacity:.9}),fe=new xe(Le,De),Ae=new xe(new he(ve*1.5,16,16),new pe({color:Re,transparent:!0,opacity:.2}));fe.add(Ae),F.add(fe),l.current.push(fe),fe.planetData=a,fe.orbitRadius=j,fe.semiMajorAxis=Q,fe.semiMinorAxis=_;const ye=a.name.replace(/_/g," "),Se=we(ye,"#ffffff");Se&&(Se.position.copy(fe.position),Se.position.y+=ve+6,Se.planetData=a,F.add(Se),D.current.push(Se))});const c=new He(4210752,.4);F.add(c);const o=new Ue(16777215,1,1e3);o.position.set(0,0,0),F.add(o);let J=!1,X=0,u=0;const b=a=>{J=!0,X=a.clientX,u=a.clientY},$=a=>{if(!J)return;const x=a.clientX-X,i=a.clientY-u,j=new ze;j.setFromVector3(te.position),j.theta-=x*.01,j.phi+=i*.01,j.phi=Math.max(.1,Math.min(Math.PI-.1,j.phi)),te.position.setFromSpherical(j),te.lookAt(0,0,0),X=a.clientX,u=a.clientY},q=()=>{J=!1,setTimeout(()=>{},3e3)},se=a=>{if(a.ctrlKey)a.preventDefault(),a.deltaY>0?V(x=>x+604800):V(x=>x-604800);else{a.preventDefault();const x=.1,i=te.position.distanceTo(new Me(0,0,0));a.deltaY>0&&i<500?te.position.multiplyScalar(1+x):a.deltaY<0&&i>20&&te.position.multiplyScalar(1-x)}},f=Z.domElement;f.style.cursor="grab",f.style.borderRadius="8px",f.addEventListener("mousedown",a=>{f.style.cursor="grabbing",b(a)}),f.addEventListener("mousemove",$),f.addEventListener("mouseup",()=>{f.style.cursor="grab",q()}),f.addEventListener("mouseleave",()=>{f.style.cursor="grab",q()}),f.addEventListener("wheel",se);const de=()=>{v.current=requestAnimationFrame(de),l.current.forEach((a,x)=>{const i=a.planetData,j=a.semiMajorAxis,N=a.semiMinorAxis,Q=i.orbital_period_seconds,_=2*Math.PI/Q,Y=(i.initial_orbital_angle+P.current*_)%(2*Math.PI);a.position.x=j*Math.cos(Y),a.position.z=N*Math.sin(Y),a.position.y=0;const G=i.rotation_period_seconds,ee=2*Math.PI/G;if(a.rotation.y=P.current*ee%(2*Math.PI),D.current[x]){const ue=a.geometry.parameters?.radius||2;D.current[x].position.copy(a.position),D.current[x].position.y+=ue+6}}),Z.render(F,te)};de();const re=()=>{const a=y.clientWidth,x=a<640?120:140;te.aspect=a/x,te.updateProjectionMatrix(),Z.setSize(a,x)};return window.addEventListener("resize",re),()=>{window.removeEventListener("resize",re),f.removeEventListener("mousedown",b),f.removeEventListener("mousemove",$),f.removeEventListener("mouseup",q),f.removeEventListener("mouseleave",q),f.removeEventListener("wheel",se),v.current&&cancelAnimationFrame(v.current),y&&Z.domElement&&y.removeChild(Z.domElement),Z.dispose(),l.current=[],L.current=[],D.current=[]}},[n,d,M,B]);const Ee=y=>{const I=Math.floor(y/31557600),C=Math.floor(y%(365.25*24*3600)/(24*3600)),F=Math.floor(y%(24*3600)/3600);return I>0?`${I}y ${C}d ${F}h`:C>0?`${C}d ${F}h`:`${F}h`},ne=y=>y.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Solar System Perspective"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{ref:E,className:"w-full border border-white/20 rounded bg-black/20",style:{height:"auto"}}),!ie&&!H&&g&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:g})}),e.jsx("button",{onClick:()=>{oe(!0),W(!0)},className:"absolute top-2 right-2 p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg z-10",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-[10px]",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-[10px]",children:[B?.planets?.length||n.length," Planets"]})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Time: ",Ee(ce)]})]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View"})]})]}),R&&qe.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${z||h?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${z||h?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:ne(g)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:ne(g)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[B?.planets?.length||n.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",Ee(A-M+K)]})]})]}),e.jsx("button",{onClick:ae,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:K,onChange:y=>me(Number(y.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>me(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",K===0?"Present":K>0?`+${Math.abs(K/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(K/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(et,{planets:B?.planets||n,stars:B?.stars||d,systemName:g,cosmicOriginTime:M,currentTime:A-M+K,onTimeOffsetChange:y=>me(I=>I+y)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},Nt=({system:n,galaxy:d,systemIndex:g,cosmicOriginTime:M})=>{const[E,T]=s.useState({isOnCooldown:!1,isSaved:!1,isCollecting:!1,timeUntilNext:0});s.useEffect(()=>{let v;const l=()=>{const A=Pe.generateLocationId("system",d.coordinates.join(","),g,void 0),m=Pe.canCollectFromLocation(A),V=Pe.getTimeUntilNextCollection(A),R=d.coordinates,oe=Xe.generateSystemUrl(R,g,Xe.getCurrentPage()),w=pt.getLocations().some(h=>h.stargateUrl===oe);T(h=>({isOnCooldown:!m&&V>0,isSaved:w,isCollecting:h.isCollecting,timeUntilNext:V}))},L=()=>{T(A=>({...A,isCollecting:!0})),v=setTimeout(()=>{T(A=>({...A,isCollecting:!1}))},1e3)};l();const D=setInterval(l,1e3),P=Ke.subscribe("mining_completed",L);return()=>{clearInterval(D),v&&clearTimeout(v),P()}},[n.name,g,d.coordinates]);const k=v=>v.replace(/_/g," ");return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[e.jsx(ot,{locationType:"system",locationId:n.name,coordinates:d.coordinates.join(","),systemIndex:g,className:"text-xs"}),e.jsx(it,{type:"system",name:n.name,coordinates:d.coordinates.join(","),systemIndex:g,className:"text-xs"}),e.jsx("div",{className:"inline-flex items-center bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] font-medium px-1.5 py-0.5 rounded h-[21px] box-border",children:"VISITED"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(lt,{isOnCooldown:E.isOnCooldown,isSaved:E.isSaved,isCollecting:E.isCollecting}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Details"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"System Type"}),e.jsx("div",{className:"text-sm font-bold text-blue-300 capitalize",children:n.star_system_type})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Planets"}),e.jsx("div",{className:"text-sm font-bold text-purple-300",children:n.num_planets})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-orange-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Stars"}),e.jsx("div",{className:"text-sm font-bold text-orange-300",children:n.stars.length})]})]}),e.jsx("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-3",children:e.jsx(jt,{planets:n.planets,stars:n.stars,systemName:n.name,cosmicOriginTime:M})}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-yellow-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Stellar Composition"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1",children:n.stars.map((v,l)=>e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-yellow-500/20",children:[e.jsxs("div",{className:"text-xs text-gray-300",children:["Star ",l+1]}),e.jsx("div",{className:"text-xs font-bold text-yellow-300",children:v.Type}),e.jsxs("div",{className:"text-xs text-gray-300",children:[v.Color," • ",v.Size]})]},l))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System:"}),e.jsx("div",{className:"text-white truncate font-medium",children:k(n.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System ID:"}),e.jsxs("div",{className:"text-white font-medium",children:["#",g+1]})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),e.jsx("div",{className:"text-white truncate font-medium",children:k(d.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),e.jsx("div",{className:"text-white font-medium",children:d.coordinates.join(", ")})]})]})]})]})},tt=s.forwardRef(({planets:n,stars:d,systemName:g,cosmicOriginTime:M,systemUrl:E},T)=>{const k=s.useRef(null),v=s.useRef(null),l=s.useRef(null),L=s.useRef(null),D=s.useRef([]),P=s.useRef([]),A=s.useRef([]),m=s.useRef(null),V=s.useRef(0),R=s.useRef(null),oe=Math.floor(Date.now()/1e3),[z,w]=s.useState(0),[h,W]=s.useState(!1),[K,me]=s.useState(!1),[B,be]=s.useState(!1),[ie,S]=s.useState(0),[H,le]=s.useState(null),[ce,ae]=s.useState(!0),[we,Ee]=s.useState(null),[ne,y]=s.useState(!1);s.useImperativeHandle(T,()=>({captureScreenshot:()=>F(),isGeneratingImage:ne}));const I=oe-M+z;V.current=I,s.useEffect(()=>{(async()=>{try{ae(!0),Ee(null);const O=await fetch("/api/system/rendering-data");if(!O.ok)throw new Error(`HTTP error! status: ${O.status}`);const U=await O.json();if(U.success)le(U.system_data);else throw new Error(U.error||"Failed to fetch system data")}catch(O){Ee(O instanceof Error?O.message:"Unknown error")}finally{ae(!1)}})()},[]);const C=()=>{me(!0),setTimeout(()=>{W(!1),me(!1)},300)};s.useEffect(()=>{const r=O=>{O.key==="Escape"&&h&&C()};return h&&S(z),document.addEventListener("solar-system-close-fullscreen",C),document.addEventListener("keydown",r),()=>{document.removeEventListener("solar-system-close-fullscreen",C),document.removeEventListener("keydown",r)}},[h,z]),s.useEffect(()=>{if(h&&B){const r=setTimeout(()=>{be(!1)},50);return()=>clearTimeout(r)}},[h,B]),s.useEffect(()=>{if(ce||!H||(window.tonnirLoggedInSystem=!1,!k.current))return;const r=k.current,O=r.clientWidth,U=r.clientHeight,t=Math.min(O,U),p=new Ge;p.background=new Oe(17),v.current=p;const c=new $e(45,1,.1,1e4);c.position.set(0,300,0),c.lookAt(0,0,0),R.current=c;const o=new _e({antialias:!0,alpha:!0});o.setSize(t,t),o.setClearColor(17,1),l.current=o,o.domElement.className="",r.appendChild(o.domElement);const J={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},X={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},u=new Ve;H.stars.forEach((i,j)=>{const N=parseFloat(i.Size)*3,Q=new he(N,16,16),_=X[i.Color]||"#FFFF44",Y=new pe({color:_,transparent:!0,opacity:.9}),G=new xe(Q,Y);H.stars.length===1?G.position.set(0,0,0):H.stars.length===2?G.position.set(j===0?-N*2:N*2,0,0):j===0?G.position.set(-N*2,0,0):j===1?G.position.set(N*2,0,0):G.position.set(0,N*2,0);const ee=new he(N*1.5,16,16),ue=new pe({color:_,transparent:!0,opacity:.3}),ve=new xe(ee,ue);G.add(ve),u.add(G)}),p.add(u);const b=H.timing.max_orbital_radius,$=80;window.systemMaxOrbitalRadius=b,H.planets.forEach((i,j)=>{const Q=20+i.orbital_radius/b*$,_=i.eccentricity_factor,Y=Q,G=Y*Math.sqrt(1-_*_),ee=360,ue=2,ve=4;for(let Fe=0;Fe<ee;Fe+=ue+ve){const Ce=[];for(let ge=Fe;ge<Math.min(Fe+ue,ee-1);ge++){const je=ge/ee*2*Math.PI,Ne=Y*Math.cos(je),Te=G*Math.sin(je);Ce.push(new Me(Ne,0,Te))}if(Ce.length>1){const ge=new We().setFromPoints(Ce),je=new Ye({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Ne=new Be(ge,je);p.add(Ne),P.current.push(Ne)}}const Le=i.diameter/15e3,Re=Math.max(Math.min(Le,4),1.5),De=new he(Re,16,16),fe=J[i.planet_type]||"#FFFFFF",Ae=new pe({color:fe,transparent:!0,opacity:.9}),ye=new xe(De,Ae),Se=new xe(new he(Re*1.5,16,16),new pe({color:fe,transparent:!0,opacity:.2}));ye.add(Se),p.add(ye),D.current.push(ye),ye.planetData=i,ye.orbitRadius=Q,ye.semiMajorAxis=Y,ye.semiMinorAxis=G,A.current.push(null)});const q=new He(4210752,.4);p.add(q);const se=new Ue(16777215,1,1e3);se.position.set(0,0,0),p.add(se);const f=new yt(c,o.domElement);f.enableDamping=!0,f.dampingFactor=.05,f.minDistance=50,f.maxDistance=800,f.autoRotate=!1,f.autoRotateSpeed=.5,f.enablePan=!0,f.enableZoom=!0,f.target.set(0,0,0),m.current=f;const de=i=>{if(i.ctrlKey)i.preventDefault(),i.deltaY>0?w(j=>j+604800):w(j=>j-604800);else{i.preventDefault();const j=.1,N=c.position.distanceTo(new Me(0,0,0));i.deltaY>0&&N<500?c.position.multiplyScalar(1+j):i.deltaY<0&&N>20&&c.position.multiplyScalar(1-j)}},re=o.domElement;re.style.borderRadius="8px",re.addEventListener("wheel",de);const a=()=>{L.current=requestAnimationFrame(a),D.current.forEach((i,j)=>{const N=i.planetData,Q=i.semiMajorAxis,_=i.semiMinorAxis,Y=N.orbital_period_seconds,G=2*Math.PI/Y,ee=(N.initial_orbital_angle+V.current*G)%(2*Math.PI);i.position.x=Q*Math.cos(ee),i.position.z=_*Math.sin(ee),i.position.y=0;const ue=N.rotation_period_seconds,ve=2*Math.PI/ue;i.rotation.y=V.current*ve%(2*Math.PI)}),m.current&&m.current.update(),o.render(p,c)};a();const x=()=>{if(!k.current||!o)return;const i=k.current,j=Math.min(i.clientWidth,i.clientHeight);o.setSize(j,j),c.aspect=1,c.updateProjectionMatrix()};return window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x),re.removeEventListener("wheel",de),m.current&&m.current.dispose(),L.current&&cancelAnimationFrame(L.current),r&&o.domElement&&r.removeChild(o.domElement),o.dispose(),D.current=[],P.current=[],A.current=[]}},[n,d,M,H,z]);const F=()=>{if(!l.current||!v.current||!R.current||ne)return;y(!0),m.current&&(m.current.enabled=!1);const r=l.current,O=v.current,U=R.current,t=r.domElement.width,p=r.domElement.height,c=3840/t,o=[];O.traverse(u=>{if(u.isPoints&&u.material){const b=u.material;if(b.size!==void 0&&(o.push({material:b,originalSize:b.size}),b.size=b.size*c*1),u.geometry&&u.geometry.attributes.size){const $=u.geometry.attributes.size,q=$.array.slice();o.push({geometry:u.geometry,originalSizeArray:q});for(let se=0;se<$.array.length;se++)$.array[se]*=c*1;$.needsUpdate=!0}}if(u.isSprite&&(o.push({object:u,originalScale:u.scale.clone()}),u.scale.multiplyScalar(c*1)),u.isLine&&u.material){const b=u.material;b.linewidth!==void 0&&(o.push({material:b,originalLinewidth:b.linewidth}),b.linewidth=b.linewidth*c*1)}});const J=3840,X=3840;r.setSize(J,X),U.aspect=1,U.updateProjectionMatrix(),r.render(O,U),r.domElement.toBlob(u=>{if(u){const b=document.createElement("canvas"),$=b.getContext("2d");if(b.width=J,b.height=X,$){const q=new Image;q.onload=async()=>{$.drawImage(q,0,0),bt($,{imageWidth:J,imageHeight:X}),E&&await wt($,J,X,{type:"system",stargateUrl:E}),b.toBlob(f=>{if(f){const de=URL.createObjectURL(f),re=document.createElement("a");re.href=de,re.download=`system_${g}_${Date.now()}.png`,re.click(),URL.revokeObjectURL(de)}},"image/png",1)};const se=URL.createObjectURL(u);q.src=se}}o.forEach(({material:b,object:$,originalSize:q,originalScale:se,originalLinewidth:f,geometry:de,originalSizeArray:re})=>{if(q!==void 0&&(b.size=q),se!==void 0&&$.scale.copy(se),f!==void 0&&(b.linewidth=f),de&&re){const a=de.attributes.size;for(let x=0;x<re.length;x++)a.array[x]=re[x];a.needsUpdate=!0}}),r.setSize(t,p),U.aspect=1,U.updateProjectionMatrix(),m.current&&(m.current.enabled=!0),y(!1)},"image/png",1)},te=r=>{const O=Math.floor(r/31557600),U=Math.floor(r%(365.25*24*3600)/(24*3600)),t=Math.floor(r%(24*3600)/3600);return O>0?`${O}y ${U}d ${t}h`:U>0?`${U}d ${t}h`:`${t}h`},Z=r=>r.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center w-full h-full",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{ref:k,className:"w-full h-full border border-white/20 rounded bg-black/20"}),e.jsx(vt,{isVisible:ne}),!ce&&!we&&g&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:Z(g)})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 z-10",children:[e.jsx("button",{onClick:F,disabled:ne,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${ne?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:ne?"Generating image...":"Download 4K screenshot",children:ne?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(ct,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>{ne||(W(!0),be(!0))},disabled:ne,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${ne?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:ne?"Please wait...":"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})]})}),h&&qe.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${K||B?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${K||B?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:Z(g)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:Z(g)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[H?.planets?.length||n.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",te(oe-M+ie)]})]})]}),e.jsx("button",{onClick:C,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:ie,onChange:r=>S(Number(r.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>S(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",ie===0?"Present":ie>0?`+${Math.abs(ie/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(ie/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(et,{planets:H?.planets||n,stars:H?.stars||d,systemName:g,cosmicOriginTime:M,currentTime:oe-M+ie,onTimeOffsetChange:r=>S(O=>O+r)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})});tt.displayName="SolarSystem3DViewerLeft";const Et=({systemUrl:n,system:d,cosmicOriginTime:g})=>{const M=s.useRef(null),[E,T]=s.useState(!1),[k,v]=s.useState(!1),[l,L]=s.useState(!1),[D,P]=s.useState(!1),A=s.useRef(null);return s.useEffect(()=>{const m=M.current;if(!m)return;const V=m.getContext("2d");if(!V)return;let R=[];const oe=800;let z,w;const h=800;let W,K=.5;function me(){const S=m?.parentElement;if(!S||!m)return;const H=S.clientWidth,le=S.clientHeight;m.width=Math.min(H,h),m.height=Math.min(le,h),z=m.width/2,w=m.height/2}function B(){me(),R=[];for(let S=0;S<oe;S++)R.push({x:Math.random()*(m?.width||800),y:Math.random()*(m?.height||800),z:Math.random()*(m?.width||800),o:Math.random()});be()}function be(){!m||!V||(V.clearRect(0,0,m.width,m.height),R.forEach(S=>{S.z-=K,S.z<=0&&(S.z=m.width,S.x=Math.random()*m.width,S.y=Math.random()*m.height,S.o=Math.random());const H=m.width/S.z,le=(S.x-z)*H+z,ce=(S.y-w)*H+w,ae=2*H;V.beginPath(),V.fillStyle=`rgba(255, 255, 255, ${S.o})`,V.arc(le,ce,ae,0,2*Math.PI),V.fill()}),K<60&&(K+=1),W=requestAnimationFrame(be))}B();const ie=()=>me();return window.addEventListener("resize",ie),()=>{window.removeEventListener("resize",ie),W&&cancelAnimationFrame(W)}},[]),s.useEffect(()=>{T(!0),setTimeout(()=>{v(!0)},800)},[]),s.useEffect(()=>{const m=setInterval(()=>{A.current&&l&&!A.current.isGeneratingImage&&l&&L(!1)},50);return()=>clearInterval(m)},[l]),s.useEffect(()=>{const m=()=>{P(!0)},V=Ke.subscribe("mining_completed",m);return()=>{V()}},[]),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h3",{className:"text-sm font-medium text-white",children:d?.name||"System"})}),e.jsxs("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:[e.jsx("canvas",{ref:M,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${k?"opacity-0":"opacity-100"}`,style:{filter:k?"blur(50px)":"none"}}),E&&d&&e.jsx("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${E&&k?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:e.jsx(tt,{ref:A,planets:d.planets,stars:d.stars,systemName:d.name,cosmicOriginTime:g||0,systemUrl:n})}),e.jsx(dt,{isActive:D,onAnimationComplete:()=>{P(!1)}})]}),e.jsxs("div",{className:"text-center mt-auto",children:[e.jsx(mt,{href:n,onTakeScreenshot:()=>{A.current&&!l&&(L(!0),A.current.captureScreenshot())},isGeneratingImage:l}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]})]})},St=({planets:n,coordinates:d,systemIndex:g})=>{const[M,E]=s.useState(new Set),T=l=>({"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"})[l]||"#FFFFFF";s.useEffect(()=>{(()=>{try{const L=xt(d,g,n),D=new Set;L.forEach(P=>{D.add(P.toLowerCase())}),E(D)}catch{}})()},[d,g,n]);const k=l=>l.replace(/_/g," "),v=l=>{try{ft(d,g,l,n)}catch{}window.location.href=`/planet/${l.toLowerCase()}`};return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3",children:n.map(l=>e.jsxs("div",{className:"relative bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 hover:border-white/40 transition-all duration-300 group overflow-hidden",children:[M.has(l.name.toLowerCase())&&e.jsx("div",{className:"absolute top-1 right-1 bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] px-1.5 py-0.5 rounded z-10",children:"VISITED"}),e.jsx("div",{className:"absolute -top-3 -left-3 w-8 h-8 rounded-full border border-white/40 shadow-sm z-20 animate-pulse",style:{backgroundColor:T(l.planet_type)}}),e.jsxs("button",{onClick:()=>v(l.name),className:"w-full text-left block p-2 sm:p-3 text-gray-200 hover:text-white transition-colors duration-300 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Planet"}),e.jsx("div",{className:"text-sm font-semibold text-white truncate group-hover:text-blue-300 transition-colors duration-300",children:k(l.name)})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]},l.name))}),n.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No planets found"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This system appears to be empty"})]})]})},Ct=({currentSystem:n,galaxy:d})=>{const[g,M]=s.useState(!1),[E,T]=s.useState(!1),[k,v]=s.useState(!0);s.useEffect(()=>{M(n.index>0),T(!0),v(!1)},[n.index]);const l=async()=>{if(n.index>0){if(!ke.canAffordTravel("system",1)){ke.executeTravel("system",1);return}if(!ke.executeTravel("system",1))return;const P=d.coordinates.join(",");Ie(P,n.index-1),window.location.href=`/system/${n.index-1}`}},L=async()=>{if(!ke.canAffordTravel("system",1)){ke.executeTravel("system",1);return}if(!ke.executeTravel("system",1))return;const P=d.coordinates.join(",");Ie(P,n.index+1),window.location.href=`/system/${n.index+1}`};return k?null:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:l,disabled:!g,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${g?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:L,disabled:!E,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${E?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})},Mt=({system:n,galaxy:d,system_url:g,version:M,system_index:E,image_url:T,page:k,cosmic_origin_time:v})=>{const[l]=s.useState(d.coordinates.join(","));s.useEffect(()=>{document.body.setAttribute("data-coordinates",l),document.body.setAttribute("data-system-index",E.toString()),Ie(l,E)},[l,E]);const L=P=>P.replace(/_/g," "),D=P=>P.replace(/_/g," ");return e.jsxs("div",{className:"w-full h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white overflow-auto",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(rt,{}),e.jsxs("div",{className:"relative z-10 pt-1",children:[e.jsx(at,{}),e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["System '",L(n.name),"'"]}),e.jsxs("p",{className:"text-lg sm:text-xl text-gray-300",children:["at Galaxy '",D(d.name),"' - Coordinates ",d.coordinates.join(", ")]})]}),e.jsx(Ct,{currentSystem:{name:n.name,index:E},galaxy:d}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[e.jsx("div",{className:"order-1 lg:order-1",children:e.jsx(Et,{systemUrl:g,system:n,cosmicOriginTime:v})}),e.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),e.jsx("div",{className:"order-2 lg:order-2",children:e.jsx(Nt,{system:n,galaxy:d,systemIndex:E,cosmicOriginTime:v})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:["Planets in '",L(n.name),"'"]}),e.jsx(St,{planets:n.planets,coordinates:l,systemIndex:E})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${k}`,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:e.jsxs("span",{className:"text-base sm:text-lg",children:["← Back to Galaxy '",D(d.name),"'"]})})})]}),e.jsx(Ft,{version:M})]}),e.jsx(ut,{}),e.jsx(gt,{currentLocation:{type:"system",name:n.name,coordinates:d.coordinates.join(","),systemIndex:n.index}}),e.jsx(ht,{currentView:"system"})]})};document.addEventListener("DOMContentLoaded",async()=>{try{const n=document.getElementById("system-data"),d=document.getElementById("galaxy-data"),g=document.getElementById("meta-data");if(!n||!d||!g)return;const M=JSON.parse(n.textContent||"{}"),E=JSON.parse(d.textContent||"{}"),T=JSON.parse(g.textContent||"{}"),k={system:M,galaxy:E,system_url:T.system_url,version:T.version,system_index:T.system_index,image_url:T.image_url,page:T.page||1,cosmic_origin_time:T.cosmic_origin_time},v=document.getElementById("atlas-react-root");v&&st.createRoot(v).render(nt.createElement(Mt,k))}catch{}});
