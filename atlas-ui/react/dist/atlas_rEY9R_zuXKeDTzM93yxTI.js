import{S as b}from"./atlas_C0O52P_24VXpcB_jxaut3.js";import{C as E,G as N,V as P,B as F,a as C,S as L,A as z,P as B,Q as H}from"./atlas_DfFO9DeAqJfHmKzNHJUiw.js";const l={ERUPTION_COUNT:{min:15,max:35},ERUPTION_FREQUENCY:{min:.2,max:.8},ERUPTION_DURATION:{min:2,max:5},ERUPTION_HEIGHT:{min:.05,max:.15},ERUPTION_SPREAD:{min:.6,max:1.9},PARTICLES_PER_ERUPTION:{min:50,max:150},PARTICLE_SIZE:{min:.07,max:.09},PARTICLE_LIFETIME:{min:1.5,max:3.5},PARTICLE_SPEED:{min:.1,max:.4},EMISSIVE_INTENSITY:{min:2,max:4},TURBULENCE:{min:.5,max:1.5}};class V{position;direction;lastEruptionTime=0;isActive=!1;eruptionStartTime=0;rng;particleDirections=[];particleSpeeds=[];particleSizes=[];particleLifetimes=[];particleBirthTimes=[];particleActive=[];constructor(i,t,r,e,a,o,p,c,s,u){this.position=i,this.direction=i.clone().normalize(),this.rng=new b(t);for(let n=0;n<a;n++)this.particleDirections.push(this.getRandomDirection(o)),this.particleSpeeds.push(p*(.7+this.rng.random()*.6)),this.particleSizes.push(c*u*(.5+this.rng.random())),this.particleLifetimes.push(s*(.8+this.rng.random()*.4)),this.particleBirthTimes.push(-1),this.particleActive.push(!1);this.isActive=!1,this.eruptionStartTime=0,this.lastEruptionTime=0}initializeStateFromAbsoluteTime(i,t,r,e){const a=1/t,o=r+a,p=e*o*.37%o,c=(i+p)%o;if(c<r){this.isActive=!0,this.eruptionStartTime=i-c,this.lastEruptionTime=this.eruptionStartTime-a;const s=i-this.eruptionStartTime,u=Math.min(s/r,1);for(let n=0;n<this.particleDirections.length;n++){const T=n/this.particleDirections.length*.7;u>T&&(this.particleActive[n]=!0,this.particleBirthTimes[n]=this.eruptionStartTime+T*r,i-this.particleBirthTimes[n]>this.particleLifetimes[n]&&(this.particleActive[n]=!1))}}else{this.isActive=!1,this.lastEruptionTime=i-c+r-a,this.eruptionStartTime=0;const s=i-c,u=s+r;for(let n=0;n<this.particleDirections.length;n++){const T=n/this.particleDirections.length*.7,y=s+T*r;if(y<u){const h=i-y;h>0&&h<=this.particleLifetimes[n]&&(this.particleActive[n]=!0,this.particleBirthTimes[n]=y)}}}}shouldErupt(i,t,r){const e=1/t+r,o=(i-this.lastEruptionTime)%e<r;return o&&!this.isActive?!0:(!o&&this.isActive&&this.stopEruption(),!1)}startEruption(i){this.isActive=!0,this.eruptionStartTime=i,this.lastEruptionTime=i}stopEruption(){this.isActive=!1}getRandomDirection(i){const t=this.rng.uniform(0,Math.PI*2),r=this.rng.uniform(0,i),e=new P(Math.sin(r)*Math.cos(t),Math.sin(r)*Math.sin(t),Math.cos(r)),a=new H;return a.setFromUnitVectors(new P(0,0,1),this.direction),e.applyQuaternion(a),e}}class I{fireGroup;eruptions=[];particleSystem;particleGeometry;particleMaterial;params;startTime;planetRadius;maxParticles=5e3;orbitalVisibilityFactor;temperatureActivationFactor;static vertexShader=`
    attribute float size;
    attribute float temperature;
    attribute float opacity;
    
    varying float vTemperature;
    varying float vOpacity;
    
    void main() {
      vTemperature = temperature;
      vOpacity = opacity;
      
      vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
      gl_PointSize = size * (300.0 / -mvPosition.z);
      gl_Position = projectionMatrix * mvPosition;
    }
  `;static fragmentShader=`
    uniform vec3 fireColorHot;
    uniform vec3 fireColorMid;
    uniform vec3 fireColorCool;
    uniform vec3 smokeColor;
    uniform float emissiveIntensity;
    
    varying float vTemperature;
    varying float vOpacity;
    
    void main() {
      // Forma circular de la partícula
      vec2 center = gl_PointCoord - vec2(0.5);
      float dist = length(center);
      
      // Suavizar los bordes con fadeout más gradual
      float alpha = 1.0 - smoothstep(0.2, 0.5, dist);
      alpha *= vOpacity;
      
      // Fadeout adicional basado en opacidad para transición más suave
      alpha *= smoothstep(0.0, 0.3, vOpacity);
      
      // Descartar píxeles transparentes
      if (alpha < 0.01) discard;
      
      // Color basado en temperatura
      vec3 color;
      if (vTemperature > 0.7) {
        // Muy caliente: entre blanco-amarillo y naranja
        color = mix(fireColorMid, fireColorHot, (vTemperature - 0.7) / 0.3);
      } else if (vTemperature > 0.3) {
        // Caliente: entre naranja y rojo
        color = mix(fireColorCool, fireColorMid, (vTemperature - 0.3) / 0.4);
      } else {
        // Enfriándose: entre rojo oscuro y humo
        color = mix(smokeColor, fireColorCool, vTemperature / 0.3);
      }
      
      // Añadir emisividad para brillar
      color *= emissiveIntensity * (0.5 + vTemperature * 0.5);
      
      // Efecto de brillo en el centro
      float glow = 1.0 - dist * 2.0;
      color += vec3(1.0, 0.8, 0.3) * glow * vTemperature * 0.5;
      
      gl_FragColor = vec4(color, alpha);
    }
  `;constructor(i,t={}){this.planetRadius=i;const r=t.seed||Math.floor(Math.random()*1e6),e=new b(r);this.startTime=t.startTime||r%1e4/1e3;const a=t.fireColorHot instanceof E?t.fireColorHot:new E(1,.95,.8),o=t.fireColorMid instanceof E?t.fireColorMid:new E(1,.5,.1),p=t.fireColorCool instanceof E?t.fireColorCool:new E(.8,.2,0),c=t.smokeColor instanceof E?t.smokeColor:new E(.2,.1,.05);this.params={eruptionCount:t.eruptionCount||Math.floor(e.uniform(l.ERUPTION_COUNT.min,l.ERUPTION_COUNT.max)),eruptionFrequency:t.eruptionFrequency||e.uniform(l.ERUPTION_FREQUENCY.min,l.ERUPTION_FREQUENCY.max),eruptionDuration:t.eruptionDuration||e.uniform(l.ERUPTION_DURATION.min,l.ERUPTION_DURATION.max),eruptionHeight:t.eruptionHeight||e.uniform(l.ERUPTION_HEIGHT.min,l.ERUPTION_HEIGHT.max),eruptionSpread:t.eruptionSpread||e.uniform(l.ERUPTION_SPREAD.min,l.ERUPTION_SPREAD.max),particlesPerEruption:t.particlesPerEruption||Math.floor(e.uniform(l.PARTICLES_PER_ERUPTION.min,l.PARTICLES_PER_ERUPTION.max)),particleSize:t.particleSize||e.uniform(l.PARTICLE_SIZE.min,l.PARTICLE_SIZE.max),particleLifetime:t.particleLifetime||e.uniform(l.PARTICLE_LIFETIME.min,l.PARTICLE_LIFETIME.max),particleSpeed:t.particleSpeed||e.uniform(l.PARTICLE_SPEED.min,l.PARTICLE_SPEED.max),particleGravity:t.particleGravity||.05,fireColorHot:a,fireColorMid:o,fireColorCool:p,smokeColor:c,emissiveIntensity:t.emissiveIntensity||e.uniform(l.EMISSIVE_INTENSITY.min,l.EMISSIVE_INTENSITY.max),glowIntensity:t.glowIntensity||2,turbulenceStrength:t.turbulenceStrength||e.uniform(l.TURBULENCE.min,l.TURBULENCE.max),windStrength:t.windStrength||.1,seed:r,startTime:this.startTime,timeSpeed:t.timeSpeed||e.uniform(.1,2),orbitalData:t.orbitalData,currentTime:t.currentTime||0,planetTemperature:t.planetTemperature||0},this.temperatureActivationFactor=this.calculateTemperatureActivation(),this.orbitalVisibilityFactor=this.calculateOrbitalVisibility(),this.fireGroup=new N,this.createEruptionPoints(e),this.initializeStateFromAbsoluteTime(),this.createParticleSystem(),this.initializeActiveEruptions();const u=(this.startTime+Date.now()/1e3*this.params.timeSpeed)%1e3;this.updateParticleGeometry(u)}initializeStateFromAbsoluteTime(){const t=(this.startTime+Date.now()/1e3*this.params.timeSpeed)%1e3;for(let r=0;r<this.eruptions.length;r++)this.eruptions[r].initializeStateFromAbsoluteTime(t,this.params.eruptionFrequency,this.params.eruptionDuration,r)}createEruptionPoints(i){const t=this.params.eruptionCount;for(let r=0;r<t;r++){const e=i.uniform(0,Math.PI*2),a=Math.acos(i.uniform(-1,1)),o=new P(Math.sin(a)*Math.cos(e)*this.planetRadius,Math.sin(a)*Math.sin(e)*this.planetRadius,Math.cos(a)*this.planetRadius),p=new V(o,Math.floor(i.random()*1e6),this.params.eruptionFrequency,this.params.eruptionDuration,150,this.params.eruptionSpread,this.params.particleSpeed,this.params.particleSize,this.params.particleLifetime,this.planetRadius);this.eruptions.push(p)}}createParticleSystem(){this.particleGeometry=new F;const i=new Float32Array(this.maxParticles*3),t=new Float32Array(this.maxParticles),r=new Float32Array(this.maxParticles),e=new Float32Array(this.maxParticles);this.particleGeometry.setAttribute("position",new C(i,3)),this.particleGeometry.setAttribute("size",new C(t,1)),this.particleGeometry.setAttribute("temperature",new C(r,1)),this.particleGeometry.setAttribute("opacity",new C(e,1)),this.particleMaterial=new L({vertexShader:I.vertexShader,fragmentShader:I.fragmentShader,uniforms:{fireColorHot:{value:this.params.fireColorHot},fireColorMid:{value:this.params.fireColorMid},fireColorCool:{value:this.params.fireColorCool},smokeColor:{value:this.params.smokeColor},emissiveIntensity:{value:this.params.emissiveIntensity}},transparent:!0,blending:z,depthWrite:!1,vertexColors:!1}),this.particleSystem=new B(this.particleGeometry,this.particleMaterial),this.particleSystem.renderOrder=4,this.fireGroup.add(this.particleSystem)}initializeActiveEruptions(){const t=(this.startTime+Date.now()/1e3*this.params.timeSpeed)%1e3;for(let r=0;r<this.eruptions.length;r++){const e=this.eruptions[r],a=1/this.params.eruptionFrequency,o=this.params.eruptionDuration+a,p=r*o*.37%o,c=Math.max(...e.particleLifetimes),s=Math.ceil(c/o)+1;for(let u=0;u<s;u++){const n=t-u*o,T=(n+p)%o;if(T<this.params.eruptionDuration){const y=n-T;for(let h=0;h<150;h++){const m=h/150*.7,d=y+m*this.params.eruptionDuration,f=t-d;f>0&&f<=e.particleLifetimes[h]&&(e.particleActive[h]||(e.particleActive[h]=!0,e.particleBirthTimes[h]=d))}}}}}calculateTemperatureActivation(){const i=this.params.planetTemperature||0;return i<1500?0:i>=3e3?1:(i-1500)/1500}calculateOrbitalVisibility(){if(!this.params.orbitalData||!this.params.orbitalData.enabled)return 1;const t=((this.params.currentTime||0)+(Date.now()/1e3-this.startTime)/(365.25*24*3600))%this.params.orbitalData.cycle_duration_years/this.params.orbitalData.cycle_duration_years,r=this.params.orbitalData.visible_duration_years/this.params.orbitalData.cycle_duration_years;if(t<=r){const e=t/r;return e<.1?e/.1:e>.9?(1-e)/.1:1}return 0}updateParticleGeometry(i){const t=this.particleGeometry.attributes.position,r=this.particleGeometry.attributes.size,e=this.particleGeometry.attributes.temperature,a=this.particleGeometry.attributes.opacity;let o=0;const p=150;for(let c=0;c<this.eruptions.length;c++){const s=this.eruptions[c],u=1/this.params.eruptionFrequency,n=this.params.eruptionDuration+u,T=c*n*.37%n,y=(i+T)%n,h=y<this.params.eruptionDuration;if(h&&!s.isActive?(s.isActive=!0,s.eruptionStartTime=i-y):!h&&s.isActive&&(s.isActive=!1),h){const m=i-s.eruptionStartTime,d=Math.min(m/this.params.eruptionDuration,1);for(let f=0;f<p;f++){const A=f/p*.7;d>A&&!s.particleActive[f]&&(s.particleActive[f]=!0,s.particleBirthTimes[f]=i-(d-A)*this.params.eruptionDuration)}}for(let m=0;m<p&&o<this.maxParticles;m++)if(s.particleActive[m]){const d=i-s.particleBirthTimes[m],f=s.particleLifetimes[m];if(d>f){s.particleActive[m]=!1;continue}const A=s.particleDirections[m].clone(),M=s.particleSpeeds[m]*d,S=s.position.clone().add(A.multiplyScalar(M)),D=this.params.particleGravity*d*d*.5;S.y-=D;const w=new P(Math.sin(i*.5+m*.1)*.01,Math.cos(i*.3+m*.1)*.005,Math.sin(i*.7+m*.1)*.01);S.add(w);const _=d/f,x=Math.max(0,1-_*.9),U=this.smoothstep(0,.1,_),O=this.smoothstep(1,.7,_),g=U*O,G=s.particleSizes[m];g>.01&&(t.setXYZ(o,S.x,S.y,S.z),r.setX(o,G),e.setX(o,x),a.setX(o,g),o++)}}for(let c=o;c<this.maxParticles;c++)t.setXYZ(c,0,0,0),r.setX(c,0),a.setX(c,0),e.setX(c,0);t.needsUpdate=!0,r.needsUpdate=!0,e.needsUpdate=!0,a.needsUpdate=!0,this.particleGeometry.setDrawRange(0,o)}smoothstep(i,t,r){const e=Math.max(0,Math.min(1,(r-i)/(t-i)));return e*e*(3-2*e)}update(i){const r=(this.startTime+Date.now()/1e3*this.params.timeSpeed)%1e3;this.orbitalVisibilityFactor=this.calculateOrbitalVisibility();const e=this.temperatureActivationFactor*this.orbitalVisibilityFactor;if(e>0){if(this.updateParticleGeometry(r),this.particleMaterial&&this.particleMaterial.uniforms){const a=this.params.emissiveIntensity||1;this.particleMaterial.uniforms.emissiveIntensity.value=a*e}}else this.hideAllParticles()}hideAllParticles(){const i=this.particleGeometry.attributes.position,t=this.particleGeometry.attributes.size,r=this.particleGeometry.attributes.opacity,e=this.particleGeometry.attributes.temperature;for(let a=0;a<this.maxParticles;a++)i.setXYZ(a,0,0,0),t.setX(a,0),r.setX(a,0),e.setX(a,0);i.needsUpdate=!0,t.needsUpdate=!0,e.needsUpdate=!0,r.needsUpdate=!0,this.particleGeometry.setDrawRange(0,0)}addToScene(i,t){t&&this.fireGroup.position.copy(t),i.add(this.fireGroup)}getObject3D(){return this.fireGroup}dispose(){this.particleGeometry.dispose(),this.particleMaterial.dispose(),this.fireGroup.clear(),this.eruptions=[]}}function k(v,i,t){const r=v?.seeds?.planet_seed||Math.floor(Math.random()*1e6),e=v?.original_planet_data?.surface_temperature||0,a=v?.timing?.elapsed_time?v.timing.elapsed_time/(365.25*24*3600):0,o=v?.original_planet_data?.orbital_period_seconds?v.original_planet_data.orbital_period_seconds/(365.25*24*3600):1,p=v?.fire_eruption_data||{},c=new b(r+9001),s=p.cycle_duration_years||c.uniform(o*.1,o*.8),u={enabled:p.enabled!==void 0?p.enabled:!0,cycle_duration_years:s,visible_duration_years:p.visible_duration_years||c.uniform(s*.4,s*.55)},n={seed:r+9e3,planetTemperature:e,orbitalData:u,currentTime:a};return new I(i,n)}export{I as F,k as c};
