import{j as n,r as c}from"./atlas_C3xj8MG9oH9uC54MklkAb.js";import{W as Be}from"./atlas_hV4YbJX4LmBeaYZmYRF0y.js";import{O as Ue}from"./atlas_BJLzboHTaSIGvKgNbvLUr.js";import{Q as $e}from"./atlas_C0q7_QgoBkw_1ECio0nFC.js";import{e as O}from"./atlas_wcPzamFt5CPpIcmd124GE.js";import{E as U,c as Ge}from"./atlas_DIajYqgJJlFIdWNB9l9vK.js";import{g as He}from"./atlas_BkcglrC3q9-fMfrzU8uke.js";import{P as We}from"./atlas_BMkCctBHLeH7Oacwp8KHY.js";import{c as Ve}from"./atlas_DqkZSA4SKHSRE9_1MZZpu.js";import{a1 as qe,a2 as Ye,C as Ee,a3 as Qe,a4 as Ze,a5 as Xe,a6 as Je,a7 as Re,a8 as Ke,b as et,z as tt,M as rt,m as nt}from"./atlas_BOOzg5XYrrU1N4SZySfRd.js";const st=async f=>{const{url:p,size:L}=f;return new Promise((N,M)=>{const _=document.createElement("canvas"),b=L,E=Math.floor(L*.8);$e.toCanvas(_,p,{width:E,margin:0,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"H"},y=>{if(y){M(y);return}const l=document.createElement("canvas"),o=l.getContext("2d"),z=Math.floor(b*.17);if(l.width=b,l.height=b+z,o){const R=Math.floor(b*.1);o.fillStyle="#FFFFFF",o.beginPath(),o.roundRect(0,0,l.width,l.height,R),o.fill();const Z=(b-E)/2;o.drawImage(_,Z,Z),o.fillStyle="#000000",o.font=`bold ${Math.floor(b*.13)}px Arial`,o.textAlign="center",o.textBaseline="middle",o.fillText("VIEW IT LIVE",b/2,b+z*.2),N(l)}})})},at=async(f,p,L,N)=>{try{const M=Math.floor(p/8),_=await st({url:N,size:M}),b=Math.floor(p/100),E=p-_.width-b,y=L-_.height-b;f.drawImage(_,E,y)}catch(M){console.warn("Failed to generate QR code:",M)}},it=(f,p)=>{const{imageWidth:L,imageHeight:N,startYear:M=2023,companyName:_="Banshee",opacity:b=.5,fontSize:E}=p,y=new Date().getFullYear(),l=y===M?`${M}`:`${M}-${y}`,o=`The Atlas â€¢ Copyright ${_} â€¢ ${l}`;f.fillStyle=`rgba(255, 255, 255, ${b})`;const z=E||Math.floor(L/80);f.font=`${z}px Arial`,f.textAlign="left",f.textBaseline="bottom";const R=Math.floor(L/100);f.fillText(o,R,N-R)},ot=({isVisible:f,message:p="Exporting view, please wait..."})=>n.jsxs("div",{className:`absolute inset-0 bg-black flex flex-col items-center justify-center z-10 transition-all duration-300 ${f?"opacity-100 visible":"opacity-0 invisible"}`,children:[n.jsx("div",{className:"w-16 h-16 border-4 border-white/20 border-t-white rounded-full animate-spin mb-6"}),n.jsx("p",{className:"text-white text-xl font-medium text-center px-4",children:p})]}),ct=({planetData:f,showInConsole:p=!0,showInPage:L=!1})=>{const[N,M]=c.useState([]),[_,b]=c.useState({});c.useEffect(()=>{if(!f)return;const l=E(f);b(l),M(y(f)),typeof window<"u"&&(window.__DEBUG_PLANET_DATA=f,window.__DEBUG_PLANET_ANALYSIS=l)},[f,p]);function E(l){const o={hasValidStructure:!1,missingFields:[],dataIntegrity:"unknown",renderingIssues:[],colorConsistency:"unknown"};if(l.planet_info&&l.surface_elements?o.hasValidStructure=!0:(l.planet_info||o.missingFields.push("planet_info"),l.surface_elements||o.missingFields.push("surface_elements")),l.surface_elements?.type==="oceanic"&&(o.oceanicData={hasAbstractLands:!!l.surface_elements.abstract_lands?.length,numGreenPatches:l.surface_elements.green_patches?.length||0,numClouds:l.surface_elements.clouds?.length||0,hasDepths:l.surface_elements.depths?.enabled||!1,baseColorIsBlue:l.planet_info?.base_color==="#0000FF",greenPatchColor:l.surface_elements.green_patches?.[0]?.color,issues:[]},o.oceanicData.numGreenPatches>15&&o.oceanicData.issues.push("Muchos parches verdes pueden ocultar el ocÃ©ano azul"),o.oceanicData.baseColorIsBlue||o.oceanicData.issues.push(`Color base no es azul puro: ${l.planet_info?.base_color}`),o.renderingIssues=o.oceanicData.issues),l.planet_info?.base_color&&l.planet_info?.type){const R={Oceanic:"#0000FF",Rocky:"#808080",Icy:"#ADD8E6",Desert:"#FFD700",Lava:"#FF0000"}[l.planet_info.type];R&&l.planet_info.base_color!==R?o.colorConsistency=`Inconsistente: esperado ${R}, recibido ${l.planet_info.base_color}`:o.colorConsistency="Correcto"}return o}function y(l){const o=[];if(!l.surface_elements?.type)return["No surface type defined"];const z=l.surface_elements.type.toLowerCase();switch(z){case"oceanic":o.push("OceanWavesEffect (PROBLEMA: ignora green_patches de Python)");break;case"rocky":o.push("RockyTerrainEffect");break;case"icy":o.push("IcyTerrainEffect");break;case"gas giant":o.push("GasGiantBandsEffect");break;default:o.push(`Generic effect for type: ${z}`)}return l.atmosphere?.density>0&&o.push("AtmosphericEffect"),l.rings&&o.push("RingSystemEffect"),o}return L?n.jsxs("div",{style:{position:"fixed",top:10,right:10,background:"rgba(0, 0, 0, 0.9)",color:"#00ff00",padding:"10px",borderRadius:"5px",fontFamily:"monospace",fontSize:"12px",maxWidth:"400px",maxHeight:"600px",overflow:"auto",zIndex:1e4,border:"1px solid #00ff00"},children:[n.jsxs("h3",{style:{margin:"0 0 10px 0",color:"#00ff00"},children:["ðŸ” Planet Debug: ",f.planet_info?.name]}),n.jsxs("div",{style:{marginBottom:"10px"},children:[n.jsx("strong",{children:"Type:"})," ",f.planet_info?.type,n.jsx("br",{}),n.jsx("strong",{children:"Base Color:"})," ",f.planet_info?.base_color,n.jsx("br",{}),n.jsx("strong",{children:"Radius:"})," ",f.planet_info?.radius]}),f.surface_elements?.type==="oceanic"&&n.jsxs("div",{style:{marginBottom:"10px",borderTop:"1px solid #00ff00",paddingTop:"10px"},children:[n.jsx("strong",{children:"ðŸŒŠ Oceanic Data:"}),n.jsx("br",{}),n.jsxs("span",{style:{color:_.oceanicData?.baseColorIsBlue?"#00ff00":"#ff0000"},children:["Base Color: ",_.oceanicData?.baseColorIsBlue?"âœ“ Blue":"âœ— Not Blue"]}),n.jsx("br",{}),"Green Patches: ",_.oceanicData?.numGreenPatches,n.jsx("br",{}),"Clouds: ",_.oceanicData?.numClouds,n.jsx("br",{}),"Has Depths: ",_.oceanicData?.hasDepths?"Yes":"No",n.jsx("br",{}),_.oceanicData?.issues?.length>0&&n.jsxs("div",{style:{color:"#ffaa00",marginTop:"5px"},children:["âš ï¸ Issues:",n.jsx("br",{}),_.oceanicData.issues.map((l,o)=>n.jsxs("div",{children:["- ",l]},o))]})]}),n.jsxs("div",{style:{borderTop:"1px solid #00ff00",paddingTop:"10px"},children:[n.jsx("strong",{children:"ðŸŽ¨ Effects Applied:"}),n.jsx("br",{}),N.map((l,o)=>n.jsxs("div",{style:{color:l.includes("PROBLEMA")?"#ff0000":"#00ff00"},children:["- ",l]},o))]}),n.jsx("button",{style:{marginTop:"10px",background:"#00ff00",color:"#000",border:"none",padding:"5px 10px",cursor:"pointer",borderRadius:"3px"},children:"Log to Console"})]}):null};function lt(f){c.useEffect(()=>{if(f&&f.surface_elements?.type==="oceanic"){f.surface_elements.green_patches?.length>0;const p=f.planet_info?.base_color;p!=="#0000FF"&&console.warn("âš ï¸ Planeta oceÃ¡nico sin color azul base!",p)}},[f])}const Q=2.5,Pe=()=>{const f=45*Math.PI/180;return Q/(Math.tan(f/2)*.5)},ut=c.forwardRef(({planetName:f,containerClassName:p="",width:L=800,height:N=600,autoRotate:M=!0,enableControls:_=!0,showDebugInfo:b=!1,planetData:E,cosmicOriginTime:y,initialAngleRotation:l,onDataLoaded:o,onEffectsCreated:z,onError:R},Z)=>{const P=c.useRef(null),m=c.useRef(null),S=c.useRef(null),j=c.useRef(null),h=c.useRef(null),B=c.useRef(null),Se=c.useRef(new qe),re=c.useRef(null),ne=c.useRef(0),I=c.useRef(null),[me,X]=c.useState(!0),[pe,G]=c.useState(null),[x,he]=c.useState(null),[Ce,se]=c.useState([]),[J,ae]=c.useState({activeEffects:0,enabledEffects:0,frameRate:0,renderTime:0}),W=c.useRef([]),ie=c.useRef(0),K=c.useRef(null),D=c.useRef(null),C=c.useRef(null),[oe,ge]=c.useState(!1);c.useImperativeHandle(Z,()=>({captureScreenshot:()=>{if(!S.current||!m.current||!j.current||oe)return;ge(!0),B.current&&(B.current.enabled=!1);const e=S.current,r=m.current,t=j.current,s=e.domElement.width,i=e.domElement.height,u=3840/s,a=[];r.traverse(g=>{if(g.isPoints&&g.material){const d=g.material;if(d.size!==void 0&&(a.push({material:d,originalSize:d.size}),d.size=d.size*u*1),d.uniforms&&(d.uniforms.size&&(a.push({material:d,uniform:"size",originalValue:d.uniforms.size.value}),d.uniforms.size.value=d.uniforms.size.value*u*1),d.uniforms.scale&&(a.push({material:d,uniform:"scale",originalValue:d.uniforms.scale.value}),d.uniforms.scale.value=d.uniforms.scale.value*u*1)),g.geometry&&g.geometry.attributes.size){const v=g.geometry.attributes.size,T=v.array.slice();a.push({geometry:g.geometry,originalSizeArray:T});for(let k=0;k<v.array.length;k++)v.array[k]*=u*1;v.needsUpdate=!0}}if(g.isSprite&&(a.push({object:g,originalScale:g.scale.clone()}),g.scale.multiplyScalar(u*1)),g.isLine&&g.material){const d=g.material;d.linewidth!==void 0&&(a.push({material:d,originalLinewidth:d.linewidth}),d.linewidth=d.linewidth*u*1)}});const A=3840,$=3840;e.setSize(A,$),t.aspect=1,t.updateProjectionMatrix(),e.render(r,t),e.domElement.toBlob(g=>{if(g){const d=document.createElement("canvas"),v=d.getContext("2d");if(d.width=A,d.height=$,v){const T=new Image;T.onload=async()=>{v.drawImage(T,0,0),it(v,{imageWidth:A,imageHeight:$}),await at(v,A,$,window.location.href),d.toBlob(q=>{if(q){const Y=URL.createObjectURL(q),H=document.createElement("a");H.href=Y,H.download=`planet_${f}_${Date.now()}.png`,H.click(),URL.revokeObjectURL(Y)}},"image/png",1)};const k=URL.createObjectURL(g);T.src=k}}a.forEach(({material:d,object:v,originalSize:T,originalScale:k,originalLinewidth:q,uniform:Y,originalValue:H,geometry:we,originalSizeArray:de})=>{if(T!==void 0&&(d.size=T),k!==void 0&&v.scale.copy(k),q!==void 0&&(d.linewidth=q),Y&&H!==void 0&&(d.uniforms[Y].value=H),we&&de){const ve=we.attributes.size;for(let te=0;te<de.length;te++)ve.array[te]=de[te];ve.needsUpdate=!0}}),e.setSize(s,i),t.aspect=s/i,t.updateProjectionMatrix(),B.current&&(B.current.enabled=!0),ge(!1)},"image/png",1)},isGeneratingImage:oe}));const Ae=Math.floor(Date.now()/1e3),[Me,dt]=c.useState(0),je=y||x?.timing?.cosmic_origin_time||Date.now()/1e3-3600,Le=Ae-je+Me;ne.current=Le;const ce=c.useCallback(()=>{if(!P.current||!S.current||!j.current)return;const e=P.current,r=e.clientWidth||400,t=e.clientHeight||400;S.current.setSize(r,t),C.current&&C.current.setSize(r,t),j.current.aspect=r/t,j.current.updateProjectionMatrix()},[]),_e=async e=>{if(!(!h.current||!m.current||!D.current)){U.log("Applying modular effects from API data",{planet:e.planet_info.name,type:e.planet_info.type});try{ue();const r=He(e);D.current.updateBaseColor(r);const t=O.createEffectsFromPythonPlanetData(e,Q,h.current,m.current,D.current),s=e.planet_info?.type||e.surface_elements?.planet_type||e.planet_type;if((s==="toxic"||s==="Toxic")&&m.current&&j.current&&S.current)try{const i=Ve(m.current,j.current,S.current,Q,{planet_type:"toxic",toxic_intensity:.8,atmosphere_thickness:.6},e.seeds?.planet_seed);if(i){C.current=i;const u={id:`effect_toxic_postprocessing_${Date.now()}`,type:"toxic_post_processing",effect:{dispose:()=>i.dispose(),update:a=>i.update(a),updateUniforms:a=>i.update(a),addToScene:()=>{},apply:()=>{}},priority:100,enabled:!0,name:"Toxic Post-Processing (Bloom + Godrays + Chromatic Aberration)"};O.effects.set(u.id,u),t.push(u),U.log("Created toxic post-processing effects")}}catch(i){U.error("Error creating toxic post-processing",i)}else C.current&&(C.current.dispose(),C.current=null);se(t),W.current=t,z&&z(t),U.log(`Successfully applied ${t.length} modular effects`),fe()}catch{ee()}}},De=c.useCallback(()=>{if(!P.current)return!1;try{for(;P.current.firstChild;)P.current.removeChild(P.current.firstChild);m.current=null,j.current=null,S.current=null,h.current=null,w.current=null;const e=P.current,r=e.clientWidth||L||400,t=e.clientHeight||N||400,s=new Ye;s.background=new Ee(1297),m.current=s;const i=new Qe(45,r/t,.1,1e4),u=Pe();i.position.set(0,0,u),i.lookAt(0,0,0),j.current=i;const a=new Be({antialias:!0,alpha:!0,powerPreference:"high-performance"});return a.setSize(r,t),a.setPixelRatio(Math.min(window.devicePixelRatio,2)),a.shadowMap.enabled=!0,a.shadowMap.type=Ze,a.toneMapping=Xe,a.toneMappingExposure=1.2,a.outputColorSpace=Je,a.domElement.className="",P.current.appendChild(a.domElement),S.current=a,ze(s,null),Ie(s),_&&ke(i,a.domElement),!0}catch{return!1}},[x,E,y]),Fe=e=>{if(!e)return 0;const r=e.sun_angle||e.lighting?.sun_angle;if(r!==void 0)return r;const t=e.timing?.current_orbital_angle||e.timing?.orbital_angle;return t??0},F=c.useRef(null),le=c.useRef(null),V=c.useRef(null),w=c.useRef(null),Te=e=>{e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=50,e.shadow.camera.left=-10,e.shadow.camera.right=10,e.shadow.camera.top=10,e.shadow.camera.bottom=-10},be=e=>{if(!F.current||!m.current)return;const r=Fe(e),t=10,s=r+Math.PI,i=Math.sin(r)*5,u=t*Math.cos(s),a=i,A=t*Math.sin(s);F.current.position.set(u,a,A),F.current.target.position.set(0,0,0),m.current.children.includes(F.current.target)||m.current.add(F.current.target),le.current&&le.current.position.set(-u*.5,0,-A*.5),D.current&&F.current&&D.current.updateFromThreeLight(F.current),F.current&&O.updateLightForAllEffects(F.current)},ze=(e,r)=>{{const t=new Re(16777215,2);t.position.set(-10,5,10),t.target.position.set(0,0,0),t.castShadow=!0,Te(t),e.add(t),e.add(t.target),F.current=t;const s=new Re(16777215,.05);s.position.set(8,-3,-5),e.add(s),le.current=s;const i=new Ke(2236996,.1);e.add(i),setTimeout(()=>{D.current&&t&&D.current.updateFromThreeLight(t),t&&O.updateLightForAllEffects(t)},50);return}},Ie=e=>{const r=new et(Q,128,64),t=new tt({color:8421504}),s=new rt(r,t);s.castShadow=!0,s.receiveShadow=!0,s.position.set(0,0,0),e.add(s),h.current=s;const i=new Ee(8421504);D.current=new We(s,i),D.current.addToScene(e)},ke=(e,r)=>{const t=new Ue(e,r);t.enableDamping=!0,t.dampingFactor=.05;const s=Pe();t.minDistance=s*.5,t.maxDistance=s*2,t.autoRotate=M,t.autoRotateSpeed=.5,t.enablePan=!0,t.enableZoom=!0,t.target.set(0,0,0),B.current=t},Oe=c.useCallback(async()=>{if(!window.isLoadingPlanetData){window.isLoadingPlanetData=!0;try{X(!0),G(null),U.log("Loading planet data from API",{planetName:f});const r=await fetch("/api/planet/rendering-data");if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const t=await r.json();if(!t.success)throw new Error(t.error||"Failed to fetch planet data");const s=t.planet_data,i=t.timing,u=t.rendering_data,a={planet_info:u?.planet_info||{name:s.name,type:s.planet_type,base_color:"#808080",radius:s.diameter/15e3,orbital_radius:s.orbital_radius},surface_elements:u?.surface_elements,atmosphere:u?.atmosphere,rings:u?.rings,effects_3d:u?.effects_3d,shader_uniforms:u?.shader_uniforms,universal_actions:u?.universal_actions,timing:{cosmic_origin_time:i.cosmic_origin_time,current_time_seconds:i.current_time_seconds,elapsed_time:i.elapsed_time,initial_orbital_angle:s.initial_orbital_angle,current_orbital_angle:s.current_orbital_angle,max_orbital_radius:i.max_orbital_radius,system_max_orbital_radius:s.system_max_orbital_radius},original_planet_data:s,seeds:u?.seeds};return he(a),I.current=a,U.log("API data loaded successfully",{planet:a.planet_info.name,type:a.planet_info.type,hasEffects:!!a.surface_elements,fullRenderingData:u}),o&&o(a),a}catch(e){const r=e instanceof Error?e.message:"Unknown error";return G(r),R&&R(r),null}finally{X(!1),window.isLoadingPlanetData=!1}}},[f,o,R]);c.useCallback(async()=>{if(!window.isLoadingPlanetData){window.isLoadingPlanetData=!0;try{X(!0),G(null),U.log("Loading planet data from API",{planetName:f});const r=await fetch("/api/planet/rendering-data");if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const t=await r.json();if(!t.success)throw new Error(t.error||"Failed to fetch planet data");const s=t.planet_data,i=t.timing,u=t.rendering_data,a={planet_info:u?.planet_info||{name:s.name,type:s.planet_type,base_color:"#808080",radius:s.diameter/15e3,orbital_radius:s.orbital_radius},surface_elements:u?.surface_elements,atmosphere:u?.atmosphere,rings:u?.rings,effects_3d:u?.effects_3d,shader_uniforms:u?.shader_uniforms,universal_actions:u?.universal_actions,timing:{cosmic_origin_time:i.cosmic_origin_time,current_time_seconds:i.current_time_seconds,elapsed_time:i.elapsed_time,initial_orbital_angle:s.initial_orbital_angle,current_orbital_angle:s.current_orbital_angle,max_orbital_radius:i.max_orbital_radius,system_max_orbital_radius:s.system_max_orbital_radius},original_planet_data:s,seeds:u?.seeds};he(a),I.current=a,U.log("API data loaded successfully",{planet:a.planet_info.name,type:a.planet_info.type,hasEffects:!!a.surface_elements,fullRenderingData:u}),be(a),w.current&&m.current&&(m.current.remove(w.current),w.current.geometry.dispose(),w.current.material.dispose(),w.current=null),await _e(a),o&&o(a)}catch(e){const r=e instanceof Error?e.message:"Unknown error";G(r),R&&R(r),ee()}finally{X(!1),window.isLoadingPlanetData=!1}}},[f,E,y,l]);const xe=c.useCallback(()=>{if(!x||!h.current)return;const e=E?.orbital_period_seconds||365.25*24*3600,r=2*Math.PI/e,t=x.timing?.initial_orbital_angle||0,s=Date.now()/1e3,i=0,u=y||x.timing?.cosmic_origin_time||Date.now()/1e3-3600,a=s-u+i,A=(t+a*r)%(2*Math.PI),$=x.timing?.max_orbital_radius||100,d=20+x.planet_info?.orbital_radius/$*80,v=d,T=d*Math.cos(A),k=v*Math.sin(A);h.current.position.x=T,h.current.position.z=k,h.current.position.y=0},[x,E,y]),Ne=c.useCallback(async e=>{const r=e||x;if(r&&m.current)try{be(r),w.current&&m.current&&(m.current.remove(w.current),w.current.geometry.dispose(),w.current.material.dispose(),w.current=null),await _e(r)}catch{ee()}},[x]),ee=()=>{if(!(!m.current||!h.current)){U.warn("Applying fallback effects for planet type:",E?.planet_type);try{ue(),h.current.material instanceof nt&&h.current.material.color.setHex(6710886);try{const e=Ge("generic"),r=O.createEffectsFromList(e,Q,h.current);r.forEach(t=>{t.effect.addToScene&&m.current&&h.current&&t.effect.addToScene(m.current,h.current.position)}),W.current=r,se(r)}catch{}fe()}catch{}}},ue=()=>{W.current.forEach(e=>{try{O.removeEffect(e.id),e.effect.dispose&&e.effect.dispose()}catch{}}),C.current&&(C.current.dispose(),C.current=null),W.current=[],se([])},ye=c.useCallback(()=>{re.current=requestAnimationFrame(ye);const e=performance.now(),r=Se.current.getDelta();B.current&&B.current.update();try{O.updateAllEffects(r,h.current?.rotation.y,j.current||void 0)}catch{}if(h.current&&I.current){I.current.planet_info?.name;const i=I.current.original_planet_data,u=i?.orbital_period_seconds||365.25*24*3600,a=I.current.timing?.initial_orbital_angle||0;y||I.current.timing?.cosmic_origin_time||Date.now()/1e3-3600;const A=i?.axial_tilt||0,$=2*Math.PI/u;(a+ne.current*$)%(2*Math.PI);const g=I.current.timing?.max_orbital_radius||I.current.timing?.system_max_orbital_radius,d=i?.orbital_radius;if(!g||!d)return;i?.eccentricity_factor,h.current.position.set(0,0,0);const v=i?.rotation_period_seconds||86400,T=2*Math.PI/v;h.current.rotation.y=ne.current*T%(2*Math.PI),h.current.rotation.z=A*(Math.PI/180)}W.current.forEach(i=>{i.effect.updateUniforms&&i.effect.updateUniforms(r)});const s=Array.from(O.effects.values()).find(i=>i.type==="toxic_post_processing")?.enabled||!1;if(C.current&&s&&(C.current.update(r),F.current&&C.current.updateLightPosition(F.current.position,j.current)),S.current&&m.current&&j.current){const i=performance.now();C.current&&s?C.current.render():S.current.render(m.current,j.current);const u=performance.now()-i;if(e-ie.current>5e3){const a=1e3/(e-ie.current);fe(),ae(A=>({...A,frameRate:Math.round(a),renderTime:Math.round(u*100)/100})),ie.current=e}}},[]),fe=c.useCallback(()=>{const e=O.getStats();ae(r=>({...r,activeEffects:e.activeEffects,enabledEffects:e.enabledEffects}))},[]);return c.useEffect(()=>{let e=!0;return window.tonnirLoggedInPlanet=!1,window.orbitChecked=!1,window.debugOrbitRadius=null,window.debugSystemMaxRadius=null,window.planetNameLogged=!1,window.timingDataLogged=!1,window.isLoadingPlanetData=!1,window.orbitalAngleSourceLogged=!1,window.orbitalAngleDebugged=!1,window.positionDebugged=!1,window.animationLoopDebugged=!1,(async()=>{try{if(!e)return;const t=await Oe();if(!e)return;if(!De()){e&&G("Failed to initialize 3D renderer");return}if(!e||(ye(),P.current&&"ResizeObserver"in window&&(K.current=new ResizeObserver(ce),K.current.observe(P.current)),window.addEventListener("resize",ce),!e))return;t?await Ne(t):ee()}catch(t){e&&G(t instanceof Error?t.message:"Unknown initialization error")}})(),()=>{if(e=!1,I.current=null,re.current&&cancelAnimationFrame(re.current),K.current&&K.current.disconnect(),window.removeEventListener("resize",ce),ue(),D.current&&(D.current.dispose(),D.current=null),B.current&&B.current.dispose(),V.current&&m.current&&(m.current.remove(V.current),V.current.geometry.dispose(),V.current.material.dispose(),V.current=null),w.current&&m.current&&(m.current.remove(w.current),w.current.geometry.dispose(),w.current.material.dispose(),w.current=null),S.current&&P.current)try{P.current.contains(S.current.domElement)&&P.current.removeChild(S.current.domElement),S.current.dispose()}catch{}}},[]),c.useEffect(()=>{const e=setInterval(()=>{const r=O.getStats();ae(t=>({...t,activeEffects:r.activeEffects,enabledEffects:r.enabledEffects}))},1e4);return()=>clearInterval(e)},[]),c.useEffect(()=>{x&&m.current&&h.current&&xe()},[x,xe]),lt(x),n.jsxs("div",{className:`relative ${p}`,children:[b&&x&&n.jsx(ct,{planetData:x,showInPage:!0,showInConsole:!0}),n.jsx("div",{ref:P,className:"w-full h-full",style:{minHeight:"300px",aspectRatio:"1"}}),n.jsx(ot,{isVisible:oe}),me&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50",children:n.jsxs("div",{className:"text-white text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mx-auto mb-2"}),n.jsx("div",{children:"Loading planet..."})]})}),pe&&n.jsxs("div",{className:"absolute top-0 left-0 right-0 p-2 bg-red-500 text-white text-sm",children:[n.jsx("strong",{children:"Error:"})," ",pe]}),x&&!me&&n.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:n.jsx("h3",{className:"text-xs font-bold",children:x.planet_info.name})}),b&&n.jsxs("div",{className:"absolute top-0 right-0 p-4 text-white bg-black bg-opacity-70 text-xs font-mono",children:[n.jsx("h4",{className:"font-bold mb-2",children:"Debug Info"}),n.jsxs("div",{children:["Frame Rate: ",J.frameRate," FPS"]}),n.jsxs("div",{children:["Render Time: ",J.renderTime,"ms"]}),n.jsxs("div",{children:["Active Effects: ",J.activeEffects]}),n.jsxs("div",{children:["Enabled Effects: ",J.enabledEffects]}),n.jsxs("div",{className:"mt-2",children:[n.jsx("div",{className:"font-semibold",children:"Effects:"}),Ce.map(e=>n.jsxs("div",{className:"ml-2",children:[e.type," (",e.enabled?"ON":"OFF",")"]},e.id))]})]})]})});class ft extends c.Component{constructor(p){super(p),this.state={hasError:!1,error:null}}static getDerivedStateFromError(p){return{hasError:!0,error:p.message}}componentDidCatch(p,L){}render(){return this.state.hasError?n.jsx("div",{className:"flex items-center justify-center w-full h-full bg-gray-900/50 rounded",children:n.jsxs("div",{className:"text-center p-4",children:[n.jsx("div",{className:"text-red-400 text-sm mb-2",children:"3D Renderer Error"}),n.jsx("div",{className:"text-xs text-gray-400",children:this.state.error})]})}):this.props.children}}const Et=c.forwardRef((f,p)=>n.jsx(ft,{children:n.jsx(ut,{ref:p,...f})}));export{ot as E,Et as M,it as a,at as b};
