import{r as P,j as s,V as ot,c as at,R as nt}from"./atlas_bDOTfl6YifhEgi64OZoGp.js";import{H as rt}from"./atlas_DAPSgiEQDbHKEp53GoVrV.js";import{S as lt,U as ct,m as Y,c as Z,a as ht}from"./atlas_Ep8Z7FyBoZ31__UNPvjgh.js";import{m as dt,V as k,n as I,T as z,Q as $,l as G,o as D,R as mt,p as ut,q as pt,r as J,C as tt,e as ft,s as U,N as gt,t as xt,S as _t,P as bt,W as yt,c as K,u as wt,d as X,M as vt,A as jt,k as V}from"./atlas_0u4puQilmEK-9IoYPrt7x.js";const q={type:"change"},W={type:"start"},et={type:"end"},H=new mt,Q=new ut,Pt=Math.cos(70*pt.DEG2RAD),E=new k,M=2*Math.PI,x={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},B=1e-6;class Nt extends dt{constructor(t,e=null){super(t,e),this.state=x.NONE,this.target=new k,this.cursor=new k,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:I.ROTATE,MIDDLE:I.DOLLY,RIGHT:I.PAN},this.touches={ONE:z.ROTATE,TWO:z.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new k,this._lastQuaternion=new $,this._lastTargetPosition=new k,this._quat=new $().setFromUnitVectors(t.up,new k(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new G,this._sphericalDelta=new G,this._scale=1,this._panOffset=new k,this._rotateStart=new D,this._rotateEnd=new D,this._rotateDelta=new D,this._panStart=new D,this._panEnd=new D,this._panDelta=new D,this._dollyStart=new D,this._dollyEnd=new D,this._dollyDelta=new D,this._dollyDirection=new k,this._mouse=new D,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=St.bind(this),this._onPointerDown=Et.bind(this),this._onPointerUp=Ct.bind(this),this._onContextMenu=Lt.bind(this),this._onMouseWheel=Tt.bind(this),this._onKeyDown=Dt.bind(this),this._onTouchStart=Rt.bind(this),this._onTouchMove=kt.bind(this),this._onMouseDown=Mt.bind(this),this._onMouseMove=At.bind(this),this._interceptControlDown=Ot.bind(this),this._interceptControlUp=Ft.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(q),this.update(),this.state=x.NONE}update(t=null){const e=this.object.position;E.copy(e).sub(this.target),E.applyQuaternion(this._quat),this._spherical.setFromVector3(E),this.autoRotate&&this.state===x.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let o=this.minAzimuthAngle,a=this.maxAzimuthAngle;isFinite(o)&&isFinite(a)&&(o<-Math.PI?o+=M:o>Math.PI&&(o-=M),a<-Math.PI?a+=M:a>Math.PI&&(a-=M),o<=a?this._spherical.theta=Math.max(o,Math.min(a,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(o+a)/2?Math.max(o,this._spherical.theta):Math.min(a,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let n=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const r=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),n=r!=this._spherical.radius}if(E.setFromSpherical(this._spherical),E.applyQuaternion(this._quatInverse),e.copy(this.target).add(E),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let r=null;if(this.object.isPerspectiveCamera){const l=E.length();r=this._clampDistance(l*this._scale);const m=l-r;this.object.position.addScaledVector(this._dollyDirection,m),this.object.updateMatrixWorld(),n=!!m}else if(this.object.isOrthographicCamera){const l=new k(this._mouse.x,this._mouse.y,0);l.unproject(this.object);const m=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),n=m!==this.object.zoom;const f=new k(this._mouse.x,this._mouse.y,0);f.unproject(this.object),this.object.position.sub(f).add(l),this.object.updateMatrixWorld(),r=E.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;r!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(r).add(this.object.position):(H.origin.copy(this.object.position),H.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(H.direction))<Pt?this.object.lookAt(this.target):(Q.setFromNormalAndCoplanarPoint(this.object.up,this.target),H.intersectPlane(Q,this.target))))}else if(this.object.isOrthographicCamera){const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),r!==this.object.zoom&&(this.object.updateProjectionMatrix(),n=!0)}return this._scale=1,this._performCursorZoom=!1,n||this._lastPosition.distanceToSquared(this.object.position)>B||8*(1-this._lastQuaternion.dot(this.object.quaternion))>B||this._lastTargetPosition.distanceToSquared(this.target)>B?(this.dispatchEvent(q),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?M/60*this.autoRotateSpeed*t:M/60/60*this.autoRotateSpeed}_getZoomScale(t){const e=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,e){E.setFromMatrixColumn(e,0),E.multiplyScalar(-t),this._panOffset.add(E)}_panUp(t,e){this.screenSpacePanning===!0?E.setFromMatrixColumn(e,1):(E.setFromMatrixColumn(e,0),E.crossVectors(this.object.up,E)),E.multiplyScalar(t),this._panOffset.add(E)}_pan(t,e){const o=this.domElement;if(this.object.isPerspectiveCamera){const a=this.object.position;E.copy(a).sub(this.target);let n=E.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*n/o.clientHeight,this.object.matrix),this._panUp(2*e*n/o.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/o.clientWidth,this.object.matrix),this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/o.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,e){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const o=this.domElement.getBoundingClientRect(),a=t-o.left,n=e-o.top,r=o.width,l=o.height;this._mouse.x=a/r*2-1,this._mouse.y=-(n/l)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(M*this._rotateDelta.x/e.clientHeight),this._rotateUp(M*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let e=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(M*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-M*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(M*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-M*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),e=!0;break}e&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),o=.5*(t.pageX+e.x),a=.5*(t.pageY+e.y);this._rotateStart.set(o,a)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),o=.5*(t.pageX+e.x),a=.5*(t.pageY+e.y);this._panStart.set(o,a)}}_handleTouchStartDolly(t){const e=this._getSecondPointerPosition(t),o=t.pageX-e.x,a=t.pageY-e.y,n=Math.sqrt(o*o+a*a);this._dollyStart.set(0,n)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const o=this._getSecondPointerPosition(t),a=.5*(t.pageX+o.x),n=.5*(t.pageY+o.y);this._rotateEnd.set(a,n)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(M*this._rotateDelta.x/e.clientHeight),this._rotateUp(M*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),o=.5*(t.pageX+e.x),a=.5*(t.pageY+e.y);this._panEnd.set(o,a)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const e=this._getSecondPointerPosition(t),o=t.pageX-e.x,a=t.pageY-e.y,n=Math.sqrt(o*o+a*a);this._dollyEnd.set(0,n),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const r=(t.pageX+e.x)*.5,l=(t.pageY+e.y)*.5;this._updateZoomParameters(r,l)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId){this._pointers.splice(e,1);return}}_isTrackingPointer(t){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return!0;return!1}_trackPointer(t){let e=this._pointerPositions[t.pointerId];e===void 0&&(e=new D,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(t){const e=t.deltaMode,o={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:o.deltaY*=16;break;case 2:o.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(o.deltaY*=10),o}}function Et(i){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(i.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(i)&&(this._addPointer(i),i.pointerType==="touch"?this._onTouchStart(i):this._onMouseDown(i)))}function St(i){this.enabled!==!1&&(i.pointerType==="touch"?this._onTouchMove(i):this._onMouseMove(i))}function Ct(i){switch(this._removePointer(i),this._pointers.length){case 0:this.domElement.releasePointerCapture(i.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(et),this.state=x.NONE;break;case 1:const t=this._pointers[0],e=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:e.x,pageY:e.y});break}}function Mt(i){let t;switch(i.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case I.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(i),this.state=x.DOLLY;break;case I.ROTATE:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=x.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=x.ROTATE}break;case I.PAN:if(i.ctrlKey||i.metaKey||i.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(i),this.state=x.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(i),this.state=x.PAN}break;default:this.state=x.NONE}this.state!==x.NONE&&this.dispatchEvent(W)}function At(i){switch(this.state){case x.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(i);break;case x.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(i);break;case x.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(i);break}}function Tt(i){this.enabled===!1||this.enableZoom===!1||this.state!==x.NONE||(i.preventDefault(),this.dispatchEvent(W),this._handleMouseWheel(this._customWheelEvent(i)),this.dispatchEvent(et))}function Dt(i){this.enabled!==!1&&this._handleKeyDown(i)}function Rt(i){switch(this._trackPointer(i),this._pointers.length){case 1:switch(this.touches.ONE){case z.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(i),this.state=x.TOUCH_ROTATE;break;case z.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(i),this.state=x.TOUCH_PAN;break;default:this.state=x.NONE}break;case 2:switch(this.touches.TWO){case z.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(i),this.state=x.TOUCH_DOLLY_PAN;break;case z.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(i),this.state=x.TOUCH_DOLLY_ROTATE;break;default:this.state=x.NONE}break;default:this.state=x.NONE}this.state!==x.NONE&&this.dispatchEvent(W)}function kt(i){switch(this._trackPointer(i),this.state){case x.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(i),this.update();break;case x.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(i),this.update();break;case x.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(i),this.update();break;case x.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(i),this.update();break;default:this.state=x.NONE}}function Lt(i){this.enabled!==!1&&i.preventDefault()}function Ot(i){i.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Ft(i){i.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}class zt{seed;constructor(t){this.seed=t%2147483647,this.seed<=0&&(this.seed+=2147483646)}random(){return this.seed=this.seed*16807%2147483647,(this.seed-1)/2147483646}randint(t,e){return Math.floor(this.random()*(e-t+1))+t}uniform(t,e){return this.random()*(e-t)+t}}function It(i){let t=0;for(let e=0;e<i.length;e++){const o=i.charCodeAt(e);t=(t<<5)-t+o,t=t&t}return Math.abs(t)}const Yt=`
  varying vec3 vPosition;
  varying vec3 vNormal;
  varying vec2 vUv;
  
  void main() {
    vPosition = position;
    vNormal = normal;
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,Ht=`
  uniform float time;
  uniform float seed;
  uniform vec3 planetColor;
  uniform float numBands;
  uniform float rotationAngle;
  uniform float bandPositions[20]; // Máximo 20 bandas como en Pillow
  uniform float bandWidths[20];
  varying vec3 vPosition;
  varying vec3 vNormal;
  varying vec2 vUv;
  
  // Hash function to generate pseudo-random numbers
  float hash(float n) {
    return fract(sin(n + seed) * 43758.5453123);
  }
  
  // Simple noise function
  float noise(vec3 p) {
    vec3 i = floor(p);
    vec3 f = fract(p);
    f = f * f * (3.0 - 2.0 * f);
    
    float n = i.x + i.y * 57.0 + 113.0 * i.z;
    return mix(
      mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),
          mix(hash(n + 57.0), hash(n + 58.0), f.x), f.y),
      mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),
          mix(hash(n + 170.0), hash(n + 171.0), f.x), f.y), f.z);
  }
  
  // Recreate generate_cloud_bands EXACTLY as in Pillow
  float createCloudBands(vec3 pos) {
    float bands = 0.0;
    
    // Bands are HORIZONTAL (constant latitude) from north pole to south pole
    // pos.y is already normalized from -1 (south pole) to +1 (north pole)
    float currentY = pos.y;
    float currentX = pos.x; // For rotation
    
    // Apply rotation EXACTLY as in Pillow
    float cosAngle = cos(rotationAngle);
    float sinAngle = sin(rotationAngle);
    
    // Rotation in normalized coordinates
    float rotatedY = sinAngle * currentX + cosAngle * currentY;
    
    // Check if we are inside any horizontal band
    for(int i = 0; i < 20; i++) {
      if(float(i) >= numBands) break;
      
      float bandPosY = bandPositions[i]; // Already normalized between -1 and 1
      float bandWidth = bandWidths[i];   // Already normalized
      
      // Check if rotatedY is inside this band
      float distToBand = abs(rotatedY - bandPosY);
      if(distToBand < bandWidth / 2.0) {
        // Smooth band edges
        float bandIntensity = 1.0 - (distToBand / (bandWidth / 2.0));
        bands += bandIntensity * 0.6; // A bit more intense
      }
    }
    
    return bands;
  }
  
  // Function to create concentric rings like draw_planet_rings
  float createRings(vec3 pos) {
    float distance = length(pos);
    float rings = 0.0;
    
    // Create multiple concentric rings
    for(int i = 0; i < 30; i++) {
      float ringRadius = 0.5 + float(i) * 0.015;
      float ringWidth = 0.01;
      float opacity = pow((30.0 - float(i)) / 30.0, 4.0) * 0.3;
      
      float ringDist = abs(distance - ringRadius);
      if(ringDist < ringWidth) {
        rings += opacity * (1.0 - ringDist / ringWidth);
      }
    }
    
    return rings;
  }
  
  // Function to create cloud formations
  float createClouds(vec3 pos) {
    float clouds = 0.0;
    
    // Use noise to create irregular cloud patterns
    clouds += 0.5 * noise(pos * 8.0);
    clouds += 0.25 * noise(pos * 16.0);
    clouds += 0.125 * noise(pos * 32.0);
    
    // Add subtle temporal variation
    clouds += 0.1 * sin(time * 0.1 + length(pos) * 10.0);
    
    return smoothstep(0.3, 0.7, clouds);
  }
  
  void main() {
    vec3 pos = normalize(vPosition);
    
    // Base color of gas giant (orange)
    vec3 baseColor = vec3(1.0, 0.647, 0.0); // #FFA500 orange
    
    // Create cloud bands EXACTLY as in Pillow
    float bands = createCloudBands(pos);
    
    // Create surface rings
    float rings = createRings(pos);
    
    // Create cloud formations
    float clouds = createClouds(pos);
    
    // Combine all elements
    vec3 finalColor = baseColor;
    
    // Apply orange bands EXACTLY as in Pillow (255, 165, 0, 1)
    vec3 bandColor = vec3(1.0, 0.647, 0.0); // #FFA500 original orange
    finalColor = mix(finalColor, bandColor * 1.2, bands * 0.8); // More opacity for better visibility
    
    // Apply rings (darken)
    finalColor *= (1.0 - rings * 0.5);
    
    // Apply clouds (lighter tone)
    finalColor += clouds * vec3(0.3, 0.2, 0.1);
    
    // Add storm variation (red) in certain zones
    float stormZone = smoothstep(0.7, 1.0, noise(pos * 4.0 + vec3(seed * 0.1)));
    finalColor = mix(finalColor, vec3(0.545, 0.0, 0.0), stormZone * 0.6); // dark red
    
    // Apply basic lighting
    float lighting = dot(vNormal, normalize(vec3(1.0, 1.0, 1.0))) * 0.5 + 0.5;
    finalColor *= lighting;
    
    gl_FragColor = vec4(finalColor, 1.0);
  }
`,Ut={async create(i){const{planetMesh:t,planetName:e,planetData:o}=i,a=e.replace(/_/g," "),r=await crypto.subtle.digest("SHA-256",new TextEncoder().encode("1.618033988749895")),l=Array.from(new Uint8Array(r)).map(R=>R.toString(16).padStart(2,"0")).join(""),m=BigInt("0x"+l),f=o.diameter||1e3,j=o.density||5.5,u=o.gravity||9.8,c=`${m.toString()}-${a}-Gas Giant-${f}-${j}-${u}-_safe_shaper`,_=It(c),N=new zt(_),h=N.randint(3,20),d=N.uniform(-15,15)*Math.PI/180,p=[],g=[],b=100,y=200;for(let R=0;R<h;R++){const v=N.randint(2,4),F=1-2*(N.randint(y-b,y+b)-100)/200;p.push(F),g.push(v/b)}for(;p.length<20;)p.push(0),g.push(0);const w=new J({vertexShader:Yt,fragmentShader:Ht,uniforms:{time:{value:0},seed:{value:_*.001},planetColor:{value:new tt(1,.647,0)},numBands:{value:h},rotationAngle:{value:d},bandPositions:{value:p},bandWidths:{value:g}}});t.material=w;const S=o.rotation_period_seconds||86400,A=o.cosmicOriginTime||Date.now()/1e3,T=o.initialAngleRotation||0,L=()=>{const v=Date.now()/1e3-A,O=2*Math.PI/S;return(T+v*O)%(2*Math.PI)},C=()=>{w.uniforms.time.value+=.01,t.rotation.y=L(),requestAnimationFrame(C)};C()}};class Bt{mt=new Array(624);mti=625;constructor(t){let e;if(typeof t=="string"){const o=BigInt("0x"+t);e=Number(o%BigInt(4294967296))}else typeof t=="bigint"?e=Number(t%BigInt(4294967296)):e=t>>>0;this.initGenrand(e)}initGenrand(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<624;this.mti++)this.mt[this.mti]=1812433253*(this.mt[this.mti-1]^this.mt[this.mti-1]>>>30)+this.mti>>>0}genrandInt32(){let t;const e=[0,2567483615];if(this.mti>=624){let o;for(this.mti===625&&this.initGenrand(5489),o=0;o<227;o++)t=this.mt[o]&2147483648|this.mt[o+1]&2147483647,this.mt[o]=this.mt[o+397]^t>>>1^e[t&1];for(;o<623;o++)t=this.mt[o]&2147483648|this.mt[o+1]&2147483647,this.mt[o]=this.mt[o-227]^t>>>1^e[t&1];t=this.mt[623]&2147483648|this.mt[0]&2147483647,this.mt[623]=this.mt[396]^t>>>1^e[t&1],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0}random(){const t=this.genrandInt32()>>>5,e=this.genrandInt32()>>>6;return(t*67108864+e)*(1/9007199254740992)}uniform(t,e){return t+(e-t)*this.random()}randint(t,e){return Math.floor(this.uniform(t,e+1))}choices(t,e){const o=e.reduce((n,r)=>n+r,0);let a=this.uniform(0,o);for(let n=0;n<t.length;n++)if(a-=e[n],a<=0)return t[n];return t[t.length-1]}}async function Zt(i){const t=new TextEncoder().encode(i),e=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(e)).map(n=>n.toString(16).padStart(2,"0")).join("")}function Wt(i,t,e,o,a){const n=e+a.randint(120,160),r=n+a.randint(20,40),l=a.randint(500,1500),m=new ft,f=new Float32Array(l*3),j=new Float32Array(l*3),u=new Float32Array(l);for(let b=0;b<l;b++){const y=a.uniform(0,Math.PI*2),w=a.uniform(n,r),S=.3,A=w*Math.cos(y),T=w*Math.sin(y),L=w*S*Math.sin(y);f[b*3]=A,f[b*3+1]=L,f[b*3+2]=T;const C=a.randint(20,50)/255;j[b*3]=C,j[b*3+1]=C,j[b*3+2]=C;const R=[.5,1,1.5,2],v=[.4,.3,.2,.1];u[b]=a.choices(R,v)}m.setAttribute("position",new U(f,3)),m.setAttribute("color",new U(j,3)),m.setAttribute("size",new U(u,1));const c=new J({uniforms:{time:{value:0}},vertexShader:`
      attribute float size;
      varying vec3 vColor;
      
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
        gl_PointSize = size * (200.0 / -mvPosition.z);
        gl_Position = projectionMatrix * mvPosition;
      }
    `,fragmentShader:`
      varying vec3 vColor;
      
      void main() {
        float distance = length(gl_PointCoord - vec2(0.5));
        if (distance > 0.5) discard;
        
        float alpha = (1.0 - distance) * 1.0; // Full opacity as in Pillow
        gl_FragColor = vec4(vColor, alpha);
      }
    `,transparent:!0,vertexColors:!0,depthWrite:!1,blending:gt}),_=new xt(m,c);_.position.set(0,0,0),_.renderOrder=1,i.add(_);const N=o.rotation_period_seconds||86400,h=o.cosmicOriginTime||Date.now()/1e3,d=o.initialAngleRotation||0,p=()=>{const y=Date.now()/1e3-h,w=2*Math.PI/N;return(d+y*w)%(2*Math.PI)};_.rotation.y=p();const g=()=>{_.rotation.y=p(),c.uniforms.time.value+=.01,requestAnimationFrame(g)};g()}const $t={async create(i){const{scene:t,planetMesh:e,planetRadius:o,planetData:a,planetName:n}=i;try{const r=await fetch(`/api/planet/${n}/location-data`);if(!r.ok)throw new Error(`API request failed: ${r.status}`);const l=await r.json();if(!l.success)throw new Error(`API error: ${l.error}`);const{universe:m,galaxy:f,system:j,planet:u,seeds:c}=l;if(!u.has_rings)return;const _=u.name.replace(/_/g," "),N=`${c.config_seed}-${_}-rings-${u.diameter}-${u.density}-${u.gravity}-_safe_shaper`,h=await Zt(N),d=new Bt(h),p={diameter:u.diameter,density:u.density,gravity:u.gravity,mass:u.mass,orbital_radius_m:u.orbital_radius_m,rotation_period_seconds:u.rotation_period_seconds,surface_temperature:u.surface_temperature,axial_tilt:u.axial_tilt,cosmicOriginTime:m.cosmic_origin_time,initialAngleRotation:u.initial_angle_rotation};Wt(t,e,o,p,d)}catch{}}},Gt=({planetType:i="Rocky",planetName:t="Planet",planetData:e,cosmicOriginTime:o,initialAngleRotation:a,system:n,galaxy:r})=>{const l=P.useRef(null),m=P.useRef(null);return P.useEffect(()=>{if(!l.current)return;const f=l.current,j=300,u=300,c=new _t;c.background=new tt(17);const _={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},N=75,h=new bt(50,j/u,.1,1e3);h.position.set(0,0,250),h.lookAt(0,0,0);const d=new yt({antialias:!0,alpha:!0});d.setSize(j,u),d.setClearColor(17,1),f.appendChild(d.domElement);const p=new Nt(h,d.domElement);p.enableDamping=!0,p.dampingFactor=.05,p.enableZoom=!0,p.minDistance=100,p.maxDistance=500,p.enablePan=!1;const g=new K(N,32,32),b=_[i]||"#808080",y=new wt({color:b,transparent:!0,opacity:.9}),w=new X(g,y);c.add(w);const S=new X(new K(N*1.2,32,32),new vt({color:b,transparent:!0,opacity:.1}));w.add(S),i==="Gas Giant"&&e&&Ut.create({scene:c,planetMesh:w,planetRadius:N,planetData:{diameter:e.diameter||1e3,density:e.density||5.5,gravity:e.gravity||9.8,mass:e.mass||5972e21,orbital_radius_m:(e.orbital_radius||1)*1496e8,rotation_period_seconds:e.rotation_period_seconds||86400,surface_temperature:e.surface_temperature||273,axial_tilt:e.axial_tilt||0,seed:e.seed||0,cosmicOriginTime:o,initialAngleRotation:a},planetName:t}).catch(C=>{}),e&&e.mass&&e.orbital_radius&&e.rotation_period_seconds&&e.surface_temperature&&e.axial_tilt!==void 0&&$t.create({scene:c,planetMesh:w,planetRadius:N,planetData:{diameter:e.diameter||1e3,density:e.density||5.5,gravity:e.gravity||9.8,mass:e.mass,orbital_radius_m:e.orbital_radius*1496e8,rotation_period_seconds:e.rotation_period_seconds,surface_temperature:e.surface_temperature,axial_tilt:e.axial_tilt,seed:e.seed||0,cosmicOriginTime:o,initialAngleRotation:a},planetName:t,system:n,galaxy:r}).catch(C=>{});const A=new jt(8421504,1.5);c.add(A);const T=new V(16777215,2,1e3);if(T.position.set(100,100,100),c.add(T),i==="Gas Giant"){const C=new V(16777215,1.2,1e3);C.position.set(-100,-100,100),c.add(C)}const L=()=>{m.current=requestAnimationFrame(L),p.update(),d.render(c,h)};return L(),()=>{m.current&&cancelAnimationFrame(m.current),f&&d.domElement&&f.removeChild(d.domElement),d.dispose(),g.dispose(),y.dispose()}},[i,t]),s.jsxs("div",{className:"flex flex-col items-center w-full",children:[s.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Planet Preview"}),s.jsx("div",{ref:l,className:"border border-white/20 rounded bg-black/20",style:{width:"300px",height:"300px"}}),s.jsxs("div",{className:"text-xs text-gray-400 mt-2 text-center",children:[s.jsxs("div",{className:"text-[10px] text-gray-500",children:[t," - ",i]}),s.jsx("div",{className:"text-[9px] text-gray-600 mt-1",children:"Drag to rotate • Scroll to zoom"})]})]})},Kt=({planet:i,system:t,galaxy:e,cosmicOriginTime:o,initialAngleRotation:a})=>{const[n,r]=P.useState(!1),l=c=>c.replace(/_/g," "),m=c=>{const _=c/86400;return _<30?`${_.toFixed(2)} days`:_<365?`${(_/30).toFixed(2)} months`:`${(_/365).toFixed(2)} years`},f=c=>{const _=c*9/5+32;return`${c.toFixed(1)}°C (${_.toFixed(1)}°F)`},j=c=>`${c.toExponential(2)} kg`,u=c=>c>=1e3?`${(c/1e3).toFixed(2)} km`:`${c.toFixed(2)} m`;return s.jsxs("div",{className:"h-full flex flex-col relative",children:[s.jsx("div",{className:"absolute top-0 right-0 bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] px-1.5 py-0.5 rounded z-10",children:"VISITED"}),s.jsxs("div",{className:"flex items-center justify-between mb-3 pr-16",children:[s.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Planet Information"}),s.jsx(lt,{type:"planet",name:i.name,coordinates:e.coordinates.join(","),systemIndex:t.index,planetName:i.name,className:"text-xs"})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[s.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[s.jsx("div",{className:"text-xs text-gray-200",children:"Type"}),s.jsx("div",{className:"text-sm font-bold text-blue-300 capitalize",children:i.planet_type})]}),s.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[s.jsx("div",{className:"text-xs text-gray-200",children:"Atmosphere"}),s.jsx("div",{className:"text-sm font-bold text-purple-300 capitalize",children:i.atmosphere})]}),s.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-green-500/30",children:[s.jsx("div",{className:"text-xs text-gray-200",children:"Life Forms"}),s.jsx("div",{className:"text-sm font-bold text-green-300 capitalize",children:i.life_forms})]})]}),s.jsx("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-2",children:s.jsx(Gt,{planetType:i.planet_type,planetName:i.name,planetData:{diameter:i.diameter,density:i.density,gravity:i.gravity,mass:i.mass,orbital_radius:i.orbital_radius,rotation_period_seconds:i.rotation_period_seconds,surface_temperature:i.surface_temperature,axial_tilt:i.axial_tilt,seed:t.index},cosmicOriginTime:o,initialAngleRotation:a,system:{index:t.index,name:t.name},galaxy:{coordinates:e.coordinates,name:e.name}})}),s.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-orange-500/30 mb-3",children:[s.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Physical Properties"}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-1",children:[s.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-orange-500/20",children:[s.jsx("div",{className:"text-xs text-gray-300",children:"Mass"}),s.jsx("div",{className:"text-xs font-bold text-orange-300",children:j(i.mass)})]}),s.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-orange-500/20",children:[s.jsx("div",{className:"text-xs text-gray-300",children:"Diameter"}),s.jsx("div",{className:"text-xs font-bold text-orange-300",children:u(i.diameter)})]}),s.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-orange-500/20",children:[s.jsx("div",{className:"text-xs text-gray-300",children:"Density"}),s.jsxs("div",{className:"text-xs font-bold text-orange-300",children:[i.density.toFixed(2)," kg/m³"]})]}),s.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-orange-500/20",children:[s.jsx("div",{className:"text-xs text-gray-300",children:"Gravity"}),s.jsxs("div",{className:"text-xs font-bold text-orange-300",children:[i.gravity.toFixed(2)," m/s²"]})]})]})]}),s.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-cyan-500/30 mb-3",children:[s.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Orbital Properties"}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-1",children:[s.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-cyan-500/20",children:[s.jsx("div",{className:"text-xs text-gray-300",children:"Radius"}),s.jsxs("div",{className:"text-xs font-bold text-cyan-300",children:[i.orbital_radius.toFixed(2)," AU"]})]}),s.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-cyan-500/20",children:[s.jsx("div",{className:"text-xs text-gray-300",children:"Period"}),s.jsx("div",{className:"text-xs font-bold text-cyan-300",children:m(i.orbital_period_seconds)})]}),s.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-cyan-500/20",children:[s.jsx("div",{className:"text-xs text-gray-300",children:"Speed"}),s.jsxs("div",{className:"text-xs font-bold text-cyan-300",children:[i.orbital_speed.toFixed(2)," m/s"]})]}),s.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-cyan-500/20",children:[s.jsx("div",{className:"text-xs text-gray-300",children:"Tilt"}),s.jsxs("div",{className:"text-xs font-bold text-cyan-300",children:[i.axial_tilt.toFixed(2),"°"]})]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-2",children:[s.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-red-500/30",children:[s.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Surface Conditions"}),s.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[s.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-red-500/20",children:[s.jsx("div",{className:"text-xs text-gray-300",children:"Temperature"}),s.jsx("div",{className:"text-xs font-bold text-red-300",children:f(i.surface_temperature)})]}),s.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-red-500/20",children:[s.jsx("div",{className:"text-xs text-gray-300",children:"Rotation"}),s.jsx("div",{className:"text-xs font-bold text-red-300",children:m(i.rotation_period_seconds)})]})]})]}),s.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-yellow-500/30",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"text-xs text-gray-200",children:["Elements (",i.elements.length,")"]}),i.elements.length>4&&s.jsx("button",{onClick:()=>r(!n),className:"text-xs text-yellow-400 hover:text-yellow-300 transition-colors duration-300",children:n?"▲ Less":"▼ All"})]}),s.jsx("div",{className:"flex flex-wrap gap-1",children:(n?i.elements:i.elements.slice(0,4)).map((c,_)=>s.jsx("span",{className:"text-xs bg-yellow-500/20 text-yellow-300 px-1.5 py-0.5 rounded border border-yellow-500/30",children:c},_))})]})]}),s.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[s.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),s.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-2 text-xs",children:[s.jsxs("div",{className:"bg-white/5 rounded p-2",children:[s.jsx("span",{className:"text-gray-400",children:"Status:"}),s.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),s.jsxs("div",{className:"bg-white/5 rounded p-2",children:[s.jsx("span",{className:"text-gray-400",children:"Planet:"}),s.jsx("div",{className:"text-white truncate font-medium",children:l(i.name)})]}),s.jsxs("div",{className:"bg-white/5 rounded p-2",children:[s.jsx("span",{className:"text-gray-400",children:"System:"}),s.jsx("div",{className:"text-white truncate font-medium",children:l(t.name)})]}),s.jsxs("div",{className:"bg-white/5 rounded p-2",children:[s.jsx("span",{className:"text-gray-400",children:"System ID:"}),s.jsxs("div",{className:"text-white font-medium",children:["#",t.index+1]})]}),s.jsxs("div",{className:"bg-white/5 rounded p-2",children:[s.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),s.jsx("div",{className:"text-white truncate font-medium",children:l(e.name)})]}),s.jsxs("div",{className:"bg-white/5 rounded p-2",children:[s.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),s.jsx("div",{className:"text-white font-medium",children:e.coordinates.join(", ")})]})]})]})]})},Xt=({planetUrl:i,imageUrl:t,planet:e,cosmicOriginTime:o,initialAngleRotation:a})=>{const n=P.useRef(null),r=P.useRef(null),[l,m]=P.useState("Aligning Stargate..."),[f,j]=P.useState(!1),[u,c]=P.useState(!1),[_,N]=P.useState(!1);return P.useEffect(()=>{const h=document.createElement("style");return h.textContent=`
      [data-rmiz-modal-overlay="visible"] {
        background-color: rgba(0, 0, 0, 0.8) !important;
        backdrop-filter: blur(20px) !important;
        -webkit-backdrop-filter: blur(20px) !important;
        transition: backdrop-filter 0.3s ease-in-out !important;
      }
      
      [data-rmiz-modal-img] {
        border-radius: 1rem !important;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8) !important;
      }
      
      [data-rmiz-modal-overlay="hidden"] {
        backdrop-filter: blur(0px) !important;
        -webkit-backdrop-filter: blur(0px) !important;
        transition: backdrop-filter 0.3s ease-in-out !important;
      }
    `,document.head.appendChild(h),()=>{document.head.removeChild(h)}},[]),P.useEffect(()=>{const h=n.current;if(!h)return;const d=h.getContext("2d");if(!d)return;let p=[];const g=800;let b,y;const w=800;let S,A=.5;function T(){const v=h?.parentElement;if(!v||!h)return;const O=v.clientWidth,F=v.clientHeight;h.width=Math.min(O,w),h.height=Math.min(F,w),b=h.width/2,y=h.height/2}function L(){T(),p=[];for(let v=0;v<g;v++)p.push({x:Math.random()*(h?.width||800),y:Math.random()*(h?.height||800),z:Math.random()*(h?.width||800),o:Math.random()});C()}function C(){!h||!d||(d.clearRect(0,0,h.width,h.height),p.forEach(v=>{v.z-=A,v.z<=0&&(v.z=h.width,v.x=Math.random()*h.width,v.y=Math.random()*h.height,v.o=Math.random());const O=h.width/v.z,F=(v.x-b)*O+b,st=(v.y-y)*O+y,it=2*O;d.beginPath(),d.fillStyle=`rgba(255, 255, 255, ${v.o})`,d.arc(F,st,it,0,2*Math.PI),d.fill()}),A<60&&(A+=1),S=requestAnimationFrame(C))}L();const R=()=>T();return window.addEventListener("resize",R),()=>{window.removeEventListener("resize",R),S&&cancelAnimationFrame(S)}},[]),P.useEffect(()=>{if(t){console.log("Loading planet image:",t);const h=new Image;h.onload=()=>{console.log("Planet image loaded successfully"),r.current&&(r.current.src=t,c(!0),N(!0))},h.onerror=()=>{console.error("Failed to load planet image:",t),setTimeout(()=>{c(!0),N(!0)},1500)},h.src=t}else console.log("No imageUrl provided, using placeholder"),setTimeout(()=>{c(!0),N(!0)},1500)},[t]),P.useEffect(()=>{if(sessionStorage.getItem("stargateAnimationShown")){m("Stargate system aligned");return}sessionStorage.setItem("stargateAnimationShown","true"),j(!0);const d=(w,S)=>Array.from({length:S},()=>w[Math.floor(Math.random()*w.length)]).join(""),p=[{chars:"01",duration:40,iterations:20},{chars:"0123456789",duration:25,iterations:30},{chars:"0123456789ABCDEF",duration:20,iterations:40},{chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}|;:\\'\",.<>?/`~",duration:10,iterations:100}];let g=0,b=0;const y=()=>{if(g>=p.length){const S="Stargate system aligned";let A=0;m("");const T=()=>{A<S.length?(m(S.substring(0,A+1)),A++,setTimeout(T,30)):j(!1)};T();return}const w=p[g];m(d(w.chars,32)),b++,b>=w.iterations&&(g++,b=0),setTimeout(y,w.duration)};y()},[]),s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white mb-3",children:"Planet Visualization"}),s.jsxs("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black/50 flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:[s.jsx("canvas",{ref:n,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${_?"opacity-0":"opacity-100"}`,style:{filter:_?"blur(50px)":"none"}}),s.jsx("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${u?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:u&&t?s.jsx("div",{className:"w-full h-full flex items-center justify-center",children:s.jsx(ct,{zoomMargin:20,classDialog:"backdrop-blur-3xl",children:s.jsx("img",{ref:r,className:"max-w-full max-h-full object-contain rounded-xl shadow-2xl shadow-blue-500/20",src:t,alt:"Planet visualization",style:{width:"100%",height:"100%",objectFit:"contain",backgroundColor:"transparent"}})})}):s.jsx("img",{ref:r,className:"w-full h-full object-cover",src:"/static/images/placeholder-min.jpg",alt:"Planet visualization"})})]}),s.jsxs("div",{className:"text-center mt-auto",children:[s.jsxs("a",{href:i,className:`inline-block px-4 py-2 bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 text-gray-200 font-medium text-sm rounded-lg border border-slate-600 hover:border-slate-500 shadow-md hover:shadow-lg transition-all duration-300 relative overflow-hidden group ${f?"animate-pulse":""}`,style:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:[s.jsxs("span",{className:"relative z-10 font-mono flex items-center gap-2",children:[s.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:s.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6s.792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95a1 1 0 001.715 1.029zM8.5 10a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM10 14c-.304 0-.792-.193-1.264-.979a1 1 0 00-1.715 1.029C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 00-1.715-1.029C10.792 13.807 10.304 14 10 14z",clipRule:"evenodd"})}),l]}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-slate-600/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),s.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]})]})},Vt=({currentPlanet:i,system:t,galaxy:e,systemPlanets:o})=>{const[a,n]=P.useState(null),[r,l]=P.useState(null),[m,f]=P.useState(!1),[j,u]=P.useState(!1),[c,_]=P.useState(!0);P.useEffect(()=>{if(o&&o.length>0){const d=o.findIndex(p=>p.name.toLowerCase()===i.toLowerCase());d!==-1?(d>0?(n(o[d-1].name.toLowerCase()),f(!0)):t.index>0?(n("__prev_system__"),f(!0)):f(!1),d<o.length-1?(l(o[d+1].name.toLowerCase()),u(!0)):(l("__next_system__"),u(!0))):(f(!1),u(!1))}else f(!1),u(!1);_(!1)},[i,t.index,o]);const N=async()=>{const d=e.coordinates.join(",");if(a==="__prev_system__")try{const p=await fetch(`/system/${t.index-1}`,{headers:{Accept:"application/json"}});if(p.ok){const g=await p.json();if(g.system&&g.system.planets&&g.system.planets.length>0){const y=g.system.planets[g.system.planets.length-1].name.toLowerCase();Y(d,t.index-1,y,g.system.planets),Z(d,t.index-1),window.location.href=`/planet/${y}`;return}}window.location.href=`/system/${t.index-1}`}catch{window.location.href=`/system/${t.index-1}`}else a&&(Y(d,t.index,a,o),window.location.href=`/planet/${a}`)},h=async()=>{const d=e.coordinates.join(",");if(r==="__next_system__")try{const p=await fetch(`/system/${t.index+1}`,{headers:{Accept:"application/json"}});if(p.ok){const g=await p.json();if(g.system&&g.system.planets&&g.system.planets.length>0){const y=g.system.planets[0].name.toLowerCase();Y(d,t.index+1,y,g.system.planets),Z(d,t.index+1),window.location.href=`/planet/${y}`;return}}window.location.href=`/system/${t.index+1}`}catch{window.location.href=`/system/${t.index+1}`}else r&&(Y(d,t.index,r,o),window.location.href=`/planet/${r}`)};return c?null:s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("button",{onClick:N,disabled:!m,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${m?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsx("button",{onClick:h,disabled:!j,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${j?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})},qt=({planet:i,system:t,galaxy:e,planet_url:o,version:a,image_url:n,cosmic_origin_time:r,initial_angle_rotation:l})=>{const[m]=P.useState(e.coordinates.join(","));P.useEffect(()=>{document.body.setAttribute("data-coordinates",m),document.body.setAttribute("data-system-index",t.index.toString()),document.body.setAttribute("data-planet-name",i.name.toLowerCase()),Y(m,t.index,i.name,t.planets||[]),Z(m,t.index)},[m,t.index,i.name]);const f=c=>c.replace(/_/g," "),j=c=>c.replace(/_/g," "),u=c=>c.replace(/_/g," ");return s.jsxs("div",{className:"w-full h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white overflow-auto",children:[s.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),s.jsxs("div",{className:"relative z-10",children:[s.jsx(rt,{}),s.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["Planet '",f(i.name),"'"]}),s.jsxs("p",{className:"text-lg sm:text-xl text-gray-300",children:["in System '",j(t.name),"' - Galaxy '",u(e.name),"'"]}),s.jsxs("p",{className:"text-sm sm:text-base text-gray-400",children:["Coordinates ",e.coordinates.join(", ")]})]}),s.jsx(Vt,{currentPlanet:i.name,system:t,galaxy:e,systemPlanets:t.planets||[]}),s.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:s.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[s.jsx("div",{className:"order-1 lg:order-1",children:s.jsx(Xt,{planetUrl:o,imageUrl:n,planet:i,cosmicOriginTime:r,initialAngleRotation:l})}),s.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),s.jsx("div",{className:"order-2 lg:order-2",children:s.jsx(Kt,{planet:i,system:t,galaxy:e,cosmicOriginTime:r,initialAngleRotation:l})})]})}),s.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:s.jsx("button",{onClick:()=>window.location.href=`/system/${t.index}`,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:s.jsxs("span",{className:"text-base sm:text-lg",children:["← Back to System '",j(t.name),"'"]})})})]}),s.jsx(ot,{version:a})]}),s.jsx(ht,{currentLocation:{type:"planet",name:i.name,coordinates:e.coordinates.join(","),systemIndex:t.index,planetName:i.name}})]})};console.log("Atlas Planet React script loading...");document.addEventListener("DOMContentLoaded",async()=>{console.log("DOM loaded, starting Planet React app...");try{const i=document.getElementById("planet-data"),t=document.getElementById("system-data"),e=document.getElementById("galaxy-data"),o=document.getElementById("meta-data");if(!i||!t||!e||!o){console.error("Missing required data elements");return}const a=JSON.parse(i.textContent||"{}"),n=JSON.parse(t.textContent||"{}"),r=JSON.parse(e.textContent||"{}"),l=JSON.parse(o.textContent||"{}"),m={planet:a,system:n,galaxy:r,planet_url:l.planet_url,version:l.version,image_url:l.image_url,cosmic_origin_time:l.cosmic_origin_time,initial_angle_rotation:l.initial_angle_rotation},f=document.getElementById("atlas-react-root");f&&(at.createRoot(f).render(nt.createElement(qt,m)),console.log("Planet React app rendered successfully!"))}catch(i){console.error("Error initializing Planet React app:",i)}});
