import{r as n,j as e,a as Xe,c as et,R as tt}from"./atlas_C3xj8MG9oH9uC54MklkAb.js";import{R as st,L as nt,c as rt,d as at,S as Me,e as Pe,F as ot,H as it,a as lt}from"./atlas_Dd1oIz2vPimnyjaTh6Eli.js";import{W as Ie}from"./atlas_hV4YbJX4LmBeaYZmYRF0y.js";import{a2 as _e,C as Ge,a3 as Oe,G as $e,b as de,z as me,M as ue,V as Ne,B as Ve,W as We,n as Be,a8 as Ye,y as He,v as qe,cK as Ke,cL as Ze,I as ze}from"./atlas_BOOzg5XYrrU1N4SZySfRd.js";import{R as ct,S as dt,M as mt,a as Te,b as Ue,D as ut,T as ht}from"./atlas_B0b__4oaKLmjnmTXuLsj1.js";import{O as xt}from"./atlas_BJLzboHTaSIGvKgNbvLUr.js";import{a as pt,b as ft}from"./atlas_B_wkj_c15TKRW0LY7NgAy.js";import{V as gt}from"./atlas_DwvSdObFEIQcgn4zq5yYd.js";import"./atlas_C0q7_QgoBkw_1ECio0nFC.js";import"./atlas_wcPzamFt5CPpIcmd124GE.js";import"./atlas_DcFWk_8uQW5YiyxJyXm9Z.js";import"./atlas_CE2WK_Y-xuzINP7b3IpS3.js";import"./atlas_B-kptGVZDVdmtnkIZVh1u.js";import"./atlas_Bd8W2S8TCToc_TkfjBSRh.js";import"./atlas_BFuxIgjPmiYBRSaU6AzKX.js";import"./atlas_CH4XVS_nmu8TTUL6-ibC9.js";import"./atlas_XaDvYkrecyxhCh31P9DPo.js";import"./atlas_8smkL2kAlW8VsbqAp0E2n.js";import"./atlas_CjehN3jkco148tZZ8HqMi.js";import"./atlas_Dy-tlkqGLRE2Gl_vKG4xP.js";import"./atlas_D34u812Y6QAdJLe2a36BS.js";import"./atlas_BkcglrC3q9-fMfrzU8uke.js";import"./atlas_BMkCctBHLeH7Oacwp8KHY.js";import"./atlas_C92kSEtvzpygOQttG5_li.js";import"./atlas_B877x597f8C_bbJT6q9cw.js";import"./atlas_DAbZALnNf85bcXe1oVQnz.js";import"./atlas_DQBcmrKCsDOyRg5Jaj7Di.js";import"./atlas_Cm5pcYvuRuae8wLwYAuwz.js";import"./atlas_BRjO3l-9Uk0GXd99tH-yJ.js";import"./atlas_MCqKeA1rPM8tvcWERWIKQ.js";import"./atlas_DUeAOsmuB5IQYdEBY9tsy.js";import"./atlas_dAPGVvdiBoF3N71Jj1_R5.js";import"./atlas_e5uNz0v6NagohqMDG5OXg.js";import"./atlas_BO01S8JSEJPQBe1CeUH90.js";import"./atlas_DoGAVfLGhj19oLHZhptsG.js";import"./atlas_BTW9-VU5aCkr6W1y5CLfB.js";import"./atlas_D0-SfIZytUwPNEpr5qGyx.js";import"./atlas_P538xA28SIauNdsCb0ZYe.js";import"./atlas_CwupL9FClDwMIIJCaIsAX.js";import"./atlas_DY-bkmziKm4gSYWMvPahE.js";import"./atlas_By5tzXmHX4pj8fcpSexic.js";import"./atlas_3VRqq9jdnqdyWEklvEohb.js";import"./atlas_C8ykrCiAzITyq4ruXfKyg.js";import"./atlas_C2xUkmgG06MuKr4w07SbG.js";import"./atlas_DQrR5ctqeBlMvAnkpcJ3X.js";import"./atlas_BoXOdkgAKhVHQJiALu9rF.js";import"./atlas_qb-1r_R3caM5mPfGaf2Rh.js";import"./atlas_BCsVZ7wab0-olf8yw4pX9.js";import"./atlas_DbJYOiCroQ2VkDmDQ_fcP.js";import"./atlas_BTQdOeq3M2jF6mnM2ye_h.js";import"./atlas_B6cOxK1uXF_kRZ-THv-4m.js";import"./atlas_DpmY_YPo_wU0wdo7fOe9u.js";import"./atlas_DXaxYlG2vplsutHz8IC7A.js";import"./atlas_vfnLYY9OxNiRrcaEDklGk.js";import"./atlas_D4yQrit3qgZjHgPDw4i8o.js";import"./atlas_DJbw34qPG7dJ89663B1Zt.js";import"./atlas_QHr9Leq2IshRgis-ZHroK.js";import"./atlas_DnaLGJ954EOeDtbKHVyqk.js";import"./atlas_Ddl-3Pyb4NhSKcZ_QU3d6.js";import"./atlas_CPQnWwOf4six85153COyV.js";import"./atlas_DIajYqgJJlFIdWNB9l9vK.js";import"./atlas_DqkZSA4SKHSRE9_1MZZpu.js";import"./atlas_7nMzc3Dql9nxsSiWM62af.js";import"./atlas_CkL02Wqzuo1RtTjRZ4BLy.js";const Je=({planets:r,stars:l,systemName:f,cosmicOriginTime:T,currentTime:S,onTimeOffsetChange:k})=>{const P=n.useRef(null),N=n.useRef(null),d=n.useRef(null),$=n.useRef(null),z=n.useRef([]),M=n.useRef([]),m=n.useRef([]),V=n.useRef(0),Z=(R,q="#ffffff")=>{const L=document.createElement("canvas"),h=L.getContext("2d");if(!h)return null;L.width=768,L.height=192,h.fillStyle="rgba(0, 0, 0, 0.8)",h.fillRect(0,0,L.width,L.height),h.strokeStyle="#ffffff",h.lineWidth=3,h.strokeRect(3,3,L.width-6,L.height-6),h.fillStyle=q,h.font="bold 48px Arial",h.textAlign="center",h.textBaseline="middle",h.fillText(R,384,96);const u=new qe(L),I=new Ke({map:u,transparent:!0,alphaTest:.1}),W=new Ze(I);return W.scale.set(30,7.5,1),W};return V.current=S,n.useEffect(()=>{if(!P.current)return;const R=P.current,q=R.clientWidth,L=R.clientHeight,h=new _e;h.background=new Ge(17),N.current=h;const u=new Oe(60,q/L,.1,1e4);u.position.set(0,120,180),u.lookAt(0,0,0);const I=new Ie({antialias:!0,alpha:!0});I.setSize(q,L),I.setClearColor(17,1),d.current=I,R.appendChild(I.domElement);const W={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},he={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},_=new $e;l.forEach((t,a)=>{const b=parseFloat(t.Size)*4,y=new de(b,32,32),F=he[t.Color]||"#FFFF44",x=new me({color:F,transparent:!0,opacity:.9}),j=new ue(y,x);l.length===1?j.position.set(0,0,0):l.length===2?j.position.set(a===0?-b*2:b*2,0,0):a===0?j.position.set(-b*2,0,0):a===1?j.position.set(b*2,0,0):j.position.set(0,b*2,0);const Y=new de(b*1.5,32,32),X=new me({color:F,transparent:!0,opacity:.3}),A=new ue(Y,X);j.add(A),_.add(j)}),h.add(_);const xe=Math.max(...r.map(t=>t.orbital_radius)),w=150;r.forEach((t,a)=>{const y=30+t.orbital_radius/xe*w,F=t.eccentricity_factor,x=y,j=x*Math.sqrt(1-F*F),Y=360,X=2,A=4;for(let K=0;K<Y;K+=X+A){const D=[];for(let B=K;B<Math.min(K+X,Y-1);B++){const J=B/Y*2*Math.PI,te=x*Math.cos(J),je=j*Math.sin(J);D.push(new Ne(te,0,je))}if(D.length>1){const B=new Ve().setFromPoints(D),J=new We({color:7372944,transparent:!0,opacity:.8,linewidth:2}),te=new Be(B,J);h.add(te),M.current.push(te)}}const ne=t.diameter/8e3,C=Math.max(Math.min(ne,8),2.5),fe=new de(C,32,32),le=W[t.planet_type]||"#FFFFFF",s=new me({color:le,transparent:!0,opacity:.9}),i=new ue(fe,s),p=new ue(new de(C*1.5,32,32),new me({color:le,transparent:!0,opacity:.2}));i.add(p),h.add(i),z.current.push(i),i.planetData=t,i.orbitRadius=y,i.semiMajorAxis=x,i.semiMinorAxis=j;const H=t.name.replace(/_/g," "),U=Z(H,"#ffffff");U&&(U.position.copy(i.position),U.position.y+=C+10,U.planetData=t,h.add(U),m.current.push(U))});const ce=new Ye(4210752,.4);h.add(ce);const pe=new He(16777215,1,2e3);pe.position.set(0,0,0),h.add(pe);let re=!1,ie=0,ae=0,Q=0;const ve=t=>{re=!0,ie=t.clientX,ae=t.clientY},Fe=t=>{if(!re)return;const a=t.clientX-ie,b=t.clientY-ae,y=new ze;y.setFromVector3(u.position),y.theta-=a*.01,y.phi+=b*.01,y.phi=Math.max(.1,Math.min(Math.PI-.1,y.phi)),u.position.setFromSpherical(y),u.lookAt(0,0,0),ie=t.clientX,ae=t.clientY},v=()=>{re=!1,setTimeout(()=>{},3e3)},G=t=>{if(t.ctrlKey)t.preventDefault(),t.deltaY>0?k(604800):k(-604800);else{t.preventDefault();const a=.1,b=u.position.distanceTo(new Ne(0,0,0));t.deltaY>0&&b<800?u.position.multiplyScalar(1+a):t.deltaY<0&&b>50&&u.position.multiplyScalar(1-a)}},O=t=>{t.key==="Escape"&&document.dispatchEvent(new CustomEvent("solar-system-close-fullscreen"))},E=t=>{if(t.preventDefault(),t.touches.length===1)re=!0,ie=t.touches[0].clientX,ae=t.touches[0].clientY;else if(t.touches.length===2){const a=t.touches[0].clientX-t.touches[1].clientX,b=t.touches[0].clientY-t.touches[1].clientY;Q=Math.sqrt(a*a+b*b)}},o=t=>{if(t.preventDefault(),t.touches.length===1&&re){const a=t.touches[0].clientX-ie,b=t.touches[0].clientY-ae,y=new ze;y.setFromVector3(u.position),y.theta-=a*.01,y.phi+=b*.01,y.phi=Math.max(.1,Math.min(Math.PI-.1,y.phi)),u.position.setFromSpherical(y),u.lookAt(0,0,0),ie=t.touches[0].clientX,ae=t.touches[0].clientY}else if(t.touches.length===2){const a=t.touches[0].clientX-t.touches[1].clientX,b=t.touches[0].clientY-t.touches[1].clientY,y=Math.sqrt(a*a+b*b);if(Q>0){const x=y/Q,j=u.position.distanceTo(new Ne(0,0,0));x>1&&j>50?u.position.multiplyScalar(1-.01):x<1&&j<800&&u.position.multiplyScalar(1+.01)}Q=y}},g=t=>{t.preventDefault(),re=!1,Q=0,setTimeout(()=>{},3e3)},c=I.domElement;c.style.cursor="grab",c.addEventListener("mousedown",t=>{c.style.cursor="grabbing",ve(t)}),c.addEventListener("mousemove",Fe),c.addEventListener("mouseup",()=>{c.style.cursor="grab",v()}),c.addEventListener("mouseleave",()=>{c.style.cursor="grab",v()}),c.addEventListener("wheel",G),c.addEventListener("touchstart",E,{passive:!1}),c.addEventListener("touchmove",o,{passive:!1}),c.addEventListener("touchend",g,{passive:!1}),document.addEventListener("keydown",O);const oe=()=>{$.current=requestAnimationFrame(oe),z.current.forEach((t,a)=>{const b=t.planetData,y=t.semiMajorAxis,F=t.semiMinorAxis,x=b.orbital_period_seconds,j=2*Math.PI/x,Y=(b.initial_orbital_angle+V.current*j)%(2*Math.PI);t.position.x=y*Math.cos(Y),t.position.z=F*Math.sin(Y),t.position.y=0;const X=b.rotation_period_seconds,A=2*Math.PI/X;if(t.rotation.y=V.current*A%(2*Math.PI),m.current[a]){const ne=t.geometry.parameters?.radius||2;m.current[a].position.copy(t.position),m.current[a].position.y+=ne+10}}),I.render(h,u)};oe();const ee=()=>{const t=R.clientWidth,a=R.clientHeight;u.aspect=t/a,u.updateProjectionMatrix(),I.setSize(t,a)};return window.addEventListener("resize",ee),()=>{window.removeEventListener("resize",ee),document.removeEventListener("keydown",O),c.removeEventListener("mousedown",ve),c.removeEventListener("mousemove",Fe),c.removeEventListener("mouseup",v),c.removeEventListener("mouseleave",v),c.removeEventListener("wheel",G),c.removeEventListener("touchstart",E),c.removeEventListener("touchmove",o),c.removeEventListener("touchend",g),$.current&&cancelAnimationFrame($.current),R&&I.domElement&&R.removeChild(I.domElement),I.dispose(),z.current=[],M.current=[],m.current=[]}},[r,l,T]),e.jsx("div",{ref:P,className:"w-full h-full"})},bt=({planets:r,stars:l,systemName:f,cosmicOriginTime:T})=>{const S=n.useRef(null),k=n.useRef(null),P=n.useRef(null),N=n.useRef(null),d=n.useRef([]),$=n.useRef([]),z=n.useRef([]),M=n.useRef(0),m=Math.floor(Date.now()/1e3),[V,Z]=n.useState(0),[R,q]=n.useState(!1),[L,h]=n.useState(!1),[u,I]=n.useState(!1),[W,he]=n.useState(0),[_,xe]=n.useState(null),[w,ce]=n.useState(!0),[pe,re]=n.useState(null),ie=m-T+V;M.current=ie,n.useEffect(()=>{(async()=>{try{ce(!0),re(null);const G=await fetch("/api/system/rendering-data");if(!G.ok)throw new Error(`HTTP error! status: ${G.status}`);const O=await G.json();if(O.success)xe(O.system_data);else throw new Error(O.error||"Failed to fetch system data")}catch(G){re(G instanceof Error?G.message:"Unknown error")}finally{ce(!1)}})()},[]);const ae=()=>{h(!0),setTimeout(()=>{q(!1),h(!1)},300)},Q=(v,G="#ffffff")=>{const O=document.createElement("canvas"),E=O.getContext("2d");if(!E)return null;O.width=512,O.height=128,E.fillStyle="rgba(0, 0, 0, 0.7)",E.fillRect(0,0,O.width,O.height),E.strokeStyle="#ffffff",E.lineWidth=2,E.strokeRect(2,2,O.width-4,O.height-4),E.fillStyle=G,E.font="bold 32px Arial",E.textAlign="center",E.textBaseline="middle",E.fillText(v,256,64);const o=new qe(O),g=new Ke({map:o,transparent:!0,alphaTest:.1}),c=new Ze(g);return c.scale.set(20,5,1),c};n.useEffect(()=>{const v=G=>{G.key==="Escape"&&R&&ae()};return R&&he(V),document.addEventListener("solar-system-close-fullscreen",ae),document.addEventListener("keydown",v),()=>{document.removeEventListener("solar-system-close-fullscreen",ae),document.removeEventListener("keydown",v)}},[R,V]),n.useEffect(()=>{if(R&&u){const v=setTimeout(()=>{I(!1)},50);return()=>clearTimeout(v)}},[R,u]),n.useEffect(()=>{if(w||!_||(window.tonnirLoggedInSystem=!1,!S.current))return;const v=S.current,G=v.clientWidth,O=G<640,E=new _e;E.background=new Ge(17),k.current=E;const o=new Oe(45,G/(O?120:140),.1,1e4);o.position.set(0,80,120),o.lookAt(0,0,0);const g=new Ie({antialias:!0,alpha:!0});g.setSize(G,O?120:140),g.setClearColor(17,1),P.current=g,v.appendChild(g.domElement);const c={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},oe={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},ee=new $e;_.stars.forEach((s,i)=>{const p=parseFloat(s.Size)*3,H=new de(p,16,16),U=oe[s.Color]||"#FFFF44",K=new me({color:U,transparent:!0,opacity:.9}),D=new ue(H,K);_.stars.length===1?D.position.set(0,0,0):_.stars.length===2?D.position.set(i===0?-p*2:p*2,0,0):i===0?D.position.set(-p*2,0,0):i===1?D.position.set(p*2,0,0):D.position.set(0,p*2,0);const B=new de(p*1.5,16,16),J=new me({color:U,transparent:!0,opacity:.3}),te=new ue(B,J);D.add(te),ee.add(D)}),E.add(ee);const t=_.timing.max_orbital_radius,a=80;window.systemMaxOrbitalRadius=t,_.planets.forEach((s,i)=>{const H=20+s.orbital_radius/t*a,U=s.eccentricity_factor,K=H,D=K*Math.sqrt(1-U*U),B=360,J=2,te=4;for(let be=0;be<B;be+=J+te){const ye=[];for(let we=be;we<Math.min(be+J,B-1);we++){const Ce=we/B*2*Math.PI,Re=K*Math.cos(Ce),Qe=D*Math.sin(Ce);ye.push(new Ne(Re,0,Qe))}if(ye.length>1){const we=new Ve().setFromPoints(ye),Ce=new We({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Re=new Be(we,Ce);E.add(Re),$.current.push(Re)}}const je=s.diameter/15e3,Ee=Math.max(Math.min(je,4),1.5),Le=new de(Ee,16,16),ke=c[s.planet_type]||"#FFFFFF",De=new me({color:ke,transparent:!0,opacity:.9}),se=new ue(Le,De),Ae=new ue(new de(Ee*1.5,16,16),new me({color:ke,transparent:!0,opacity:.2}));se.add(Ae),E.add(se),d.current.push(se),se.planetData=s,se.orbitRadius=H,se.semiMajorAxis=K,se.semiMinorAxis=D;const Se=s.name.replace(/_/g," "),ge=Q(Se,"#ffffff");ge&&(ge.position.copy(se.position),ge.position.y+=Ee+6,ge.planetData=s,E.add(ge),z.current.push(ge))});const b=new Ye(4210752,.4);E.add(b);const y=new He(16777215,1,1e3);y.position.set(0,0,0),E.add(y);let F=!1,x=0,j=0;const Y=s=>{F=!0,x=s.clientX,j=s.clientY},X=s=>{if(!F)return;const i=s.clientX-x,p=s.clientY-j,H=new ze;H.setFromVector3(o.position),H.theta-=i*.01,H.phi+=p*.01,H.phi=Math.max(.1,Math.min(Math.PI-.1,H.phi)),o.position.setFromSpherical(H),o.lookAt(0,0,0),x=s.clientX,j=s.clientY},A=()=>{F=!1,setTimeout(()=>{},3e3)},ne=s=>{if(s.ctrlKey)s.preventDefault(),s.deltaY>0?Z(i=>i+604800):Z(i=>i-604800);else{s.preventDefault();const i=.1,p=o.position.distanceTo(new Ne(0,0,0));s.deltaY>0&&p<500?o.position.multiplyScalar(1+i):s.deltaY<0&&p>20&&o.position.multiplyScalar(1-i)}},C=g.domElement;C.style.cursor="grab",C.style.borderRadius="8px",C.addEventListener("mousedown",s=>{C.style.cursor="grabbing",Y(s)}),C.addEventListener("mousemove",X),C.addEventListener("mouseup",()=>{C.style.cursor="grab",A()}),C.addEventListener("mouseleave",()=>{C.style.cursor="grab",A()}),C.addEventListener("wheel",ne);const fe=()=>{N.current=requestAnimationFrame(fe),d.current.forEach((s,i)=>{const p=s.planetData,H=s.semiMajorAxis,U=s.semiMinorAxis,K=p.orbital_period_seconds,D=2*Math.PI/K,B=(p.initial_orbital_angle+M.current*D)%(2*Math.PI);s.position.x=H*Math.cos(B),s.position.z=U*Math.sin(B),s.position.y=0;const J=p.rotation_period_seconds,te=2*Math.PI/J;if(s.rotation.y=M.current*te%(2*Math.PI),z.current[i]){const je=s.geometry.parameters?.radius||2;z.current[i].position.copy(s.position),z.current[i].position.y+=je+6}}),g.render(E,o)};fe();const le=()=>{const s=v.clientWidth,i=s<640?120:140;o.aspect=s/i,o.updateProjectionMatrix(),g.setSize(s,i)};return window.addEventListener("resize",le),()=>{window.removeEventListener("resize",le),C.removeEventListener("mousedown",Y),C.removeEventListener("mousemove",X),C.removeEventListener("mouseup",A),C.removeEventListener("mouseleave",A),C.removeEventListener("wheel",ne),N.current&&cancelAnimationFrame(N.current),v&&g.domElement&&v.removeChild(g.domElement),g.dispose(),d.current=[],$.current=[],z.current=[]}},[r,l,T,_]);const ve=v=>{const G=Math.floor(v/31557600),O=Math.floor(v%(365.25*24*3600)/(24*3600)),E=Math.floor(v%(24*3600)/3600);return G>0?`${G}y ${O}d ${E}h`:O>0?`${O}d ${E}h`:`${E}h`},Fe=v=>v.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Solar System Perspective"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{ref:S,className:"w-full border border-white/20 rounded bg-black/20",style:{height:"auto"}}),!w&&!pe&&f&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:f})}),e.jsx("button",{onClick:()=>{q(!0),I(!0)},className:"absolute top-2 right-2 p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg z-10",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-[10px]",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-[10px]",children:[_?.planets?.length||r.length," Planets"]})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Time: ",ve(ie)]})]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View"})]})]}),R&&Xe.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${L||u?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${L||u?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:Fe(f)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:Fe(f)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[_?.planets?.length||r.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",ve(m-T+W)]})]})]}),e.jsx("button",{onClick:ae,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:W,onChange:v=>he(Number(v.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>he(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",W===0?"Present":W>0?`+${Math.abs(W/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(W/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Je,{planets:_?.planets||r,stars:_?.stars||l,systemName:f,cosmicOriginTime:T,currentTime:m-T+W,onTimeOffsetChange:v=>he(G=>G+v)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},wt=({system:r,galaxy:l,systemIndex:f,cosmicOriginTime:T})=>{const[S,k]=n.useState({isOnCooldown:!1,isSaved:!1,isCollecting:!1,timeUntilNext:0});n.useEffect(()=>{let N;const d=()=>{const m=Te.generateLocationId("system",l.coordinates.join(","),f,void 0),V=Te.canCollectFromLocation(m),Z=Te.getTimeUntilNextCollection(m),R=l.coordinates,q=Ue.generateSystemUrl(R,f,Ue.getCurrentPage()),h=nt.getLocations().some(u=>u.stargateUrl===q);k(u=>({isOnCooldown:!V&&Z>0,isSaved:h,isCollecting:u.isCollecting,timeUntilNext:Z}))},$=()=>{k(m=>({...m,isCollecting:!0})),N=setTimeout(()=>{k(m=>({...m,isCollecting:!1}))},1e3)};d();const z=setInterval(d,1e3),M=st.subscribe("mining_completed",$);return()=>{clearInterval(z),N&&clearTimeout(N),M()}},[r.name,f,l.coordinates]);const P=N=>N.replace(/_/g," ");return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[e.jsx(ct,{locationType:"system",locationId:r.name,coordinates:l.coordinates.join(","),systemIndex:f,className:"text-xs"}),e.jsx(dt,{type:"system",name:r.name,coordinates:l.coordinates.join(","),systemIndex:f,className:"text-xs"}),e.jsx("div",{className:"inline-flex items-center bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] font-medium px-1.5 py-0.5 rounded h-[21px] box-border",children:"VISITED"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(mt,{isOnCooldown:S.isOnCooldown,isSaved:S.isSaved,isCollecting:S.isCollecting}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Details"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"System Type"}),e.jsx("div",{className:"text-sm font-bold text-blue-300 capitalize",children:r.star_system_type})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Planets"}),e.jsx("div",{className:"text-sm font-bold text-purple-300",children:r.num_planets})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-orange-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Stars"}),e.jsx("div",{className:"text-sm font-bold text-orange-300",children:r.stars.length})]})]}),e.jsx("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-3",children:e.jsx(bt,{planets:r.planets,stars:r.stars,systemName:r.name,cosmicOriginTime:T})}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-yellow-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Stellar Composition"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1",children:r.stars.map((N,d)=>e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-yellow-500/20",children:[e.jsxs("div",{className:"text-xs text-gray-300",children:["Star ",d+1]}),e.jsx("div",{className:"text-xs font-bold text-yellow-300",children:N.Type}),e.jsxs("div",{className:"text-xs text-gray-300",children:[N.Color," • ",N.Size]})]},d))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System:"}),e.jsx("div",{className:"text-white truncate font-medium",children:P(r.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System ID:"}),e.jsxs("div",{className:"text-white font-medium",children:["#",f+1]})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),e.jsx("div",{className:"text-white truncate font-medium",children:P(l.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),e.jsx("div",{className:"text-white font-medium",children:l.coordinates.join(", ")})]})]})]})]})},vt=({planets:r,stars:l,systemName:f,cosmicOriginTime:T})=>{const S=n.useRef(null),k=n.useRef(null),P=n.useRef(null),N=n.useRef(null),d=n.useRef([]),$=n.useRef([]),z=n.useRef([]),M=n.useRef(null),m=n.useRef(0),V=n.useRef(null),Z=Math.floor(Date.now()/1e3),[R,q]=n.useState(0),[L,h]=n.useState(!1),[u,I]=n.useState(!1),[W,he]=n.useState(!1),[_,xe]=n.useState(0),[w,ce]=n.useState(null),[pe,re]=n.useState(!0),[ie,ae]=n.useState(null),[Q,ve]=n.useState(!1),Fe=Z-T+R;m.current=Fe,n.useEffect(()=>{(async()=>{try{re(!0),ae(null);const g=await fetch("/api/system/rendering-data");if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);const c=await g.json();if(c.success)ce(c.system_data);else throw new Error(c.error||"Failed to fetch system data")}catch(g){ae(g instanceof Error?g.message:"Unknown error")}finally{re(!1)}})()},[]);const v=()=>{I(!0),setTimeout(()=>{h(!1),I(!1)},300)};n.useEffect(()=>{const o=g=>{g.key==="Escape"&&L&&v()};return L&&xe(R),document.addEventListener("solar-system-close-fullscreen",v),document.addEventListener("keydown",o),()=>{document.removeEventListener("solar-system-close-fullscreen",v),document.removeEventListener("keydown",o)}},[L,R]),n.useEffect(()=>{if(L&&W){const o=setTimeout(()=>{he(!1)},50);return()=>clearTimeout(o)}},[L,W]),n.useEffect(()=>{if(pe||!w||(window.tonnirLoggedInSystem=!1,!S.current))return;const o=S.current,g=o.clientWidth,c=o.clientHeight,oe=Math.min(g,c),ee=new _e;ee.background=new Ge(17),k.current=ee;const t=new Oe(45,1,.1,1e4);t.position.set(0,300,0),t.lookAt(0,0,0),V.current=t;const a=new Ie({antialias:!0,alpha:!0});a.setSize(oe,oe),a.setClearColor(17,1),P.current=a,a.domElement.className="transition-all duration-300",o.appendChild(a.domElement);const b={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},y={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},F=new $e;w.stars.forEach((s,i)=>{const p=parseFloat(s.Size)*3,H=new de(p,16,16),U=y[s.Color]||"#FFFF44",K=new me({color:U,transparent:!0,opacity:.9}),D=new ue(H,K);w.stars.length===1?D.position.set(0,0,0):w.stars.length===2?D.position.set(i===0?-p*2:p*2,0,0):i===0?D.position.set(-p*2,0,0):i===1?D.position.set(p*2,0,0):D.position.set(0,p*2,0);const B=new de(p*1.5,16,16),J=new me({color:U,transparent:!0,opacity:.3}),te=new ue(B,J);D.add(te),F.add(D)}),ee.add(F);const x=w.timing.max_orbital_radius,j=80;window.systemMaxOrbitalRadius=x,w.planets.forEach((s,i)=>{const H=20+s.orbital_radius/x*j,U=s.eccentricity_factor,K=H,D=K*Math.sqrt(1-U*U),B=360,J=2,te=4;for(let Se=0;Se<B;Se+=J+te){const ge=[];for(let be=Se;be<Math.min(Se+J,B-1);be++){const ye=be/B*2*Math.PI,we=K*Math.cos(ye),Ce=D*Math.sin(ye);ge.push(new Ne(we,0,Ce))}if(ge.length>1){const be=new Ve().setFromPoints(ge),ye=new We({color:7372944,transparent:!0,opacity:.8,linewidth:2}),we=new Be(be,ye);ee.add(we),$.current.push(we)}}const je=s.diameter/15e3,Ee=Math.max(Math.min(je,4),1.5),Le=new de(Ee,16,16),ke=b[s.planet_type]||"#FFFFFF",De=new me({color:ke,transparent:!0,opacity:.9}),se=new ue(Le,De),Ae=new ue(new de(Ee*1.5,16,16),new me({color:ke,transparent:!0,opacity:.2}));se.add(Ae),ee.add(se),d.current.push(se),se.planetData=s,se.orbitRadius=H,se.semiMajorAxis=K,se.semiMinorAxis=D,z.current.push(null)});const Y=new Ye(4210752,.4);ee.add(Y);const X=new He(16777215,1,1e3);X.position.set(0,0,0),ee.add(X);const A=new xt(t,a.domElement);A.enableDamping=!0,A.dampingFactor=.05,A.minDistance=50,A.maxDistance=800,A.autoRotate=!1,A.autoRotateSpeed=.5,A.enablePan=!0,A.enableZoom=!0,A.target.set(0,0,0),M.current=A;const ne=s=>{if(s.ctrlKey)s.preventDefault(),s.deltaY>0?q(i=>i+604800):q(i=>i-604800);else{s.preventDefault();const i=.1,p=t.position.distanceTo(new Ne(0,0,0));s.deltaY>0&&p<500?t.position.multiplyScalar(1+i):s.deltaY<0&&p>20&&t.position.multiplyScalar(1-i)}},C=a.domElement;C.style.borderRadius="8px",C.addEventListener("wheel",ne);const fe=()=>{N.current=requestAnimationFrame(fe),d.current.forEach((s,i)=>{const p=s.planetData,H=s.semiMajorAxis,U=s.semiMinorAxis,K=p.orbital_period_seconds,D=2*Math.PI/K,B=(p.initial_orbital_angle+m.current*D)%(2*Math.PI);s.position.x=H*Math.cos(B),s.position.z=U*Math.sin(B),s.position.y=0;const J=p.rotation_period_seconds,te=2*Math.PI/J;s.rotation.y=m.current*te%(2*Math.PI)}),M.current&&M.current.update(),a.render(ee,t)};fe();const le=()=>{if(!S.current||!a)return;const s=S.current,i=Math.min(s.clientWidth,s.clientHeight);a.setSize(i,i),t.aspect=1,t.updateProjectionMatrix()};return window.addEventListener("resize",le),()=>{window.removeEventListener("resize",le),C.removeEventListener("wheel",ne),M.current&&M.current.dispose(),N.current&&cancelAnimationFrame(N.current),o&&a.domElement&&o.removeChild(a.domElement),a.dispose(),d.current=[],$.current=[],z.current=[]}},[r,l,T,w,R]);const G=()=>{if(!P.current||!k.current||!V.current||Q)return;ve(!0),P.current.domElement&&(P.current.domElement.style.filter="blur(15px)"),M.current&&(M.current.enabled=!1);const o=P.current,g=k.current,c=V.current,oe=o.domElement.width,ee=o.domElement.height,t=3840/oe,a=[];g.traverse(F=>{if(F.isPoints&&F.material){const x=F.material;if(x.size!==void 0&&(a.push({material:x,originalSize:x.size}),x.size=x.size*t*1),F.geometry&&F.geometry.attributes.size){const j=F.geometry.attributes.size,Y=j.array.slice();a.push({geometry:F.geometry,originalSizeArray:Y});for(let X=0;X<j.array.length;X++)j.array[X]*=t*1;j.needsUpdate=!0}}if(F.isSprite&&(a.push({object:F,originalScale:F.scale.clone()}),F.scale.multiplyScalar(t*1)),F.isLine&&F.material){const x=F.material;x.linewidth!==void 0&&(a.push({material:x,originalLinewidth:x.linewidth}),x.linewidth=x.linewidth*t*1)}});const b=3840,y=3840;o.setSize(b,y),c.aspect=1,c.updateProjectionMatrix(),o.render(g,c),o.domElement.toBlob(F=>{if(F){const x=document.createElement("canvas"),j=x.getContext("2d");if(x.width=b,x.height=y,j){const Y=new Image;Y.onload=async()=>{j.drawImage(Y,0,0),pt(j,{imageWidth:b,imageHeight:y}),await ft(j,b,y,window.location.href),x.toBlob(A=>{if(A){const ne=URL.createObjectURL(A),C=document.createElement("a");C.href=ne,C.download=`system_${f}_${Date.now()}.png`,C.click(),URL.revokeObjectURL(ne)}},"image/png",1)};const X=URL.createObjectURL(F);Y.src=X}}a.forEach(({material:x,object:j,originalSize:Y,originalScale:X,originalLinewidth:A,geometry:ne,originalSizeArray:C})=>{if(Y!==void 0&&(x.size=Y),X!==void 0&&j.scale.copy(X),A!==void 0&&(x.linewidth=A),ne&&C){const fe=ne.attributes.size;for(let le=0;le<C.length;le++)fe.array[le]=C[le];fe.needsUpdate=!0}}),o.setSize(oe,ee),c.aspect=1,c.updateProjectionMatrix(),P.current?.domElement&&(P.current.domElement.style.filter="none"),M.current&&(M.current.enabled=!0),ve(!1)},"image/png",1)},O=o=>{const g=Math.floor(o/31557600),c=Math.floor(o%(365.25*24*3600)/(24*3600)),oe=Math.floor(o%(24*3600)/3600);return g>0?`${g}y ${c}d ${oe}h`:c>0?`${c}d ${oe}h`:`${oe}h`},E=o=>o.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center w-full h-full",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{ref:S,className:"w-full h-full border border-white/20 rounded bg-black/20"}),!pe&&!ie&&f&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:E(f)})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 z-10",children:[e.jsx("button",{onClick:G,disabled:Q,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${Q?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:Q?"Generating image...":"Download screenshot",children:Q?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(ut,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>{Q||(h(!0),he(!0))},disabled:Q,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${Q?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:Q?"Please wait...":"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})]})}),L&&Xe.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${u||W?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${u||W?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:E(f)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:E(f)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[w?.planets?.length||r.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",O(Z-T+_)]})]})]}),e.jsx("button",{onClick:v,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:_,onChange:o=>xe(Number(o.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>xe(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",_===0?"Present":_>0?`+${Math.abs(_/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(_/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Je,{planets:w?.planets||r,stars:w?.stars||l,systemName:f,cosmicOriginTime:T,currentTime:Z-T+_,onTimeOffsetChange:o=>xe(g=>g+o)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},yt=({systemUrl:r,system:l,cosmicOriginTime:f})=>{const T=n.useRef(null),[S,k]=n.useState("Aligning Stargate..."),[P,N]=n.useState(!1),[d,$]=n.useState(!1),[z,M]=n.useState(!1);return n.useEffect(()=>{const m=T.current;if(!m)return;const V=m.getContext("2d");if(!V)return;let Z=[];const R=800;let q,L;const h=800;let u,I=.5;function W(){const w=m?.parentElement;if(!w||!m)return;const ce=w.clientWidth,pe=w.clientHeight;m.width=Math.min(ce,h),m.height=Math.min(pe,h),q=m.width/2,L=m.height/2}function he(){W(),Z=[];for(let w=0;w<R;w++)Z.push({x:Math.random()*(m?.width||800),y:Math.random()*(m?.height||800),z:Math.random()*(m?.width||800),o:Math.random()});_()}function _(){!m||!V||(V.clearRect(0,0,m.width,m.height),Z.forEach(w=>{w.z-=I,w.z<=0&&(w.z=m.width,w.x=Math.random()*m.width,w.y=Math.random()*m.height,w.o=Math.random());const ce=m.width/w.z,pe=(w.x-q)*ce+q,re=(w.y-L)*ce+L,ie=2*ce;V.beginPath(),V.fillStyle=`rgba(255, 255, 255, ${w.o})`,V.arc(pe,re,ie,0,2*Math.PI),V.fill()}),I<60&&(I+=1),u=requestAnimationFrame(_))}he();const xe=()=>W();return window.addEventListener("resize",xe),()=>{window.removeEventListener("resize",xe),u&&cancelAnimationFrame(u)}},[]),n.useEffect(()=>{$(!0),setTimeout(()=>{M(!0)},800)},[]),n.useEffect(()=>{if(sessionStorage.getItem("stargateAnimationShown")){k("Stargate system aligned");return}sessionStorage.setItem("stargateAnimationShown","true"),N(!0);const V=(h,u)=>Array.from({length:u},()=>h[Math.floor(Math.random()*h.length)]).join(""),Z=[{chars:"01",duration:40,iterations:20},{chars:"0123456789",duration:25,iterations:30},{chars:"0123456789ABCDEF",duration:20,iterations:40},{chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}|;:\\'\",.<>?/`~",duration:10,iterations:100}];let R=0,q=0;const L=()=>{if(R>=Z.length){const u="Stargate system aligned";let I=0;k("");const W=()=>{I<u.length?(k(u.substring(0,I+1)),I++,setTimeout(W,30)):N(!1)};W();return}const h=Z[R];k(V(h.chars,32)),q++,q>=h.iterations&&(R++,q=0),setTimeout(L,h.duration)};L()},[]),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h3",{className:"text-sm font-medium text-white",children:l?.name||"System"})}),e.jsxs("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:[e.jsx("canvas",{ref:T,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${z?"opacity-0":"opacity-100"}`,style:{filter:z?"blur(50px)":"none"}}),d&&l&&e.jsx("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${d&&z?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:e.jsx(vt,{planets:l.planets,stars:l.stars,systemName:l.name,cosmicOriginTime:f||0})})]}),e.jsxs("div",{className:"text-center mt-auto",children:[e.jsxs("a",{href:r,className:`inline-block px-4 py-2 bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 text-gray-200 font-medium text-sm rounded-lg border border-slate-600 hover:border-slate-500 shadow-md hover:shadow-lg transition-all duration-300 relative overflow-hidden group ${P?"animate-pulse":""}`,style:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("span",{className:"relative z-10 font-mono flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6s.792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95a1 1 0 001.715 1.029zM8.5 10a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM10 14c-.304 0-.792-.193-1.264-.979a1 1 0 00-1.715 1.029C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 00-1.715-1.029C10.792 13.807 10.304 14 10 14z",clipRule:"evenodd"})}),S]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-slate-600/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]})]})},Ft=({planets:r,coordinates:l,systemIndex:f})=>{const[T,S]=n.useState(new Set),k=d=>({"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"})[d]||"#FFFFFF";n.useEffect(()=>{(()=>{try{const $=rt(l,f,r),z=new Set;$.forEach(M=>{z.add(M.toLowerCase())}),S(z)}catch{}})()},[l,f,r]);const P=d=>d.replace(/_/g," "),N=d=>{try{at(l,f,d,r)}catch{}window.location.href=`/planet/${d.toLowerCase()}`};return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3",children:r.map(d=>e.jsxs("div",{className:"relative bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 hover:border-white/40 transition-all duration-300 group overflow-hidden",children:[T.has(d.name.toLowerCase())&&e.jsx("div",{className:"absolute top-1 right-1 bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] px-1.5 py-0.5 rounded z-10",children:"VISITED"}),e.jsx("div",{className:"absolute -top-3 -left-3 w-8 h-8 rounded-full border border-white/40 shadow-sm z-20 animate-pulse",style:{backgroundColor:k(d.planet_type)}}),e.jsxs("button",{onClick:()=>N(d.name),className:"w-full text-left block p-2 sm:p-3 text-gray-200 hover:text-white transition-colors duration-300 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Planet"}),e.jsx("div",{className:"text-sm font-semibold text-white truncate group-hover:text-blue-300 transition-colors duration-300",children:P(d.name)})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]},d.name))}),r.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No planets found"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This system appears to be empty"})]})]})},jt=({currentSystem:r,galaxy:l})=>{const[f,T]=n.useState(!1),[S,k]=n.useState(!1),[P,N]=n.useState(!0);n.useEffect(()=>{T(r.index>0),k(!0),N(!1)},[r.index]);const d=async()=>{if(r.index>0){if(!Me.canAffordTravel("system",1)){Me.executeTravel("system",1);return}if(!Me.executeTravel("system",1))return;const M=l.coordinates.join(",");Pe(M,r.index-1),window.location.href=`/system/${r.index-1}`}},$=async()=>{if(!Me.canAffordTravel("system",1)){Me.executeTravel("system",1);return}if(!Me.executeTravel("system",1))return;const M=l.coordinates.join(",");Pe(M,r.index+1),window.location.href=`/system/${r.index+1}`};return P?null:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:d,disabled:!f,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${f?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:$,disabled:!S,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${S?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})},Nt=({system:r,galaxy:l,system_url:f,version:T,system_index:S,image_url:k,page:P,cosmic_origin_time:N})=>{const[d]=n.useState(l.coordinates.join(","));n.useEffect(()=>{document.body.setAttribute("data-coordinates",d),document.body.setAttribute("data-system-index",S.toString()),Pe(d,S)},[d,S]);const $=M=>M.replace(/_/g," "),z=M=>M.replace(/_/g," ");return e.jsxs("div",{className:"w-full h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white overflow-auto",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(ot,{}),e.jsxs("div",{className:"relative z-10 pt-1",children:[e.jsx(it,{}),e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["System '",$(r.name),"'"]}),e.jsxs("p",{className:"text-lg sm:text-xl text-gray-300",children:["at Galaxy '",z(l.name),"' - Coordinates ",l.coordinates.join(", ")]})]}),e.jsx(jt,{currentSystem:{name:r.name,index:S},galaxy:l}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[e.jsx("div",{className:"order-1 lg:order-1",children:e.jsx(yt,{systemUrl:f,system:r,cosmicOriginTime:N})}),e.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),e.jsx("div",{className:"order-2 lg:order-2",children:e.jsx(wt,{system:r,galaxy:l,systemIndex:S,cosmicOriginTime:N})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:["Planets in '",$(r.name),"'"]}),e.jsx(Ft,{planets:r.planets,coordinates:d,systemIndex:S})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${P}`,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:e.jsxs("span",{className:"text-base sm:text-lg",children:["← Back to Galaxy '",z(l.name),"'"]})})})]}),e.jsx(gt,{version:T})]}),e.jsx(ht,{}),e.jsx(lt,{currentLocation:{type:"system",name:r.name,coordinates:l.coordinates.join(","),systemIndex:r.index}})]})};document.addEventListener("DOMContentLoaded",async()=>{try{const r=document.getElementById("system-data"),l=document.getElementById("galaxy-data"),f=document.getElementById("meta-data");if(!r||!l||!f)return;const T=JSON.parse(r.textContent||"{}"),S=JSON.parse(l.textContent||"{}"),k=JSON.parse(f.textContent||"{}"),P={system:T,galaxy:S,system_url:k.system_url,version:k.version,system_index:k.system_index,image_url:k.image_url,page:k.page||1,cosmic_origin_time:k.cosmic_origin_time},N=document.getElementById("atlas-react-root");N&&et.createRoot(N).render(tt.createElement(Nt,P))}catch{}});
