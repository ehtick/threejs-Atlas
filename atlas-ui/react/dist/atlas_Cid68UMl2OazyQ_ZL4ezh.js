import{S as ct}from"./atlas_BlTNaWGHZ8zx8h3TIfddO.js";import{G as mt,C as V,V as g,B as pt,p as st,r as yt,k as at,s as gt,t as wt,M as rt,u as xt,l as vt}from"./atlas_Xs9BLEnnn6iCcADsGARg5.js";class it{landGroup;lands=[];constructor(e,o={}){this.landGroup=new mt;const n=o.seed||Math.floor(Math.random()*1e6),a=new ct(n);o.greenPatches&&o.greenPatches.length>0?this.generateLandsFromPython(e,o.greenPatches,a,o):this.generateProceduralLands(e,a,o)}generateLandsFromPython(e,o,n,a){o.forEach((c,b)=>{let d=c.position_3d||c.position||[0,0,1];if(d.length===2){const t=n.uniform(0,Math.PI*2),s=Math.acos(n.uniform(-1,1));d=[Math.sin(s)*Math.cos(t),Math.sin(s)*Math.sin(t),Math.cos(s)]}const h=(c.size||.1)*e*1.8;Math.max(8,Math.min(c.sides||20,12));let m=new V(4881497),w=1;c.color&&Array.isArray(c.color)&&(m=new V(c.color[0],c.color[1],c.color[2]),c.color.length>3&&(w=c.color[3]));const M=Math.max(24,Math.min(64,Math.floor(h*32))),f=new g(d[0],d[1],d[2]).normalize(),S=new g,W=new g;Math.abs(f.y)<.99?S.crossVectors(f,new g(0,1,0)).normalize():S.crossVectors(f,new g(1,0,0)).normalize(),W.crossVectors(f,S).normalize();const _=2/Math.max(h*.05,1),q=(t,s)=>{let i=0,r=1,l=_,u=0;const N=Math.min(5,Math.max(3,Math.floor(h/40)+2));for(let F=0;F<N;F++){const I=t*l,A=s*l,y=(P,ft)=>{const Mt=P*12.9898+ft*78.233;return Math.sin(Mt+n.uniform(0,1e3))*43758.5453%1},x=Math.floor(I),G=Math.floor(A),Y=I-x,Z=A-G,R=P=>P*P*P*(P*(P*6-15)+10),v=R(Y),U=R(Z),H=y(x,G),J=y(x+1,G),nt=y(x,G+1),O=y(x+1,G+1),D=H*(1-v)+J*v,ht=nt*(1-v)+O*v,ut=D*(1-U)+ht*U;i+=ut*r,u+=r,r*=.5,l*=2.2}return i/u},$=[],X=[],K=[],lt=.35,L=new Map,dt=new Map;let Q=0;for(let t=0;t<=M;t++)for(let s=0;s<=M;s++){const i=(t/M-.5)*2,r=(s/M-.5)*2,l=Math.sqrt(i*i+r*r),u=q(i*2,r*2);if(1-l*.5+u*.6>lt&&l<1.2){const F=i*h,I=r*h,y=new g().addScaledVector(S,F).addScaledVector(W,I).addScaledVector(f,0);$.push(y.x,y.y,y.z),K.push((i+1)*.5,(r+1)*.5),L.set(`${t},${s}`,Q),dt.set(`${t},${s}`,u),Q++}}for(let t=0;t<M;t++)for(let s=0;s<M;s++){const i=L.get(`${t},${s}`),r=L.get(`${t+1},${s}`),l=L.get(`${t},${s+1}`),u=L.get(`${t+1},${s+1}`);i!==void 0&&r!==void 0&&l!==void 0&&X.push(i,r,l),r!==void 0&&u!==void 0&&l!==void 0&&X.push(r,u,l)}const p=new pt;p.setAttribute("position",new st($,3)),p.setAttribute("uv",new st(K,2)),p.setIndex(X),p.computeVertexNormals();const B=p.attributes.position,T=f.clone().multiplyScalar(e),tt=new g;for(let t=0;t<B.count;t++){tt.fromBufferAttribute(B,t);const i=tt.clone().add(T).clone().normalize(),r=p.attributes.uv;if(r){const l=r.getX(t)*2-1,u=r.getY(t)*2-1,N=Math.sqrt(l*l+u*u),F=q(l*2,u*2),A=Math.max(0,1-Math.pow(N,.7))*.5+F*.5,x=(D=>D*D*(3-2*D))(A),Y=e*1.01-e,Z=h*.15,R=Math.min(Z,Y*.9),v=e*.008,U=e+v,H=e+v+R,J=yt.lerp(U,H,x),O=i.multiplyScalar(J).sub(T);B.setXYZ(t,O.x,O.y,O.z)}}B.needsUpdate=!0,p.computeVertexNormals(),p.translate(T.x,T.y,T.z);const et=new at({color:a.transparentMode?new V(15135743):m,opacity:a.transparentMode?.3:w,transparent:a.transparentMode||w<1,emissive:a.transparentMode?new V(13428479).multiplyScalar(.1):m.clone().multiplyScalar(.05),emissiveIntensity:a.transparentMode?.05:1e-7,shininess:a.transparentMode?30:8,flatShading:!1,bumpScale:.002,depthWrite:!0,depthTest:!0,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}),E=document.createElement("canvas");E.width=E.height=64;const ot=E.getContext("2d"),z=ot.createImageData(64,64);for(let t=0;t<z.data.length;t+=4){const s=n.uniform(.8,1.2),i=Math.floor(128*s);z.data[t]=i,z.data[t+1]=i,z.data[t+2]=i,z.data[t+3]=255}ot.putImageData(z,0,0);const k=new gt(E);k.wrapS=k.wrapT=wt,k.repeat.set(2,2),et.bumpMap=k;const C=new rt(p,et);C.castShadow=!0,C.receiveShadow=!0,C.renderOrder=1,this.lands.push(C),this.landGroup.add(C)})}generateProceduralLands(e,o,n){const a=Math.floor(o.uniform(5,15));for(let c=0;c<a;c++){const b=o.uniform(0,Math.PI*2),d=Math.acos(o.uniform(-1,1)),h=new g(Math.sin(d)*Math.cos(b),Math.sin(d)*Math.sin(b),Math.cos(d)),m=e*o.uniform(.02,.08),w=new xt(m,16),M=h.clone().multiplyScalar(e*1.002);w.lookAt(h),w.translate(M.x,M.y,M.z);const f=o.uniform(.3,.7),S=new V(.36*(1-f)+.22*f,.23*(1-f)+.36*f,0),_=n.tundraMode||!1?.25:1,q=new at({color:n.transparentMode?new V(15135743):S,opacity:n.transparentMode?.3:_,transparent:n.transparentMode||_<1,emissive:n.transparentMode?new V(13428479).multiplyScalar(.1):657920,shininess:n.transparentMode?30:5,depthWrite:!0,depthTest:!0}),$=new rt(w,q);$.renderOrder=1,this.lands.push($),this.landGroup.add($)}}addToScene(e,o){o&&this.landGroup.position.copy(o),e.add(this.landGroup)}update(e){}getObject3D(){return this.landGroup}dispose(){this.lands.forEach(e=>{e.geometry.dispose(),e.material instanceof vt&&e.material.dispose()}),this.lands=[],this.landGroup.clear()}}function bt(j,e,o){const n=e.green_patches;if(!n||n.length===0)return null;const a=o||Math.floor(Math.random()*1e6);return new it(j,{greenPatches:n,seed:a+6e3})}function St(j,e,o){const n=o||Math.floor(Math.random()*1e6),a=new ct(n+7e3),c=Math.floor(a.uniform(3,8)),b=[];for(let d=0;d<c;d++){const h=a.uniform(0,Math.PI*2),m=Math.acos(a.uniform(-1,1));b.push({position_3d:[Math.sin(m)*Math.cos(h),Math.sin(m)*Math.sin(h),Math.cos(m)],size:a.uniform(.05,.15),sides:Math.floor(a.uniform(8,16)),color:[0,0,0]})}return console.log(`ðŸ§Š Creating ${c} transparent ice formations for Icy planet with seed ${n+7e3}`),new it(j,{greenPatches:b,seed:n+7e3,transparentMode:!0})}export{it as L,St as a,bt as c};
