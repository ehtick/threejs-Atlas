import{a as pt,g as ft,r as b,j as a,R as p}from"./atlas_DVrnBBsgS-kH5xseABxRO.js";var vt=pt();const wt=ft(vt);class E{static STORAGE_KEY="_atlasLocations";static MAX_LOCATIONS=50;static getLocations(){try{const t=localStorage.getItem(this.STORAGE_KEY);if(!t)return[];const e=JSON.parse(t);return Array.isArray(e)?e:[]}catch(t){return console.error("Error reading saved locations:",t),[]}}static saveLocation(t){try{const e=this.getLocations(),s=e.findIndex(i=>i.stargateUrl===t.stargateUrl),o={...t,id:this.generateId(),timestamp:Date.now()};s!==-1?(e[s]=o,console.log("📍 Updated saved location:",t.name)):(e.push(o),console.log("📍 Saved new location:",t.name)),e.length>this.MAX_LOCATIONS&&(e.sort((i,c)=>c.timestamp-i.timestamp),e.splice(this.MAX_LOCATIONS)),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e))}catch(e){console.error("Error saving location:",e)}}static removeLocation(t){try{const s=this.getLocations().filter(o=>o.id!==t);localStorage.setItem(this.STORAGE_KEY,JSON.stringify(s)),console.log("🗑️ Removed saved location")}catch(e){console.error("Error removing location:",e)}}static clearAllLocations(){try{localStorage.removeItem(this.STORAGE_KEY),console.log("🗑️ Cleared all saved locations")}catch(t){console.error("Error clearing locations:",t)}}static generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static getLocationStats(){const t=this.getLocations();return{total:t.length,galaxies:t.filter(e=>e.type==="galaxy").length,systems:t.filter(e=>e.type==="system").length,planets:t.filter(e=>e.type==="planet").length}}}class T{static encodeUrl(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_")}static generateGalaxyUrl(t,e=1){const s=`coordinates=${t[0]},${t[1]},${t[2]}&page=${e}`,o=this.encodeUrl(s);return`${window.location.origin}/stargate/${o}`}static generateSystemUrl(t,e,s=1){const o=`coordinates=${t[0]},${t[1]},${t[2]}&system=${e}&page=${s}`,i=this.encodeUrl(o);return`${window.location.origin}/stargate/${i}`}static generatePlanetUrl(t,e,s,o=1){const i=`coordinates=${t[0]},${t[1]},${t[2]}&system=${e}&planet=${s.toLowerCase()}&page=${o}`,c=this.encodeUrl(i);return`${window.location.origin}/stargate/${c}`}static getCurrentPage(){try{const e=new URLSearchParams(window.location.search).get("page");if(e)return parseInt(e,10);const s=window.location.pathname.match(/\/galaxy\/(\d+)/);return s?parseInt(s[1],10):1}catch{return 1}}}const kt=({type:n,name:t,coordinates:e,systemIndex:s,planetName:o,className:i=""})=>{const[c,h]=b.useState(!1),[l,r]=b.useState(!1),m=()=>{try{const u=e.split(",").map(Number),d=T.getCurrentPage();switch(n){case"galaxy":return T.generateGalaxyUrl(u,d);case"system":if(s!==void 0)return T.generateSystemUrl(u,s,d);break;case"planet":if(s!==void 0&&o)return T.generatePlanetUrl(u,s,o,d);break}return window.location.pathname}catch(u){return console.error("Error generating stargate URL:",u),window.location.pathname}};b.useEffect(()=>{const u=E.getLocations(),d=m(),w=u.some(f=>f.stargateUrl===d);h(w)},[e,s,o,n]);const v=async()=>{r(!0);try{const u=m();E.saveLocation({name:t,type:n,stargateUrl:u}),h(!0),setTimeout(()=>{r(!1)},300)}catch(u){console.error("Error saving location:",u),r(!1)}},g=u=>u.replace(/_/g," ");return a.jsx(a.Fragment,{children:a.jsx("button",{onClick:v,disabled:c||l,className:`inline-flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-200 text-sm font-medium ${c?"bg-green-500/20 border border-green-500/50 text-green-400 cursor-default":l?"bg-blue-500/20 border border-blue-500/50 text-blue-400 cursor-wait":"bg-white/10 hover:bg-white/20 border border-white/20 hover:border-white/40 text-white hover:text-blue-300"} ${i}`,title:c?"Location saved":`Save ${g(t)} to bookmarks`,children:l?a.jsxs(a.Fragment,{children:[a.jsxs("svg",{className:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a.jsx("span",{children:"Saving..."})]}):c?a.jsxs(a.Fragment,{children:[a.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})}),a.jsx("span",{children:"Saved"})]}):a.jsxs(a.Fragment,{children:[a.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),a.jsx("span",{children:"Save Location"})]})})})};function xt(){return p.createElement("svg",{"aria-hidden":"true","data-rmiz-btn-unzoom-icon":!0,fill:"currentColor",focusable:"false",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},p.createElement("path",{d:"M 14.144531 1.148438 L 9 6.292969 L 9 3 L 8 3 L 8 8 L 13 8 L 13 7 L 9.707031 7 L 14.855469 1.851563 Z M 8 8 L 3 8 L 3 9 L 6.292969 9 L 1.148438 14.144531 L 1.851563 14.855469 L 7 9.707031 L 7 13 L 8 13 Z"}))}function yt(){return p.createElement("svg",{"aria-hidden":"true","data-rmiz-btn-zoom-icon":!0,fill:"currentColor",focusable:"false",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg"},p.createElement("path",{d:"M 9 1 L 9 2 L 12.292969 2 L 2 12.292969 L 2 9 L 1 9 L 1 14 L 6 14 L 6 13 L 2.707031 13 L 13 2.707031 L 13 6 L 14 6 L 14 1 Z"}))}const U=(n,t)=>n===t?.tagName?.toUpperCase?.(),P=n=>U("DIV",n)||U("SPAN",n),R=n=>U("IMG",n),J=n=>n.complete&&n.naturalHeight!==0,k=n=>U("SVG",n),H=({height:n,offset:t,width:e})=>Math.min((window.innerWidth-t*2)/e,(window.innerHeight-t*2)/n),bt=({containerHeight:n,containerWidth:t,offset:e,targetHeight:s,targetWidth:o})=>{const i=H({height:s,offset:e,width:o}),c=o>s?o/t:s/n;return i>1?c:i*c},N=({containerHeight:n,containerWidth:t,hasScalableSrc:e,offset:s,targetHeight:o,targetWidth:i})=>!n||!t?1:!e&&o&&i?bt({containerHeight:n,containerWidth:t,offset:s,targetHeight:o,targetWidth:i}):H({height:n,offset:s,width:t}),St=/url(?:\(['"]?)(.*?)(?:['"]?\))/,Q=n=>{if(n){if(R(n))return n.currentSrc;if(P(n)){const t=window.getComputedStyle(n).backgroundImage;if(t)return St.exec(t)?.[1]}}},Lt=n=>{if(n)return R(n)?n.alt??void 0:n.getAttribute("aria-label")??void 0},Et=({containerHeight:n,containerLeft:t,containerTop:e,containerWidth:s,hasScalableSrc:o,offset:i,targetHeight:c,targetWidth:h})=>{const l=N({containerHeight:n,containerWidth:s,hasScalableSrc:o,offset:i,targetHeight:c,targetWidth:h});return{top:e,left:t,width:s*l,height:n*l,transform:`translate(0,0) scale(${1/l})`}},y=({position:n,relativeNum:t})=>{const e=parseFloat(n);return n.endsWith("%")?t*e/100:e},Nt=({containerHeight:n,containerLeft:t,containerTop:e,containerWidth:s,hasScalableSrc:o,objectFit:i,objectPosition:c,offset:h,targetHeight:l,targetWidth:r})=>{if(i==="scale-down"&&(r<=s&&l<=n?i="none":i="contain"),i==="cover"||i==="contain"){const m=s/r,v=n/l,g=i==="cover"?Math.max(m,v):Math.min(m,v),[u="50%",d="50%"]=c.split(" "),w=y({position:u,relativeNum:s-r*g}),f=y({position:d,relativeNum:n-l*g}),x=N({containerHeight:l*g,containerWidth:r*g,hasScalableSrc:o,offset:h,targetHeight:l,targetWidth:r});return{top:e+f,left:t+w,width:r*g*x,height:l*g*x,transform:`translate(0,0) scale(${1/x})`}}else if(i==="none"){const[m="50%",v="50%"]=c.split(" "),g=y({position:m,relativeNum:s-r}),u=y({position:v,relativeNum:n-l}),d=N({containerHeight:l,containerWidth:r,hasScalableSrc:o,offset:h,targetHeight:l,targetWidth:r});return{top:e+u,left:t+g,width:r*d,height:l*d,transform:`translate(0,0) scale(${1/d})`}}else if(i==="fill"){const m=s/r,v=n/l,g=Math.max(m,v),u=N({containerHeight:l*g,containerWidth:r*g,hasScalableSrc:o,offset:h,targetHeight:l,targetWidth:r});return{width:s*u,height:n*u,transform:`translate(0,0) scale(${1/u})`}}else return{}},It=({backgroundPosition:n,backgroundSize:t,containerHeight:e,containerLeft:s,containerTop:o,containerWidth:i,hasScalableSrc:c,offset:h,targetHeight:l,targetWidth:r})=>{if(t==="cover"||t==="contain"){const m=i/r,v=e/l,g=t==="cover"?Math.max(m,v):Math.min(m,v),[u="50%",d="50%"]=n.split(" "),w=y({position:u,relativeNum:i-r*g}),f=y({position:d,relativeNum:e-l*g}),x=N({containerHeight:l*g,containerWidth:r*g,hasScalableSrc:c,offset:h,targetHeight:l,targetWidth:r});return{top:o+f,left:s+w,width:r*g*x,height:l*g*x,transform:`translate(0,0) scale(${1/x})`}}else if(t==="auto"){const[m="50%",v="50%"]=n.split(" "),g=y({position:m,relativeNum:i-r}),u=y({position:v,relativeNum:e-l}),d=N({containerHeight:l,containerWidth:r,hasScalableSrc:c,offset:h,targetHeight:l,targetWidth:r});return{top:o+u,left:s+g,width:r*d,height:l*d,transform:`translate(0,0) scale(${1/d})`}}else{const[m="50%",v="50%"]=t.split(" "),g=y({position:m,relativeNum:i}),u=y({position:v,relativeNum:e}),d=g/r,w=u/l,f=Math.min(d,w),[x="50%",D="50%"]=n.split(" "),j=y({position:x,relativeNum:i-r*f}),z=y({position:D,relativeNum:e-l*f}),S=N({containerHeight:l*f,containerWidth:r*f,hasScalableSrc:c,offset:h,targetHeight:l,targetWidth:r});return{top:o+z,left:s+j,width:r*f*S,height:l*f*S,transform:`translate(0,0) scale(${1/S})`}}},Ct=/\.svg$/i,Dt=({hasZoomImg:n,imgSrc:t,isSvg:e,isZoomed:s,loadedImgEl:o,offset:i,shouldRefresh:c,targetEl:h})=>{const l=e||t?.slice?.(0,18)==="data:image/svg+xml"||n||!!(t&&Ct.test(t)),r=h.getBoundingClientRect(),m=window.getComputedStyle(h),v=o!=null&&P(h),g=o!=null&&!v,u=Et({containerHeight:r.height,containerLeft:r.left,containerTop:r.top,containerWidth:r.width,hasScalableSrc:l,offset:i,targetHeight:o?.naturalHeight||r.height,targetWidth:o?.naturalWidth||r.width}),d=g?Nt({containerHeight:r.height,containerLeft:r.left,containerTop:r.top,containerWidth:r.width,hasScalableSrc:l,objectFit:m.objectFit,objectPosition:m.objectPosition,offset:i,targetHeight:o?.naturalHeight||r.height,targetWidth:o?.naturalWidth||r.width}):void 0,w=v?It({backgroundPosition:m.backgroundPosition,backgroundSize:m.backgroundSize,containerHeight:r.height,containerLeft:r.left,containerTop:r.top,containerWidth:r.width,hasScalableSrc:l,offset:i,targetHeight:o?.naturalHeight||r.height,targetWidth:o?.naturalWidth||r.width}):void 0,f=Object.assign({},u,d,w);if(s){const x=window.innerWidth/2,D=window.innerHeight/2,j=parseFloat(String(f.left||0))+parseFloat(String(f.width||0))/2,z=parseFloat(String(f.top||0))+parseFloat(String(f.height||0))/2,S=x-j,M=D-z;c&&(f.transitionDuration="0.01ms"),f.transform=`translate(${S}px,${M}px) scale(1)`}return f},G=n=>{if(!n)return{};if(k(n)){const t=n.parentElement,e=n.getBoundingClientRect();if(t){const s=t.getBoundingClientRect();return{height:e.height,left:s.left-e.left,top:s.top-e.top,width:e.width}}else return{height:e.height,left:e.left,width:e.width,top:e.top}}else return{height:n.offsetHeight,left:n.offsetLeft,width:n.offsetWidth,top:n.offsetTop}},jt=n=>{const t="-zoom",e=["clip-path","fill","mask","marker-start","marker-mid","marker-end"],s=new Map;if(n.hasAttribute("id")){const o=n.id,i=o+t;s.set(o,i),n.id=i}n.querySelectorAll("[id]").forEach(o=>{const i=o.id,c=i+t;s.set(i,c),o.id=c}),s.forEach((o,i)=>{const c=`url(#${i})`,h=`url(#${o})`,l=e.map(r=>`[${r}="${c}"]`).join(", ");n.querySelectorAll(l).forEach(r=>{e.forEach(m=>{r.getAttribute(m)===c&&r.setAttribute(m,h)})})}),n.querySelectorAll("style").forEach(o=>{s.forEach((i,c)=>{o.textContent&&(o.textContent=o.textContent.replaceAll(`#${c}`,`#${i}`))})})},zt=["img","svg",'[role="img"]',"[data-zoom]"].map(n=>`${n}:not([aria-hidden="true"])`).join(","),W={overflow:"",width:""};function At(n){return p.createElement(tt,{...n})}class tt extends p.Component{constructor(){super(...arguments),this.state={id:"",isZoomImgLoaded:!1,loadedImgEl:void 0,modalState:"UNLOADED",shouldRefresh:!1,styleGhost:{}},this.refContent=p.createRef(),this.refDialog=p.createRef(),this.refModalContent=p.createRef(),this.refModalImg=p.createRef(),this.refWrap=p.createRef(),this.imgEl=null,this.isScaling=!1,this.prevBodyAttrs=W,this.styleModalImg={},this.handleModalStateChange=t=>{const{modalState:e}=this.state;t!=="LOADING"&&e==="LOADING"?(this.loadZoomImg(),window.addEventListener("resize",this.handleResize,{passive:!0}),window.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),window.addEventListener("touchmove",this.handleTouchMove,{passive:!0}),window.addEventListener("touchend",this.handleTouchEnd,{passive:!0}),window.addEventListener("touchcancel",this.handleTouchCancel,{passive:!0}),document.addEventListener("keydown",this.handleKeyDown,!0)):t!=="LOADED"&&e==="LOADED"?window.addEventListener("wheel",this.handleWheel,{passive:!0}):t!=="UNLOADING"&&e==="UNLOADING"?(this.ensureImgTransitionEnd(),window.removeEventListener("wheel",this.handleWheel),window.removeEventListener("touchstart",this.handleTouchStart),window.removeEventListener("touchmove",this.handleTouchMove),window.removeEventListener("touchend",this.handleTouchEnd),window.removeEventListener("touchcancel",this.handleTouchCancel),document.removeEventListener("keydown",this.handleKeyDown,!0)):t!=="UNLOADED"&&e==="UNLOADED"&&(this.bodyScrollEnable(),window.removeEventListener("resize",this.handleResize),this.refModalImg.current?.removeEventListener?.("transitionend",this.handleImgTransitionEnd),this.refDialog.current?.close?.())},this.getDialogContainer=()=>{let t=document.querySelector("[data-rmiz-portal]");return t==null&&(t=document.createElement("div"),t.setAttribute("data-rmiz-portal",""),document.body.appendChild(t)),t},this.setId=()=>{const t=()=>Math.random().toString(16).slice(-4);this.setState({id:t()+t()+t()})},this.setAndTrackImg=()=>{const t=this.refContent.current;t&&(this.imgEl=t.querySelector(zt),this.imgEl?(this.contentNotFoundChangeObserver?.disconnect?.(),this.imgEl.addEventListener("load",this.handleImgLoad),this.imgEl.addEventListener("click",this.handleZoom),this.state.loadedImgEl||this.handleImgLoad(),this.imgElResizeObserver=new ResizeObserver(e=>{const s=e[0];s?.target&&(this.imgEl=s.target,this.setState({styleGhost:G(this.imgEl)}))}),this.imgElResizeObserver.observe(this.imgEl),this.contentChangeObserver||(this.contentChangeObserver=new MutationObserver(()=>{this.setState({styleGhost:G(this.imgEl)})}),this.contentChangeObserver.observe(t,{attributes:!0,childList:!0,subtree:!0}))):this.contentNotFoundChangeObserver||(this.contentNotFoundChangeObserver=new MutationObserver(this.setAndTrackImg),this.contentNotFoundChangeObserver.observe(t,{childList:!0,subtree:!0})))},this.handleIfZoomChanged=t=>{const{isZoomed:e}=this.props;!t&&e?this.zoom():t&&!e&&this.unzoom()},this.handleImgLoad=()=>{const t=Q(this.imgEl);if(!t)return;const e=new Image;R(this.imgEl)&&(e.sizes=this.imgEl.sizes,e.srcset=this.imgEl.srcset,e.crossOrigin=this.imgEl.crossOrigin),e.src=t;const s=()=>{this.setState({loadedImgEl:e,styleGhost:G(this.imgEl)})};e.decode().then(s).catch(()=>{if(J(e)){s();return}e.onload=s})},this.handleZoom=()=>{!this.props.isDisabled&&this.hasImage()&&this.props.onZoomChange?.(!0)},this.handleUnzoom=()=>{this.props.isDisabled||this.props.onZoomChange?.(!1)},this.handleBtnUnzoomClick=t=>{t.preventDefault(),t.stopPropagation(),this.handleUnzoom()},this.handleDialogCancel=t=>{t.preventDefault()},this.handleDialogClick=t=>{(t.target===this.refModalContent.current||t.target===this.refModalImg.current)&&(t.stopPropagation(),this.handleUnzoom())},this.handleDialogClose=t=>{t.stopPropagation(),this.handleUnzoom()},this.handleKeyDown=t=>{(t.key==="Escape"||t.keyCode===27)&&(t.preventDefault(),t.stopPropagation(),this.handleUnzoom())},this.handleWheel=t=>{t.ctrlKey||(t.stopPropagation(),queueMicrotask(()=>{this.handleUnzoom()}))},this.handleTouchStart=t=>{if(t.touches.length>1){this.isScaling=!0;return}t.changedTouches.length===1&&t.changedTouches[0]&&(this.touchYStart=t.changedTouches[0].screenY)},this.handleTouchMove=t=>{const e=window.visualViewport?.scale??1;if(this.props.canSwipeToUnzoom&&!this.isScaling&&e<=1&&this.touchYStart!=null&&t.changedTouches[0]){this.touchYEnd=t.changedTouches[0].screenY;const s=Math.max(this.touchYStart,this.touchYEnd),o=Math.min(this.touchYStart,this.touchYEnd);Math.abs(s-o)>this.props.swipeToUnzoomThreshold&&(this.touchYStart=void 0,this.touchYEnd=void 0,this.handleUnzoom())}},this.handleTouchEnd=()=>{this.isScaling=!1,this.touchYStart=void 0,this.touchYEnd=void 0},this.handleTouchCancel=()=>{this.isScaling=!1,this.touchYStart=void 0,this.touchYEnd=void 0},this.handleResize=()=>{this.setState({shouldRefresh:!0})},this.hasImage=()=>this.imgEl&&(this.state.loadedImgEl||k(this.imgEl))&&window.getComputedStyle(this.imgEl).display!=="none",this.zoom=()=>{this.bodyScrollDisable(),this.refDialog.current?.showModal?.(),this.refModalImg.current?.addEventListener?.("transitionend",this.handleImgTransitionEnd),this.setState({modalState:"LOADING"})},this.unzoom=()=>{this.setState({modalState:"UNLOADING"})},this.handleImgTransitionEnd=()=>{clearTimeout(this.timeoutTransitionEnd),this.state.modalState==="LOADING"?this.setState({modalState:"LOADED"}):this.state.modalState==="UNLOADING"&&this.setState({shouldRefresh:!1,modalState:"UNLOADED"})},this.ensureImgTransitionEnd=()=>{if(this.refModalImg.current){const t=window.getComputedStyle(this.refModalImg.current).transitionDuration,e=parseFloat(t);if(e){const s=e*(t.endsWith("ms")?1:1e3)+50;this.timeoutTransitionEnd=setTimeout(this.handleImgTransitionEnd,s)}}},this.bodyScrollDisable=()=>{this.prevBodyAttrs={overflow:document.body.style.overflow,width:document.body.style.width};const t=document.body.clientWidth;document.body.style.overflow="hidden",document.body.style.width=`${t}px`},this.bodyScrollEnable=()=>{document.body.style.width=this.prevBodyAttrs.width,document.body.style.overflow=this.prevBodyAttrs.overflow,this.prevBodyAttrs=W},this.loadZoomImg=()=>{const{props:{zoomImg:t}}=this,e=t?.src;if(e){const s=new Image;s.sizes=t?.sizes??"",s.srcset=t?.srcSet??"",s.crossOrigin=t?.crossOrigin??void 0,s.src=e;const o=()=>{this.setState({isZoomImgLoaded:!0})};s.decode().then(o).catch(()=>{if(J(s)){o();return}s.onload=o})}},this.UNSAFE_handleSvg=()=>{const{imgEl:t,refModalImg:e,styleModalImg:s}=this;if(k(t)){const o=t.cloneNode(!0);jt(o),o.style.width=`${s.width||0}px`,o.style.height=`${s.height||0}px`,o.addEventListener("click",this.handleUnzoom),e.current?.firstChild?.remove?.(),e.current?.appendChild?.(o)}}}render(){const{handleBtnUnzoomClick:t,handleDialogCancel:e,handleDialogClick:s,handleDialogClose:o,handleUnzoom:i,handleZoom:c,imgEl:h,props:{a11yNameButtonUnzoom:l,a11yNameButtonZoom:r,children:m,classDialog:v,IconUnzoom:g,IconZoom:u,isZoomed:d,wrapElement:w,ZoomContent:f,zoomImg:x,zoomMargin:D},refContent:j,refDialog:z,refModalContent:S,refModalImg:M,refWrap:et,state:{id:B,isZoomImgLoaded:Y,loadedImgEl:st,modalState:L,shouldRefresh:ot,styleGhost:nt}}=this,_=`rmiz-modal-${B}`,Z=`rmiz-modal-img-${B}`,at=P(h),O=R(h),F=k(h),$=Lt(h),V=Q(h),it=O?h.sizes:void 0,rt=O?h.srcset:void 0,lt=O?h.crossOrigin:void 0,ct=!!x?.src,A=this.hasImage(),dt=$?`${r}: ${$}`:r,ht=L==="LOADING"||L==="LOADED",mt=A?"found":"not-found",ut=L==="UNLOADED"||L==="UNLOADING"?"hidden":"visible",gt={visibility:L==="UNLOADED"?"visible":"hidden"};this.styleModalImg=A?Dt({hasZoomImg:ct,imgSrc:V,isSvg:F,isZoomed:d&&ht,loadedImgEl:st,offset:D,shouldRefresh:ot,targetEl:h}):{};let K=null;if(A){const X=O||at?p.createElement("img",{alt:$,crossOrigin:lt,sizes:it,src:V,srcSet:rt,...Y&&L==="LOADED"?x:{},"data-rmiz-modal-img":"",height:this.styleModalImg.height||void 0,id:Z,ref:M,style:this.styleModalImg,width:this.styleModalImg.width||void 0}):F?p.createElement("div",{"data-rmiz-modal-img":!0,ref:M,style:this.styleModalImg}):null,q=p.createElement("button",{"aria-label":l,"data-rmiz-btn-unzoom":"",onClick:t,type:"button"},p.createElement(g,null));K=f?p.createElement(f,{buttonUnzoom:q,modalState:L,img:X,isZoomImgLoaded:Y,onUnzoom:i}):p.createElement(p.Fragment,null,X,q)}return p.createElement(w,{"aria-owns":_,"data-rmiz":"",ref:et},p.createElement(w,{"data-rmiz-content":mt,ref:j,style:gt},m),A&&p.createElement(w,{"data-rmiz-ghost":"",style:nt},p.createElement("button",{"aria-label":dt,"data-rmiz-btn-zoom":"",onClick:c,type:"button"},p.createElement(u,null))),A&&wt.createPortal(p.createElement("dialog",{"aria-labelledby":Z,"aria-modal":"true",className:v,"data-rmiz-modal":"",id:_,onClick:s,onClose:o,onCancel:e,ref:z,role:"dialog"},p.createElement("div",{"data-rmiz-modal-overlay":ut}),p.createElement("div",{"data-rmiz-modal-content":"",ref:S},K)),this.getDialogContainer()))}componentDidMount(){this.setId(),this.setAndTrackImg(),this.handleImgLoad(),this.UNSAFE_handleSvg()}componentWillUnmount(){this.state.modalState!=="UNLOADED"&&this.bodyScrollEnable(),this.contentChangeObserver?.disconnect?.(),this.contentNotFoundChangeObserver?.disconnect?.(),this.imgElResizeObserver?.disconnect?.(),this.imgEl?.removeEventListener?.("load",this.handleImgLoad),this.imgEl?.removeEventListener?.("click",this.handleZoom),this.refModalImg.current?.removeEventListener?.("transitionend",this.handleImgTransitionEnd),window.removeEventListener("wheel",this.handleWheel),window.removeEventListener("touchstart",this.handleTouchStart),window.removeEventListener("touchmove",this.handleTouchMove),window.removeEventListener("touchend",this.handleTouchEnd),window.removeEventListener("touchcancel",this.handleTouchCancel),window.removeEventListener("resize",this.handleResize),document.removeEventListener("keydown",this.handleKeyDown,!0)}componentDidUpdate(t,e){this.handleModalStateChange(e.modalState),this.UNSAFE_handleSvg(),this.handleIfZoomChanged(t.isZoomed)}}tt.defaultProps={a11yNameButtonUnzoom:"Minimize image",a11yNameButtonZoom:"Expand image",canSwipeToUnzoom:!0,IconUnzoom:xt,IconZoom:yt,isDisabled:!1,swipeToUnzoomThreshold:10,wrapElement:"div",zoomMargin:0};function Ut(n){const[t,e]=p.useState(!1);return p.createElement(At,{...n,isZoomed:t,onZoomChange:e})}const I=n=>{const[t,e,s]=n.split(",").map(Number);return`${t.toString(36)}_${e.toString(36)}_${s.toString(36)}`};class C{static STORAGE_KEY="__atlasArchive";static MAX_ENTRIES_PER_GALAXY=1e3;static getData(){try{this.cleanupLegacyStorage();const t=localStorage.getItem(this.STORAGE_KEY);return t?JSON.parse(t):{g:{}}}catch(t){return console.error("Error reading Atlas archive:",t),{g:{}}}}static cleanupLegacyStorage(){try{const t="atlasHistoricalData";localStorage.getItem(t)&&(localStorage.removeItem(t),console.log("🧹 Cleaned up legacy storage (atlasHistoricalData)"))}catch(t){console.error("Error cleaning up legacy storage:",t)}}static saveData(t){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(e){console.error("Error saving Atlas archive:",e)}}static performCleanup(t){const e=Object.keys(t.g);if(e.length>100){const s=e.slice(0,e.length-100);s.forEach(o=>delete t.g[o]),console.log(`🧹 Cleaned up ${s.length} old galaxy records`)}Object.keys(t.g).forEach(s=>{const o=t.g[s],i=Object.keys(o);i.length>this.MAX_ENTRIES_PER_GALAXY&&i.slice(0,i.length-this.MAX_ENTRIES_PER_GALAXY).forEach(h=>delete o[h])})}static performEmergencyCleanup(){const t=document.body.getAttribute("data-coordinates");if(t){const e=I(t),s=this.getData(),o=s.g[e];s.g={},o&&(s.g[e]=o),this.saveData(s),console.log("🚨 Emergency cleanup: kept only current galaxy data")}}static markPlanetVisited(t,e,s,o){const i=this.getData(),c=I(t),h=e.toString(16),l=o.findIndex(m=>m.name.toLowerCase()===s.toLowerCase());if(l===-1){console.warn(`Planet ${s} not found in system planets list`);return}i.g[c]||(i.g[c]={}),i.g[c][h]||(i.g[c][h]="");const r=this.bitmapToIndices(i.g[c][h]);r.includes(l)||(r.push(l),i.g[c][h]=this.indicesToBitmap(r),this.saveData(i),console.log(`✅ Marked planet '${s}' as visited (index: ${l})`))}static markSystemVisited(t,e){const s=this.getData(),o=I(t),i=e.toString(16);s.g[o]||(s.g[o]={}),s.g[o][i]||(s.g[o][i]="",this.saveData(s),console.log(`✅ Marked system ${e} as visited`))}static bitmapToIndices(t){return t?t.split("").map((e,s)=>e==="1"?s:-1).filter(e=>e!==-1):[]}static indicesToBitmap(t){if(t.length===0)return"";const e=Math.max(...t),s=Array(e+1).fill("0");return t.forEach(o=>{o>=0&&(s[o]="1")}),s.join("")}static isSystemVisited(t,e){const s=this.getData(),o=I(t),i=e.toString(16);return!!(s.g[o]&&i in s.g[o])}static getVisitedPlanets(t,e,s){const o=this.getData(),i=I(t),c=e.toString(16),h=o.g[i]?.[c]||"";return this.bitmapToIndices(h).map(r=>{const m=s[r];return m?m.name.toLowerCase():null}).filter(r=>r!==null)}static getVisitedPlanetCount(t,e){const s=this.getData(),o=I(t),i=e.toString(16),c=s.g[o]?.[i]||"";return this.bitmapToIndices(c).length}static getStorageStats(){const t=this.getData(),e=JSON.stringify(t);let s=0,o=0;return Object.values(t.g).forEach(i=>{s+=Object.keys(i).length,Object.values(i).forEach(c=>{o+=c.length})}),{size:e.length,galaxies:Object.keys(t.g).length,systems:s,planets:o}}}const Rt=(n,t,e,s)=>{C.markPlanetVisited(n,t,e,s)},$t=(n,t)=>{C.markSystemVisited(n,t)},Gt=(n,t,e)=>C.getVisitedPlanets(n,t,e),Mt=(n,t)=>C.isSystemVisited(n,t),Pt=(n,t,e,s)=>{if(!Mt(n,t))return"none";{const o=C.getVisitedPlanetCount(n,t);return o>=e&&e>0?"complete":(o>0,"partial")}},Ot=()=>C.getStorageStats(),Bt=({currentLocation:n})=>{const[t,e]=b.useState(!1),[s,o]=b.useState("stats"),[i,c]=b.useState(null),[h,l]=b.useState([]),[r,m]=b.useState(null);b.useEffect(()=>{t&&(c(Ot()),l(E.getLocations()),m(E.getLocationStats()))},[t]);const v=d=>{if(d===0)return"0 B";const w=1024,f=["B","KB","MB"],x=Math.floor(Math.log(d)/Math.log(w));return parseFloat((d/Math.pow(w,x)).toFixed(2))+" "+f[x]},g=d=>d.replace(/_/g," "),u=(d,w)=>{d.stopPropagation(),E.removeLocation(w),l(E.getLocations()),m(E.getLocationStats())};return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:a.jsxs("button",{onClick:()=>e(!t),className:"w-14 h-14 bg-gradient-to-br from-blue-600 via-purple-600 to-blue-800 hover:from-blue-500 hover:via-purple-500 hover:to-blue-700 text-white rounded-full shadow-2xl border-2 border-blue-400/30 transition-all duration-300 transform hover:scale-105 backdrop-blur-sm",title:"Spaceship Control Panel",children:[a.jsx("div",{className:"flex items-center justify-center",children:a.jsx("svg",{className:"w-7 h-7",fill:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{d:"M12 2L8 7h3v10a1 1 0 001 1h2a1 1 0 001-1V7h3l-4-5zM6 13.5V16a4 4 0 004 4h4a4 4 0 004-4v-2.5l-2 1.5v1a2 2 0 01-2 2h-4a2 2 0 01-2-2v-1l-2-1.5z"})})}),a.jsx("div",{className:"absolute inset-0 rounded-full bg-blue-400/20 animate-ping"})]})}),t&&a.jsxs("div",{className:"fixed bottom-24 right-6 w-96 max-h-96 bg-black/90 backdrop-blur-xl rounded-2xl border border-blue-400/30 shadow-2xl z-40 overflow-hidden",children:[a.jsxs("div",{className:"bg-gradient-to-r from-blue-600/20 to-purple-600/20 p-4 border-b border-white/10",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse"}),a.jsx("h3",{className:"text-white font-bold text-lg",children:"🚀 Ship Control"})]}),a.jsx("button",{onClick:()=>e(!1),className:"text-gray-400 hover:text-white transition-colors duration-200",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsxs("div",{className:"flex mt-3 space-x-1",children:[a.jsx("button",{onClick:()=>o("stats"),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors duration-200 ${s==="stats"?"bg-blue-500/30 text-blue-300 border border-blue-500/50":"text-gray-400 hover:text-white hover:bg-white/10"}`,children:"📊 Statistics"}),a.jsxs("button",{onClick:()=>o("locations"),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors duration-200 ${s==="locations"?"bg-purple-500/30 text-purple-300 border border-purple-500/50":"text-gray-400 hover:text-white hover:bg-white/10"}`,children:["📍 Saved Locations (",r?.total||0,")"]})]})]}),a.jsxs("div",{className:"p-4 max-h-64 overflow-y-auto",children:[s==="stats"&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-white font-semibold mb-2 text-sm",children:"🌌 Exploration Progress"}),a.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[a.jsxs("div",{className:"bg-white/5 rounded-lg p-2 border border-blue-500/20",children:[a.jsx("div",{className:"text-gray-400",children:"Galaxies"}),a.jsx("div",{className:"text-blue-400 font-bold",children:i?.galaxies||0})]}),a.jsxs("div",{className:"bg-white/5 rounded-lg p-2 border border-purple-500/20",children:[a.jsx("div",{className:"text-gray-400",children:"Systems"}),a.jsx("div",{className:"text-purple-400 font-bold",children:i?.systems||0})]}),a.jsxs("div",{className:"bg-white/5 rounded-lg p-2 border border-cyan-500/20",children:[a.jsx("div",{className:"text-gray-400",children:"Planets"}),a.jsx("div",{className:"text-cyan-400 font-bold",children:i?.planets||0})]}),a.jsxs("div",{className:"bg-white/5 rounded-lg p-2 border border-green-500/20",children:[a.jsx("div",{className:"text-gray-400",children:"Archive Size"}),a.jsx("div",{className:"text-green-400 font-bold",children:i?v(i.size):"0 B"})]})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-white font-semibold mb-2 text-sm",children:"📍 Saved Locations"}),a.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:r&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"bg-white/5 rounded-lg p-2",children:[a.jsx("div",{className:"text-gray-400",children:"Total"}),a.jsx("div",{className:"text-white font-bold",children:r.total})]}),a.jsxs("div",{className:"bg-white/5 rounded-lg p-2",children:[a.jsx("div",{className:"text-gray-400",children:"Planets"}),a.jsx("div",{className:"text-cyan-400 font-bold",children:r.planets})]})]})})]})]}),s==="locations"&&a.jsx("div",{className:"space-y-2",children:h.length===0?a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"text-gray-400 text-sm mb-2",children:"No saved locations"}),a.jsx("div",{className:"text-gray-500 text-xs",children:"Use the 📍 button to save locations"})]}):h.map(d=>a.jsx("div",{className:"bg-white/5 hover:bg-white/10 rounded-lg p-3 border border-white/10 hover:border-white/20 transition-all duration-200 group",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("a",{href:d.stargateUrl,className:"flex-1 min-w-0 hover:text-blue-300 transition-colors duration-200",title:`Navigate to ${g(d.name)}`,children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[a.jsxs("div",{className:"text-xs",children:[d.type==="galaxy"&&"🌌",d.type==="system"&&"⭐",d.type==="planet"&&"🪐"]}),a.jsx("div",{className:"text-white text-sm font-medium truncate",children:g(d.name)})]}),a.jsxs("div",{className:"text-gray-400 text-xs truncate",children:["Saved ",new Date(d.timestamp).toLocaleDateString()]})]}),a.jsx("button",{onClick:w=>u(w,d.id),className:"opacity-0 group-hover:opacity-100 text-gray-400 hover:text-red-400 transition-all duration-200 ml-2",title:"Remove location",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})},d.id))})]})]})]})};export{kt as S,Ut as U,Bt as a,Gt as b,$t as c,Pt as g,Rt as m,vt as r};
