import{D as p,S as O,g as f}from"./atlas_CXe69HDW-Q8b_kGwXRltZ.js";import{G as S,O as L,z as _,C as u,M as A,V as E,B as I,g as M,S as y,o as b}from"./atlas_DUxdE5_5iPCKlmI6uaLFO.js";const c={SATELLITE_COUNT:{min:1,max:10},SATELLITE_DISTANCE:{min:.8,max:1.2},ORBITAL_SPEED:{min:.4,max:1}};class C{group;satellites=[];trails=[];trailPositions=[];params;rng;planetRadius;cosmicOffset;TRAIL_LENGTH=15;constructor(t,i={}){this.planetRadius=t;const s=i.seed||Math.floor(Math.random()*1e6);this.rng=new O(s),this.params={color:i.color||[1,1,.8],satelliteCount:i.satelliteCount||Math.floor(this.rng.random()*(c.SATELLITE_COUNT.max-c.SATELLITE_COUNT.min)+c.SATELLITE_COUNT.min),satelliteDistance:i.satelliteDistance||this.rng.random()*(c.SATELLITE_DISTANCE.max-c.SATELLITE_DISTANCE.min)+c.SATELLITE_DISTANCE.min,orbitalSpeed:i.orbitalSpeed||this.rng.random()*(c.ORBITAL_SPEED.max-c.ORBITAL_SPEED.min)+c.ORBITAL_SPEED.min,cosmicOriginTime:i.cosmicOriginTime||p,seed:s},this.cosmicOffset=s%100*.1,this.group=new S,this.createSatellites()}createSatellites(){const t=this.params.satelliteCount,i=this.planetRadius+this.params.satelliteDistance;for(let s=0;s<t;s++){const o=i,n=this.rng.random()*Math.PI,e=this.rng.random()*Math.PI*2,a=this.rng.random()*Math.PI*2,r=this.calculateOrbitalPosition(o,n,e,a),h=new L(this.planetRadius*.025,0),l=new _({color:new u(this.params.color[0],this.params.color[1],this.params.color[2]),transparent:!1,opacity:1}),m=new A(h,l);m.position.set(r.x,r.y,r.z),m.userData={distance:o,inclination:n,longitudeOfAscendingNode:e,initialAngle:a,orbitalSpeed:this.rng.random()*.5+.5},this.satellites.push(m),this.group.add(m),this.createTrail(s)}}createTrail(t){const i=[],s=[];for(let a=0;a<this.TRAIL_LENGTH;a++){i.push(new E(0,0,0));const r=(this.TRAIL_LENGTH-a)/this.TRAIL_LENGTH;s.push(r)}this.trailPositions[t]=i;const o=new I().setFromPoints(i);o.setAttribute("opacity",new M(s,1));const n=new y({uniforms:{color:{value:new u(this.params.color[0],this.params.color[1],this.params.color[2])}},vertexShader:`
        attribute float opacity;
        varying float vOpacity;
        
        void main() {
          vOpacity = opacity;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:`
        uniform vec3 color;
        varying float vOpacity;
        
        void main() {
          gl_FragColor = vec4(color, vOpacity);
        }
      `,transparent:!0,depthWrite:!1}),e=new b(o,n);e.renderOrder=998,this.trails.push(e),this.group.add(e)}calculateOrbitalPosition(t,i,s,o){const n=t*Math.cos(o),e=t*Math.sin(o),a=0,r=n,h=e*Math.cos(i)-a*Math.sin(i),l=e*Math.sin(i)+a*Math.cos(i),m=r*Math.cos(s)-h*Math.sin(s),d=r*Math.sin(s)+h*Math.cos(s),g=l;return new E(m,d,g)}update(t){const s=(f(this.params.cosmicOriginTime||p)+this.cosmicOffset)*(this.params.orbitalSpeed||1);this.satellites.forEach((o,n)=>{const e=o.userData,a=e.initialAngle+s*e.orbitalSpeed*.1,r=this.calculateOrbitalPosition(e.distance,e.inclination,e.longitudeOfAscendingNode,a);o.position.set(r.x,r.y,r.z),o.rotation.y=a,this.updateTrailWithInterpolation(n)})}updateTrailWithInterpolation(t){const i=this.trailPositions[t],o=this.satellites[t].userData,e=(f(this.params.cosmicOriginTime||p)+this.cosmicOffset)*(this.params.orbitalSpeed||1),a=o.initialAngle+e*o.orbitalSpeed*.1;for(let l=0;l<this.TRAIL_LENGTH;l++){const m=l*.05,d=a-m,g=this.calculateOrbitalPosition(o.distance,o.inclination,o.longitudeOfAscendingNode,d);i[l].copy(g)}const h=this.trails[t].geometry;h.setFromPoints(i),h.attributes.position.needsUpdate=!0}getObject3D(){return this.group}addToScene(t,i){i&&this.group.position.copy(i),t.add(this.group)}removeFromScene(t){t.remove(this.group)}dispose(){this.satellites.forEach(t=>{t.geometry.dispose(),t.material.dispose()}),this.trails.forEach(t=>{t.geometry.dispose(),t.material.dispose()}),this.group.clear()}setEnabled(t){this.group.visible=t}updateParams(t){if(Object.assign(this.params,t),t.color){const i=new u(t.color[0],t.color[1],t.color[2]);this.satellites.forEach(s=>{s.material.color=i}),this.trails.forEach(s=>{const o=s.material;o.uniforms.color.value=i})}}}function v(T,t,i){const o={seed:(i||Math.floor(Math.random()*1e6))+90001,color:t.color||[1,1,.8],cosmicOriginTime:t?.timing?.cosmic_origin_time||t?.cosmicOriginTime||p};return new C(T,o)}export{C as L,v as c};
