import{S as ct}from"./atlas_CMUvaCD4mo7XQYkYXSJfw.js";import{G as mt,C as V,V as y,B as pt,h as st,o as wt,m as at,p as yt,R as gt,M as rt,q as xt,i as vt}from"./atlas_Ce3hh0hgxYWauQ_qSK6cl.js";class it{landGroup;lands=[];constructor(e,o={}){this.landGroup=new mt;const n=o.seed||Math.floor(Math.random()*1e6),a=new ct(n);o.greenPatches&&o.greenPatches.length>0?this.generateLandsFromPython(e,o.greenPatches,a,o):this.generateProceduralLands(e,a,o)}generateLandsFromPython(e,o,n,a){o.forEach((c,b)=>{let d=c.position_3d||c.position||[0,0,1];if(d.length===2){const t=n.uniform(0,Math.PI*2),s=Math.acos(n.uniform(-1,1));d=[Math.sin(s)*Math.cos(t),Math.sin(s)*Math.sin(t),Math.cos(s)]}const h=(c.size||.1)*e*1.8;Math.max(8,Math.min(c.sides||20,12));let m=new V(4881497),g=1;c.color&&Array.isArray(c.color)&&(m=new V(c.color[0],c.color[1],c.color[2]),c.color.length>3&&(g=c.color[3]));const f=Math.max(24,Math.min(64,Math.floor(h*32))),M=new y(d[0],d[1],d[2]).normalize(),S=new y,Z=new y;Math.abs(M.y)<.99?S.crossVectors(M,new y(0,1,0)).normalize():S.crossVectors(M,new y(1,0,0)).normalize(),Z.crossVectors(M,S).normalize();const q=2/Math.max(h*.05,1),_=(t,s)=>{let i=0,r=1,l=q,u=0;const O=Math.min(5,Math.max(3,Math.floor(h/40)+2));for(let z=0;z<O;z++){const I=t*l,A=s*l,w=(P,Mt)=>{const ft=P*12.9898+Mt*78.233;return Math.sin(ft+n.uniform(0,1e3))*43758.5453%1},x=Math.floor(I),F=Math.floor(A),H=I-x,U=A-F,X=P=>P*P*P*(P*(P*6-15)+10),v=X(H),Y=X(U),W=w(x,F),J=w(x+1,F),nt=w(x,F+1),T=w(x+1,F+1),D=W*(1-v)+J*v,ht=nt*(1-v)+T*v,ut=D*(1-Y)+ht*Y;i+=ut*r,u+=r,r*=.5,l*=2.2}return i/u},G=[],k=[],K=[],lt=.35,L=new Map,dt=new Map;let Q=0;for(let t=0;t<=f;t++)for(let s=0;s<=f;s++){const i=(t/f-.5)*2,r=(s/f-.5)*2,l=Math.sqrt(i*i+r*r),u=_(i*2,r*2);if(1-l*.5+u*.6>lt&&l<1.2){const z=i*h,I=r*h,w=new y().addScaledVector(S,z).addScaledVector(Z,I).addScaledVector(M,0);G.push(w.x,w.y,w.z),K.push((i+1)*.5,(r+1)*.5),L.set(`${t},${s}`,Q),dt.set(`${t},${s}`,u),Q++}}for(let t=0;t<f;t++)for(let s=0;s<f;s++){const i=L.get(`${t},${s}`),r=L.get(`${t+1},${s}`),l=L.get(`${t},${s+1}`),u=L.get(`${t+1},${s+1}`);i!==void 0&&r!==void 0&&l!==void 0&&k.push(i,r,l),r!==void 0&&u!==void 0&&l!==void 0&&k.push(r,u,l)}const p=new pt;p.setAttribute("position",new st(G,3)),p.setAttribute("uv",new st(K,2)),p.setIndex(k),p.computeVertexNormals();const B=p.attributes.position,C=M.clone().multiplyScalar(e),tt=new y;for(let t=0;t<B.count;t++){tt.fromBufferAttribute(B,t);const i=tt.clone().add(C).clone().normalize(),r=p.attributes.uv;if(r){const l=r.getX(t)*2-1,u=r.getY(t)*2-1,O=Math.sqrt(l*l+u*u),z=_(l*2,u*2),A=Math.max(0,1-Math.pow(O,.7))*.5+z*.5,x=(D=>D*D*(3-2*D))(A),H=e*1.01-e,U=h*.15,X=Math.min(U,H*.9),v=e*.002,Y=e+v,W=e+v+X,J=wt.lerp(Y,W,x),T=i.multiplyScalar(J).sub(C);B.setXYZ(t,T.x,T.y,T.z)}}B.needsUpdate=!0,p.computeVertexNormals(),p.translate(C.x,C.y,C.z);const et=new at({color:a.transparentMode?new V(15135743):m,opacity:a.transparentMode?.3:g,transparent:a.transparentMode||g<1,emissive:a.transparentMode?new V(13428479).multiplyScalar(.1):m.clone().multiplyScalar(.05),emissiveIntensity:a.transparentMode?.05:1e-7,shininess:a.transparentMode?30:8,flatShading:!1,bumpScale:.002}),E=document.createElement("canvas");E.width=E.height=64;const ot=E.getContext("2d"),$=ot.createImageData(64,64);for(let t=0;t<$.data.length;t+=4){const s=n.uniform(.8,1.2),i=Math.floor(128*s);$.data[t]=i,$.data[t+1]=i,$.data[t+2]=i,$.data[t+3]=255}ot.putImageData($,0,0);const R=new yt(E);R.wrapS=R.wrapT=gt,R.repeat.set(2,2),et.bumpMap=R;const N=new rt(p,et);N.castShadow=!0,N.receiveShadow=!0,this.lands.push(N),this.landGroup.add(N)})}generateProceduralLands(e,o,n){const a=Math.floor(o.uniform(5,15));for(let c=0;c<a;c++){const b=o.uniform(0,Math.PI*2),d=Math.acos(o.uniform(-1,1)),h=new y(Math.sin(d)*Math.cos(b),Math.sin(d)*Math.sin(b),Math.cos(d)),m=e*o.uniform(.02,.08),g=new xt(m,16),f=h.clone().multiplyScalar(e*1);g.lookAt(h),g.translate(f.x,f.y,f.z);const M=o.uniform(.3,.7),S=new V(.36*(1-M)+.22*M,.23*(1-M)+.36*M,0),q=n.tundraMode||!1?.25:1,_=new at({color:n.transparentMode?new V(15135743):S,opacity:n.transparentMode?.3:q,transparent:n.transparentMode||q<1,emissive:n.transparentMode?new V(13428479).multiplyScalar(.1):657920,shininess:n.transparentMode?30:5}),G=new rt(g,_);this.lands.push(G),this.landGroup.add(G)}}addToScene(e,o){o&&this.landGroup.position.copy(o),e.add(this.landGroup)}update(e){}getObject3D(){return this.landGroup}dispose(){this.lands.forEach(e=>{e.geometry.dispose(),e.material instanceof vt&&e.material.dispose()}),this.lands=[],this.landGroup.clear()}}function bt(j,e,o){const n=e.green_patches;if(!n||n.length===0)return null;const a=o||Math.floor(Math.random()*1e6);return new it(j,{greenPatches:n,seed:a+6e3})}function St(j,e,o){const n=o||Math.floor(Math.random()*1e6),a=new ct(n+7e3),c=Math.floor(a.uniform(3,8)),b=[];for(let d=0;d<c;d++){const h=a.uniform(0,Math.PI*2),m=Math.acos(a.uniform(-1,1));b.push({position_3d:[Math.sin(m)*Math.cos(h),Math.sin(m)*Math.sin(h),Math.cos(m)],size:a.uniform(.05,.15),sides:Math.floor(a.uniform(8,16)),color:[0,0,0]})}return console.log(`ðŸ§Š Creating ${c} transparent ice formations for Icy planet with seed ${n+7e3}`),new it(j,{greenPatches:b,seed:n+7e3,transparentMode:!0})}export{it as L,St as a,bt as c};
