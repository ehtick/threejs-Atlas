import{r as s,j as e,a as Xe,c as et,R as tt}from"./atlas_C3xj8MG9oH9uC54MklkAb.js";import{R as st,L as nt,c as at,d as rt,S as Me,e as Pe,F as ot,H as it,a as lt}from"./atlas_Dd1oIz2vPimnyjaTh6Eli.js";import{W as Ie}from"./atlas_jwQDkDgkbYrDf9CRKibQy.js";import{a4 as _e,C as Ge,a5 as Oe,G as $e,b as me,z as ue,M as he,V as Se,B as Ve,a2 as Be,o as We,aa as Ye,y as He,v as qe,cL as Ke,cM as Ze,I as ze}from"./atlas_pGQiCQeTD5l6dMUXRRcYJ.js";import{R as ct,S as dt,M as mt,a as Te,D as ut,T as ht}from"./atlas_BJpzWMzCSjQD1vPE6gEgw.js";import{S as Ue,E as xt,a as pt,b as ft}from"./atlas_uJRM88EpPhyLqmS8e1wo1.js";import{O as gt}from"./atlas_D0eA6tgysic-V8oq2dTta.js";import{V as bt}from"./atlas_DwvSdObFEIQcgn4zq5yYd.js";import"./atlas_C0q7_QgoBkw_1ECio0nFC.js";import"./atlas_BMOTvxb1A3Tqk3tQ4b7kw.js";import"./atlas_CtOhIAiNHzSpXytHIyKwk.js";import"./atlas_DJ7i7UfL_c0UysIQfk_Wq.js";import"./atlas_CwYcokoa2i6NGa8CMcVH-.js";import"./atlas_CDmCjAbKL2BudWSRsmj9N.js";import"./atlas_MjNYrLc1c4EY8hYLeoBxW.js";import"./atlas_BJ_QDdZoUPjYT-9n_I4Gp.js";import"./atlas_HiFslN68N6WR8NcVQRQp7.js";import"./atlas_ChinNMIx15I-x-zfb2cxc.js";import"./atlas_BK5KpVHHDMchlABYedhdJ.js";import"./atlas_D1CR0bARAX433mi1gofoX.js";import"./atlas_k2E4Oa2ZTr-ShzFQV4yGe.js";import"./atlas_C6pdp7ZaYdLNQa3nKe66N.js";import"./atlas_CCCB6wayl60uvstX_VV1b.js";import"./atlas_CuSf8Ux199dN5TQGANNsL.js";import"./atlas_B-7ciEeDInNr7ubvXaM1p.js";import"./atlas_QIlGLcqC1yx-yIj5WPE_2.js";import"./atlas_BrtSY9WI0jnpWr8b8l2p0.js";import"./atlas_DozMyZz-MgtutptlVtnXw.js";import"./atlas_DSMMIt__RfTLlDwy5o46G.js";import"./atlas_FvuaiM6ukQxncYDnO-LRN.js";import"./atlas_AcePMkcyOwGOfjKIaBXr7.js";import"./atlas_qLVe_rIPJrOk-heQF9xYK.js";import"./atlas_CVSIdj3IKNuZh1Tc9MWju.js";import"./atlas_DEVVBRTll3E69js2-hd6f.js";import"./atlas_DJS6mCG7iAKygTFzFyy0q.js";import"./atlas_CXqOkCPqDZlFOooak3r6p.js";import"./atlas_CXGNRo_qmRRLtYwZjj9MN.js";import"./atlas_B-8_xMAZUXFU3ijFjimI-.js";import"./atlas_ZZwvv2NOfM75V8EKAgXHJ.js";import"./atlas_CNSvMCCms-TRWdl5PfLso.js";import"./atlas_DNAC-xK9EjNtVKbqCBrWr.js";import"./atlas_DleynCheRNz9nOtzxamBI.js";import"./atlas_DRk1PRoP8HUsgl6w7XFKV.js";import"./atlas_DuNAKdzbUSGhCUnfjh5BO.js";import"./atlas_D7m96u8GNCAETXWneOccD.js";import"./atlas_DDAIyn7FrSglShWFzRYs6.js";import"./atlas_CUZqEERRQBivhH-lGjb0z.js";import"./atlas_B3jNgK3wg_91IYqexUq2H.js";import"./atlas_M0UXn4YDKB4xcqAMdAR2c.js";import"./atlas_cDvRyMmiFrWDA_rD6LEQ8.js";import"./atlas_CsENJmsgVSKbIkIORp0De.js";import"./atlas_3xd9BqPYYnkrfh-Kzp59J.js";import"./atlas_B55frdK5FY4jYv3eL7WSF.js";import"./atlas_GBC17wBCdVuY879Mt3pV2.js";import"./atlas_EMT4MQkZxhiCjMEXcl8lu.js";import"./atlas_CNSwdXAEZgA__qIDxXEVA.js";import"./atlas_C3o773RrkB_QrrdANyLLX.js";import"./atlas_fEdukK2Ek4bJoqmXZLuoQ.js";import"./atlas_Cle6kZu3ADge2F2XZyyYF.js";import"./atlas_BBGO3sthS_o2yDU3NQGQW.js";import"./atlas_DsAFxLjqd-fdDTXvXH8ER.js";import"./atlas_BUJnV0krBUhxxLpEWQCvw.js";import"./atlas_DHEyh2PRya1CVc9B_tQzq.js";import"./atlas_Cs0We1NVUxzA8UwJU4DMq.js";import"./atlas_4Br5bcXbvuWUmKa_tm5wr.js";const Je=({planets:a,stars:m,systemName:b,cosmicOriginTime:L,currentTime:E,onTimeOffsetChange:y})=>{const V=s.useRef(null),v=s.useRef(null),x=s.useRef(null),z=s.useRef(null),D=s.useRef([]),G=s.useRef([]),i=s.useRef([]),O=s.useRef(0),te=(S,B="#ffffff")=>{const T=document.createElement("canvas"),d=T.getContext("2d");if(!d)return null;T.width=768,T.height=192,d.fillStyle="rgba(0, 0, 0, 0.8)",d.fillRect(0,0,T.width,T.height),d.strokeStyle="#ffffff",d.lineWidth=3,d.strokeRect(3,3,T.width-6,T.height-6),d.fillStyle=B,d.font="bold 48px Arial",d.textAlign="center",d.textBaseline="middle",d.fillText(S,384,96);const p=new qe(T),A=new Ke({map:p,transparent:!0,alphaTest:.1}),Y=new Ze(A);return Y.scale.set(30,7.5,1),Y};return O.current=E,s.useEffect(()=>{if(!V.current)return;const S=V.current,B=S.clientWidth,T=S.clientHeight,d=new _e;d.background=new Ge(17),v.current=d;const p=new Oe(60,B/T,.1,1e4);p.position.set(0,120,180),p.lookAt(0,0,0);const A=new Ie({antialias:!0,alpha:!0});A.setSize(B,T),A.setClearColor(17,1),x.current=A,S.appendChild(A.domElement);const Y={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},ce={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},X=new $e;m.forEach((t,u)=>{const o=parseFloat(t.Size)*4,w=new me(o,32,32),ee=ce[t.Color]||"#FFFF44",f=new ue({color:ee,transparent:!0,opacity:.9}),h=new he(w,f);m.length===1?h.position.set(0,0,0):m.length===2?h.position.set(u===0?-o*2:o*2,0,0):u===0?h.position.set(-o*2,0,0):u===1?h.position.set(o*2,0,0):h.position.set(0,o*2,0);const P=new me(o*1.5,32,32),Z=new ue({color:ee,transparent:!0,opacity:.3}),W=new he(P,Z);h.add(W),X.add(h)}),d.add(X);const oe=Math.max(...a.map(t=>t.orbital_radius)),M=150;a.forEach((t,u)=>{const w=30+t.orbital_radius/oe*M,ee=t.eccentricity_factor,f=w,h=f*Math.sqrt(1-ee*ee),P=360,Z=2,W=4;for(let J=0;J<P;J+=Z+W){const _=[];for(let R=J;R<Math.min(J+Z,P-1);R++){const Q=R/P*2*Math.PI,se=f*Math.cos(Q),pe=h*Math.sin(Q);_.push(new Se(se,0,pe))}if(_.length>1){const R=new Ve().setFromPoints(_),Q=new Be({color:7372944,transparent:!0,opacity:.8,linewidth:2}),se=new We(R,Q);d.add(se),G.current.push(se)}}const $=t.diameter/8e3,C=Math.max(Math.min($,8),2.5),ae=new me(C,32,32),xe=Y[t.planet_type]||"#FFFFFF",r=new ue({color:xe,transparent:!0,opacity:.9}),n=new he(ae,r),g=new he(new me(C*1.5,32,32),new ue({color:xe,transparent:!0,opacity:.2}));n.add(g),d.add(n),D.current.push(n),n.planetData=t,n.orbitRadius=w,n.semiMajorAxis=f,n.semiMinorAxis=h;const F=t.name.replace(/_/g," "),U=te(F,"#ffffff");U&&(U.position.copy(n.position),U.position.y+=C+10,U.planetData=t,d.add(U),i.current.push(U))});const H=new Ye(4210752,.4);d.add(H);const ge=new He(16777215,1,2e3);ge.position.set(0,0,0),d.add(ge);let ie=!1,le=0,de=0,be=0;const ne=t=>{ie=!0,le=t.clientX,de=t.clientY},Ne=t=>{if(!ie)return;const u=t.clientX-le,o=t.clientY-de,w=new ze;w.setFromVector3(p.position),w.theta-=u*.01,w.phi+=o*.01,w.phi=Math.max(.1,Math.min(Math.PI-.1,w.phi)),p.position.setFromSpherical(w),p.lookAt(0,0,0),le=t.clientX,de=t.clientY},j=()=>{ie=!1,setTimeout(()=>{},3e3)},k=t=>{if(t.ctrlKey)t.preventDefault(),t.deltaY>0?y(604800):y(-604800);else{t.preventDefault();const u=.1,o=p.position.distanceTo(new Se(0,0,0));t.deltaY>0&&o<800?p.position.multiplyScalar(1+u):t.deltaY<0&&o>50&&p.position.multiplyScalar(1-u)}},I=t=>{t.key==="Escape"&&document.dispatchEvent(new CustomEvent("solar-system-close-fullscreen"))},N=t=>{if(t.preventDefault(),t.touches.length===1)ie=!0,le=t.touches[0].clientX,de=t.touches[0].clientY;else if(t.touches.length===2){const u=t.touches[0].clientX-t.touches[1].clientX,o=t.touches[0].clientY-t.touches[1].clientY;be=Math.sqrt(u*u+o*o)}},q=t=>{if(t.preventDefault(),t.touches.length===1&&ie){const u=t.touches[0].clientX-le,o=t.touches[0].clientY-de,w=new ze;w.setFromVector3(p.position),w.theta-=u*.01,w.phi+=o*.01,w.phi=Math.max(.1,Math.min(Math.PI-.1,w.phi)),p.position.setFromSpherical(w),p.lookAt(0,0,0),le=t.touches[0].clientX,de=t.touches[0].clientY}else if(t.touches.length===2){const u=t.touches[0].clientX-t.touches[1].clientX,o=t.touches[0].clientY-t.touches[1].clientY,w=Math.sqrt(u*u+o*o);if(be>0){const f=w/be,h=p.position.distanceTo(new Se(0,0,0));f>1&&h>50?p.position.multiplyScalar(1-.01):f<1&&h<800&&p.position.multiplyScalar(1+.01)}be=w}},l=t=>{t.preventDefault(),ie=!1,be=0,setTimeout(()=>{},3e3)},c=A.domElement;c.style.cursor="grab",c.addEventListener("mousedown",t=>{c.style.cursor="grabbing",ne(t)}),c.addEventListener("mousemove",Ne),c.addEventListener("mouseup",()=>{c.style.cursor="grab",j()}),c.addEventListener("mouseleave",()=>{c.style.cursor="grab",j()}),c.addEventListener("wheel",k),c.addEventListener("touchstart",N,{passive:!1}),c.addEventListener("touchmove",q,{passive:!1}),c.addEventListener("touchend",l,{passive:!1}),document.addEventListener("keydown",I);const K=()=>{z.current=requestAnimationFrame(K),D.current.forEach((t,u)=>{const o=t.planetData,w=t.semiMajorAxis,ee=t.semiMinorAxis,f=o.orbital_period_seconds,h=2*Math.PI/f,P=(o.initial_orbital_angle+O.current*h)%(2*Math.PI);t.position.x=w*Math.cos(P),t.position.z=ee*Math.sin(P),t.position.y=0;const Z=o.rotation_period_seconds,W=2*Math.PI/Z;if(t.rotation.y=O.current*W%(2*Math.PI),i.current[u]){const $=t.geometry.parameters?.radius||2;i.current[u].position.copy(t.position),i.current[u].position.y+=$+10}}),A.render(d,p)};K();const re=()=>{const t=S.clientWidth,u=S.clientHeight;p.aspect=t/u,p.updateProjectionMatrix(),A.setSize(t,u)};return window.addEventListener("resize",re),()=>{window.removeEventListener("resize",re),document.removeEventListener("keydown",I),c.removeEventListener("mousedown",ne),c.removeEventListener("mousemove",Ne),c.removeEventListener("mouseup",j),c.removeEventListener("mouseleave",j),c.removeEventListener("wheel",k),c.removeEventListener("touchstart",N),c.removeEventListener("touchmove",q),c.removeEventListener("touchend",l),z.current&&cancelAnimationFrame(z.current),S&&A.domElement&&S.removeChild(A.domElement),A.dispose(),D.current=[],G.current=[],i.current=[]}},[a,m,L]),e.jsx("div",{ref:V,className:"w-full h-full"})},wt=({planets:a,stars:m,systemName:b,cosmicOriginTime:L})=>{const E=s.useRef(null),y=s.useRef(null),V=s.useRef(null),v=s.useRef(null),x=s.useRef([]),z=s.useRef([]),D=s.useRef([]),G=s.useRef(0),i=Math.floor(Date.now()/1e3),[O,te]=s.useState(0),[S,B]=s.useState(!1),[T,d]=s.useState(!1),[p,A]=s.useState(!1),[Y,ce]=s.useState(0),[X,oe]=s.useState(null),[M,H]=s.useState(!0),[ge,ie]=s.useState(null),le=i-L+O;G.current=le,s.useEffect(()=>{(async()=>{try{H(!0),ie(null);const k=await fetch("/api/system/rendering-data");if(!k.ok)throw new Error(`HTTP error! status: ${k.status}`);const I=await k.json();if(I.success)oe(I.system_data);else throw new Error(I.error||"Failed to fetch system data")}catch(k){ie(k instanceof Error?k.message:"Unknown error")}finally{H(!1)}})()},[]);const de=()=>{d(!0),setTimeout(()=>{B(!1),d(!1)},300)},be=(j,k="#ffffff")=>{const I=document.createElement("canvas"),N=I.getContext("2d");if(!N)return null;I.width=512,I.height=128,N.fillStyle="rgba(0, 0, 0, 0.7)",N.fillRect(0,0,I.width,I.height),N.strokeStyle="#ffffff",N.lineWidth=2,N.strokeRect(2,2,I.width-4,I.height-4),N.fillStyle=k,N.font="bold 32px Arial",N.textAlign="center",N.textBaseline="middle",N.fillText(j,256,64);const q=new qe(I),l=new Ke({map:q,transparent:!0,alphaTest:.1}),c=new Ze(l);return c.scale.set(20,5,1),c};s.useEffect(()=>{const j=k=>{k.key==="Escape"&&S&&de()};return S&&ce(O),document.addEventListener("solar-system-close-fullscreen",de),document.addEventListener("keydown",j),()=>{document.removeEventListener("solar-system-close-fullscreen",de),document.removeEventListener("keydown",j)}},[S,O]),s.useEffect(()=>{if(S&&p){const j=setTimeout(()=>{A(!1)},50);return()=>clearTimeout(j)}},[S,p]),s.useEffect(()=>{if(M||!X||(window.tonnirLoggedInSystem=!1,!E.current))return;const j=E.current,k=j.clientWidth,I=k<640,N=new _e;N.background=new Ge(17),y.current=N;const q=new Oe(45,k/(I?120:140),.1,1e4);q.position.set(0,80,120),q.lookAt(0,0,0);const l=new Ie({antialias:!0,alpha:!0});l.setSize(k,I?120:140),l.setClearColor(17,1),V.current=l,j.appendChild(l.domElement);const c={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},K={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},re=new $e;X.stars.forEach((r,n)=>{const g=parseFloat(r.Size)*3,F=new me(g,16,16),U=K[r.Color]||"#FFFF44",J=new ue({color:U,transparent:!0,opacity:.9}),_=new he(F,J);X.stars.length===1?_.position.set(0,0,0):X.stars.length===2?_.position.set(n===0?-g*2:g*2,0,0):n===0?_.position.set(-g*2,0,0):n===1?_.position.set(g*2,0,0):_.position.set(0,g*2,0);const R=new me(g*1.5,16,16),Q=new ue({color:U,transparent:!0,opacity:.3}),se=new he(R,Q);_.add(se),re.add(_)}),N.add(re);const t=X.timing.max_orbital_radius,u=80;window.systemMaxOrbitalRadius=t,X.planets.forEach((r,n)=>{const F=20+r.orbital_radius/t*u,U=r.eccentricity_factor,J=F,_=J*Math.sqrt(1-U*U),R=360,Q=2,se=4;for(let Ee=0;Ee<R;Ee+=Q+se){const Fe=[];for(let ve=Ee;ve<Math.min(Ee+Q,R-1);ve++){const je=ve/R*2*Math.PI,Ce=J*Math.cos(je),Qe=_*Math.sin(je);Fe.push(new Se(Ce,0,Qe))}if(Fe.length>1){const ve=new Ve().setFromPoints(Fe),je=new Be({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Ce=new We(ve,je);N.add(Ce),z.current.push(Ce)}}const pe=r.diameter/15e3,ke=Math.max(Math.min(pe,4),1.5),Re=new me(ke,16,16),Le=c[r.planet_type]||"#FFFFFF",De=new ue({color:Le,transparent:!0,opacity:.9}),we=new he(Re,De),ye=new he(new me(ke*1.5,16,16),new ue({color:Le,transparent:!0,opacity:.2}));we.add(ye),N.add(we),x.current.push(we),we.planetData=r,we.orbitRadius=F,we.semiMajorAxis=J,we.semiMinorAxis=_;const Ae=r.name.replace(/_/g," "),fe=be(Ae,"#ffffff");fe&&(fe.position.copy(we.position),fe.position.y+=ke+6,fe.planetData=r,N.add(fe),D.current.push(fe))});const o=new Ye(4210752,.4);N.add(o);const w=new He(16777215,1,1e3);w.position.set(0,0,0),N.add(w);let ee=!1,f=0,h=0;const P=r=>{ee=!0,f=r.clientX,h=r.clientY},Z=r=>{if(!ee)return;const n=r.clientX-f,g=r.clientY-h,F=new ze;F.setFromVector3(q.position),F.theta-=n*.01,F.phi+=g*.01,F.phi=Math.max(.1,Math.min(Math.PI-.1,F.phi)),q.position.setFromSpherical(F),q.lookAt(0,0,0),f=r.clientX,h=r.clientY},W=()=>{ee=!1,setTimeout(()=>{},3e3)},$=r=>{if(r.ctrlKey)r.preventDefault(),r.deltaY>0?te(n=>n+604800):te(n=>n-604800);else{r.preventDefault();const n=.1,g=q.position.distanceTo(new Se(0,0,0));r.deltaY>0&&g<500?q.position.multiplyScalar(1+n):r.deltaY<0&&g>20&&q.position.multiplyScalar(1-n)}},C=l.domElement;C.style.cursor="grab",C.style.borderRadius="8px",C.addEventListener("mousedown",r=>{C.style.cursor="grabbing",P(r)}),C.addEventListener("mousemove",Z),C.addEventListener("mouseup",()=>{C.style.cursor="grab",W()}),C.addEventListener("mouseleave",()=>{C.style.cursor="grab",W()}),C.addEventListener("wheel",$);const ae=()=>{v.current=requestAnimationFrame(ae),x.current.forEach((r,n)=>{const g=r.planetData,F=r.semiMajorAxis,U=r.semiMinorAxis,J=g.orbital_period_seconds,_=2*Math.PI/J,R=(g.initial_orbital_angle+G.current*_)%(2*Math.PI);r.position.x=F*Math.cos(R),r.position.z=U*Math.sin(R),r.position.y=0;const Q=g.rotation_period_seconds,se=2*Math.PI/Q;if(r.rotation.y=G.current*se%(2*Math.PI),D.current[n]){const pe=r.geometry.parameters?.radius||2;D.current[n].position.copy(r.position),D.current[n].position.y+=pe+6}}),l.render(N,q)};ae();const xe=()=>{const r=j.clientWidth,n=r<640?120:140;q.aspect=r/n,q.updateProjectionMatrix(),l.setSize(r,n)};return window.addEventListener("resize",xe),()=>{window.removeEventListener("resize",xe),C.removeEventListener("mousedown",P),C.removeEventListener("mousemove",Z),C.removeEventListener("mouseup",W),C.removeEventListener("mouseleave",W),C.removeEventListener("wheel",$),v.current&&cancelAnimationFrame(v.current),j&&l.domElement&&j.removeChild(l.domElement),l.dispose(),x.current=[],z.current=[],D.current=[]}},[a,m,L,X]);const ne=j=>{const k=Math.floor(j/31557600),I=Math.floor(j%(365.25*24*3600)/(24*3600)),N=Math.floor(j%(24*3600)/3600);return k>0?`${k}y ${I}d ${N}h`:I>0?`${I}d ${N}h`:`${N}h`},Ne=j=>j.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Solar System Perspective"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{ref:E,className:"w-full border border-white/20 rounded bg-black/20",style:{height:"auto"}}),!M&&!ge&&b&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:b})}),e.jsx("button",{onClick:()=>{B(!0),A(!0)},className:"absolute top-2 right-2 p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg z-10",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-[10px]",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-[10px]",children:[X?.planets?.length||a.length," Planets"]})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Time: ",ne(le)]})]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View"})]})]}),S&&Xe.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${T||p?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${T||p?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:Ne(b)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:Ne(b)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[X?.planets?.length||a.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",ne(i-L+Y)]})]})]}),e.jsx("button",{onClick:de,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:Y,onChange:j=>ce(Number(j.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>ce(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",Y===0?"Present":Y>0?`+${Math.abs(Y/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(Y/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Je,{planets:X?.planets||a,stars:X?.stars||m,systemName:b,cosmicOriginTime:L,currentTime:i-L+Y,onTimeOffsetChange:j=>ce(k=>k+j)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},vt=({system:a,galaxy:m,systemIndex:b,cosmicOriginTime:L})=>{const[E,y]=s.useState({isOnCooldown:!1,isSaved:!1,isCollecting:!1,timeUntilNext:0});s.useEffect(()=>{let v;const x=()=>{const i=Te.generateLocationId("system",m.coordinates.join(","),b,void 0),O=Te.canCollectFromLocation(i),te=Te.getTimeUntilNextCollection(i),S=m.coordinates,B=Ue.generateSystemUrl(S,b,Ue.getCurrentPage()),d=nt.getLocations().some(p=>p.stargateUrl===B);y(p=>({isOnCooldown:!O&&te>0,isSaved:d,isCollecting:p.isCollecting,timeUntilNext:te}))},z=()=>{y(i=>({...i,isCollecting:!0})),v=setTimeout(()=>{y(i=>({...i,isCollecting:!1}))},1e3)};x();const D=setInterval(x,1e3),G=st.subscribe("mining_completed",z);return()=>{clearInterval(D),v&&clearTimeout(v),G()}},[a.name,b,m.coordinates]);const V=v=>v.replace(/_/g," ");return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[e.jsx(ct,{locationType:"system",locationId:a.name,coordinates:m.coordinates.join(","),systemIndex:b,className:"text-xs"}),e.jsx(dt,{type:"system",name:a.name,coordinates:m.coordinates.join(","),systemIndex:b,className:"text-xs"}),e.jsx("div",{className:"inline-flex items-center bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] font-medium px-1.5 py-0.5 rounded h-[21px] box-border",children:"VISITED"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(mt,{isOnCooldown:E.isOnCooldown,isSaved:E.isSaved,isCollecting:E.isCollecting}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Details"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"System Type"}),e.jsx("div",{className:"text-sm font-bold text-blue-300 capitalize",children:a.star_system_type})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Planets"}),e.jsx("div",{className:"text-sm font-bold text-purple-300",children:a.num_planets})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-orange-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Stars"}),e.jsx("div",{className:"text-sm font-bold text-orange-300",children:a.stars.length})]})]}),e.jsx("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-3",children:e.jsx(wt,{planets:a.planets,stars:a.stars,systemName:a.name,cosmicOriginTime:L})}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-yellow-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Stellar Composition"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1",children:a.stars.map((v,x)=>e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-yellow-500/20",children:[e.jsxs("div",{className:"text-xs text-gray-300",children:["Star ",x+1]}),e.jsx("div",{className:"text-xs font-bold text-yellow-300",children:v.Type}),e.jsxs("div",{className:"text-xs text-gray-300",children:[v.Color," • ",v.Size]})]},x))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System:"}),e.jsx("div",{className:"text-white truncate font-medium",children:V(a.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System ID:"}),e.jsxs("div",{className:"text-white font-medium",children:["#",b+1]})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),e.jsx("div",{className:"text-white truncate font-medium",children:V(m.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),e.jsx("div",{className:"text-white font-medium",children:m.coordinates.join(", ")})]})]})]})]})},yt=({planets:a,stars:m,systemName:b,cosmicOriginTime:L,systemUrl:E})=>{const y=s.useRef(null),V=s.useRef(null),v=s.useRef(null),x=s.useRef(null),z=s.useRef([]),D=s.useRef([]),G=s.useRef([]),i=s.useRef(null),O=s.useRef(0),te=s.useRef(null),S=Math.floor(Date.now()/1e3),[B,T]=s.useState(0),[d,p]=s.useState(!1),[A,Y]=s.useState(!1),[ce,X]=s.useState(!1),[oe,M]=s.useState(0),[H,ge]=s.useState(null),[ie,le]=s.useState(!0),[de,be]=s.useState(null),[ne,Ne]=s.useState(!1),j=S-L+B;O.current=j,s.useEffect(()=>{(async()=>{try{le(!0),be(null);const c=await fetch("/api/system/rendering-data");if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const K=await c.json();if(K.success)ge(K.system_data);else throw new Error(K.error||"Failed to fetch system data")}catch(c){be(c instanceof Error?c.message:"Unknown error")}finally{le(!1)}})()},[]);const k=()=>{Y(!0),setTimeout(()=>{p(!1),Y(!1)},300)};s.useEffect(()=>{const l=c=>{c.key==="Escape"&&d&&k()};return d&&M(B),document.addEventListener("solar-system-close-fullscreen",k),document.addEventListener("keydown",l),()=>{document.removeEventListener("solar-system-close-fullscreen",k),document.removeEventListener("keydown",l)}},[d,B]),s.useEffect(()=>{if(d&&ce){const l=setTimeout(()=>{X(!1)},50);return()=>clearTimeout(l)}},[d,ce]),s.useEffect(()=>{if(ie||!H||(window.tonnirLoggedInSystem=!1,!y.current))return;const l=y.current,c=l.clientWidth,K=l.clientHeight,re=Math.min(c,K),t=new _e;t.background=new Ge(17),V.current=t;const u=new Oe(45,1,.1,1e4);u.position.set(0,300,0),u.lookAt(0,0,0),te.current=u;const o=new Ie({antialias:!0,alpha:!0});o.setSize(re,re),o.setClearColor(17,1),v.current=o,o.domElement.className="",l.appendChild(o.domElement);const w={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},ee={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},f=new $e;H.stars.forEach((n,g)=>{const F=parseFloat(n.Size)*3,U=new me(F,16,16),J=ee[n.Color]||"#FFFF44",_=new ue({color:J,transparent:!0,opacity:.9}),R=new he(U,_);H.stars.length===1?R.position.set(0,0,0):H.stars.length===2?R.position.set(g===0?-F*2:F*2,0,0):g===0?R.position.set(-F*2,0,0):g===1?R.position.set(F*2,0,0):R.position.set(0,F*2,0);const Q=new me(F*1.5,16,16),se=new ue({color:J,transparent:!0,opacity:.3}),pe=new he(Q,se);R.add(pe),f.add(R)}),t.add(f);const h=H.timing.max_orbital_radius,P=80;window.systemMaxOrbitalRadius=h,H.planets.forEach((n,g)=>{const U=20+n.orbital_radius/h*P,J=n.eccentricity_factor,_=U,R=_*Math.sqrt(1-J*J),Q=360,se=2,pe=4;for(let fe=0;fe<Q;fe+=se+pe){const Ee=[];for(let Fe=fe;Fe<Math.min(fe+se,Q-1);Fe++){const ve=Fe/Q*2*Math.PI,je=_*Math.cos(ve),Ce=R*Math.sin(ve);Ee.push(new Se(je,0,Ce))}if(Ee.length>1){const Fe=new Ve().setFromPoints(Ee),ve=new Be({color:7372944,transparent:!0,opacity:.8,linewidth:2}),je=new We(Fe,ve);t.add(je),D.current.push(je)}}const ke=n.diameter/15e3,Re=Math.max(Math.min(ke,4),1.5),Le=new me(Re,16,16),De=w[n.planet_type]||"#FFFFFF",we=new ue({color:De,transparent:!0,opacity:.9}),ye=new he(Le,we),Ae=new he(new me(Re*1.5,16,16),new ue({color:De,transparent:!0,opacity:.2}));ye.add(Ae),t.add(ye),z.current.push(ye),ye.planetData=n,ye.orbitRadius=U,ye.semiMajorAxis=_,ye.semiMinorAxis=R,G.current.push(null)});const Z=new Ye(4210752,.4);t.add(Z);const W=new He(16777215,1,1e3);W.position.set(0,0,0),t.add(W);const $=new gt(u,o.domElement);$.enableDamping=!0,$.dampingFactor=.05,$.minDistance=50,$.maxDistance=800,$.autoRotate=!1,$.autoRotateSpeed=.5,$.enablePan=!0,$.enableZoom=!0,$.target.set(0,0,0),i.current=$;const C=n=>{if(n.ctrlKey)n.preventDefault(),n.deltaY>0?T(g=>g+604800):T(g=>g-604800);else{n.preventDefault();const g=.1,F=u.position.distanceTo(new Se(0,0,0));n.deltaY>0&&F<500?u.position.multiplyScalar(1+g):n.deltaY<0&&F>20&&u.position.multiplyScalar(1-g)}},ae=o.domElement;ae.style.borderRadius="8px",ae.addEventListener("wheel",C);const xe=()=>{x.current=requestAnimationFrame(xe),z.current.forEach((n,g)=>{const F=n.planetData,U=n.semiMajorAxis,J=n.semiMinorAxis,_=F.orbital_period_seconds,R=2*Math.PI/_,Q=(F.initial_orbital_angle+O.current*R)%(2*Math.PI);n.position.x=U*Math.cos(Q),n.position.z=J*Math.sin(Q),n.position.y=0;const se=F.rotation_period_seconds,pe=2*Math.PI/se;n.rotation.y=O.current*pe%(2*Math.PI)}),i.current&&i.current.update(),o.render(t,u)};xe();const r=()=>{if(!y.current||!o)return;const n=y.current,g=Math.min(n.clientWidth,n.clientHeight);o.setSize(g,g),u.aspect=1,u.updateProjectionMatrix()};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r),ae.removeEventListener("wheel",C),i.current&&i.current.dispose(),x.current&&cancelAnimationFrame(x.current),l&&o.domElement&&l.removeChild(o.domElement),o.dispose(),z.current=[],D.current=[],G.current=[]}},[a,m,L,H,B]);const I=()=>{if(!v.current||!V.current||!te.current||ne)return;Ne(!0),i.current&&(i.current.enabled=!1);const l=v.current,c=V.current,K=te.current,re=l.domElement.width,t=l.domElement.height,u=3840/re,o=[];c.traverse(f=>{if(f.isPoints&&f.material){const h=f.material;if(h.size!==void 0&&(o.push({material:h,originalSize:h.size}),h.size=h.size*u*1),f.geometry&&f.geometry.attributes.size){const P=f.geometry.attributes.size,Z=P.array.slice();o.push({geometry:f.geometry,originalSizeArray:Z});for(let W=0;W<P.array.length;W++)P.array[W]*=u*1;P.needsUpdate=!0}}if(f.isSprite&&(o.push({object:f,originalScale:f.scale.clone()}),f.scale.multiplyScalar(u*1)),f.isLine&&f.material){const h=f.material;h.linewidth!==void 0&&(o.push({material:h,originalLinewidth:h.linewidth}),h.linewidth=h.linewidth*u*1)}});const w=3840,ee=3840;l.setSize(w,ee),K.aspect=1,K.updateProjectionMatrix(),l.render(c,K),l.domElement.toBlob(f=>{if(f){const h=document.createElement("canvas"),P=h.getContext("2d");if(h.width=w,h.height=ee,P){const Z=new Image;Z.onload=async()=>{P.drawImage(Z,0,0),pt(P,{imageWidth:w,imageHeight:ee}),E&&await ft(P,w,ee,{type:"system",stargateUrl:E}),h.toBlob($=>{if($){const C=URL.createObjectURL($),ae=document.createElement("a");ae.href=C,ae.download=`system_${b}_${Date.now()}.png`,ae.click(),URL.revokeObjectURL(C)}},"image/png",1)};const W=URL.createObjectURL(f);Z.src=W}}o.forEach(({material:h,object:P,originalSize:Z,originalScale:W,originalLinewidth:$,geometry:C,originalSizeArray:ae})=>{if(Z!==void 0&&(h.size=Z),W!==void 0&&P.scale.copy(W),$!==void 0&&(h.linewidth=$),C&&ae){const xe=C.attributes.size;for(let r=0;r<ae.length;r++)xe.array[r]=ae[r];xe.needsUpdate=!0}}),l.setSize(re,t),K.aspect=1,K.updateProjectionMatrix(),i.current&&(i.current.enabled=!0),Ne(!1)},"image/png",1)},N=l=>{const c=Math.floor(l/31557600),K=Math.floor(l%(365.25*24*3600)/(24*3600)),re=Math.floor(l%(24*3600)/3600);return c>0?`${c}y ${K}d ${re}h`:K>0?`${K}d ${re}h`:`${re}h`},q=l=>l.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center w-full h-full",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{ref:y,className:"w-full h-full border border-white/20 rounded bg-black/20"}),e.jsx(xt,{isVisible:ne}),!ie&&!de&&b&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:q(b)})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 z-10",children:[e.jsx("button",{onClick:I,disabled:ne,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${ne?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:ne?"Generating image...":"Download 4K screenshot",children:ne?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(ut,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>{ne||(p(!0),X(!0))},disabled:ne,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${ne?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:ne?"Please wait...":"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})]})}),d&&Xe.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${A||ce?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${A||ce?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:q(b)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:q(b)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[H?.planets?.length||a.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",N(S-L+oe)]})]})]}),e.jsx("button",{onClick:k,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"mb-2 sm:mb-4 px-2 sm:px-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"-15y"}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"range",min:-15*365.25*24*3600,max:15*365.25*24*3600,step:604800,value:oe,onChange:l=>M(Number(l.target.value)),className:`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer 
                               [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-5 [&::-webkit-slider-thumb]:h-5 
                               [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-blue-400 
                               [&::-webkit-slider-thumb]:border-2 [&::-webkit-slider-thumb]:border-blue-600
                               [&::-webkit-slider-thumb]:cursor-pointer [&::-webkit-slider-thumb]:shadow-lg`}),e.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-0.5 h-2 bg-yellow-400 rounded"})]}),e.jsx("span",{className:"text-xs sm:text-sm text-gray-400 min-w-fit",children:"+15y"}),e.jsx("button",{onClick:()=>M(0),className:"px-2 py-1 text-xs bg-gray-600 hover:bg-gray-500 text-white rounded transition-colors duration-200",title:"Reset to current time",children:"Now"})]}),e.jsxs("div",{className:"text-center text-xs text-gray-500 mt-1",children:["Time Travel: ",oe===0?"Present":oe>0?`+${Math.abs(oe/(365.25*24*3600)).toFixed(1)} years`:`-${Math.abs(oe/(365.25*24*3600)).toFixed(1)} years`," • Range: 30 years"]})]}),e.jsx("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0",children:e.jsx(Je,{planets:H?.planets||a,stars:H?.stars||m,systemName:b,cosmicOriginTime:L,currentTime:S-L+oe,onTimeOffsetChange:l=>M(c=>c+l)})}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},Ft=({systemUrl:a,system:m,cosmicOriginTime:b})=>{const L=s.useRef(null),[E,y]=s.useState("Aligning Stargate..."),[V,v]=s.useState(!1),[x,z]=s.useState(!1),[D,G]=s.useState(!1);return s.useEffect(()=>{const i=L.current;if(!i)return;const O=i.getContext("2d");if(!O)return;let te=[];const S=800;let B,T;const d=800;let p,A=.5;function Y(){const M=i?.parentElement;if(!M||!i)return;const H=M.clientWidth,ge=M.clientHeight;i.width=Math.min(H,d),i.height=Math.min(ge,d),B=i.width/2,T=i.height/2}function ce(){Y(),te=[];for(let M=0;M<S;M++)te.push({x:Math.random()*(i?.width||800),y:Math.random()*(i?.height||800),z:Math.random()*(i?.width||800),o:Math.random()});X()}function X(){!i||!O||(O.clearRect(0,0,i.width,i.height),te.forEach(M=>{M.z-=A,M.z<=0&&(M.z=i.width,M.x=Math.random()*i.width,M.y=Math.random()*i.height,M.o=Math.random());const H=i.width/M.z,ge=(M.x-B)*H+B,ie=(M.y-T)*H+T,le=2*H;O.beginPath(),O.fillStyle=`rgba(255, 255, 255, ${M.o})`,O.arc(ge,ie,le,0,2*Math.PI),O.fill()}),A<60&&(A+=1),p=requestAnimationFrame(X))}ce();const oe=()=>Y();return window.addEventListener("resize",oe),()=>{window.removeEventListener("resize",oe),p&&cancelAnimationFrame(p)}},[]),s.useEffect(()=>{z(!0),setTimeout(()=>{G(!0)},800)},[]),s.useEffect(()=>{if(sessionStorage.getItem("stargateAnimationShown")){y("Stargate system aligned");return}sessionStorage.setItem("stargateAnimationShown","true"),v(!0);const O=(d,p)=>Array.from({length:p},()=>d[Math.floor(Math.random()*d.length)]).join(""),te=[{chars:"01",duration:40,iterations:20},{chars:"0123456789",duration:25,iterations:30},{chars:"0123456789ABCDEF",duration:20,iterations:40},{chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()-_=+[]{}|;:\\'\",.<>?/`~",duration:10,iterations:100}];let S=0,B=0;const T=()=>{if(S>=te.length){const p="Stargate system aligned";let A=0;y("");const Y=()=>{A<p.length?(y(p.substring(0,A+1)),A++,setTimeout(Y,30)):v(!1)};Y();return}const d=te[S];y(O(d.chars,32)),B++,B>=d.iterations&&(S++,B=0),setTimeout(T,d.duration)};T()},[]),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h3",{className:"text-sm font-medium text-white",children:m?.name||"System"})}),e.jsxs("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:[e.jsx("canvas",{ref:L,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${D?"opacity-0":"opacity-100"}`,style:{filter:D?"blur(50px)":"none"}}),x&&m&&e.jsx("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${x&&D?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:e.jsx(yt,{planets:m.planets,stars:m.stars,systemName:m.name,cosmicOriginTime:b||0,systemUrl:a})})]}),e.jsxs("div",{className:"text-center mt-auto",children:[e.jsxs("a",{href:a,className:`inline-block px-4 py-2 bg-gradient-to-r from-slate-800 via-slate-700 to-slate-800 text-gray-200 font-medium text-sm rounded-lg border border-slate-600 hover:border-slate-500 shadow-md hover:shadow-lg transition-all duration-300 relative overflow-hidden group ${V?"animate-pulse":""}`,style:{boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:[e.jsxs("span",{className:"relative z-10 font-mono flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.736 6.979C9.208 6.193 9.696 6 10 6s.792.193 1.264.979a1 1 0 001.715-1.029C12.279 4.784 11.232 4 10 4s-2.279.784-2.979 1.95a1 1 0 001.715 1.029zM8.5 10a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0zM10 14c-.304 0-.792-.193-1.264-.979a1 1 0 00-1.715 1.029C7.721 15.216 8.768 16 10 16s2.279-.784 2.979-1.95a1 1 0 00-1.715-1.029C10.792 13.807 10.304 14 10 14z",clipRule:"evenodd"})}),E]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-slate-600/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]})]})},jt=({planets:a,coordinates:m,systemIndex:b})=>{const[L,E]=s.useState(new Set),y=x=>({"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"})[x]||"#FFFFFF";s.useEffect(()=>{(()=>{try{const z=at(m,b,a),D=new Set;z.forEach(G=>{D.add(G.toLowerCase())}),E(D)}catch{}})()},[m,b,a]);const V=x=>x.replace(/_/g," "),v=x=>{try{rt(m,b,x,a)}catch{}window.location.href=`/planet/${x.toLowerCase()}`};return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3",children:a.map(x=>e.jsxs("div",{className:"relative bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 hover:border-white/40 transition-all duration-300 group overflow-hidden",children:[L.has(x.name.toLowerCase())&&e.jsx("div",{className:"absolute top-1 right-1 bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] px-1.5 py-0.5 rounded z-10",children:"VISITED"}),e.jsx("div",{className:"absolute -top-3 -left-3 w-8 h-8 rounded-full border border-white/40 shadow-sm z-20 animate-pulse",style:{backgroundColor:y(x.planet_type)}}),e.jsxs("button",{onClick:()=>v(x.name),className:"w-full text-left block p-2 sm:p-3 text-gray-200 hover:text-white transition-colors duration-300 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Planet"}),e.jsx("div",{className:"text-sm font-semibold text-white truncate group-hover:text-blue-300 transition-colors duration-300",children:V(x.name)})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]},x.name))}),a.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No planets found"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This system appears to be empty"})]})]})},Nt=({currentSystem:a,galaxy:m})=>{const[b,L]=s.useState(!1),[E,y]=s.useState(!1),[V,v]=s.useState(!0);s.useEffect(()=>{L(a.index>0),y(!0),v(!1)},[a.index]);const x=async()=>{if(a.index>0){if(!Me.canAffordTravel("system",1)){Me.executeTravel("system",1);return}if(!Me.executeTravel("system",1))return;const G=m.coordinates.join(",");Pe(G,a.index-1),window.location.href=`/system/${a.index-1}`}},z=async()=>{if(!Me.canAffordTravel("system",1)){Me.executeTravel("system",1);return}if(!Me.executeTravel("system",1))return;const G=m.coordinates.join(",");Pe(G,a.index+1),window.location.href=`/system/${a.index+1}`};return V?null:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:x,disabled:!b,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${b?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:z,disabled:!E,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${E?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})},Et=({system:a,galaxy:m,system_url:b,version:L,system_index:E,image_url:y,page:V,cosmic_origin_time:v})=>{const[x]=s.useState(m.coordinates.join(","));s.useEffect(()=>{document.body.setAttribute("data-coordinates",x),document.body.setAttribute("data-system-index",E.toString()),Pe(x,E)},[x,E]);const z=G=>G.replace(/_/g," "),D=G=>G.replace(/_/g," ");return e.jsxs("div",{className:"w-full h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white overflow-auto",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(ot,{}),e.jsxs("div",{className:"relative z-10 pt-1",children:[e.jsx(it,{}),e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["System '",z(a.name),"'"]}),e.jsxs("p",{className:"text-lg sm:text-xl text-gray-300",children:["at Galaxy '",D(m.name),"' - Coordinates ",m.coordinates.join(", ")]})]}),e.jsx(Nt,{currentSystem:{name:a.name,index:E},galaxy:m}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[e.jsx("div",{className:"order-1 lg:order-1",children:e.jsx(Ft,{systemUrl:b,system:a,cosmicOriginTime:v})}),e.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),e.jsx("div",{className:"order-2 lg:order-2",children:e.jsx(vt,{system:a,galaxy:m,systemIndex:E,cosmicOriginTime:v})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:["Planets in '",z(a.name),"'"]}),e.jsx(jt,{planets:a.planets,coordinates:x,systemIndex:E})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${V}`,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:e.jsxs("span",{className:"text-base sm:text-lg",children:["← Back to Galaxy '",D(m.name),"'"]})})})]}),e.jsx(bt,{version:L})]}),e.jsx(ht,{}),e.jsx(lt,{currentLocation:{type:"system",name:a.name,coordinates:m.coordinates.join(","),systemIndex:a.index}})]})};document.addEventListener("DOMContentLoaded",async()=>{try{const a=document.getElementById("system-data"),m=document.getElementById("galaxy-data"),b=document.getElementById("meta-data");if(!a||!m||!b)return;const L=JSON.parse(a.textContent||"{}"),E=JSON.parse(m.textContent||"{}"),y=JSON.parse(b.textContent||"{}"),V={system:L,galaxy:E,system_url:y.system_url,version:y.version,system_index:y.system_index,image_url:y.image_url,page:y.page||1,cosmic_origin_time:y.cosmic_origin_time},v=document.getElementById("atlas-react-root");v&&et.createRoot(v).render(tt.createElement(Et,V))}catch{}});
