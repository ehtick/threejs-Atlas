import{j as e,r as x}from"./atlas_C3xj8MG9oH9uC54MklkAb.js";import{g as C,s as R,a as j,m as Me,r as Ie,S as m,R as oe,A as G,E as $,D as z,U as pe}from"./atlas_rQxpL_TZ4r6gbTsCbGbF8.js";class B{static STORAGE_KEY="_atlasDailyChallenges";static BASE_GOALS={galaxies:1,systems:3,planets:10};static getTodaysChallenges(){const t=new Date().toISOString().split("T")[0],s=this.getStoredChallenges();return!s||s.date!==t?this.createNewDayChallenges(t,s):s}static getStoredChallenges(){try{const t=C(this.STORAGE_KEY);return t?JSON.parse(t):null}catch(t){return console.error("Error reading daily challenges:",t),null}}static createNewDayChallenges(t,s){const a=s?s.dayNumber+1:1,r=Math.pow(1.1,a-1),n=this.getCurrentStats(),o=[{type:"galaxies",current:n.galaxies,target:Math.ceil(a*this.BASE_GOALS.galaxies*r),dayNumber:a,completed:!1},{type:"systems",current:n.systems,target:Math.ceil(a*this.BASE_GOALS.systems*r),dayNumber:a,completed:!1},{type:"planets",current:n.planets,target:Math.ceil(a*this.BASE_GOALS.planets*r),dayNumber:a,completed:!1}],c=(s?.totalCompletedDays||0)+(s?.dayCompleted?1:0),d={date:t,dayNumber:a,challenges:o,lastReset:Date.now(),totalCompletedDays:c,dayCompleted:!1};return this.saveChallenges(d),d}static getCurrentStats(){try{const t=C("__atlasArchive");if(!t)return{galaxies:0,systems:0,planets:0};const s=JSON.parse(t);let a=0,r=0;Object.values(s.g||{}).forEach(d=>{a+=Object.keys(d).length,Object.values(d).forEach(l=>{typeof l=="string"&&(r+=(l.match(/1/g)||[]).length)})});const n=new Set(Object.keys(s.g||{})),o=new Set(Object.keys(s.gv||{}));return{galaxies:new Set([...n,...o]).size,systems:a,planets:r}}catch(t){return console.error("Error getting current stats:",t),{galaxies:0,systems:0,planets:0}}}static updateProgress(){const t=this.getTodaysChallenges(),s=this.getCurrentStats();return t.challenges.forEach(r=>{const n=s[r.type];r.current=n,r.completed=n>=r.target}),t.challenges.every(r=>r.completed)&&!t.dayCompleted&&(t.dayCompleted=!0),this.saveChallenges(t),t}static getCompletedDaysCount(){try{return this.getTodaysChallenges().totalCompletedDays||0}catch(t){return console.error("Error getting completed days count:",t),0}}static saveChallenges(t){try{R(this.STORAGE_KEY,JSON.stringify(t))}catch(s){console.error("Error saving daily challenges:",s)}}static getCompletionStatus(){const t=this.getTodaysChallenges(),s=t.challenges.filter(r=>r.completed).length,a=t.challenges.length;return{completed:s,total:a,allCompleted:s===a}}static getDayInfo(){const t=this.getTodaysChallenges(),s=Math.pow(1.1,t.dayNumber-1);return{dayNumber:t.dayNumber,multiplier:Math.round(s*100)/100}}}const I=f=>{const[t,s,a]=f.split(",").map(Number);return`${t.toString(36)}_${s.toString(36)}_${a.toString(36)}`};class T{static STORAGE_KEY=j.ARCHIVE;static MAX_ENTRIES_PER_GALAXY=1e3;static getData(){try{this.migrateToEncodedStorage(),this.cleanupLegacyStorage();const t=C(this.STORAGE_KEY);if(!t)return{g:{},gv:{}};const s=JSON.parse(t);return s.gv||(s.gv={}),s}catch(t){return console.error("Error reading Atlas archive:",t),{g:{},gv:{}}}}static cleanupLegacyStorage(){try{const t="atlasHistoricalData";localStorage.getItem(t)&&localStorage.removeItem(t)}catch(t){console.error("Error cleaning up legacy storage:",t)}}static migrateToEncodedStorage(){try{localStorage.getItem(this.STORAGE_KEY)&&Me()}catch(t){console.error("Error migrating to encoded storage:",t)}}static saveData(t){try{R(this.STORAGE_KEY,JSON.stringify(t))}catch(s){console.error("Error saving Atlas archive:",s)}}static performCleanup(t){const s=Object.keys(t.g);s.length>100&&s.slice(0,s.length-100).forEach(r=>delete t.g[r]),Object.keys(t.g).forEach(a=>{const r=t.g[a],n=Object.keys(r);n.length>this.MAX_ENTRIES_PER_GALAXY&&n.slice(0,n.length-this.MAX_ENTRIES_PER_GALAXY).forEach(c=>delete r[c])})}static performEmergencyCleanup(){const t=document.body.getAttribute("data-coordinates");if(t){const s=I(t),a=this.getData(),r=a.g[s];a.g={},r&&(a.g[s]=r),this.saveData(a)}}static markPlanetVisited(t,s,a,r){const n=this.getData(),o=I(t),c=s.toString(16),d=r.findIndex(u=>u.name.toLowerCase()===a.toLowerCase());if(d===-1){console.warn(`Planet ${a} not found in system planets list`);return}n.g[o]||(n.g[o]={}),n.g[o][c]||(n.g[o][c]="");const l=this.bitmapToIndices(n.g[o][c]);l.includes(d)||(l.push(d),n.g[o][c]=this.indicesToBitmap(l),this.saveData(n),B.updateProgress())}static markGalaxyVisited(t){const s=this.getData(),a=I(t);s.gv[a]||(s.gv[a]=!0,console.log(`🌌 Galaxy marked as visited: ${t} (hash: ${a})`),this.saveData(s),B.updateProgress())}static markSystemVisited(t,s){const a=this.getData(),r=I(t),n=s.toString(16);this.markGalaxyVisited(t),a.g[r]||(a.g[r]={}),a.g[r][n]||(a.g[r][n]="",this.saveData(a),B.updateProgress())}static bitmapToIndices(t){return t?t.split("").map((s,a)=>s==="1"?a:-1).filter(s=>s!==-1):[]}static indicesToBitmap(t){if(t.length===0)return"";const s=Math.max(...t),a=Array(s+1).fill("0");return t.forEach(r=>{r>=0&&(a[r]="1")}),a.join("")}static isGalaxyVisited(t){const s=this.getData(),a=I(t);return!!s.gv[a]}static isSystemVisited(t,s){const a=this.getData(),r=I(t),n=s.toString(16);return!!(a.g[r]&&n in a.g[r])}static getVisitedPlanets(t,s,a){const r=this.getData(),n=I(t),o=s.toString(16),c=r.g[n]?.[o]||"";return this.bitmapToIndices(c).map(l=>{const u=a[l];return u?u.name.toLowerCase():null}).filter(l=>l!==null)}static getVisitedPlanetCount(t,s){const a=this.getData(),r=I(t),n=s.toString(16),o=a.g[r]?.[n]||"";return this.bitmapToIndices(o).length}static getStorageStats(){const t=this.getData();let s=0;Object.values(j).forEach(l=>{const u=C(l);u&&(s+=u.length)});let r=0,n=0;Object.values(t.g).forEach(l=>{r+=Object.keys(l).length,Object.values(l).forEach(u=>{typeof u=="string"&&(n+=(u.match(/1/g)||[]).length)})});const o=new Set(Object.keys(t.g||{})),c=new Set(Object.keys(t.gv||{})),d=new Set([...o,...c]);return{size:s,galaxies:d.size,visitedGalaxies:Object.keys(t.gv).length,systems:r,planets:n}}}const Pe=f=>{T.markGalaxyVisited(f)},Ue=(f,t,s,a)=>{T.markPlanetVisited(f,t,s,a)},_e=(f,t)=>{T.markSystemVisited(f,t)},Ge=(f,t,s)=>T.getVisitedPlanets(f,t,s),De=(f,t)=>T.isSystemVisited(f,t),$e=(f,t,s,a)=>{if(!De(f,t))return"none";{const r=T.getVisitedPlanetCount(f,t);return r>=s&&s>0?"complete":(r>0,"partial")}},Oe=()=>T.getStorageStats();class H{static STORAGE_KEY="_atlasLocations";static BASE_MAX_LOCATIONS=5;static BONUS_PER_COMPLETION=5;static ABSOLUTE_MAX_LOCATIONS=999;static getLocations(){try{const t=C(this.STORAGE_KEY);if(!t)return[];const s=JSON.parse(t);return Array.isArray(s)?s:[]}catch(t){return console.error("Error reading saved locations:",t),[]}}static normalizeStargateUrl(t){const s=t.indexOf("/stargate/");return s!==-1?t.substring(s):t}static isLocationSaved(t){const s=this.normalizeStargateUrl(t);return this.getLocations().some(r=>this.normalizeStargateUrl(r.stargateUrl)===s)}static async saveLocation(t){try{const s=this.getLocations(),a=this.getCurrentMaxLocations(),r=s.findIndex(o=>o.stargateUrl===t.stargateUrl),n={...t,id:this.generateId(),timestamp:Date.now()};return r!==-1?(s[r]=n,R(this.STORAGE_KEY,JSON.stringify(s)),!0):s.length>=a&&!await this.showSlotFullDialog(a)?!1:(s.push(n),s.length>a&&(s.sort((o,c)=>c.timestamp-o.timestamp),s.splice(a)),R(this.STORAGE_KEY,JSON.stringify(s)),!0)}catch(s){return console.error("Error saving location:",s),!1}}static saveLocationSync(t){const s=this.getLocations(),a=this.getCurrentMaxLocations(),r=s.findIndex(o=>o.stargateUrl===t.stargateUrl),n={...t,id:this.generateId(),timestamp:Date.now()};r!==-1?s[r]=n:s.push(n),s.length>a&&(s.sort((o,c)=>c.timestamp-o.timestamp),s.splice(a)),R(this.STORAGE_KEY,JSON.stringify(s))}static removeLocation(t){try{const a=this.getLocations().filter(r=>r.id!==t);R(this.STORAGE_KEY,JSON.stringify(a))}catch(s){console.error("Error removing location:",s)}}static clearAllLocations(){try{Ie(this.STORAGE_KEY)}catch(t){console.error("Error clearing locations:",t)}}static generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static async showSlotFullDialog(t){return new Promise(s=>{const a=document.createElement("div");a.className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm transition-all duration-300 opacity-0",a.style.backdropFilter="blur(8px)";const r=document.createElement("div");r.className="relative bg-gradient-to-br from-slate-900/95 to-slate-800/95 border border-slate-600/50 rounded-2xl p-8 max-w-md mx-4 text-white shadow-2xl backdrop-blur-xl transform scale-95 transition-all duration-300",r.style.backdropFilter="blur(20px)",r.style.boxShadow="0 25px 50px -12px rgba(0, 0, 0, 0.8), 0 0 0 1px rgba(255, 255, 255, 0.05)";const n=document.createElement("div");n.className="text-center";const o=document.createElement("div");o.className="inline-flex items-center justify-center w-16 h-16 bg-amber-500/20 rounded-full mb-6";const c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("class","w-8 h-8 text-amber-400"),c.setAttribute("fill","none"),c.setAttribute("stroke","currentColor"),c.setAttribute("viewBox","0 0 24 24");const d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-width","2"),d.setAttribute("d","M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z");const l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("stroke-linecap","round"),l.setAttribute("stroke-linejoin","round"),l.setAttribute("stroke-width","2"),l.setAttribute("d","M15 11a3 3 0 11-6 0 3 3 0 016 0z"),c.appendChild(d),c.appendChild(l),o.appendChild(c);const u=document.createElement("h2");u.className="text-2xl font-bold mb-4 text-white",u.textContent="Storage Full";const y=document.createElement("p");y.className="text-slate-400 mb-6 text-[10px] bg-slate-800/50 rounded-lg p-3 border border-slate-700/50",y.textContent="💡 Complete daily challenges to increase your storage capacity";const E=document.createElement("p");E.className="text-slate-300 mb-4 text-base leading-relaxed",E.textContent="You have reached your maximum of ";const A=document.createElement("span");A.className="font-bold text-amber-400 bg-amber-400/10 px-2 py-1 rounded-lg",A.textContent=t.toString(),E.appendChild(A),E.appendChild(document.createTextNode(" saved locations."));const w=document.createElement("p");w.className="text-slate-200 mb-8 text-base",w.textContent="Overwrite the oldest saved location?";const p=document.createElement("div");p.className="flex gap-4 justify-center";const k=document.createElement("button");k.id="cancelSave",k.className="px-6 py-3 bg-slate-700/80 hover:bg-slate-600/80 border border-slate-600/50 hover:border-slate-500/50 rounded-xl transition-all duration-200 font-medium text-slate-200 hover:text-white transform hover:scale-105 hover:shadow-lg",k.textContent="Cancel";const b=document.createElement("button");b.id="confirmOverwrite",b.className="px-6 py-3 bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 rounded-xl transition-all duration-200 font-semibold text-white transform hover:scale-105 hover:shadow-lg border border-amber-400/30",b.textContent="Overwrite",p.appendChild(k),p.appendChild(b),n.appendChild(o),n.appendChild(u),n.appendChild(y),n.appendChild(E),n.appendChild(w),n.appendChild(p),r.appendChild(n),a.appendChild(r),document.body.appendChild(a),requestAnimationFrame(()=>{a.style.opacity="1",r.style.transform="scale(1)"});const F=r.querySelector("#cancelSave"),S=r.querySelector("#confirmOverwrite"),D=L=>{a.style.opacity="0",r.style.transform="scale(0.95)",setTimeout(()=>{document.body.contains(a)&&document.body.removeChild(a),s(L)},300)};F?.addEventListener("click",()=>{D(!1)}),S?.addEventListener("click",()=>{D(!0)}),a.addEventListener("click",L=>{L.target===a&&D(!1)});const h=L=>{L.key==="Escape"&&(document.removeEventListener("keydown",h),D(!1))};document.addEventListener("keydown",h)})}static hasAvailableSlot(){const t=this.getLocations(),s=this.getCurrentMaxLocations();return t.length<s}static getAvailableSlots(){const t=this.getLocations(),s=this.getCurrentMaxLocations();return Math.max(0,s-t.length)}static getCurrentMaxLocations(){try{const t=this.getCompletedDaysCount(),s=B.getCompletionStatus().allCompleted?1:0,a=this.BASE_MAX_LOCATIONS+(t+s)*this.BONUS_PER_COMPLETION;return Math.min(a,this.ABSOLUTE_MAX_LOCATIONS)}catch(t){return console.error("Error calculating max locations:",t),this.BASE_MAX_LOCATIONS}}static getCompletedDaysCount(){try{const t=C("_atlasDailyChallenges");return t&&JSON.parse(t).totalCompletedDays||0}catch(t){return console.error("Error getting completion history:",t),0}}static getLocationStats(){const t=this.getLocations(),s=this.getCurrentMaxLocations();return{total:t.length,galaxies:t.filter(a=>a.type==="galaxy").length,systems:t.filter(a=>a.type==="system").length,planets:t.filter(a=>a.type==="planet").length,maxAllowed:s,available:Math.max(0,s-t.length)}}static async saveLocationWithConfirmation(t,s,a){try{const r={name:t,type:s,stargateUrl:a};return await this.saveLocation(r)?{success:!0,message:`Location "${t}" saved successfully!`}:{success:!1,message:"Save operation cancelled by user."}}catch(r){return console.error("Error saving location with confirmation:",r),{success:!1,message:"Failed to save location. Please try again."}}}}class le{static VERSION="2.4.42";static generateFallbackHash(t){let s=0;for(let a=0;a<t.length;a++){const r=t.charCodeAt(a);s=(s<<5)-s+r,s=s&s}return Math.abs(s).toString(16).padStart(8,"0")}static async generateHash(t){if(!crypto||!crypto.subtle||!crypto.subtle.digest)return console.warn("crypto.subtle not available, using fallback hash"),this.generateFallbackHash(t);const s=new TextEncoder().encode(t),a=await crypto.subtle.digest("SHA-256",s);return Array.from(new Uint8Array(a)).map(o=>o.toString(16).padStart(2,"0")).join("")}static async verifyHash(t,s){const a=await this.generateHash(t);if(s===a)return!0;if(s.length===8||a.length===8){if(!crypto||!crypto.subtle||!crypto.subtle.digest)return console.warn("Cannot verify SHA-256 hash in non-secure context, accepting"),!0;{const r=this.generateFallbackHash(t);return s===r}}return!1}static async exportAllData(){const t=Date.now(),s={spaceship:btoa(encodeURIComponent(j.SPACESHIP)),archive:btoa(encodeURIComponent(j.ARCHIVE)),dailyChallenges:btoa(encodeURIComponent(j.DAILY_CHALLENGES)),locations:btoa(encodeURIComponent(j.LOCATIONS))},a={spaceship:localStorage.getItem(s.spaceship),archive:localStorage.getItem(s.archive),dailyChallenges:localStorage.getItem(s.dailyChallenges),locations:localStorage.getItem(s.locations)},r={};a.spaceship&&(r.spaceship=await this.generateHash(a.spaceship)),a.archive&&(r.archive=await this.generateHash(a.archive)),a.dailyChallenges&&(r.dailyChallenges=await this.generateHash(a.dailyChallenges)),a.locations&&(r.locations=await this.generateHash(a.locations));const n={version:this.VERSION,timestamp:t,data:a,hashes:r},o=JSON.stringify(n),c=await this.generateHash(o),d={...n,checksum:c},l=JSON.stringify(d),u=new TextEncoder().encode(l);return btoa(String.fromCharCode(...u))}static async downloadExport(){try{const t=await this.exportAllData(),a=`atlas-data-saved-${new Date().toISOString().replace(/[:.]/g,"-").slice(0,19)}.atl`,r=new Blob([t],{type:"application/octet-stream"}),n=URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download=a,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)}catch(t){throw console.error("Error exporting data:",t),new Error("Failed to export data")}}static async importData(t){return new Promise((s,a)=>{const r=new FileReader;r.onload=async n=>{try{const o=n.target?.result,c=atob(o).split("").map(p=>p.charCodeAt(0)),d=new TextDecoder().decode(new Uint8Array(c)),l=JSON.parse(d);if(!this.validateImportData(l))throw new Error("Invalid import data format");const{checksum:u,...y}=l,E=JSON.stringify(y);if(!await this.verifyHash(E,u))throw new Error("Data integrity check failed. File may have been tampered with.");if(l.data.spaceship&&l.hashes.spaceship&&!await this.verifyHash(l.data.spaceship,l.hashes.spaceship))throw new Error("Spaceship data integrity check failed");if(l.data.archive&&l.hashes.archive&&!await this.verifyHash(l.data.archive,l.hashes.archive))throw new Error("Archive data integrity check failed");if(l.data.dailyChallenges&&l.hashes.dailyChallenges&&!await this.verifyHash(l.data.dailyChallenges,l.hashes.dailyChallenges))throw new Error("Daily challenges data integrity check failed");if(l.data.locations&&l.hashes.locations&&!await this.verifyHash(l.data.locations,l.hashes.locations))throw new Error("Locations data integrity check failed");const w={spaceship:btoa(encodeURIComponent(j.SPACESHIP)),archive:btoa(encodeURIComponent(j.ARCHIVE)),dailyChallenges:btoa(encodeURIComponent(j.DAILY_CHALLENGES)),locations:btoa(encodeURIComponent(j.LOCATIONS))};l.data.spaceship!==void 0&&(l.data.spaceship===null?localStorage.removeItem(w.spaceship):localStorage.setItem(w.spaceship,l.data.spaceship)),l.data.archive!==void 0&&(l.data.archive===null?localStorage.removeItem(w.archive):localStorage.setItem(w.archive,l.data.archive)),l.data.dailyChallenges!==void 0&&(l.data.dailyChallenges===null?localStorage.removeItem(w.dailyChallenges):localStorage.setItem(w.dailyChallenges,l.data.dailyChallenges)),l.data.locations!==void 0&&(l.data.locations===null?localStorage.removeItem(w.locations):localStorage.setItem(w.locations,l.data.locations)),window.location.reload(),s()}catch(o){console.error("Error importing data:",o),a(new Error(o instanceof Error?o.message:"Failed to import data. Please ensure the file is valid."))}},r.onerror=()=>{a(new Error("Failed to read file"))},r.readAsText(t)})}static validateImportData(t){return t&&typeof t=="object"&&typeof t.version=="string"&&typeof t.timestamp=="number"&&t.data&&typeof t.data=="object"&&t.hashes&&typeof t.hashes=="object"&&typeof t.checksum=="string"}static getDataSummary(){const t=C(j.SPACESHIP),s=C(j.ARCHIVE),a=C(j.DAILY_CHALLENGES),r=C(j.LOCATIONS),n=o=>o?new Blob([o]).size:0;return{hasSpaceship:!!t,hasArchive:!!s,hasDailyChallenges:!!a,hasLocations:!!r,totalSize:n(t)+n(s)+n(a)+n(r)}}}const V=({value:f,max:t,label:s,color:a="indigo",size:r="xs",showPercentage:n=!1})=>{const o=t>0?Math.min(f/t*100,100):0,c={indigo:{bg:"bg-indigo-500/20",fill:"bg-gradient-to-r from-indigo-500 to-indigo-400",text:"text-indigo-400"},blue:{bg:"bg-blue-500/20",fill:"bg-gradient-to-r from-blue-500 to-blue-400",text:"text-blue-400"},purple:{bg:"bg-purple-500/20",fill:"bg-gradient-to-r from-purple-500 to-purple-400",text:"text-purple-400"},cyan:{bg:"bg-cyan-500/20",fill:"bg-gradient-to-r from-cyan-500 to-cyan-400",text:"text-cyan-400"},green:{bg:"bg-green-500/20",fill:"bg-gradient-to-r from-green-500 to-green-400",text:"text-green-400"},orange:{bg:"bg-orange-500/20",fill:"bg-gradient-to-r from-orange-500 to-orange-400",text:"text-orange-400"},yellow:{bg:"bg-yellow-500/20",fill:"bg-gradient-to-r from-yellow-500 to-yellow-400",text:"text-yellow-400"}},d={xs:"h-1.5",sm:"h-2"},l=c[a]||c.indigo,u=d[r];return e.jsxs("div",{className:"w-full",children:[s&&e.jsxs("div",{className:"flex items-center justify-between text-xs mb-1",children:[e.jsx("span",{className:"text-gray-400",children:s}),n&&e.jsxs("span",{className:`${l.text} font-medium`,children:[o.toFixed(0),"%"]})]}),e.jsx("div",{className:`w-full ${l.bg} rounded-full overflow-hidden ${u}`,children:e.jsx("div",{className:`${l.fill} ${u} rounded-full transition-all duration-700 ease-out shadow-sm`,style:{width:`${o}%`},children:e.jsx("div",{className:`w-full h-full ${l.fill} opacity-50 animate-pulse`})})})]})},ze=({currentLocation:f})=>{const[t,s]=x.useState(!1),[a,r]=x.useState(!1),[n,o]=x.useState("stats"),[c,d]=x.useState(null),[l,u]=x.useState([]),[y,E]=x.useState(null),[A,w]=x.useState(null),[p,k]=x.useState({antimatter:0,element115:0,deuterium:0}),[b,F]=x.useState({level:1,efficiency:1,range:300,storage:500,multiplier:1}),[S,D]=x.useState({antimatter:0,element115:0,deuterium:0}),[h,L]=x.useState({antimatter:0,element115:0,deuterium:0,sources:{planets:0,systems:0,galaxies:0}}),[ee,ie]=x.useState({antimatter:0,element115:0,deuterium:0,sources:{planets:0,systems:0,galaxies:0}}),[te,ce]=x.useState(!1),[K,de]=x.useState(!1),[,fe]=x.useState({}),[me,P]=x.useState(null),[be,he]=x.useState(!1),se=x.useRef(null),ae=x.useRef(null),Y=x.useRef(null);x.useEffect(()=>{if(t){d(Oe()),u(H.getLocations()),E(H.getLocationStats());const i=B.updateProgress();w(i),k(m.getResources()),F(m.getUpgrade());const g=m.getUpgrade();D(m.getUpgradeCost(g.level));const v=m.getAccumulatedResourcesWithLimit();L(v);const M=m.calculatePassiveGeneration();ie(M)}},[t]),x.useEffect(()=>{if(!t)return;const i=()=>{const W=m.getAccumulatedResourcesWithLimit();L(W);const X=m.calculatePassiveGeneration();ie(X)},g=()=>{k(m.getResources())},v=setInterval(i,15e3),M=oe.subscribe("resources_updated",g);let O=null;return n==="saved"&&(O=setInterval(()=>{fe({})},3e4)),()=>{clearInterval(v),O&&clearInterval(O),M()}},[t,n]);const re=()=>{r(!0),setTimeout(()=>{s(!1),r(!1)},300)},ye=async()=>{try{await le.downloadExport()}catch(i){console.error("Export failed:",i),P("Export failed. Please try again."),setTimeout(()=>P(null),3e3)}},ve=async i=>{const g=i.target.files?.[0];if(g){if(!g.name.endsWith(".atl")){P("Please select a valid .atl file"),setTimeout(()=>P(null),3e3);return}try{await le.importData(g),he(!0),setTimeout(()=>he(!1),3e3)}catch(v){P(v instanceof Error?v.message:"Import failed"),setTimeout(()=>P(null),3e3)}Y.current&&(Y.current.value="")}},we=()=>{t?re():s(!0)};x.useEffect(()=>{const i=g=>{t&&!a&&se.current&&!se.current.contains(g.target)&&re()};return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[t,a]),x.useEffect(()=>{const i=g=>{te&&!K&&ae.current&&!ae.current.contains(g.target)&&J()};return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[te,K]);const je=i=>{if(i===0)return"0 B";const g=1024,v=["B","KB","MB"],M=Math.floor(Math.log(i)/Math.log(g));return parseFloat((i/Math.pow(g,M)).toFixed(2))+" "+v[M]},ue=i=>i.replace(/_/g," "),Ne=(i,g)=>{i.stopPropagation(),H.removeLocation(g),u(H.getLocations()),E(H.getLocationStats())},J=()=>{de(!0),setTimeout(()=>{ce(!1),de(!1)},300)};return e.jsx(e.Fragment,{children:e.jsxs("div",{ref:se,className:"fixed bottom-4 sm:bottom-6 right-4 sm:right-6 z-50",children:[e.jsxs("button",{onClick:we,className:"w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-br from-blue-600 via-purple-600 to-blue-800 hover:from-blue-500 hover:via-purple-500 hover:to-blue-700 text-white rounded-full shadow-2xl border-2 border-blue-400/30 transition-all duration-300 transform hover:scale-105 backdrop-blur-sm",title:"Spaceship Control Panel",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("svg",{className:"flex items-center justify-center",xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",children:e.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,children:[e.jsx("path",{d:"M12 3a6.02 6.02 0 0 0-5.923 4.9c-.086.466-.13.699.032 1.005c.161.307.39.409.847.613c1.38.614 3.134.982 5.044.982s3.665-.368 5.044-.982c.457-.204.686-.306.847-.613c.162-.306.118-.54.032-1.005A6.02 6.02 0 0 0 12 3"}),e.jsx("path",{d:"M17 5.5c2.989.788 5 2.26 5 3.945C22 11.961 17.523 14 12 14S2 11.96 2 9.445C2 7.76 4.011 6.288 7 5.5M12 18v3m5-4l1 4M7 17l-1 4"})]})})}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-blue-400/20 animate-ping"})]}),t&&e.jsxs("div",{className:"fixed bottom-20 sm:bottom-24 right-2 sm:right-6 w-[calc(100vw-1rem)] sm:w-96 max-w-md max-h-[70vh] sm:max-h-96 bg-black/90 backdrop-blur-xl rounded-2xl border border-blue-400/30 shadow-2xl z-40 overflow-hidden transition-all duration-300 ease-out",style:{animation:a?"slideDownFadeOut 0.3s ease-out forwards":"slideUpFadeIn 0.3s ease-out forwards"},children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600/20 to-purple-600/20 p-4 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full animate-pulse"}),e.jsx("h3",{className:"text-white font-bold text-lg",children:"🚀 Spaceship Control"})]}),e.jsx("button",{onClick:re,className:"text-gray-400 hover:text-white transition-colors duration-200",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex mt-3 space-x-1 overflow-x-auto",children:[e.jsx("button",{onClick:()=>o("stats"),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors duration-200 whitespace-nowrap ${n==="stats"?"bg-blue-500/30 text-blue-300 border border-blue-500/50":"text-gray-400 hover:text-white hover:bg-white/10"}`,children:"📊 Stats"}),e.jsx("button",{onClick:()=>o("ship"),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors duration-200 whitespace-nowrap ${n==="ship"?"bg-green-500/30 text-green-300 border border-green-500/50":"text-gray-400 hover:text-white hover:bg-white/10"}`,children:"🚀 Ship"}),e.jsxs("button",{onClick:()=>o("saved"),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors duration-200 whitespace-nowrap ${n==="saved"?"bg-purple-500/30 text-purple-300 border border-purple-500/50":"text-gray-400 hover:text-white hover:bg-white/10"}`,children:["📍 Saved (",y?.total||0,")"]})]})]}),e.jsxs("div",{className:"p-4 max-h-64 overflow-y-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]",children:[n==="stats"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold mb-2 text-xs",children:"🌟 Daily Challenges"}),e.jsx("div",{className:"bg-white/5 rounded p-2 border border-indigo-500/20",children:A&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:"Today's Progress"}),e.jsxs("span",{className:"text-[9px] text-indigo-400",children:["Day ",A.dayNumber," • x",B.getDayInfo().multiplier]})]}),e.jsx("div",{className:"space-y-1.5 mb-2",children:A.challenges.map(i=>{const g={galaxies:"indigo",systems:"blue",planets:"purple"},v={galaxies:"Galaxies",systems:"Systems",planets:"Planets"};return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"text-[10px] text-gray-400 mb-0.5",children:v[i.type]}),e.jsx(V,{value:i.current,max:i.target,label:`${i.current}/${i.target}`,color:g[i.type],showPercentage:!0}),i.completed&&e.jsx("div",{className:"absolute -right-2 top-1.5",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:12,height:12,viewBox:"0 0 128 128",children:e.jsx("path",{fill:"#40c0e7",stroke:"#40c0e7",strokeMiterlimit:10,strokeWidth:6,d:"M48.3 103.45L12.65 67.99a2.2 2.2 0 0 1 0-3.12l9-9.01c.86-.86 2.25-.86 3.11 0l23.47 23.33c.86.86 2.26.85 3.12-.01l51.86-52.36c.86-.87 2.26-.87 3.13-.01l9.01 9.01c.86.86.86 2.25.01 3.11l-56.5 57.01l.01.01l-7.45 7.49c-.86.86-2.26.86-3.12.01z"})})})]},i.type)})}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 text-[10px]",children:[e.jsxs("div",{className:"bg-black/30 rounded p-1.5 border border-indigo-500/30",children:[e.jsx("div",{className:"text-gray-400 text-[9px]",children:"Completed"}),e.jsxs("div",{className:"text-indigo-400 font-bold",children:[A.challenges.filter(i=>i.completed).length,"/",A.challenges.length]})]}),e.jsxs("div",{className:"bg-black/30 rounded p-1.5 border border-green-500/30",children:[e.jsx("div",{className:"text-gray-400 text-[9px]",children:"Atlas Size"}),e.jsx("div",{className:"text-green-400 font-bold",children:c?je(c.size):"0 B"})]})]})]})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold mb-2 text-xs",children:"📍 Saved Locations"}),e.jsxs("div",{className:"bg-white/5 rounded p-2 border border-purple-500/20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:"Storage Usage"}),e.jsxs("span",{className:"text-[9px] text-purple-400",children:[y?.total||0,"/",y?.maxAllowed||50," slots"]})]}),e.jsx("div",{className:"mb-2",children:e.jsx(V,{value:y?.total||0,max:y?.maxAllowed||50,label:`${y?.total||0}/${y?.maxAllowed||50}`,color:"purple",showPercentage:!0})}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 text-[10px]",children:[e.jsxs("div",{className:"bg-black/30 rounded p-1 text-center border border-indigo-500/30",children:[e.jsx("div",{className:"text-gray-400 text-[9px]",children:"Galaxies"}),e.jsx("div",{className:"text-indigo-400 font-bold",children:y?.galaxies||0})]}),e.jsxs("div",{className:"bg-black/30 rounded p-1 text-center border border-blue-500/30",children:[e.jsx("div",{className:"text-gray-400 text-[9px]",children:"Systems"}),e.jsx("div",{className:"text-blue-400 font-bold",children:y?.systems||0})]}),e.jsxs("div",{className:"bg-black/30 rounded p-1 text-center border border-purple-500/30",children:[e.jsx("div",{className:"text-gray-400 text-[9px]",children:"Planets"}),e.jsx("div",{className:"text-purple-400 font-bold",children:y?.planets||0})]})]}),e.jsx("div",{className:"text-[8px] text-gray-500 mt-2",children:"Complete daily tasks to save more locations"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold mb-2 text-xs",children:"💾 Data Management"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"bg-white/5 rounded p-2 border border-blue-500/20",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:"Export/Import Atlas Data"}),e.jsx("span",{className:"text-[9px] text-blue-400",children:(()=>{const i=le.getDataSummary();return`${[i.hasSpaceship,i.hasArchive,i.hasDailyChallenges,i.hasLocations].filter(Boolean).length}/4 keys`})()})]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs("button",{onClick:ye,className:"flex-1 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 text-[10px] px-2 py-1.5 rounded border border-blue-500/50 transition-colors duration-200 flex items-center justify-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:14,viewBox:"0 0 24 24",children:e.jsxs("g",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeWidth:1.5,children:[e.jsx("path",{d:"M4 12a8 8 0 1 0 16 0"}),e.jsx("path",{strokeLinejoin:"round",d:"M12 14V4m0 0l3 3m-3-3L9 7"})]})}),e.jsx("span",{children:"Export"})]}),e.jsxs("button",{onClick:()=>Y.current?.click(),className:"flex-1 bg-green-500/20 hover:bg-green-500/30 text-green-300 text-[10px] px-2 py-1.5 rounded border border-green-500/50 transition-colors duration-200 flex items-center justify-center gap-1",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:14,viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"currentColor",d:"M14.47 10.47a.75.75 0 1 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 1 1 1.06-1.06l1.72 1.72V4a.75.75 0 0 1 1.5 0v8.19z"}),e.jsx("path",{fill:"currentColor",d:"M20.75 12a.75.75 0 0 0-1.5 0a7.25 7.25 0 1 1-14.5 0a.75.75 0 0 0-1.5 0a8.75 8.75 0 1 0 17.5 0"})]}),e.jsx("span",{children:"Import"})]})]}),e.jsx("input",{ref:Y,type:"file",accept:".atl",onChange:ve,className:"hidden"}),me&&e.jsx("div",{className:"mt-2 text-[9px] text-red-400 bg-red-500/10 p-1 rounded",children:me}),be&&e.jsx("div",{className:"mt-2 text-[9px] text-green-400 bg-green-500/10 p-1 rounded",children:"Data imported successfully! Reloading..."}),e.jsx("div",{className:"text-[8px] text-gray-500 mt-2",children:"Saves all localStorage keys to .atl file"})]})})]})]}),n==="ship"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-white font-semibold mb-2 text-xs flex items-center gap-1",children:["⚡ Resources",e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Lv.",b.level]})]}),e.jsxs("div",{className:"space-y-1 mb-2",children:[e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-purple-500/20",children:[e.jsxs("div",{className:"flex justify-between text-[10px] mb-0.5",children:[e.jsxs("span",{className:"text-purple-300 flex items-center gap-1",children:[e.jsx(G,{size:12,color:"currentColor"}),"Antimatter"]}),e.jsxs("span",{className:"text-white font-mono",children:[p.antimatter,"/",b.storage]})]}),e.jsx(V,{value:p.antimatter,max:b.storage,label:"",color:"purple",showPercentage:!1})]}),e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-cyan-500/20",children:[e.jsxs("div",{className:"flex justify-between text-[10px] mb-0.5",children:[e.jsxs("span",{className:"text-cyan-300 flex items-center gap-1",children:[e.jsx($,{size:12,color:"currentColor"}),"Element 115"]}),e.jsxs("span",{className:"text-white font-mono",children:[p.element115,"/",b.storage]})]}),e.jsx(V,{value:p.element115,max:b.storage,label:"",color:"cyan",showPercentage:!1})]}),e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-orange-500/20",children:[e.jsxs("div",{className:"flex justify-between text-[10px] mb-0.5",children:[e.jsxs("span",{className:"text-orange-300 flex items-center gap-1",children:[e.jsx(z,{size:12,color:"currentColor"}),"Deuterium"]}),e.jsxs("span",{className:"text-white font-mono",children:[p.deuterium,"/",b.storage]})]}),e.jsx(V,{value:p.deuterium,max:b.storage,label:"",color:"orange",showPercentage:!1})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-white font-semibold mb-2 text-xs",children:"🔧 Ship Upgrade"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 text-[10px] mb-2",children:[e.jsxs("div",{className:"bg-white/5 rounded p-1 border border-blue-500/20",children:[e.jsx("div",{className:"text-gray-400 text-[9px]",children:"Efficiency"}),e.jsxs("div",{className:"text-blue-400 font-bold",children:[b.efficiency.toFixed(1),"x"]})]}),e.jsxs("div",{className:"bg-white/5 rounded p-1 border border-yellow-500/20",children:[e.jsx("div",{className:"text-gray-400 text-[9px]",children:"Storage"}),e.jsx("div",{className:"text-yellow-400 font-bold",children:b.storage})]}),e.jsxs("div",{className:"bg-white/5 rounded p-1 border border-indigo-500/20",children:[e.jsx("div",{className:"text-gray-400 text-[9px]",children:"Multiplier"}),e.jsxs("div",{className:"text-indigo-400 font-bold",children:[b.multiplier.toFixed(1),"x"]})]})]}),b.level<100&&!m.canAffordUpgrade()&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/30 rounded p-1.5 mb-2",children:[e.jsx("div",{className:"text-[10px] text-red-300 font-semibold mb-0.5",children:"Missing resources:"}),e.jsxs("div",{className:"text-[9px] text-red-200 space-y-0.5",children:[S.antimatter>p.antimatter&&e.jsxs("div",{className:"flex items-center gap-1",children:["• Need ",S.antimatter-p.antimatter," more ",e.jsx(G,{size:10,color:"currentColor"})," Antimatter"]}),S.element115>p.element115&&e.jsxs("div",{className:"flex items-center gap-1",children:["• Need ",S.element115-p.element115," more ",e.jsx($,{size:10,color:"currentColor"})," Element 115"]}),S.deuterium>p.deuterium&&e.jsxs("div",{className:"flex items-center gap-1",children:["• Need ",S.deuterium-p.deuterium," more ",e.jsx(z,{size:10,color:"currentColor"})," Deuterium"]})]})]}),e.jsx("button",{onClick:()=>{if(m.upgradeShip()){k(m.getResources()),F(m.getUpgrade());const i=m.getUpgrade();D(m.getUpgradeCost(i.level));const g=m.getAccumulatedResourcesWithLimit();L(g),oe.emit("resources_updated")}},disabled:!m.canAffordUpgrade(),className:`w-full px-2 py-1.5 rounded text-[10px] font-medium transition-all duration-200 ${m.canAffordUpgrade()?"bg-gradient-to-r from-green-600/30 to-blue-600/30 hover:from-green-600/40 hover:to-blue-600/40 text-green-300 border border-green-500/50 hover:border-green-400/70 cursor-pointer":"bg-gray-700/30 text-gray-500 border border-gray-600/30 cursor-not-allowed"}`,children:b.level>=100?e.jsx("div",{className:"text-yellow-400",children:"🌟 MAX LEVEL - Ultimate Spaceship!"}):e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold",children:["Upgrade to Level ",b.level+1]}),e.jsxs("div",{className:"opacity-80 flex gap-2 justify-center mt-0.5",children:[e.jsxs("span",{className:"text-purple-300 flex items-center gap-0.5",children:[e.jsx(G,{size:10,color:"currentColor"}),S.antimatter,"AM"]}),e.jsxs("span",{className:"text-cyan-300 flex items-center gap-0.5",children:[e.jsx($,{size:10,color:"currentColor"}),S.element115,"E115"]}),e.jsxs("span",{className:"text-orange-300 flex items-center gap-0.5",children:[e.jsx(z,{size:10,color:"currentColor"}),S.deuterium,"D"]})]})]})})]})]}),n==="saved"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-500/20 to-blue-500/20 rounded-lg p-2 border border-purple-500/30",children:[e.jsxs("h4",{className:"text-white font-semibold text-xs flex items-center gap-1 mb-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M3.5 8V6.5l4-3l3 1.5l4-3l6 4.5V8zm-.476 8.124L1.184 9.5h21.632l-1.84 6.624a4.5 4.5 0 0 0-7.364 4.376h-3.224q.111-.483.112-1a4.5 4.5 0 0 0-7.476-3.376M6 22.5a3 3 0 1 0 0-6a3 3 0 0 0 0 6m12 0a3 3 0 1 0 0-6a3 3 0 0 0 0 6",clipRule:"evenodd"})}),"Mining Operations"]}),h.sources.planets===0&&h.sources.systems===0?e.jsx("div",{className:"text-[10px] text-gray-400",children:"💡 Save planets and systems to enable mining operations"}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-[10px] mb-1",children:[e.jsx("span",{className:"text-purple-300",children:"Generating/hour:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-purple-300 flex items-center gap-0.5",children:[e.jsx(G,{size:8,color:"currentColor"}),"+",Math.round(ee.antimatter*60)," AM"]}),e.jsxs("span",{className:"text-cyan-300 flex items-center gap-0.5",children:[e.jsx($,{size:8,color:"currentColor"}),"+",Math.round(ee.element115*60)," E115"]}),e.jsxs("span",{className:"text-orange-300 flex items-center gap-0.5",children:[e.jsx(z,{size:8,color:"currentColor"}),"+",Math.round(ee.deuterium*60)," D"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px] mb-2",children:[e.jsx("span",{className:"text-gray-400",children:"Ready to collect:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-purple-300 flex items-center gap-0.5",children:[e.jsx(G,{size:8,color:"currentColor"}),"+",Math.round(h.antimatter)," AM"]}),e.jsxs("span",{className:"text-cyan-300 flex items-center gap-0.5",children:[e.jsx($,{size:8,color:"currentColor"}),"+",Math.round(h.element115)," E115"]}),e.jsxs("span",{className:"text-orange-300 flex items-center gap-0.5",children:[e.jsx(z,{size:8,color:"currentColor"}),"+",Math.round(h.deuterium)," D"]})]})]}),e.jsxs("button",{onClick:()=>{ce(!0)},disabled:h.antimatter+h.element115+h.deuterium===0,className:`w-full px-2 py-1.5 rounded text-[10px] font-medium transition-all duration-200 ${h.antimatter+h.element115+h.deuterium>0?"bg-gradient-to-r from-purple-600/30 to-blue-600/30 hover:from-purple-600/40 hover:to-blue-600/40 text-purple-300 border border-purple-500/50 hover:border-purple-400/70 cursor-pointer":"bg-gray-700/30 text-gray-500 border border-gray-600/30 cursor-not-allowed"}`,children:["🚀 Collect From ",h.sources.planets,"🪐 ",h.sources.systems,"⭐"]})]})]}),e.jsx("div",{className:"space-y-1",children:l.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-gray-400 text-xs mb-1",children:"No saved locations"}),e.jsx("div",{className:"text-gray-500 text-[10px]",children:"Use the 📍 button to save locations"})]}):l.map(i=>{const v=((N,U)=>{try{const _=N.split("/stargate/")[1];if(!_)return"";const q=atob(_.replace(/-/g,"+").replace(/_/g,"/")),ne=new URLSearchParams(q),Q=ne.get("coordinates"),Z=ne.get("system"),xe=ne.get("planet");return Q?U==="galaxy"?`galaxy_${Q}`:U==="system"&&Z?`system_${Q}_${Z}`:U==="planet"&&Z&&xe?`planet_${Q}_${Z}_${xe}`:"":""}catch{return""}})(i.stargateUrl,i.type),M=v?pe.canCollectFromLocation(v):!0,O=v?pe.getTimeUntilNextCollection(v):0,W={planet:900*1e3,system:2700*1e3,galaxy:480*60*1e3},X=W[i.type]||W.planet,Se=O*60*60*1e3,Ce=X-Se,Ee=Math.max(0,Math.min(100,Ce/X*100)),Ae=N=>{if(N<=0)return"Ready";const U=Math.floor(N*60),_=Math.floor(U/60),q=U%60;return _>0?`${_}h ${q}m`:`${q}m`},ge=i.stargateUrl.indexOf("/stargate/"),Le=ge!==-1?i.stargateUrl.substring(ge):i.stargateUrl,ke=`${window.location.origin}${Le}`;return e.jsxs("a",{href:ke,className:"block bg-white/5 hover:bg-white/10 rounded p-1.5 border border-white/10 hover:border-white/20 transition-all duration-200 hover:text-blue-300",title:`Navigate to ${ue(i.name)}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs("div",{className:"text-[8px]",children:[i.type==="galaxy"&&"🌌",i.type==="system"&&"⭐",i.type==="planet"&&"🪐"]}),e.jsx("div",{className:"text-white text-[10px] font-medium truncate",children:ue(i.name)}),e.jsx("div",{className:"text-gray-500 text-[8px] shrink-0",children:(()=>{try{const N=new Date(i.timestamp);return isNaN(N.getTime())?"N/A":N.toLocaleDateString()}catch{return"N/A"}})()})]})}),e.jsx("button",{onClick:N=>{N.preventDefault(),N.stopPropagation(),Ne(N,i.id)},className:"text-gray-400 hover:text-red-400 transition-all duration-200 ml-1 p-0.5",title:"Remove location",children:e.jsx("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),!M&&O>0&&e.jsxs("div",{className:"mt-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsx("span",{className:"text-[8px] text-gray-400",children:"Manual mining cooldown"}),e.jsx("span",{className:"text-[8px] text-orange-400",children:Ae(O)})]}),e.jsx("div",{className:"w-full bg-gray-800/50 rounded-full h-1 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-orange-500 to-yellow-500 rounded-full transition-all duration-300",style:{width:`${Ee}%`}})})]}),M&&v&&e.jsx("div",{className:"mt-1",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("span",{className:"text-[8px] text-green-400",children:"✓ Ready to mine"})})})]},i.id)})})]})]})]}),te&&e.jsx("div",{className:`fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 ${K?"animate-fadeOut":"animate-fadeIn"}`,children:e.jsxs("div",{ref:ae,className:`bg-black/90 backdrop-blur-xl rounded-2xl border border-purple-400/30 shadow-2xl w-full max-w-md ${K?"animate-slideDown":"animate-slideUp"}`,children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600/20 to-blue-600/20 px-4 py-3 border-b border-white/10 rounded-t-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-white font-bold text-lg flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",fillRule:"evenodd",d:"M3.5 8V6.5l4-3l3 1.5l4-3l6 4.5V8zm-.476 8.124L1.184 9.5h21.632l-1.84 6.624a4.5 4.5 0 0 0-7.364 4.376h-3.224q.111-.483.112-1a4.5 4.5 0 0 0-7.476-3.376M6 22.5a3 3 0 1 0 0-6a3 3 0 0 0 0 6m12 0a3 3 0 1 0 0-6a3 3 0 0 0 0 6",clipRule:"evenodd"})}),"Mass Collection"]}),e.jsx("button",{onClick:J,className:"text-gray-400 hover:text-white transition-colors duration-200",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"text-sm text-gray-300 mb-4",children:"Collect resources from all your saved mining locations at once."}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 mb-4",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Available to collect:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`font-bold flex items-center justify-center gap-1 ${h.antimatter>0?"text-purple-300":"text-gray-500"}`,children:[e.jsx(G,{size:12,color:"currentColor"}),"+",Math.round(h.antimatter)]}),e.jsx("div",{className:"text-gray-500",children:"Antimatter"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`font-bold flex items-center justify-center gap-1 ${h.element115>0?"text-cyan-300":"text-gray-500"}`,children:[e.jsx($,{size:12,color:"currentColor"}),"+",Math.round(h.element115)]}),e.jsx("div",{className:"text-gray-500",children:"Element 115"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`font-bold flex items-center justify-center gap-1 ${h.deuterium>0?"text-orange-300":"text-gray-500"}`,children:[e.jsx(z,{size:12,color:"currentColor"}),"+",Math.round(h.deuterium)]}),e.jsx("div",{className:"text-gray-500",children:"Deuterium"})]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-4",children:["🌟 Sources: ",h.sources.planets," Planets, ",h.sources.systems," Systems"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:J,className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium bg-gray-700/50 text-gray-300 hover:bg-gray-700/70 border border-gray-600/50 transition-all duration-200",children:"Cancel"}),e.jsx("button",{onClick:()=>{m.addResources({antimatter:Math.round(h.antimatter),element115:Math.round(h.element115),deuterium:Math.round(h.deuterium)}),m.showPassiveGenerationNotification(h);const i=JSON.parse(C("_atlasSpaceShip")||"{}");i.t||(i.t={}),i.t.lp=Date.now(),R("_atlasSpaceShip",JSON.stringify(i)),k(m.getResources());const g=m.getAccumulatedResourcesWithLimit();L(g),oe.emit("resources_updated"),J()},className:"flex-1 px-4 py-2 rounded-lg text-sm font-medium bg-gradient-to-r from-purple-600/30 to-blue-600/30 hover:from-purple-600/40 hover:to-blue-600/40 text-purple-300 border border-purple-500/50 hover:border-purple-400/70 transition-all duration-200",children:"🚀 Collect All"})]})]})]})})]})})};class Be{static getTravelCost(t,s=0){return m.calculateTravelCost(t,s)}static canAffordTravel(t,s=0){return!0}static executeTravel(t,s=0){const a=this.getTravelCost(t,s),r=m.getResources(),n=m.getUpgrade(),o={antimatter:Math.floor(a.antimatter/n.efficiency),element115:Math.floor(a.element115/n.efficiency),deuterium:Math.floor(a.deuterium/n.efficiency)};console.log("[DEBUG executeTravel] Distance:",s,"Base cost:",a,"Efficiency:",n.efficiency,"Actual cost:",o,"Resources:",r);const c=[r.antimatter/o.antimatter,r.element115/o.element115,r.deuterium/o.deuterium],d=Math.min(...c);return d>=1?(m.consumeResources(o),"success"):d>=.5?(m.consumeResources({antimatter:Math.min(r.antimatter,o.antimatter),element115:Math.min(r.element115,o.element115),deuterium:Math.min(r.deuterium,o.deuterium)}),"partial"):"emergency"}static previewTravelCost(t,s=0){const a=this.getTravelCost(t,s),r=m.getUpgrade(),n={antimatter:Math.floor(a.antimatter/r.efficiency),element115:Math.floor(a.element115/r.efficiency),deuterium:Math.floor(a.deuterium/r.efficiency)};return`${n.antimatter}AM | ${n.element115}E115 | ${n.deuterium}D`}static getActualTravelCost(t,s=0){const a=this.getTravelCost(t,s),r=m.getResources(),n=m.getUpgrade(),o={antimatter:Math.floor(a.antimatter/n.efficiency),element115:Math.floor(a.element115/n.efficiency),deuterium:Math.floor(a.deuterium/n.efficiency)},c=[r.antimatter/o.antimatter,r.element115/o.element115,r.deuterium/o.deuterium],d=Math.min(...c);return d>=1?o:d>=.5?{antimatter:Math.min(r.antimatter,o.antimatter),element115:Math.min(r.element115,o.element115),deuterium:Math.min(r.deuterium,o.deuterium)}:{antimatter:0,element115:0,deuterium:0}}static getTravelEfficiency(){return m.getUpgrade().efficiency}static getMaxTravelRange(){return m.getUpgrade().range}}export{H as L,Be as S,ze as a,Ge as b,Ue as c,_e as d,$e as g,Pe as m};
