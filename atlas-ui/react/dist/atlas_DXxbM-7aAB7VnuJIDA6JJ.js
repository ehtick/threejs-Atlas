import{S as _}from"./atlas_CXe69HDW-Q8b_kGwXRltZ.js";import{G as j,r as L,V as m,s as D,F as H,C as I,M as Z,e as O,n as J,T as K,q as Q,t as W,i as q}from"./atlas_DUxdE5_5iPCKlmI6uaLFO.js";class ${featuresGroup;crystals=[];cracks=[];iceCaps=[];planetRadius;constructor(s,t={}){this.featuresGroup=new j,this.planetRadius=s;const a=t.seed||Math.floor(Math.random()*1e6),n=new _(a);t.crystals&&t.crystals.length>0&&this.generateCrystals(t.crystals,n),t.cracks&&t.cracks.length>0&&this.generateCracks(t.cracks),t.iceCaps&&t.iceCaps.length>0&&this.generateIceCaps(t.iceCaps,n)}generateCrystals(s,t){s.forEach(a=>{const n=a.position||[0,0],h=(a.width||.05)*this.planetRadius*.8,i=(a.length||.1)*this.planetRadius*.08,R=a.angle||0,c=a.color||[172/255,215/255,230/255,1],b=this.planetRadius*.015,l=Math.max(i,b),p=new L(h*2,l,h*1.5,4,2,4),u=p.attributes.position,e=new m;for(let r=0;r<u.count;r++){if(e.fromBufferAttribute(u,r),Math.abs(e.y)>l*.3){const E=Math.atan2(e.z,e.x),P=Math.sqrt(e.x*e.x+e.z*e.z),B=Math.round(E/(Math.PI/3))*(Math.PI/3),X=t.uniform(.8,1.2),F=P*X;e.x=Math.cos(B)*F,e.z=Math.sin(B)*F,e.y+=t.uniform(-l*.1,l*.1)}u.setXYZ(r,e.x,e.y,e.z)}u.needsUpdate=!0,p.computeVertexNormals();const G=new D({color:new I(c[0],c[1],c[2]),transparent:!0,opacity:.8,metalness:0,roughness:.02,clearcoat:1,clearcoatRoughness:0,transmission:.7,ior:1.31,thickness:.5,emissive:new I(c[0],c[1],c[2]),emissiveIntensity:.02,flatShading:!1,side:H}),M=new Z(p,G);let y=Math.min(1,Math.max(-1,n[1]));const w=Math.pow(Math.abs(y),.3),g=Math.sign(y)*w,v=t.uniform(-.3,.3)*(1-Math.abs(g)),S=Math.min(1,Math.max(-1,g+v)),d=Math.acos(Math.abs(S)),x=Math.atan2(n[0],.001)+R,k=this.planetRadius*t.uniform(1.0005,1.001),Y=k*Math.sin(d)*Math.cos(x),A=k*S,V=k*Math.sin(d)*Math.sin(x);M.position.set(Y,A,V);const C=M.position.clone().normalize(),f=new m,z=new m;Math.abs(C.x)<.9?f.set(1,0,0):f.set(0,1,0),f.crossVectors(f,C).normalize(),z.crossVectors(C,f).normalize();const o=new O;o.makeBasis(f,C,z),M.rotation.setFromRotationMatrix(o),M.rotateY(t.uniform(0,Math.PI*2));const T=t.uniform(.8,1.2);M.scale.set(T,T,T),this.crystals.push(M),this.featuresGroup.add(M)})}generateCracks(s){const t=new _(42);s.forEach(a=>{const n=a.angle||0,h=(a.length||1)*this.planetRadius*2,i=a.color||[80/255,80/255,80/255,.4],R=(a.width||1)*5e-4*this.planetRadius,c=t.uniform(.6,1),b=t.uniform(0,1)>.5?1:-1,l=Math.acos(c*b),p=[],u=20;for(let w=0;w<=u;w++){const g=w/u,v=Math.sin(g*Math.PI)*.1,d=n+(g-.5)*h/(this.planetRadius*Math.sin(Math.abs(l)))+v,x=this.planetRadius*1.002*Math.sin(Math.abs(l))*Math.cos(d),k=this.planetRadius*1.002*Math.cos(Math.abs(l))*b,Y=this.planetRadius*1.002*Math.sin(Math.abs(l))*Math.sin(d);p.push(new m(x,k,Y))}const e=new J(p),G=new K(e,u*2,R,8,!1),M=new Q({color:new I(i[0],i[1],i[2]),transparent:!0,opacity:i[3]||.4,emissive:new I(0,0,0),shininess:5}),y=new Z(G,M);this.cracks.push(y),this.featuresGroup.add(y)})}generateIceCaps(s,t){s.forEach(a=>{const n=a.position||[0,0],h=(a.radius||.3)*this.planetRadius,i=a.color||[.678,.847,1,.8],R=Math.atan2(n[1],n[0]),c=Math.acos(Math.min(1,Math.max(-1,Math.sqrt(n[0]**2+n[1]**2)))),b=this.planetRadius*1.002*Math.sin(c)*Math.cos(R),l=this.planetRadius*1.002*Math.cos(c),p=this.planetRadius*1.002*Math.sin(c)*Math.sin(R),u=new m(b,l,p),e=u.clone().normalize(),G=new j,M=Math.floor(t.uniform(8,20));for(let y=0;y<M;y++){const w=t.uniform(0,Math.PI*2),g=t.uniform(0,h*.8),v=Math.cos(w)*g,S=Math.sin(w)*g,d=new m,x=new m;Math.abs(e.y)<.99?d.crossVectors(e,new m(0,1,0)).normalize():d.crossVectors(e,new m(1,0,0)).normalize(),x.crossVectors(e,d).normalize();const A=u.clone().addScaledVector(d,v).addScaledVector(x,S).normalize().multiplyScalar(this.planetRadius*t.uniform(1.002,1.008)),V=t.uniform(h*.05,h*.15),C=t.uniform(V*.4,V*4),f=new W(V,C,6,1,!1),z=f.attributes.position,o=new m;for(let P=0;P<z.count;P++)if(o.fromBufferAttribute(z,P),o.y>.1&&o.y<C*.9){const B=Math.atan2(o.z,o.x),X=Math.sqrt(o.x*o.x+o.z*o.z),F=Math.round(B/(Math.PI/3))*(Math.PI/3),U=X*1.1;o.x=Math.cos(F)*U,o.z=Math.sin(F)*U,z.setXYZ(P,o.x,o.y,o.z)}z.needsUpdate=!0,f.computeVertexNormals();const T=new D({color:new I(i[0],i[1],i[2]),transparent:!0,opacity:.85,metalness:0,roughness:.05,clearcoat:1,clearcoatRoughness:0,transmission:.6,ior:1.31,thickness:.8,emissive:new I(i[0],i[1],i[2]),emissiveIntensity:.03,flatShading:!0,side:H}),r=new Z(f,T);r.position.copy(A),r.lookAt(0,0,0),r.rotateX(Math.PI/2),r.rotateZ(t.uniform(0,Math.PI*2));const E=t.uniform(.7,1.3);r.scale.set(E,E,E),G.add(r),this.iceCaps.push(r)}this.featuresGroup.add(G)})}addToScene(s,t){t&&this.featuresGroup.position.copy(t),s.add(this.featuresGroup)}update(s,t){t!==void 0&&(this.featuresGroup.rotation.y=t)}getObject3D(){return this.featuresGroup}dispose(){this.crystals.forEach(s=>{s.geometry.dispose(),s.material instanceof q&&s.material.dispose()}),this.cracks.forEach(s=>{s.geometry.dispose(),s.material instanceof q&&s.material.dispose()}),this.iceCaps.forEach(s=>{s.geometry.dispose(),s.material instanceof q&&s.material.dispose()}),this.crystals=[],this.cracks=[],this.iceCaps=[],this.featuresGroup.clear()}}function et(N,s,t){const a=s.crystals,n=s.cracks,h=s.ice_caps;if(!a&&!n&&!h)return null;const i=t||Math.floor(Math.random()*1e6);return new $(N,{crystals:a||[],cracks:n||[],iceCaps:h||[],seed:i+9e3})}export{et as c};
