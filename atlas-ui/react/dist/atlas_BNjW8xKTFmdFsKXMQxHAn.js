import{r as n,j as e,a as it,c as pt,R as gt}from"./atlas_BG-O7ORrd1CIuvq6sOIEu.js";import{R as lt,L as wt,c as bt,d as yt,e as He,M as Ft,F as vt,H as jt,a as St}from"./atlas_BmJDGROROnjcA3EYH2Kqq.js";import{W as Ue}from"./atlas_VMw0cJKPlPEHKRP927cEp.js";import{O as Ke}from"./atlas_DcNBpw2oKtwvZQEHQs4H7.js";import{a6 as qe,C as Ze,a7 as Ye,G as Je,b as ue,y as he,M as fe,B as Qe,a3 as Xe,o as et,cN as tt,x as st,V as $e,u as ct,cO as dt,cP as mt}from"./atlas_Bd-08EnGHvuA4jxvJ1T-8.js";import{t as _e,V as ut,s as ht}from"./atlas_DMqIF4QzDIZyBGlOslpVh.js";import{R as Nt,S as Ct,M as Et,a as Be,D as Mt,b as Rt,c as kt}from"./atlas_B7yskJs0MneaVMHGaKiH3.js";import{S as nt,a as Dt,b as Lt,E as Pt}from"./atlas_kT8jwhYxeR5TNJsGrxl0P.js";import{E as At}from"./atlas_Blh4PZGKT2N-5eolC0Mfc.js";import{S as Te,C as Tt}from"./atlas_BghXIb7TnYI60IXYrw-Ma.js";import{V as zt}from"./atlas_CMDVgZFw_5MpHeUQOkkoo.js";import{T as It,D as Ot}from"./atlas_DNzIt0dlzR1_RWlGCFc5V.js";import{G as Gt}from"./atlas_C15boFsKysI2F31iG8KEH.js";import"./atlas_DTMHG0KBmlmtp0V4aoQDq.js";import"./atlas_BgxGsf68WhABe4h1vSedx.js";import"./atlas_C3458GGz6aw3olPI_SOsX.js";import"./atlas_Bh4_uSesFez3ZkWU5GC-E.js";import"./atlas_D5TkNrZ-UIh1OV1m_7qMi.js";import"./atlas_DaMSo9bqqe5_fRtMZKEEm.js";import"./atlas_CjYZLswrAeQ6o35MTpGmn.js";import"./atlas_HbWinxsYJykT4bAyTbY8I.js";import"./atlas_DeDF8aLbVQNoQGifdv_s_.js";import"./atlas_BArexBkuWQYyRkQof9gKO.js";import"./atlas_D8HnRHg-T3829cT32vrpr.js";import"./atlas_B1O444XwqLMfTlgIH8CCo.js";import"./atlas_BZHXJLIP5MemxI14IcYe9.js";import"./atlas_BLj9txaC9WkCe-yDdtyas.js";import"./atlas_5rMvutjFpBzeKNjvBer-N.js";import"./atlas_DKx8078aWX3rJjjGj5Axe.js";import"./atlas_B2-pJMNWYXxyj-B-RssSJ.js";import"./atlas_BXbcwSx6fzBvbs3eGmSfk.js";import"./atlas_CZCzHQxzVm3Wx1WCYhNaI.js";import"./atlas_Dcasksb0GWEjH1uRFF86v.js";import"./atlas_DbRTf8R4bLgIQwcwinLe1.js";import"./atlas_CXo_uPIQMEoZfbuWEe4yJ.js";import"./atlas_BxR8EK1lUkfM1bhn6B5WF.js";import"./atlas_dTjkx2eOeyibkJ3kbr7FP.js";import"./atlas_BssYco3rxuKH59tsmgzgR.js";import"./atlas_B6vR9JHEJE1N9BaFfu-46.js";import"./atlas_DR1L1QhM3B-GjY2M1yNBl.js";import"./atlas_Crz0A88G1BDMv-7lj1KO6.js";import"./atlas_B4wiSb2oeBvKoxoqy1f7w.js";import"./atlas_BA2agnhlUJ2nxZYMhIaMm.js";import"./atlas_CmHXsxrEu4vc-ZwffDBFw.js";import"./atlas_CcxlL7GoKEbb7f6SMK3yb.js";import"./atlas_hkcQqnUQmbUPJtyV97BSo.js";import"./atlas_CNrkG-0gPvzDXk6IOIjAn.js";import"./atlas_D1UuTausyRSrA9v8uuSaI.js";import"./atlas_B7IullEdKWbqELG_4ujzy.js";import"./atlas_CMWmquRsZlZEqR2vAiJlU.js";import"./atlas_BEyIEMT2j0j5-esqVO4U2.js";import"./atlas_B85T-P50c_in1Wnp_8HxC.js";import"./atlas_Bu2VgJv3sCWZGqWlP3y0h.js";import"./atlas_DxcFU0mT9_b0HlKXFN5wv.js";import"./atlas_DC69cYYG0vadLYoYhM77y.js";import"./atlas_wMmwftNKnoVgFFp7PaKIW.js";import"./atlas_BK0_EU3vJESuw7Gksm7xY.js";import"./atlas_nw3XvAywbGH6CbuSkVo0L.js";import"./atlas_A5cqO8LVz3jZ7aQzuympI.js";import"./atlas_0Q7ZTau1DuZY2NtQggBqG.js";import"./atlas_YWP1D0MIvR25XCvuvhbHT.js";import"./atlas_CCiLCpGPElUDBfPAxK3kY.js";import"./atlas_xC7GHqs1VGh6F2sCRTUUD.js";import"./atlas_4K-jkKCoCp2H9jneMtIEs.js";import"./atlas_79rl8tzgmmjQNzGiyyJWi.js";import"./atlas_Um4vVhXkf6-PvYBKpJe19.js";import"./atlas_DxyEAomS066Akv_FnLGNj.js";import"./atlas_DrrZP6yBy2gGjX3LbulUM.js";import"./atlas_C0hstbgC64R4Zd81BzUVj.js";import"./atlas_DTVfYL1QSwUOVvlArN5hQ.js";import"./atlas_DNN6G5x7TLhEbIgPQWiHn.js";const _t=s=>{let t=0;for(let a=0;a<s.length;a++)t=(t<<5)-t+s.charCodeAt(a),t=t&t;return Math.abs(t)%1e4/1e4*.15},$t=s=>{let t=0;for(let a=0;a<s.length;a++)t=(t<<3)-t+s.charCodeAt(a)*7,t=t&t;return Math.abs(t)%1e4/1e4*Math.PI*2},at=(s,t,a,u,c)=>{const y=t*(1-a*a)/(1+a*Math.cos(s)),x=y*Math.cos(s),d=y*Math.sin(s),o=x*Math.cos(c)-d*Math.sin(c)*Math.cos(u),N=x*Math.sin(c)+d*Math.cos(c)*Math.cos(u),C=d*Math.sin(u);return new $e(o,C,N)},ft=({planets:s,stars:t,systemName:a,cosmicOriginTime:u,currentTime:c,onTimeOffsetChange:y})=>{const x=n.useRef(null),d=n.useRef(null),o=n.useRef(null),N=n.useRef(null),C=n.useRef([]),z=n.useRef([]),E=n.useRef([]),h=n.useRef(0),M=n.useRef(null),ne=(I,Z="#ffffff")=>{const O=document.createElement("canvas"),f=O.getContext("2d");if(!f)return null;O.width=768,O.height=192,f.fillStyle="rgba(0, 0, 0, 0.8)",f.fillRect(0,0,O.width,O.height),f.strokeStyle="#ffffff",f.lineWidth=3,f.strokeRect(3,3,O.width-6,O.height-6),f.fillStyle=Z,f.font="bold 48px Arial",f.textAlign="center",f.textBaseline="middle",f.fillText(I,384,96);const V=new ct(O),G=new dt({map:V,transparent:!0,alphaTest:.1}),ie=new mt(G);return ie.scale.set(30,7.5,1),ie};return h.current=c,n.useEffect(()=>{if(!x.current)return;const I=x.current,Z=I.clientWidth,O=I.clientHeight,f=new qe;f.background=new Ze(17),d.current=f;const V=new Ye(60,Z/O,.1,1e4);V.position.set(0,120,180),V.lookAt(0,0,0);const G=new Ue({antialias:!0,alpha:!0});G.setSize(Z,O),G.setClearColor(17,1),o.current=G,I.appendChild(G.domElement);const ie={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},xe={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},re=new Je;t.forEach((r,Y)=>{const p=parseFloat(r.Size)*2.5,F=new ue(p,32,32),g=xe[r.Color]||"#FFFF44",w=new he({color:g,transparent:!0,opacity:.9}),A=new fe(F,w),i=t.map((R,le)=>parseFloat(R.Size)*2.5),v=Math.max(...i)*3;t.length===1?A.position.set(0,0,0):t.length===2?A.position.set(Y===0?-v:v,0,0):Y===0?A.position.set(-v,0,0):Y===1?A.position.set(v,0,0):A.position.set(0,v,0);const K=new ue(p*1.5,32,32),H=new he({color:g,transparent:!0,opacity:.3}),T=new fe(K,H);A.add(T),re.add(A)}),f.add(re);const ge=Math.max(...s.map(r=>r.orbital_radius)),D=150,te=t.map(r=>parseFloat(r.Size)*2.5),pe=Math.max(...te)*1.5,$=Math.max(40,pe+15);s.forEach((r,Y)=>{const p=r.orbital_radius/ge,F=$+p*D,g=r.eccentricity_factor,w=F,A=_t(r.name),i=$t(r.name),S=360,v=2,K=4;for(let U=0;U<S;U+=v+K){const ae=[];for(let Q=U;Q<Math.min(U+v,S-1);Q++){const l=Q/S*2*Math.PI,b=at(l,w,g,A,i);ae.push(b)}if(ae.length>1){const Q=new Qe().setFromPoints(ae),l=new Xe({color:7372944,transparent:!0,opacity:.8,linewidth:2}),b=new et(Q,l);f.add(b),z.current.push(b)}}const H=r.diameter/6e3,T=Math.max(Math.min(H,10),2),R=new ue(T,32,32),le=ie[r.planet_type]||"#FFFFFF",we=new he({color:le,transparent:!0,opacity:.9}),j=new fe(R,we),k=new fe(new ue(T*1.5,32,32),new he({color:le,transparent:!0,opacity:.2}));j.add(k),f.add(j),C.current.push(j),j.planetData=r,j.orbitRadius=F,j.semiMajorAxis=w,j.eccentricity=g,j.inclination=A,j.ascendingNode=i;const P=r.name.replace(/_/g," "),W=ne(P,"#ffffff");W&&(W.position.copy(j.position),W.position.y+=T+10,W.planetData=r,f.add(W),E.current.push(W))});const Ce=new tt(4210752,.4);f.add(Ce);const De=new st(16777215,1,2e3);De.position.set(0,0,0),f.add(De);const L=new Ke(V,G.domElement);L.enableDamping=!0,L.dampingFactor=.05,L.minDistance=50,L.maxDistance=800,L.autoRotate=!1,L.autoRotateSpeed=.5,L.enablePan=!0,L.enableZoom=!0,L.target.set(0,0,0),M.current=L;const Ae=r=>{r.ctrlKey&&(r.preventDefault(),r.deltaY>0?y(604800):y(-604800))},Ee=r=>{r.key==="Escape"&&document.dispatchEvent(new CustomEvent("solar-system-close-fullscreen"))},Me=G.domElement;Me.addEventListener("wheel",Ae),document.addEventListener("keydown",Ee);const je=()=>{N.current=requestAnimationFrame(je),M.current&&M.current.update(),C.current.forEach((r,Y)=>{const p=r.planetData,F=r.semiMajorAxis,g=r.eccentricity,w=r.inclination,A=r.ascendingNode,i=p.orbital_period_seconds,S=2*Math.PI/i,v=(p.initial_orbital_angle+h.current*S)%(2*Math.PI),K=at(v,F,g,w,A);r.position.copy(K);const H=p.rotation_period_seconds,T=2*Math.PI/H;if(r.rotation.y=h.current*T%(2*Math.PI),E.current[Y]){const R=r.geometry.parameters?.radius||2;E.current[Y].position.copy(r.position),E.current[Y].position.y+=R+10}}),G.render(f,V)};je();const Le=()=>{const r=I.clientWidth,Y=I.clientHeight;V.aspect=r/Y,V.updateProjectionMatrix(),G.setSize(r,Y)};return window.addEventListener("resize",Le),()=>{window.removeEventListener("resize",Le),document.removeEventListener("keydown",Ee),Me.removeEventListener("wheel",Ae),M.current&&M.current.dispose(),N.current&&cancelAnimationFrame(N.current),I&&G.domElement&&I.removeChild(G.domElement),G.dispose(),C.current=[],z.current=[],E.current=[]}},[s,t,u]),e.jsx("div",{ref:x,className:"w-full h-full"})},Vt=s=>{let t=0;for(let a=0;a<s.length;a++)t=(t<<5)-t+s.charCodeAt(a),t=t&t;return Math.abs(t)%1e4/1e4*.15},Wt=s=>{let t=0;for(let a=0;a<s.length;a++)t=(t<<3)-t+s.charCodeAt(a)*7,t=t&t;return Math.abs(t)%1e4/1e4*Math.PI*2},rt=(s,t,a,u,c)=>{const y=t*(1-a*a)/(1+a*Math.cos(s)),x=y*Math.cos(s),d=y*Math.sin(s),o=x*Math.cos(c)-d*Math.sin(c)*Math.cos(u),N=x*Math.sin(c)+d*Math.cos(c)*Math.cos(u),C=d*Math.sin(u);return new $e(o,C,N)},Bt=({planets:s,stars:t,systemName:a,cosmicOriginTime:u})=>{const c=n.useRef(null),y=n.useRef(null),x=n.useRef(null),d=n.useRef(null),o=n.useRef([]),N=n.useRef([]),C=n.useRef([]),z=n.useRef(0),E=n.useRef(null),h=Math.floor(Date.now()/1e3),[M,ne]=n.useState(0),[I,Z]=n.useState(!1),[O,f]=n.useState(!1),[V,G]=n.useState(!1),[ie,xe]=n.useState(0),[re,ge]=n.useState(0),D=u?u-Date.now()/1e3:void 0,te=p=>{const F=D!==void 0?Math.max(-100,_e(D)):-100,g=Math.max(F,Math.min(100,p));xe(g),ge(ht(g))},pe=()=>{xe(0),ge(0)},[$,Ce]=n.useState(null),[De,L]=n.useState(!0),[Ae,Ee]=n.useState(null),Me=h-u+M;z.current=Me,n.useEffect(()=>{(async()=>{try{L(!0),Ee(null);const F=await fetch("/api/system/rendering-data");if(!F.ok)throw new Error(`HTTP error! status: ${F.status}`);const g=await F.json();if(g.success)Ce(g.system_data);else throw new Error(g.error||"Failed to fetch system data")}catch(F){Ee(F instanceof Error?F.message:"Unknown error")}finally{L(!1)}})()},[]);const je=()=>{f(!0),setTimeout(()=>{Z(!1),f(!1)},300)},Le=(p,F="#ffffff")=>{const g=document.createElement("canvas"),w=g.getContext("2d");if(!w)return null;g.width=512,g.height=128,w.fillStyle="rgba(0, 0, 0, 0.7)",w.fillRect(0,0,g.width,g.height),w.strokeStyle="#ffffff",w.lineWidth=2,w.strokeRect(2,2,g.width-4,g.height-4),w.fillStyle=F,w.font="bold 32px Arial",w.textAlign="center",w.textBaseline="middle",w.fillText(p,256,64);const A=new ct(g),i=new dt({map:A,transparent:!0,alphaTest:.1}),S=new mt(i);return S.scale.set(20,5,1),S};n.useEffect(()=>{const p=F=>{F.key==="Escape"&&I&&je()};return I&&ge(M),document.addEventListener("solar-system-close-fullscreen",je),document.addEventListener("keydown",p),()=>{document.removeEventListener("solar-system-close-fullscreen",je),document.removeEventListener("keydown",p)}},[I,M]),n.useEffect(()=>{if(I&&V){const p=setTimeout(()=>{G(!1)},50);return()=>clearTimeout(p)}},[I,V]),n.useEffect(()=>{if(De||!$||(window.tonnirLoggedInSystem=!1,!c.current))return;const p=c.current,F=p.clientWidth,g=F<640,w=new qe;w.background=new Ze(17),y.current=w;const A=new Ye(45,F/120,.1,1e4);A.position.set(0,80,120),A.lookAt(0,0,0);const i=new Ue({antialias:!0,alpha:!0});i.setSize(F,120),i.setClearColor(17,1),x.current=i,p.appendChild(i.domElement);const S={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},v={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},K=new Je;$.stars.forEach((l,b)=>{const X=parseFloat(l.Size)*1.43,be=new ue(X,16,16),ye=v[l.Color]||"#FFFF44",Se=new he({color:ye,transparent:!0,opacity:.9}),m=new fe(be,Se),_=$.stars.map((de,Fe)=>parseFloat(de.Size)*1.43),J=Math.max(..._)*3;$.stars.length===1?m.position.set(0,0,0):$.stars.length===2?m.position.set(b===0?-J:J,0,0):b===0?m.position.set(-J,0,0):b===1?m.position.set(J,0,0):m.position.set(0,J,0);const oe=new ue(X*1.5,16,16),ce=new he({color:ye,transparent:!0,opacity:.3}),B=new fe(oe,ce);m.add(B),K.add(m)}),w.add(K);const H=$.timing.max_orbital_radius,T=80,R=$.stars.map(l=>parseFloat(l.Size)*1.43),le=Math.max(...R)*1.5,we=Math.max(30,le+10);window.systemMaxOrbitalRadius=H,$.planets.forEach((l,b)=>{const X=l.orbital_radius/H,be=we+X*T,ye=l.eccentricity_factor,Se=be,m=Vt(l.name),_=Wt(l.name),q=360,J=2,oe=4;for(let ke=0;ke<q;ke+=J+oe){const ze=[];for(let se=ke;se<Math.min(ke+J,q-1);se++){const Ie=se/q*2*Math.PI,Ne=rt(Ie,Se,ye,m,_);ze.push(Ne)}if(ze.length>1){const se=new Qe().setFromPoints(ze),Ie=new Xe({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Ne=new et(se,Ie);w.add(Ne),N.current.push(Ne)}}const ce=l.diameter/12e3,B=Math.max(Math.min(ce,5),1),de=new ue(B,16,16),Fe=S[l.planet_type]||"#FFFFFF",me=new he({color:Fe,transparent:!0,opacity:.9}),ee=new fe(de,me),Pe=new fe(new ue(B*1.5,16,16),new he({color:Fe,transparent:!0,opacity:.2}));ee.add(Pe),w.add(ee),o.current.push(ee),ee.planetData=l,ee.orbitRadius=be,ee.semiMajorAxis=Se,ee.eccentricity=ye,ee.inclination=m,ee.ascendingNode=_;const Re=l.name.replace(/_/g," "),ve=Le(Re,"#ffffff");ve&&(ve.position.copy(ee.position),ve.position.y+=B+6,ve.planetData=l,w.add(ve),C.current.push(ve))});const j=new tt(4210752,.4);w.add(j);const k=new st(16777215,1,1e3);k.position.set(0,0,0),w.add(k);const P=new Ke(A,i.domElement);P.enableDamping=!0,P.dampingFactor=.05,P.minDistance=20,P.maxDistance=500,P.autoRotate=!1,P.autoRotateSpeed=.5,P.enablePan=!0,P.enableZoom=!0,P.target.set(0,0,0),E.current=P;const W=l=>{l.ctrlKey&&(l.preventDefault(),l.deltaY>0?ne(b=>b+604800):ne(b=>b-604800))},U=i.domElement;U.style.borderRadius="8px",U.addEventListener("wheel",W);const ae=()=>{d.current=requestAnimationFrame(ae),E.current&&E.current.update(),o.current.forEach((l,b)=>{const X=l.planetData,be=l.semiMajorAxis,ye=l.eccentricity,Se=l.inclination,m=l.ascendingNode,_=X.orbital_period_seconds,q=2*Math.PI/_,J=(X.initial_orbital_angle+z.current*q)%(2*Math.PI),oe=rt(J,be,ye,Se,m);l.position.copy(oe);const ce=X.rotation_period_seconds,B=2*Math.PI/ce;if(l.rotation.y=z.current*B%(2*Math.PI),C.current[b]){const de=l.geometry.parameters?.radius||2;C.current[b].position.copy(l.position),C.current[b].position.y+=de+6}}),i.render(w,A)};ae();const Q=()=>{const l=p.clientWidth,b=(l<640,120);A.aspect=l/b,A.updateProjectionMatrix(),i.setSize(l,b)};return window.addEventListener("resize",Q),()=>{window.removeEventListener("resize",Q),U.removeEventListener("wheel",W),E.current&&E.current.dispose(),d.current&&cancelAnimationFrame(d.current),p&&i.domElement&&p.removeChild(i.domElement),i.dispose(),o.current=[],N.current=[],C.current=[]}},[s,t,u,$]);const r=p=>{if(p<=0)return"Cosmic Origin Time";const F=Math.floor(p/(365.25*24*3600)),g=Math.floor(p%(365.25*24*3600)/(24*3600)),w=Math.floor(p%(24*3600)/3600);return F>0?`${F}y ${g}d ${w}h`:g>0?`${g}d ${w}h`:`${w}h`},Y=p=>p.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center w-full",children:[e.jsx("div",{className:"text-xs text-gray-300 mb-2",children:"Solar System Perspective"}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{ref:c,className:"w-full border border-white/20 rounded bg-black/20",style:{height:"auto"}}),!De&&!Ae&&a&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:a})}),e.jsx("button",{onClick:()=>{Z(!0),G(!0)},className:"absolute top-2 right-2 p-2 bg-black/60 hover:bg-black/80 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg z-10",title:"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2 w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-[10px]",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-[10px]",children:[$?.planets?.length||s.length," Planets"]})]})]}),e.jsxs("div",{className:"text-[10px] text-gray-500",children:["Time: ",r(Me)]})]}),e.jsx("div",{className:"text-center text-[10px] text-gray-500",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View"})]})]}),I&&it.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${O||V?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${O||V?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:Y(a)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:Y(a)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[$?.planets?.length||s.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",r(h-u+re)]})]})]}),e.jsx("button",{onClick:je,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0 relative",children:[e.jsx(ft,{planets:$?.planets||s,stars:$?.stars||t,systemName:a,cosmicOriginTime:u,currentTime:h-u+re,onTimeOffsetChange:p=>{const F=re+p,g=_e(F);te(g)}}),e.jsx(ut,{sliderPosition:ie,timeOffset:re,onSliderChange:te,onReset:pe,minTimeOffset:D})]}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})},Ht=({system:s,galaxy:t,systemIndex:a,cosmicOriginTime:u})=>{const[c,y]=n.useState({isOnCooldown:!1,isSaved:!1,isCollecting:!1,timeUntilNext:0});n.useEffect(()=>{let d;const o=()=>{const E=Be.generateLocationId("system",t.coordinates.join(","),a,void 0),h=Be.canCollectFromLocation(E),M=Be.getTimeUntilNextCollection(E),ne=t.coordinates,I=nt.generateSystemUrl(ne,a,nt.getCurrentPage()),O=wt.getLocations().some(f=>f.stargateUrl===I);y(f=>({isOnCooldown:!h&&M>0,isSaved:O,isCollecting:f.isCollecting,timeUntilNext:M}))},N=()=>{y(E=>({...E,isCollecting:!0})),d=setTimeout(()=>{y(E=>({...E,isCollecting:!1}))},1e3)};o();const C=setInterval(o,1e3),z=lt.subscribe("mining_completed",N);return()=>{clearInterval(C),d&&clearTimeout(d),z()}},[s.name,a,t.coordinates]);const x=d=>d.replace(/_/g," ");return e.jsxs("div",{className:"h-full flex flex-col relative",children:[e.jsxs("div",{className:"absolute top-0 right-0 flex gap-2 z-10",children:[e.jsx(Nt,{locationType:"system",locationId:s.name,coordinates:t.coordinates.join(","),systemIndex:a,className:"text-xs"}),e.jsx(Ct,{type:"system",name:s.name,coordinates:t.coordinates.join(","),systemIndex:a,className:"text-xs"}),e.jsx("div",{className:"inline-flex items-center bg-green-500/20 border border-green-500/50 text-green-400 text-[10px] font-medium px-1.5 py-0.5 rounded h-[21px] box-border",children:"VISITED"})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(Et,{isOnCooldown:c.isOnCooldown,isSaved:c.isSaved,isCollecting:c.isCollecting}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"Details"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-blue-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"System Type"}),e.jsx("div",{className:"text-sm font-bold text-blue-300 capitalize",children:s.star_system_type})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-purple-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Planets"}),e.jsx("div",{className:"text-sm font-bold text-purple-300",children:s.num_planets})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-orange-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200",children:"Stars"}),e.jsx("div",{className:"text-sm font-bold text-orange-300",children:s.stars.length})]})]}),e.jsx("div",{className:"bg-white/10 rounded-lg p-3 border border-gray-500/30 mb-3 col-span-3",children:e.jsx(Bt,{planets:s.planets,stars:s.stars,systemName:s.name,cosmicOriginTime:u})}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 border border-yellow-500/30",children:[e.jsx("div",{className:"text-xs text-gray-200 mb-2",children:"Stellar Composition"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1",children:s.stars.map((d,o)=>e.jsxs("div",{className:"bg-white/5 rounded p-1.5 border border-yellow-500/20",children:[e.jsxs("div",{className:"text-xs text-gray-300 flex items-center gap-2",children:[e.jsxs("span",{children:["Star ",o+1]}),e.jsx("span",{className:"font-bold text-yellow-300",children:d.Type})]}),e.jsxs("div",{className:"text-xs text-gray-300",children:[d.Color," • ",d.Size]})]},o))})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-white/10",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Technical Data"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-2 text-xs",children:[e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("div",{className:"text-green-400 font-medium",children:"Visited"})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System:"}),e.jsx("div",{className:"text-white truncate font-medium",children:x(s.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"System ID:"}),e.jsxs("div",{className:"text-white font-medium",children:["#",a+1]})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Galaxy:"}),e.jsx("div",{className:"text-white truncate font-medium",children:x(t.name)})]}),e.jsxs("div",{className:"bg-white/5 rounded px-1.5 py-0.5",children:[e.jsx("span",{className:"text-gray-400",children:"Coordinates:"}),e.jsx("div",{className:"text-white font-medium",children:t.coordinates.join(", ")})]})]})]})]})},Ut=s=>{let t=0;for(let a=0;a<s.length;a++)t=(t<<5)-t+s.charCodeAt(a),t=t&t;return Math.abs(t)%1e4/1e4*.15},Kt=s=>{let t=0;for(let a=0;a<s.length;a++)t=(t<<3)-t+s.charCodeAt(a)*7,t=t&t;return Math.abs(t)%1e4/1e4*Math.PI*2},ot=(s,t,a,u,c)=>{const y=t*(1-a*a)/(1+a*Math.cos(s)),x=y*Math.cos(s),d=y*Math.sin(s),o=x*Math.cos(c)-d*Math.sin(c)*Math.cos(u),N=x*Math.sin(c)+d*Math.cos(c)*Math.cos(u),C=d*Math.sin(u);return new $e(o,C,N)},xt=n.forwardRef(({planets:s,stars:t,systemName:a,cosmicOriginTime:u,systemUrl:c},y)=>{const x=n.useRef(null),d=n.useRef(null),o=n.useRef(null),N=n.useRef(null),C=n.useRef([]),z=n.useRef([]),E=n.useRef([]),h=n.useRef(null),M=n.useRef(0),ne=n.useRef(null),I=Math.floor(Date.now()/1e3),[Z,O]=n.useState(0),[f,V]=n.useState(!1),[G,ie]=n.useState(!1),[xe,re]=n.useState(!1),[ge,D]=n.useState(0),[te,pe]=n.useState(0),$=u?u-Date.now()/1e3:void 0,Ce=i=>{const S=$!==void 0?Math.max(-100,_e($)):-100,v=Math.max(S,Math.min(100,i));D(v),pe(ht(v))},De=()=>{D(0),pe(0)},[L,Ae]=n.useState(null),[Ee,Me]=n.useState(!0),[je,Le]=n.useState(null),[r,Y]=n.useState(!1);n.useImperativeHandle(y,()=>({captureScreenshot:()=>g(),isGeneratingImage:r}));const p=I-u+Z;M.current=p,n.useEffect(()=>{(async()=>{try{Me(!0),Le(null);const S=await fetch("/api/system/rendering-data");if(!S.ok)throw new Error(`HTTP error! status: ${S.status}`);const v=await S.json();if(v.success)Ae(v.system_data);else throw new Error(v.error||"Failed to fetch system data")}catch(S){Le(S instanceof Error?S.message:"Unknown error")}finally{Me(!1)}})()},[]);const F=()=>{ie(!0),setTimeout(()=>{V(!1),ie(!1)},300)};n.useEffect(()=>{const i=S=>{S.key==="Escape"&&f&&F()};return f&&pe(Z),document.addEventListener("solar-system-close-fullscreen",F),document.addEventListener("keydown",i),()=>{document.removeEventListener("solar-system-close-fullscreen",F),document.removeEventListener("keydown",i)}},[f,Z]),n.useEffect(()=>{if(f&&xe){const i=setTimeout(()=>{re(!1)},50);return()=>clearTimeout(i)}},[f,xe]),n.useEffect(()=>{if(Ee||!L||(window.tonnirLoggedInSystem=!1,!x.current))return;const i=x.current,S=i.clientWidth,v=i.clientHeight,K=Math.min(S,v),H=new qe;H.background=new Ze(17),d.current=H;const T=new Ye(45,1,.1,1e4);T.position.set(0,300,0),T.lookAt(0,0,0),ne.current=T;const R=new Ue({antialias:!0,alpha:!0});R.setSize(K,K),R.setClearColor(17,1),o.current=R,R.domElement.className="",i.appendChild(R.domElement);const le={"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"},we={red:"#FF4444",orange:"#FF8844",yellow:"#FFFF44",white:"#FFFFFF",blue:"#4488FF",purple:"#8844FF"},j=new Je;L.stars.forEach((m,_)=>{const q=parseFloat(m.Size)*1.75,J=new ue(q,16,16),oe=we[m.Color]||"#FFFF44",ce=new he({color:oe,transparent:!0,opacity:.9}),B=new fe(J,ce),de=L.stars.map((ve,ke)=>parseFloat(ve.Size)*1.75),me=Math.max(...de)*3;L.stars.length===1?B.position.set(0,0,0):L.stars.length===2?B.position.set(_===0?-me:me,0,0):_===0?B.position.set(-me,0,0):_===1?B.position.set(me,0,0):B.position.set(0,me,0);const ee=new ue(q*1.5,16,16),Pe=new he({color:oe,transparent:!0,opacity:.3}),Re=new fe(ee,Pe);B.add(Re),j.add(B)}),H.add(j);const k=L.timing.max_orbital_radius,P=80,W=L.stars.map(m=>parseFloat(m.Size)*1.75),U=Math.max(...W)*1.5,ae=Math.max(30,U+10);window.systemMaxOrbitalRadius=k,L.planets.forEach((m,_)=>{const q=m.orbital_radius/k,J=ae+q*P,oe=m.eccentricity_factor,ce=J,B=Ut(m.name),de=Kt(m.name),Fe=360,me=2,ee=4;for(let Ne=0;Ne<Fe;Ne+=me+ee){const Ve=[];for(let Oe=Ne;Oe<Math.min(Ne+me,Fe-1);Oe++){const We=Oe/Fe*2*Math.PI,Ge=ot(We,ce,oe,B,de);Ve.push(Ge)}if(Ve.length>1){const Oe=new Qe().setFromPoints(Ve),We=new Xe({color:7372944,transparent:!0,opacity:.8,linewidth:2}),Ge=new et(Oe,We);H.add(Ge),z.current.push(Ge)}}const Pe=m.diameter/12e3,Re=Math.max(Math.min(Pe,5),1),ve=new ue(Re,16,16),ke=le[m.planet_type]||"#FFFFFF",ze=new he({color:ke,transparent:!0,opacity:.9}),se=new fe(ve,ze),Ie=new fe(new ue(Re*1.5,16,16),new he({color:ke,transparent:!0,opacity:.2}));se.add(Ie),H.add(se),C.current.push(se),se.planetData=m,se.orbitRadius=J,se.semiMajorAxis=ce,se.eccentricity=oe,se.inclination=B,se.ascendingNode=de,E.current.push(null)});const Q=new tt(4210752,.4);H.add(Q);const l=new st(16777215,1,1e3);l.position.set(0,0,0),H.add(l);const b=new Ke(T,R.domElement);b.enableDamping=!0,b.dampingFactor=.05,b.minDistance=50,b.maxDistance=800,b.autoRotate=!1,b.autoRotateSpeed=.5,b.enablePan=!0,b.enableZoom=!0,b.target.set(0,0,0),h.current=b;const X=m=>{if(m.ctrlKey)m.preventDefault(),m.deltaY>0?O(_=>_+604800):O(_=>_-604800);else{m.preventDefault();const _=.1,q=T.position.distanceTo(new $e(0,0,0));m.deltaY>0&&q<500?T.position.multiplyScalar(1+_):m.deltaY<0&&q>20&&T.position.multiplyScalar(1-_)}},be=R.domElement;be.style.borderRadius="8px",be.addEventListener("wheel",X);const ye=()=>{N.current=requestAnimationFrame(ye),C.current.forEach((m,_)=>{const q=m.planetData,J=m.semiMajorAxis,oe=m.eccentricity,ce=m.inclination,B=m.ascendingNode,de=q.orbital_period_seconds,Fe=2*Math.PI/de,me=(q.initial_orbital_angle+M.current*Fe)%(2*Math.PI),ee=ot(me,J,oe,ce,B);m.position.copy(ee);const Pe=q.rotation_period_seconds,Re=2*Math.PI/Pe;m.rotation.y=M.current*Re%(2*Math.PI)}),h.current&&h.current.update(),R.render(H,T)};ye();const Se=()=>{if(!x.current||!R)return;const m=x.current,_=Math.min(m.clientWidth,m.clientHeight);R.setSize(_,_),T.aspect=1,T.updateProjectionMatrix()};return window.addEventListener("resize",Se),()=>{window.removeEventListener("resize",Se),be.removeEventListener("wheel",X),h.current&&h.current.dispose(),N.current&&cancelAnimationFrame(N.current),i&&R.domElement&&i.removeChild(R.domElement),R.dispose(),C.current=[],z.current=[],E.current=[]}},[s,t,u,L,Z]);const g=()=>{if(!o.current||!d.current||!ne.current||r)return;Y(!0),h.current&&(h.current.enabled=!1);const i=o.current,S=d.current,v=ne.current,K=i.domElement.width,H=i.domElement.height,T=3840/K,R=[];S.traverse(j=>{if(j.isPoints&&j.material){const k=j.material;if(k.size!==void 0&&(R.push({material:k,originalSize:k.size}),k.size=k.size*T*1),j.geometry&&j.geometry.attributes.size){const P=j.geometry.attributes.size,W=P.array.slice();R.push({geometry:j.geometry,originalSizeArray:W});for(let U=0;U<P.array.length;U++)P.array[U]*=T*1;P.needsUpdate=!0}}if(j.isSprite&&(R.push({object:j,originalScale:j.scale.clone()}),j.scale.multiplyScalar(T*1)),j.isLine&&j.material){const k=j.material;k.linewidth!==void 0&&(R.push({material:k,originalLinewidth:k.linewidth}),k.linewidth=k.linewidth*T*1)}});const le=3840,we=3840;i.setSize(le,we),v.aspect=1,v.updateProjectionMatrix(),i.render(S,v),i.domElement.toBlob(j=>{if(j){const k=document.createElement("canvas"),P=k.getContext("2d");if(k.width=le,k.height=we,P){const W=new Image;W.onload=async()=>{P.drawImage(W,0,0),Dt(P,{imageWidth:le,imageHeight:we}),c&&await Lt(P,le,we,{type:"system",stargateUrl:c}),k.toBlob(ae=>{if(ae){const Q=URL.createObjectURL(ae),l=document.createElement("a");l.href=Q,l.download=`system_${a}_${Date.now()}.jpg`,l.click(),URL.revokeObjectURL(Q)}},"image/jpeg",1)};const U=URL.createObjectURL(j);W.src=U}}R.forEach(({material:k,object:P,originalSize:W,originalScale:U,originalLinewidth:ae,geometry:Q,originalSizeArray:l})=>{if(W!==void 0&&(k.size=W),U!==void 0&&P.scale.copy(U),ae!==void 0&&(k.linewidth=ae),Q&&l){const b=Q.attributes.size;for(let X=0;X<l.length;X++)b.array[X]=l[X];b.needsUpdate=!0}}),i.setSize(K,H),v.aspect=1,v.updateProjectionMatrix(),h.current&&(h.current.enabled=!0),Y(!1)},"image/jpeg",1)},w=i=>{const S=Math.floor(i/31557600),v=Math.floor(i%(365.25*24*3600)/(24*3600)),K=Math.floor(i%(24*3600)/3600);return S>0?`${S}y ${v}d ${K}h`:v>0?`${v}d ${K}h`:`${K}h`},A=i=>i.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col items-center w-full h-full",children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{ref:x,className:"w-full h-full border border-white/20 rounded bg-black/20"}),e.jsx(Pt,{isVisible:r}),!Ee&&!je&&a&&e.jsx("div",{className:"absolute bottom-0 left-0 p-2 text-white bg-black bg-opacity-50 max-w-xs rounded-tr-lg",children:e.jsx("h3",{className:"text-xs font-bold",children:A(a)})}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-2 z-10",children:[e.jsx("button",{onClick:g,disabled:r,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${r?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:r?"Generating image...":"Download 4K screenshot",children:r?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsx(Mt,{className:"w-4 h-4 text-white"})}),e.jsx("button",{onClick:()=>{r||(V(!0),re(!0))},disabled:r,className:`p-2 border border-white/30 rounded-lg transition-all duration-200 backdrop-blur-sm shadow-lg ${r?"bg-black/40 cursor-not-allowed opacity-50":"bg-black/60 hover:bg-black/80"}`,title:r?"Please wait...":"Expand to fullscreen",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})})]})]})}),f&&it.createPortal(e.jsx("div",{className:`fixed inset-0 z-50 bg-black/95 backdrop-blur-xl transition-all duration-300 ${G||xe?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:e.jsxs("div",{className:`w-full h-full flex flex-col p-1 sm:p-2 transition-all duration-300 delay-75 ${G||xe?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-4",children:[e.jsx("div",{className:"block sm:hidden",children:e.jsx("h2",{className:"text-xs font-medium text-white",children:A(a)})}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4 flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:A(a)}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("span",{className:"text-sm text-gray-300",children:"Star(s)"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded-full"}),e.jsxs("span",{className:"text-sm text-gray-300",children:[L?.planets?.length||s.length," Planets"]})]}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Time: ",w(I-u+te)]})]})]}),e.jsx("button",{onClick:F,className:"p-0.5 sm:p-2 bg-red-500/20 hover:bg-red-500/30 border border-red-500/30 rounded transition-colors duration-200 text-red-400 hover:text-red-300",title:"Close",children:e.jsx("svg",{className:"w-3 h-3 sm:w-6 sm:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 border border-white/20 rounded-lg bg-black/20 overflow-hidden min-h-0 relative",children:[e.jsx(ft,{planets:L?.planets||s,stars:L?.stars||t,systemName:a,cosmicOriginTime:u,currentTime:I-u+te,onTimeOffsetChange:i=>{const S=te+i,v=_e(S);Ce(v)}}),e.jsx(ut,{sliderPosition:ge,timeOffset:te,onSliderChange:Ce,onReset:De,minTimeOffset:$})]}),e.jsxs("div",{className:"mt-2 sm:mt-4 text-center text-xs sm:text-sm text-gray-400",children:[e.jsx("div",{className:"hidden sm:block",children:"Scroll: Zoom • Ctrl+Scroll: +1week/-1week • Drag: Rotate View • ESC: Close"}),e.jsx("div",{className:"sm:hidden",children:"Pinch: Zoom • Drag: Rotate • ESC: Close"})]})]})}),document.body)]})});xt.displayName="SolarSystem3DViewerLeft";const qt=({systemUrl:s,system:t,cosmicOriginTime:a})=>{const u=n.useRef(null),[c,y]=n.useState(!1),[x,d]=n.useState(!1),[o,N]=n.useState(!1),[C,z]=n.useState(!1),E=n.useRef(null);return n.useEffect(()=>{const h=u.current;if(!h)return;const M=h.getContext("2d");if(!M)return;let ne=[];const I=800;let Z,O;const f=800;let V,G=.5;function ie(){const D=h?.parentElement;if(!D||!h)return;const te=D.clientWidth,pe=D.clientHeight;h.width=Math.min(te,f),h.height=Math.min(pe,f),Z=h.width/2,O=h.height/2}function xe(){ie(),ne=[];for(let D=0;D<I;D++)ne.push({x:Math.random()*(h?.width||800),y:Math.random()*(h?.height||800),z:Math.random()*(h?.width||800),o:Math.random()});re()}function re(){!h||!M||(M.clearRect(0,0,h.width,h.height),ne.forEach(D=>{D.z-=G,D.z<=0&&(D.z=h.width,D.x=Math.random()*h.width,D.y=Math.random()*h.height,D.o=Math.random());const te=h.width/D.z,pe=(D.x-Z)*te+Z,$=(D.y-O)*te+O,Ce=2*te;M.beginPath(),M.fillStyle=`rgba(255, 255, 255, ${D.o})`,M.arc(pe,$,Ce,0,2*Math.PI),M.fill()}),G<60&&(G+=1),V=requestAnimationFrame(re))}xe();const ge=()=>ie();return window.addEventListener("resize",ge),()=>{window.removeEventListener("resize",ge),V&&cancelAnimationFrame(V)}},[]),n.useEffect(()=>{y(!0),setTimeout(()=>{d(!0)},800)},[]),n.useEffect(()=>{const h=setInterval(()=>{E.current&&o&&!E.current.isGeneratingImage&&o&&N(!1)},50);return()=>clearInterval(h)},[o]),n.useEffect(()=>{const h=()=>{z(!0)},M=lt.subscribe("mining_completed",h);return()=>{M()}},[]),e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-white",children:"System Visualization"})}),e.jsxs("div",{className:"relative w-full max-w-80 sm:max-w-96 aspect-square mx-auto bg-black flex justify-center items-center rounded-xl overflow-hidden border-2 border-blue-400/30 mb-4",children:[e.jsx("canvas",{ref:u,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-[2500ms] ${x?"opacity-0":"opacity-100"}`,style:{filter:x?"blur(50px)":"none"}}),c&&t&&e.jsx("div",{className:`absolute inset-0 w-full h-full transition-all duration-500 ${c&&x?"opacity-100 blur-0":"opacity-0 blur-[25px]"}`,children:e.jsx(xt,{ref:E,planets:t.planets,stars:t.stars,systemName:t.name,cosmicOriginTime:a||0,systemUrl:s})}),e.jsx(Rt,{isActive:C,onAnimationComplete:()=>{z(!1)}})]}),e.jsxs("div",{className:"text-center mt-auto",children:[e.jsx(kt,{href:s,onTakeScreenshot:()=>{E.current&&!o&&(N(!0),E.current.captureScreenshot())},isGeneratingImage:o}),e.jsx("div",{className:"mt-2 text-xs text-gray-500 text-center",children:"Gateway to the stars"})]})]})},Zt=({planets:s,coordinates:t,systemIndex:a})=>{const[u,c]=n.useState(new Set),y=o=>({"Gas Giant":"#FFA500",Anomaly:"#FFFFFF",Rocky:"#808080",Icy:"#ADD8E6",Oceanic:"#0000FF",Desert:"#FFD700",Lava:"#FF0000",Arid:"#800000",Swamp:"#008000",Tundra:"#F0F8FF",Forest:"#006400",Savannah:"#F4A460",Cave:"#D1D1D1",Crystalline:"#00FFFF",Metallic:"#C0C0C0",Toxic:"#800080",Radioactive:"#00FF00",Magma:"#FF4500","Molten Core":"#FF8C00",Carbon:"#090909",Diamond:"#87CEFA","Super Earth":"#90EE90","Sub Earth":"#006400","Frozen Gas Giant":"#ADD8E6",Nebulous:"#FFC0CB",Aquifer:"#00FFFF",Exotic:"#FF00FF"})[o]||"#FFFFFF";n.useEffect(()=>{(()=>{try{const N=bt(t,a,s),C=new Set;N.forEach(z=>{C.add(z.toLowerCase())}),c(C)}catch{}})()},[t,a,s]);const x=o=>o.replace(/_/g," "),d=o=>{try{yt(t,a,o,s)}catch{}window.location.href=`/planet/${o.toLowerCase()}`};return e.jsxs("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 shadow-2xl p-4 sm:p-6",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-2 sm:gap-3",children:s.map(o=>e.jsxs("div",{className:"relative bg-white/10 rounded-lg border border-white/20 hover:bg-white/20 hover:border-white/40 transition-all duration-300 group overflow-hidden",children:[u.has(o.name.toLowerCase())&&e.jsx("div",{className:"absolute top-1 right-1 z-10",title:"Planet visited",children:e.jsx(At,{className:"text-green-400"})}),e.jsx("div",{className:"absolute -top-3 -left-3 w-8 h-8 rounded-full border border-white/40 shadow-sm z-20 animate-pulse",style:{backgroundColor:y(o.planet_type)}}),e.jsxs("button",{onClick:()=>d(o.name),className:"w-full text-left block p-2 sm:p-3 text-gray-200 hover:text-white transition-colors duration-300 rounded-lg",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-1",children:"Planet"}),e.jsx("div",{className:"text-sm font-semibold text-white truncate group-hover:text-blue-300 transition-colors duration-300",children:x(o.name)})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]})]},o.name))}),s.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-lg mb-2",children:"No planets found"}),e.jsx("div",{className:"text-gray-500 text-sm",children:"This system appears to be empty"})]})]})},Yt=({currentSystem:s,galaxy:t})=>{const[a,u]=n.useState(!1),[c,y]=n.useState(!1),[x,d]=n.useState(!0);n.useEffect(()=>{u(s.index>0),y(!0),d(!1)},[s.index]);const o=async()=>{if(s.index>0){if(!Te.canAffordTravel("system",1)){Te.executeTravel("system",1);return}if(!Te.executeTravel("system",1))return;const z=t.coordinates.join(",");He(z,s.index-1),window.location.href=`/system/${s.index-1}`}},N=async()=>{if(!Te.canAffordTravel("system",1)){Te.executeTravel("system",1);return}if(!Te.executeTravel("system",1))return;const z=t.coordinates.join(",");He(z,s.index+1),window.location.href=`/system/${s.index+1}`};return x?null:e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:o,disabled:!a,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${a?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("button",{onClick:N,disabled:!c,className:`flex items-center justify-center px-3 py-1.5 rounded-lg transition-all duration-200 ${c?"bg-white/10 hover:bg-white/20 border border-white/20 text-white hover:text-blue-300":"bg-white/5 border border-white/10 text-gray-600 cursor-not-allowed"}`,children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})})},Jt=({system:s,galaxy:t,system_url:a,version:u,system_index:c,image_url:y,page:x,cosmic_origin_time:d})=>{const[o]=n.useState(t.coordinates.join(","));n.useEffect(()=>{document.body.setAttribute("data-coordinates",o),document.body.setAttribute("data-system-index",c.toString()),He(o,c)},[o,c]);const N=z=>z.replace(/_/g," "),C=z=>z.replace(/_/g," ");return e.jsxs(e.Fragment,{children:[e.jsx(Ft,{}),e.jsxs("div",{className:"w-full min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 opacity-20",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='1'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`}}),e.jsx(vt,{}),e.jsxs("div",{className:"relative z-10 pt-1 flex-1 flex flex-col",children:[e.jsx(jt,{}),e.jsxs("div",{className:"w-full px-2 sm:px-4 lg:px-6 py-4 sm:py-8 flex-1",children:[e.jsxs("div",{className:"text-center mb-2",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent mb-2",children:["System '",N(s.name),"'"]}),e.jsxs("p",{className:"text-[10px] sm:text-xs text-gray-300 flex items-center justify-center gap-x-4 gap-y-1 flex-wrap",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Gt,{size:15,color:"#ffffffff"}),C(t.name)]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Tt,{size:15,color:"#ffffffff"}),t.coordinates.join(", ")]})]})]}),e.jsx(Yt,{currentSystem:{name:s.name,index:c},galaxy:t}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6",children:e.jsxs("div",{className:"flex flex-col lg:grid lg:grid-cols-[400px_1fr] gap-6 lg:gap-8 relative",children:[e.jsx("div",{className:"order-1 lg:order-1",children:e.jsx(qt,{systemUrl:a,system:s,cosmicOriginTime:d})}),e.jsx("div",{className:"hidden lg:block absolute left-[416px] top-0 bottom-0 w-1 rounded-full bg-white/10 -translate-x-1.5"}),e.jsx("div",{className:"order-2 lg:order-2",children:e.jsx(Ht,{system:s,galaxy:t,systemIndex:c,cosmicOriginTime:d})})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent",children:["Planets in '",N(s.name),"'"]}),e.jsx(Zt,{planets:s.planets,coordinates:o,systemIndex:c})]}),e.jsx("div",{className:"bg-white/5 backdrop-blur-lg rounded-2xl border border-white/10 mb-8 shadow-2xl p-4 sm:p-6 text-center",children:e.jsx("button",{onClick:()=>window.location.href=`/galaxy/${x}`,className:"w-full sm:w-auto px-6 sm:px-8 py-3 sm:py-4 bg-gradient-to-r from-gray-600 via-gray-700 to-gray-600 hover:from-gray-700 hover:via-gray-800 hover:to-gray-700 text-white font-bold rounded-xl transition-all duration-300 transform hover:scale-105 shadow-lg backdrop-blur-sm",children:e.jsxs("span",{className:"text-base sm:text-lg",children:["← Back to Galaxy '",C(t.name),"'"]})})})]}),e.jsx(zt,{version:u})]}),e.jsx(It,{}),e.jsx(St,{currentLocation:{type:"system",name:s.name,coordinates:t.coordinates.join(","),systemIndex:s.index}}),e.jsx(Ot,{currentView:"system"})]})]})};document.addEventListener("DOMContentLoaded",async()=>{try{const s=document.getElementById("system-data"),t=document.getElementById("galaxy-data"),a=document.getElementById("meta-data");if(!s||!t||!a)return;const u=JSON.parse(s.textContent||"{}"),c=JSON.parse(t.textContent||"{}"),y=JSON.parse(a.textContent||"{}"),x={system:u,galaxy:c,system_url:y.system_url,version:y.version,system_index:y.system_index,image_url:y.image_url,page:y.page||1,cosmic_origin_time:y.cosmic_origin_time},d=document.getElementById("atlas-react-root");d&&pt.createRoot(d).render(gt.createElement(Jt,x))}catch{}});
