import{c as $e,A as Le,S as Ae}from"./atlas_DhOreEVM1uBHzRPTt7uMw.js";import{c as ke,R as Ge}from"./atlas_D36RbjbgQ6vxnsBBXfit5.js";import{c as ae,A as We,a as m,b as ee,d as Ne,e as ze}from"./atlas_VDhnc9dvTbhF2parN7OFi.js";import{c as u}from"./atlas_CaTC88Qhtyyn7aUM2iYKm.js";import{c as p,L as se,a as Oe}from"./atlas_BOsk3pUelKRj5ln9rhoGJ.js";import{c as fe}from"./atlas_iaP6BvNgMsnSc2aXmYeUJ.js";import{c as de,T as Ve,a as Be,b as He,d as qe}from"./atlas_WqQSeNlyOv7J9uj3NbN8d.js";import{c as le,T as Ue}from"./atlas_DMEucpQ22_E8BLMSHUOcB.js";import{c as te,R as Ye}from"./atlas_Ds0kMxe6pC5AFTF9UgKKB.js";import{P as je,c as Ke}from"./atlas_DBNdtkSHsqUJ8jv8UOYDB.js";import{g as w,c as Je,P as Qe}from"./atlas_CiJ5REYodv1QYBJoW_2ml.js";import{P as Xe}from"./atlas_D1one951Nlf7MEYHrndJx.js";import{c as _e}from"./atlas_D3SD0gSLGNECVuJRtz3GB.js";import{c as me}from"./atlas_W0CNyNe9MMTSEfEiNdjoj.js";import{c as ue}from"./atlas_Y3HvJQxXHn08kGcILsRaf.js";import{c as F}from"./atlas_DuQiLy_JrdcoB_GBu19W7.js";import{c as Ze}from"./atlas_Db74FojOHOf-9ByMOZqq0.js";import{c as Re}from"./atlas_CQvemgFz_DfaHlTlhZ0OW.js";import{c as De}from"./atlas_DXgwrTFb2H-bNRVchNQMO.js";import{c as ce,T as es}from"./atlas_B1QT66vo82o1-APVzyjLA.js";import{E as ss,c as he}from"./atlas_BTsGONFjvJqd671wiTyTm.js";import{c as pe,E as ts}from"./atlas_Bpkhtqb5T6L4S6BLGh7oX.js";import{c as ye,C as cs}from"./atlas_Ch2bdMM3mpmtWVOciuzdk.js";import{c as rs,V as is}from"./atlas_yS18q1g5aiVjHNf1l7HQ-.js";import{c as os,M as ns}from"./atlas_DTEAjfyhmlsMI7E5KIETe.js";import{c as as,M as fs}from"./atlas_BEF7Q5BEa-gElR7Dqq85F.js";import{c as ds,C as ls}from"./atlas_Cad5Sg36gwQOkZIbuFSOr.js";import{c as _s,T as ms}from"./atlas_CwmTClggRt_VsPull2qFh.js";import{c as ge,A as us}from"./atlas_B2QNy4XqbOe8gd6zXC6Rq.js";import{c as hs,S as ps}from"./atlas_Dfna9OwXaN2YJhpBOua8S.js";import{P as re}from"./atlas_BhpysDWDwj52QSurnjO8E.js";import{F as Se}from"./atlas_ncPYTyqvLirCm9dEHojnR.js";import{c as ys,O as gs}from"./atlas_wI0UP5FipodDNvFcAdPO6.js";import{c as Ee,F as Ss}from"./atlas_BegcA54kDUatOQe3-x6p8.js";import{c as be,A as Es}from"./atlas_Bez77xiwp0n_CupGcGMiZ.js";import{c as Ie,O as bs}from"./atlas_lVZGCWAlgBUg7E85wZsSw.js";import{c as Ce,L as Is}from"./atlas_BFPmDtBqHO8zfwwPI155g.js";import{c as Cs,L as xs}from"./atlas_lT-3ahnezCqPq3IjTXoTu.js";import{c as xe,M as Ts}from"./atlas_WweLfOU1BF7h3zci6_8gC.js";import{c as Ms,F as vs}from"./atlas_1Vcldfyi9CxO-J8fgZsOi.js";import{c as Ps,C as ws}from"./atlas_CiqH1Qppfrngs0cOJX6aT.js";import{c as Fs,R as $s}from"./atlas_CdF2vjbezLyyFz8wUs-7q.js";import{c as Te}from"./atlas_BhqvIvlqBnFyBFrowPf3u.js";import{c as Ls,V as As}from"./atlas_gwatEjjI0AaYXVCl9XnFP.js";import{m as Me,C as ie}from"./atlas_CLp6T-BwF8hBVTNM0OiQd.js";const ks=!1;class C{static instance;creators=new Map;effects=new Map;nextId=1;layerSystem;constructor(){this.registerDefaultEffects()}static getInstance(){return C.instance||(C.instance=new C),C.instance}registerDefaultEffects(){this.registerEffect("atmosphere_glow",{create:(e,t)=>new We(t,e),fromPythonData:(e,t)=>ae(t,e.atmosphere||{})}),this.registerEffect("atmosphere_clouds",{create:(e,t)=>new ee(t,e),fromPythonData:(e,t)=>m(t,e.surface_elements||{},void 0,e.timing?.cosmic_origin_time)}),this.registerEffect("atmospheric_streaks",{create:(e,t)=>new us(t,e),fromPythonData:(e,t)=>ge(t,e.atmosphere||{})}),this.registerEffect("atmosphere",{create:(e,t)=>new ze(t,e),fromPythonData:(e,t)=>Ne(t,e)}),this.registerEffect("ring_system",{create:(e,t)=>new Ge(t,e),fromPythonData:(e,t)=>ke(e.rings||{},t)}),this.registerEffect("fragmentation",{create:(e,t)=>new Se(t,e),fromPythonData:(e,t)=>new Se(t,{color:e.surface?.fragment_color||[.3,.3,.3],fragmentCount:e.surface?.fragment_count||20})}),this.registerEffect("land_masses",{create:(e,t)=>new se(t,e),fromPythonData:(e,t)=>p(t,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("ocean_waves",{create:(e,t)=>new gs(e),fromPythonData:(e,t)=>ys(e)}),this.registerEffect("aquifer_water",{create:(e,t,i)=>new Es(i,e),fromPythonData:(e,t,i)=>be(i,e)}),this.registerEffect("ocean_currents",{create:(e,t,i)=>new bs(i,e),fromPythonData:(e,t,i)=>Ie(i,e)}),this.registerEffect("fluid_layers",{create:(e,t)=>new Ss(t,e),fromPythonData:(e,t)=>Ee(t,e)}),this.registerEffect("lava_flows",{create:(e,t)=>new Is(t,e),fromPythonData:(e,t)=>Ce(t,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("lava_rivers",{create:(e,t,i)=>new xs(t,e),fromPythonData:(e,t,i)=>Cs(e,t)}),this.registerEffect("molten_lava",{create:(e,t,i)=>new Ts(i,e),fromPythonData:(e,t,i)=>xe(i,e,e.seeds?.planet_seed)}),this.registerEffect("fire_eruption",{create:(e,t)=>new vs(t,e),fromPythonData:(e,t,i)=>Ms(e,t)}),this.registerEffect("carbon_trails",{create:(e,t)=>new ws(t,e),fromPythonData:(e,t,i)=>Ps(e,t)}),this.registerEffect("radiation_rings",{create:(e,t)=>new $s(t,e),fromPythonData:(e,t)=>Fs(t,e,e.seeds?.planet_seed)}),this.registerEffect("crystal_formations",{create:(e,t)=>(console.warn("Crystal formations effect not implemented yet"),null)}),this.registerEffect("star_field",{create:(e,t)=>new ps(t,e),fromPythonData:(e,t)=>hs(t,e.seeds?.planet_seed||e.planet_seed)}),this.registerEffect("tundra_snowflakes",{create:(e,t)=>new Ve(t,e),fromPythonData:(e,t)=>de(t,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("toxic_post_processing",{create:(e,t)=>null,fromPythonData:(e,t)=>null}),this.registerEffect("toxic_waste_render",{create:(e,t)=>new Ue(t,e),fromPythonData:(e,t)=>le(t,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("river_lines",{create:(e,t)=>new Ye(t,e),fromPythonData:(e,t)=>te(t,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("anomaly_phase_matter",{create:(e,t)=>new Le(t,e),fromPythonData:(e,t)=>$e(t,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("pulsating_cube",{create:(e,t)=>new je(t,e),fromPythonData:(e,t)=>{const i=w(e);return Ke(t,e.surface_elements||{},e.seeds?.planet_seed,i,e)}}),this.registerEffect("planet_rays",{create:(e,t)=>new Qe(t,e),fromPythonData:(e,t)=>Je(t,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("visual_debug_3d",{create:(e,t)=>new As(t,e),fromPythonData:(e,t)=>Ls(e,t)}),this.registerEffect("terrain_cracks",{create:(e,t)=>new es({...e,radius:t}),fromPythonData:(e,t)=>ce(e,t,e.seeds?.shape_seed||e.seeds?.planet_seed)}),this.registerEffect("exotic_geometric_shapes",{create:(e,t)=>new ss(t,e),fromPythonData:(e,t)=>{const i=w(e);return he(t,e.surface_elements||{},e.seeds?.planet_seed,i)}}),this.registerEffect("exotic_doodles",{create:(e,t)=>new ts(t,e),fromPythonData:(e,t)=>pe(t,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("cave_surface_holes",{create:(e,t,i)=>new cs(t,e),fromPythonData:(e,t,i)=>ye(t,e,e.seeds?.planet_seed)}),this.registerEffect("vegetation",{create:(e,t,i)=>new is(t,e),fromPythonData:(e,t,i)=>rs(t,e.surface_elements||{},e.seeds?.planet_seed,e.timing?.cosmic_origin_time)}),this.registerEffect("crystalline_surface",{create:(e,t,i)=>new ls(t,e),fromPythonData:(e,t,i)=>ds(t,e.surface_elements||{},e.seeds?.planet_seed,e.timing?.cosmic_origin_time)}),this.registerEffect("toxic_swamp_bubbles",{create:(e,t)=>new ms(t,e),fromPythonData:(e,t)=>_s(t,e.surface_elements||{},e.seeds?.planet_seed)}),this.registerEffect("magma_flows",{create:(e,t,i)=>new ns(t,e),fromPythonData:(e,t,i)=>os(t,e.surface_elements||{},e.seeds?.planet_seed,e.timing?.cosmic_origin_time)}),this.registerEffect("magma_eruptions",{create:(e,t,i)=>new fs(t,e),fromPythonData:(e,t,i)=>as(t,e.surface_elements||{},e.seeds?.planet_seed,e.timing?.cosmic_origin_time)})}registerEffect(e,t){this.creators.set(e,t)}createEffect(e,t,i,o,y=0){const n=this.creators.get(e);if(!n)return console.warn(`Effect type '${e}' not registered`),null;try{const l=n.create(t,i,this.layerSystem);if(!l)return null;const g={id:`effect_${this.nextId++}`,type:e,effect:l,priority:y,enabled:!0};return this.effects.set(g.id,g),g}catch(l){return console.error(`Error creating effect '${e}':`,l),null}}createEffectFromPythonData(e,t,i,o,y=0){const n=this.creators.get(e);if(!n||!n.fromPythonData)return this.createEffect(e,t,i,o,y);try{const l=n.fromPythonData(t,i,this.layerSystem);if(!l)return null;const g={id:`effect_${this.nextId++}`,type:e,effect:l,priority:y,enabled:!0};return this.effects.set(g.id,g),g}catch(l){return console.error(`Error creating effect '${e}' from Python data:`,l),null}}createEffectsFromList(e,t,i){const o=[],y=e.sort((n,l)=>(n.priority||0)-(l.priority||0));for(const n of y){const l=this.createEffect(n.type,n.params,t,i,n.priority);l&&(l.enabled=n.enabled!==!1,o.push(l))}return o}createEffectsFromPythonPlanetData(e,t,i,o,y){const n=[];try{const l=w(e);if(y?this.layerSystem=y:this.layerSystem=new Xe(i,l),e.surface_elements){const c=e.surface_elements;if(c.effects_3d&&Array.isArray(c.effects_3d))for(const h of c.effects_3d){if(h.type==="atmospheric_streaks"){const b=ge(t,h.params,e.seeds?.shape_seed+3e3),I={id:`effect_${this.nextId++}`,type:"atmospheric_streaks",effect:b,priority:h.priority||0,enabled:!0,name:"Atmospheric Streaks"};this.effects.set(I.id,I),n.push(I),b.addToScene(o,i.position);continue}const S=this.createEffect(h.type,h.params,t,i,h.priority||0);S?(S.name=h.type.replace(/_/g," ").replace(/\b\w/g,b=>b.toUpperCase()),n.push(S),S.effect.apply&&S.effect.apply(i),S.effect.addToScene&&S.effect.addToScene(o,i.position)):console.error("‚ùå FALLO AL CREAR EFECTO:",h.type)}switch(c.type.toLowerCase()){case"gas_giant":if(this.layerSystem){const s=_e(this.layerSystem,{...c,base_color:l,turbulence:e.turbulence||c.turbulence},e.seeds?.shape_seed||e.seeds?.planet_seed||e.seeds?.planet_seed),r=me(this.layerSystem,{...c,base_color:l,storm_intensity:e.storm_intensity||c.storm_intensity},(e.seeds?.shape_seed||e.seeds?.planet_seed)+1e3),a={id:`effect_${this.nextId++}`,type:"cloud_bands_layer",effect:s,priority:0,enabled:!0};this.effects.set(a.id,a),n.push(a);const f={id:`effect_${this.nextId++}`,type:"cloud_gyros_layer",effect:r,priority:1,enabled:!0};if(this.effects.set(f.id,f),n.push(f),c.polar_hexagon&&c.polar_hexagon.enabled){const d=e.timing?.elapsed_time?e.timing.elapsed_time/31557600:0,_=new re({planetColor:l,hexagonData:c.polar_hexagon,planetRadius:t,currentTime:d}),E={id:`effect_${this.nextId++}`,type:"polar_hexagon",effect:_,priority:10,enabled:!0};this.effects.set(E.id,E),n.push(E),o&&_.addToScene(o)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const d=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),_={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:d,priority:12,enabled:!0};this.effects.set(_.id,_),n.push(_),o&&d.addToScene(o)}if(c.atmosphere_clouds&&c.atmosphere_clouds.clouds&&c.atmosphere_clouds.clouds.length>0){const d=m(t,c.atmosphere_clouds,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time);if(d){const _={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:d,priority:15,enabled:!0,name:"Gas Giant Atmosphere Clouds"};this.effects.set(_.id,_),n.push(_),d.addToScene(o,i.position)}}}else console.error("‚ùå PlanetLayerSystem not initialized!");break;case"frozen_gas_giant":if(this.layerSystem){const s=_e(this.layerSystem,{...c,base_color:l,turbulence:e.turbulence||c.turbulence,icy_tint:!0},e.seeds?.shape_seed||e.seeds?.planet_seed),r={id:`effect_${this.nextId++}`,type:"cloud_bands_layer",effect:s,priority:0,enabled:!0};if(this.effects.set(r.id,r),n.push(r),c.polar_hexagon&&c.polar_hexagon.enabled){const a=e.timing?.elapsed_time?e.timing.elapsed_time/31557600:0,f=new re({planetColor:l,hexagonData:c.polar_hexagon,planetRadius:t,currentTime:a}),d={id:`effect_${this.nextId++}`,type:"polar_hexagon",effect:f,priority:10,enabled:!0};this.effects.set(d.id,d),n.push(d),o&&f.addToScene(o)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const a=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),f={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:a,priority:12,enabled:!0};this.effects.set(f.id,f),n.push(f),o&&a.addToScene(o)}if(c.atmosphere_clouds&&c.atmosphere_clouds.clouds&&c.atmosphere_clouds.clouds.length>0){const a=m(t,c.atmosphere_clouds,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time);if(a){const f={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:a,priority:15,enabled:!0,name:"Frozen Gas Giant Atmosphere Clouds"};this.effects.set(f.id,f),n.push(f),a.addToScene(o,i.position)}}}break;case"aquifer":const h=be(this.layerSystem,e);if(h){const s={id:`effect_${this.nextId++}`,type:"aquifer_water",effect:h,priority:2,enabled:!0,name:"Aquifer Water Surface"};this.effects.set(s.id,s),n.push(s)}const S=Ie(this.layerSystem,e);if(S){const s={id:`effect_${this.nextId++}`,type:"ocean_currents",effect:S,priority:1,enabled:!0,name:"Ocean Currents"};this.effects.set(s.id,s),n.push(s)}if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}if(c.land_masses&&c.land_masses.length>0){const s=p(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+7e3);if(s){const r={id:`effect_${this.nextId++}`,type:"land_masses",effect:s,priority:3,enabled:!0,name:"Emergent Land Masses"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.atmosphere_clouds&&c.atmosphere_clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+8e3,e.timing?.cosmic_origin_time);if(s){const r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:4,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Aquifer Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"nebulous":if(this.layerSystem){const s=me(this.layerSystem,{...c,base_color:l,storm_intensity:c.nebula_density||.6,color_variance:c.color_variance||.2},(e.seeds?.shape_seed||e.seeds?.planet_seed)+2e3),r={id:`effect_${this.nextId++}`,type:"cloud_gyros_layer",effect:s,priority:0,enabled:!0};if(this.effects.set(r.id,r),n.push(r),c.polar_hexagon&&c.polar_hexagon.enabled){const a=e.timing?.elapsed_time?e.timing.elapsed_time/31557600:0,f=new re({planetColor:l,hexagonData:c.polar_hexagon,planetRadius:t,currentTime:a}),d={id:`effect_${this.nextId++}`,type:"polar_hexagon",effect:f,priority:10,enabled:!0};this.effects.set(d.id,d),n.push(d),o&&f.addToScene(o)}if(c.clouds&&c.clouds.length>0){const a=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),f={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:a,priority:15,enabled:!0,name:"Nebulous Atmospheric Clouds"};this.effects.set(f.id,f),n.push(f),a.addToScene(o,i.position)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const a=u(t,c,l,(e.seeds?.shape_seed||e.seeds?.planet_seed)+5e3,e.timing?.cosmic_origin_time),f={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:a,priority:12,enabled:!0,name:"Nebulous Secondary Clouds"};this.effects.set(f.id,f),n.push(f),a.addToScene(o,i.position)}}break;case"metallic":case"metallic_3d":if(this.layerSystem){const s=Re(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed),r={id:`effect_${this.nextId++}`,type:"metallic_surface_layer",effect:s,priority:0,enabled:!0};if(this.effects.set(r.id,r),n.push(r),c.secondary_clouds&&c.secondary_clouds.length>0){const a=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),f={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:a,priority:12,enabled:!0,name:"Metallic Secondary Clouds"};this.effects.set(f.id,f),n.push(f),o&&a.addToScene(o)}}break;case"diamond":if(this.layerSystem){const s=De(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed),r={id:`effect_${this.nextId++}`,type:"diamond_surface_layer",effect:s,priority:0,enabled:!0};this.effects.set(r.id,r),n.push(r);const a=ce(e,t,e.seeds?.shape_seed||e.seeds?.planet_seed),f={id:`effect_${this.nextId++}`,type:"terrain_cracks",effect:a,priority:1,enabled:!0};if(this.effects.set(f.id,f),n.push(f),a.addToScene(o,i.position),c.clouds&&c.clouds.length>0){const d=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),_={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:d,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(_.id,_),n.push(_),d.addToScene(o,i.position)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const d=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),_={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:d,priority:12,enabled:!0,name:"Diamond Secondary Clouds"};this.effects.set(_.id,_),n.push(_),o&&d.addToScene(o)}}break;case"rocky":if(this.layerSystem){const s=ue(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed,"ROCKY"),r={id:`effect_${this.nextId++}`,type:"rocky_terrain_layer",effect:s,priority:0,enabled:!0};if(this.effects.set(r.id,r),n.push(r),c.clouds&&c.clouds.length>0){const a=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),f={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:a,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(f.id,f),n.push(f),a.addToScene(o,i.position)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const a=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),f={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:a,priority:12,enabled:!0,name:"Rocky Secondary Clouds"};this.effects.set(f.id,f),n.push(f),o&&a.addToScene(o)}}break;case"icy":if(this.layerSystem){const s=Ze(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed),r={id:`effect_${this.nextId++}`,type:"icy_terrain_layer",effect:s,priority:0,enabled:!0};this.effects.set(r.id,r),n.push(r);const a=Oe(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+8e3);if(a){const d={id:`effect_${this.nextId++}`,type:"transparent_land_masses",effect:a,priority:1,enabled:!0,name:"Ice Formations"};this.effects.set(d.id,d),n.push(d),a.addToScene(o,i.position)}else console.warn("‚ùÑÔ∏è Failed to create transparent LandMasses for Icy planet");if(c.clouds&&c.clouds.length>0){const d=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),_={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:d,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(_.id,_),n.push(_),d.addToScene(o,i.position)}const f=fe(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+9e3);if(f){const d={id:`effect_${this.nextId++}`,type:"icy_features",effect:f,priority:2,enabled:!0,name:"Ice Crystals & Features"};this.effects.set(d.id,d),n.push(d),f.addToScene(o,i.position)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const d=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),_={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:d,priority:12,enabled:!0,name:"Icy Secondary Clouds"};this.effects.set(_.id,_),n.push(_),o&&d.addToScene(o)}}break;case"oceanic":const b=Ee(t,e);if(b){const s={id:`effect_${this.nextId++}`,type:"fluid_layers",effect:b,priority:3,enabled:!0,name:"Fluid Ocean Layers"};this.effects.set(s.id,s),n.push(s),b.addToScene(o,i.position)}if(c.green_patches&&c.green_patches.length>0){const s=p(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3);if(s){const r={id:`effect_${this.nextId++}`,type:"land_masses",effect:s,priority:5,enabled:!0,name:"Land Masses (Islands)"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Oceanic Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"tundra":if(c.green_patches&&c.green_patches.length>0){const s=p(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3);if(s){const r={id:`effect_${this.nextId++}`,type:"land_masses",effect:s,priority:5,enabled:!0,name:"Tundra Terrain"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}const I=fe(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+9e3);if(I){const s={id:`effect_${this.nextId++}`,type:"icy_features",effect:I,priority:6,enabled:!0,name:"Snow Patches & Ice"};this.effects.set(s.id,s),n.push(s),I.addToScene(o,i.position)}if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}const L=de(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+15e3);if(L){const s={id:`effect_${this.nextId++}`,type:"tundra_snowflakes",effect:L,priority:20,enabled:!0,name:"Snowflakes"};this.effects.set(s.id,s),n.push(s),L.addToScene(o,i.position)}break;case"arid":let x;if(c.clouds&&c.clouds.length>0?x=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time):x=new ee(t,{color:new ie(.9,.8,.7),cloudCount:20,size:4.2,opacity:.7,density:1.2,seed:(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,rotationSpeed:.004,movementAmplitude:.012,puffiness:1.3,timeSpeed:1}),x){const s={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:x,priority:15,enabled:!0,name:"Atmospheric Clouds"};this.effects.set(s.id,s),n.push(s),x.addToScene(o,i.position)}let T;if(c.green_patches&&c.green_patches.length>0){const s={...c,green_patches:c.green_patches.map(r=>({...r,color:[.5,0,0,r.color?.[3]||1]}))};T=p(t,s,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3)}else T=new se(t,{seed:(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3,greenPatches:Array.from({length:25},(s,r)=>{const a=(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3+r*100,f=Math.sin(a)*.5+.5,d=Math.acos(1-2*(r+f)/25),_=2*Math.PI*(r*2.399%1);let E;return r<8?E=.25+f*.25:r<16?E=.15+f*.15:E=.08+f*.12,{position_3d:[Math.sin(d)*Math.cos(_),Math.sin(d)*Math.sin(_),Math.cos(d)],size:E,sides:12+Math.floor(f*16),color:[.5,0,0,.7+f*.2]}})});if(T){const s={id:`effect_${this.nextId++}`,type:"land_masses",effect:T,priority:5,enabled:!0,name:"Arid Terrain"};this.effects.set(s.id,s),n.push(s),T.addToScene(o,i.position)}const A=te(t,c,e.seeds?.shape_seed||e.seeds?.planet_seed);if(A){const s={id:`effect_${this.nextId++}`,type:"river_lines",effect:A,priority:6,enabled:!0,name:"Dried River Channels"};this.effects.set(s.id,s),n.push(s),A.addToScene(o,i.position)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Arid Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"savannah":if(this.layerSystem){const s=F(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed,"SAVANNAH"),r={id:`effect_${this.nextId++}`,type:"savannah_terrain_layer",effect:s,priority:2,enabled:!0,name:"Savannah Terrain Layer"};this.effects.set(r.id,r),n.push(r)}if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time);if(s){const r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Savannah Atmospheric Clouds"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.green_patches&&c.green_patches.length>0){const s=p(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3);if(s){const r={id:`effect_${this.nextId++}`,type:"land_masses",effect:s,priority:5,enabled:!0,name:"Savannah Terrain"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Savannah Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"desert":if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time);if(s){const r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Desert Dust Clouds"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.green_patches&&c.green_patches.length>0){const s=p(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3);if(s){const r={id:`effect_${this.nextId++}`,type:"land_masses",effect:s,priority:5,enabled:!0,name:"Desert Oases"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}const k=Te(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+7e3,"desert");if(k){const s={id:`effect_${this.nextId++}`,type:"super_earth_water_features",effect:k,priority:6,enabled:!0,name:"Desert Rare Water Mass"};this.effects.set(s.id,s),n.push(s),k.addToScene(o,i.position)}const G=qe(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+15e3);if(G){const s={id:`effect_${this.nextId++}`,type:"tundra_snowflakes",effect:G,priority:20,enabled:!0,name:"Desert Sandstorms"};this.effects.set(s.id,s),n.push(s),G.addToScene(o,i.position)}if(c.savannah_terrain_layer&&this.layerSystem){const s=F(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed,"SAVANNAH"),r={id:`effect_${this.nextId++}`,type:"savannah_terrain_layer",effect:s,priority:2,enabled:!0,name:"Desert Savannah Terrain"};this.effects.set(r.id,r),n.push(r)}break;case"molten_core":case"molten core":const oe=xe(this.layerSystem,e);if(oe){const s={id:`effect_${this.nextId++}`,type:"molten_lava",effect:oe,priority:2,enabled:!0,name:"Molten Lava Surface"};this.effects.set(s.id,s),n.push(s)}const W=Ce(t,c,(e.seeds?.planet_seed||e.seeds?.shape_seed)+9e3);if(W){const s={id:`effect_${this.nextId++}`,type:"lava_flows",effect:W,priority:4,enabled:!0,name:"Lava Flows & Fire Whips"};this.effects.set(s.id,s),n.push(s),W.addToScene(o,i.position)}const N=this.createEffectFromPythonData("fire_eruption",e,t,i)?.effect;if(N){const s={id:`effect_${this.nextId++}`,type:"fire_eruption",effect:N,priority:15,enabled:!0,name:"Fire Eruptions"};this.effects.set(s.id,s),n.push(s),N.addToScene(o,i.position)}if(c.green_patches&&c.green_patches.length>0){const s={...c,green_patches:c.green_patches.map(a=>({...a,color:[1,.55,0,a.color?.[3]||.9]}))},r=p(t,s,(e.seeds?.planet_seed||e.seeds?.shape_seed)+1e4);if(r){const a={id:`effect_${this.nextId++}`,type:"land_masses",effect:r,priority:3,enabled:!0,name:"Incandescent Land Masses"};this.effects.set(a.id,a),n.push(a),r.addToScene(o,i.position)}}if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.planet_seed||e.seeds?.shape_seed)+4e3,e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Molten Atmospheric Clouds"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Molten Core Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"lava":const z=ce(e,t,e.seeds?.shape_seed||e.seeds?.planet_seed);if(z){const s={id:`effect_${this.nextId++}`,type:"terrain_cracks",effect:z,priority:1,enabled:!0,name:"Lava Terrain Cracks"};this.effects.set(s.id,s),n.push(s),z.addToScene(o,i.position)}const O=this.createEffectFromPythonData("lava_rivers",e,t,i)?.effect;if(O){const s={id:`effect_${this.nextId++}`,type:"lava_rivers",effect:O,priority:8,enabled:!0,name:"Lava Rivers"};this.effects.set(s.id,s),n.push(s),O.addToScene(o,i.position)}const V=this.createEffectFromPythonData("fire_eruption",e,t,i)?.effect;if(V){const s={id:`effect_${this.nextId++}`,type:"fire_eruption",effect:V,priority:12,enabled:!0,name:"Lava Planet Fire Eruptions"};this.effects.set(s.id,s),n.push(s),V.addToScene(o,i.position)}if(c.green_patches&&c.green_patches.length>0){const s={...c,green_patches:c.green_patches.map(a=>({...a,color:[.8,.3,0,a.color?.[3]||.7]}))},r=p(t,s,(e.seeds?.planet_seed||e.seeds?.shape_seed)+11e3);if(r){const a={id:`effect_${this.nextId++}`,type:"land_masses",effect:r,priority:3,enabled:!0,name:"Lava Land Masses"};this.effects.set(a.id,a),n.push(a),r.addToScene(o,i.position)}}if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+7e3,e.timing?.cosmic_origin_time);if(s){const r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:16,enabled:!0,name:"Volcanic Ash Clouds"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Lava Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"exotic":if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Exotic Atmospheric Clouds"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}const B=he(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+5e3,l);if(B){const s={id:`effect_${this.nextId++}`,type:"exotic_geometric_shapes",effect:B,priority:10,enabled:!0,name:"Exotic Geometric Shapes"};this.effects.set(s.id,s),n.push(s),B.addToScene(o,i.position)}const H=pe(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3,e);if(H){const s={id:`effect_${this.nextId++}`,type:"exotic_doodles",effect:H,priority:12,enabled:!0,name:"Exotic Doodles"};this.effects.set(s.id,s),n.push(s),H.addToScene(o,i.position)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Exotic Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"cave":let M;if(c.atmosphere_clouds&&c.atmosphere_clouds.clouds&&c.atmosphere_clouds.clouds.length>0?M=m(t,c.atmosphere_clouds,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time):M=new ee(t,{color:new ie(.75,.75,.75),cloudCount:12,size:3.5,opacity:.65,density:.8,seed:(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,rotationSpeed:.003,movementAmplitude:.008,puffiness:1.1,timeSpeed:.8}),M){const s={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:M,priority:15,enabled:!0,name:"Cave Atmospheric Clouds"};this.effects.set(s.id,s),n.push(s),M.addToScene(o,i.position)}let v;if(c.green_patches&&c.green_patches.length>0)v=p(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+5e3);else{const s=new Ae((e.seeds?.shape_seed||e.seeds?.planet_seed)+5e3),r=[];for(let a=0;a<10;a++){const f=s.random()*2*Math.PI,d=Math.acos(s.random()*2-1);let _;a<3?_=.2+s.random()*.2:a<7?_=.12+s.random()*.13:_=.08+s.random()*.07,r.push({position_3d:[Math.sin(d)*Math.cos(f),Math.sin(d)*Math.sin(f),Math.cos(d)],size:_,sides:12+Math.floor(s.random()*8),color:[.29,.25,.21,.75+s.random()*.15]})}v=new se(t,{greenPatches:r,seed:(e.seeds?.shape_seed||e.seeds?.planet_seed)+5e3})}if(v){const s={id:`effect_${this.nextId++}`,type:"land_masses",effect:v,priority:5,enabled:!0,name:"Cave Land Masses"};this.effects.set(s.id,s),n.push(s),v.addToScene(o,i.position)}if(this.layerSystem){const s=ue(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed,"CAVE"),r={id:`effect_${this.nextId++}`,type:"rocky_terrain_layer",effect:s,priority:1,enabled:!0,name:"Cave Rocky Terrain"};this.effects.set(r.id,r),n.push(r)}const $=ye(t,e,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3);if($){const s={id:`effect_${this.nextId++}`,type:"cave_surface_holes",effect:$,priority:10,enabled:!0,name:"Cave Surface Holes"};if(this.effects.set(s.id,s),n.push(s),$.addToScene(o,i.position),this.layerSystem){const r=this.layerSystem.baseMaterial?.uniforms?.baseColor?.value||new ie(9127187);$.applyToPlanetSystem(this.layerSystem,r)}}const q=te(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+7e3);if(q){const s={id:`effect_${this.nextId++}`,type:"river_lines",effect:q,priority:8,enabled:!0,name:"Cave Drainage Channels"};this.effects.set(s.id,s),n.push(s),q.addToScene(o,i.position)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Cave Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"anomaly":const ne=["anomaly_phase_matter","pulsating_cube","planet_rays"],Pe=e.seeds?.planet_seed||Math.floor(Math.random()*1e6),we=ne.length;for(let s=0;s<we;s++){const r=ne[s],a=Pe+s*1e4,f=this.createEffectFromPythonData(r,{...e,seeds:{...e.seeds,planet_seed:a}},t,i,10+s);f&&(f.name=r.replace(/_/g," ").replace(/\b\w/g,d=>d.toUpperCase()),n.push(f),f.effect.addToScene&&f.effect.addToScene(o,i.position))}if(e.atmosphere&&e.atmosphere.type!=="None"){const s=this.createEffectFromPythonData("atmosphere",e.atmosphere,t,i,5);s&&(n.push(s),s.effect.addToScene(o,i.position))}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Anomaly Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"carbon":if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.planet_seed||e.seeds?.shape_seed)+4e3,e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Carbon Atmospheric Dust"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}if(c.green_patches&&c.green_patches.length>0){const s={...c,green_patches:c.green_patches.map(a=>({...a,color:[.1,.07,.06,a.color?.[3]||.9],size:(a.size||.1)*1.5}))},r=p(t,s,(e.seeds?.planet_seed||e.seeds?.shape_seed)+6e3);if(r){const a={id:`effect_${this.nextId++}`,type:"land_masses",effect:r,priority:5,enabled:!0,name:"Carbon Formations"};this.effects.set(a.id,a),n.push(a),r.addToScene(o,i.position)}}const U=He(t,c,(e.seeds?.planet_seed||e.seeds?.shape_seed)+15e3);if(U){const s={id:`effect_${this.nextId++}`,type:"tundra_snowflakes",effect:U,priority:20,enabled:!0,name:"Carbon Dust Particles"};this.effects.set(s.id,s),n.push(s),U.addToScene(o,i.position)}const Y=this.createEffectFromPythonData("carbon_trails",e,t,i);if(Y){const s={id:`effect_${this.nextId++}`,type:"carbon_trails",effect:Y.effect,priority:25,enabled:!0,name:"Carbon Gas Trails"};this.effects.set(s.id,s),n.push(s),Y.effect.addToScene(o,i.position)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Carbon Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"forest":const j=this.createEffectFromPythonData("vegetation",e,t,i);if(j){const s={id:`effect_${this.nextId++}`,type:"vegetation",effect:j.effect,priority:10,enabled:!0,name:"Forest Vegetation"};this.effects.set(s.id,s),n.push(s),j.effect.addToScene(o,i.position)}if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time);if(s){const r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Forest Atmospheric Clouds"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.green_patches&&c.green_patches.length>0){const s={...c,green_patches:c.green_patches.map(a=>({...a,size:(a.size||.1)*1.5,color:a.color||[.2,.4,.1,1]}))},r=p(t,s,(e.seeds?.planet_seed||e.seeds?.shape_seed)+6e3);if(r){const a={id:`effect_${this.nextId++}`,type:"land_masses",effect:r,priority:5,enabled:!0,name:"Forest Land Masses"};this.effects.set(a.id,a),n.push(a),r.addToScene(o,i.position)}}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Forest Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"magma":const K=this.createEffectFromPythonData("magma_flows",e,t,i);if(K){const s={id:`effect_${this.nextId++}`,type:"magma_flows",effect:K.effect,priority:12,enabled:!0,name:"Magma Flows & Lakes"};this.effects.set(s.id,s),n.push(s),K.effect.addToScene(o,i.position)}const J=this.createEffectFromPythonData("magma_eruptions",e,t,i);if(J){const s={id:`effect_${this.nextId++}`,type:"magma_eruptions",effect:J.effect,priority:13,enabled:!0,name:"Magma Eruptions & Arcs"};this.effects.set(s.id,s),n.push(s),J.effect.addToScene(o,i.position)}if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time);if(s){const r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Magma Atmospheric Clouds"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.green_patches&&c.green_patches.length>0){const s=p(t,c,(e.seeds?.planet_seed||e.seeds?.shape_seed)+6e3);if(s){const r={id:`effect_${this.nextId++}`,type:"land_masses",effect:s,priority:5,enabled:!0,name:"Magmatic Land Masses"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Magma Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"crystalline":const Q=this.createEffectFromPythonData("crystalline_surface",e,t,i);if(Q){const s={id:`effect_${this.nextId++}`,type:"crystalline_surface",effect:Q.effect,priority:3,enabled:!0,name:"Advanced Crystalline Surface"};this.effects.set(s.id,s),n.push(s),Q.effect.addToScene(o,i.position)}break;case"toxic":if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Toxic Purple Clouds"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}if(c.green_patches&&c.green_patches.length>0){const s=p(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4500);if(s){const r={id:`effect_${this.nextId++}`,type:"land_masses",effect:s,priority:10,enabled:!0,name:"Toxic Contaminated Areas"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}const X=Be(t,c,(e.seeds?.planet_seed||e.seeds?.shape_seed)+15e3);if(X){const s={id:`effect_${this.nextId++}`,type:"tundra_snowflakes",effect:X,priority:20,enabled:!0,name:"Toxic Particles"};this.effects.set(s.id,s),n.push(s),X.addToScene(o,i.position)}const Z=le(t,c,e.seeds?.planet_seed);if(Z){const s={id:`effect_${this.nextId++}`,type:"toxic_waste_render",effect:Z,priority:25,enabled:!0,name:"Toxic Waste Polygonal Spots"};this.effects.set(s.id,s),n.push(s),Z.addToScene(o,i.position)}break;case"radioactive":if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+5e3,e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Radioactive Toxic Clouds"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}if(c.green_patches&&c.green_patches.length>0){const s=p(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3);if(s){const r={id:`effect_${this.nextId++}`,type:"land_masses",effect:s,priority:10,enabled:!0,name:"Radioactive Contaminated Areas"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}const R=this.createEffectFromPythonData("radiation_rings",e,t,i);if(R){const s={id:`effect_${this.nextId++}`,type:"radiation_rings",effect:R.effect,priority:21,enabled:!0,name:"Radioactive Surface Rings"};this.effects.set(s.id,s),n.push(s),R.effect.addToScene(o,i.position)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Radioactive Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"super_earth":if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+8e3,e.timing?.cosmic_origin_time);if(s){const r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Super Earth Dense Atmosphere"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.green_patches&&c.green_patches.length>0){const s=p(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+9e3);if(s){const r={id:`effect_${this.nextId++}`,type:"land_masses",effect:s,priority:5,enabled:!0,name:"Super Earth Massive Continents"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(this.layerSystem){const s=F(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed,"SAVANNAH"),r={id:`effect_${this.nextId++}`,type:"savannah_terrain_layer",effect:s,priority:3,enabled:!0,name:"Super Earth Savannah Terrain"};this.effects.set(r.id,r),n.push(r)}const D=Te(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+11e3);if(D){const s={id:`effect_${this.nextId++}`,type:"super_earth_water_features",effect:D,priority:6,enabled:!0,name:"Super Earth Water Features"};this.effects.set(s.id,s),n.push(s),D.addToScene(o,i.position)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Super Earth Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"sub_earth":if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+7e3,e.timing?.cosmic_origin_time);if(s){const r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Sub Earth Thin Atmosphere"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.green_patches&&c.green_patches.length>0){const s=p(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+7500);if(s){const r={id:`effect_${this.nextId++}`,type:"land_masses",effect:s,priority:5,enabled:!0,name:"Sub Earth Small Continents"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.savannah_terrain_layer&&this.layerSystem){const s=F(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed,"SAVANNAH"),r={id:`effect_${this.nextId++}`,type:"savannah_terrain_layer",effect:s,priority:2,enabled:!0,name:"Sub Earth Savannah Terrain"};this.effects.set(r.id,r),n.push(r)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Sub Earth Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}break;case"swamp":if(c.clouds&&c.clouds.length>0){const s=m(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+4e3,e.timing?.cosmic_origin_time);if(s){const r={id:`effect_${this.nextId++}`,type:"atmosphere_clouds",effect:s,priority:15,enabled:!0,name:"Swamp Humid Atmosphere"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(c.green_patches&&c.green_patches.length>0){const s=p(t,c,(e.seeds?.shape_seed||e.seeds?.planet_seed)+6e3);if(s){const r={id:`effect_${this.nextId++}`,type:"land_masses",effect:s,priority:5,enabled:!0,name:"Swamp Land Masses"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}if(this.layerSystem){const s=F(this.layerSystem,e,e.seeds?.shape_seed||e.seeds?.planet_seed,"SAVANNAH"),r={id:`effect_${this.nextId++}`,type:"savannah_terrain_layer",effect:s,priority:3,enabled:!0,name:"Swamp Savannah Terrain"};this.effects.set(r.id,r),n.push(r)}if(c.secondary_clouds&&c.secondary_clouds.length>0){const s=u(t,c,l,e.seeds?.planet_seed||Math.floor(Math.random()*1e6),e.timing?.cosmic_origin_time),r={id:`effect_${this.nextId++}`,type:"secondary_clouds",effect:s,priority:12,enabled:!0,name:"Swamp Secondary Clouds"};this.effects.set(r.id,r),n.push(r),o&&s.addToScene(o)}if(c.toxic_bubbles){const s=this.createEffectFromPythonData("toxic_swamp_bubbles",e,t,i)?.effect;if(s){const r={id:`effect_${this.nextId++}`,type:"toxic_swamp_bubbles",effect:s,priority:25,enabled:!0,name:"Toxic Swamp Bubbles"};this.effects.set(r.id,r),n.push(r),s.addToScene(o,i.position)}}break;default:if(e.planet_info?.type?.toLowerCase()==="anomaly"){const r=["anomaly_phase_matter","pulsating_cube","planet_rays"],a=e.seeds?.planet_seed||Math.floor(Math.random()*1e6),f=r.length;for(let d=0;d<f;d++){const _=r[d],E=a+d*1e4,P=this.createEffectFromPythonData(_,{...e,seeds:{...e.seeds,planet_seed:E}},t,i,10+d);P&&(P.name=_.replace(/_/g," ").replace(/\b\w/g,Fe=>Fe.toUpperCase()),n.push(P),P.effect.addToScene&&P.effect.addToScene(o,i.position))}if(e.atmosphere&&e.atmosphere.type!=="None"){const d=this.createEffectFromPythonData("atmosphere",e.atmosphere,t,i,5);d&&(n.push(d),d.effect.addToScene(o,i.position))}}else if(i.material instanceof Me){const s=w(e);i.material.color.copy(s)}break}}else if(i.material instanceof Me){const c=w(e);i.material.color.copy(c)}const g=e.planet_info?.type?.toLowerCase()||e.surface_elements?.type?.toLowerCase(),ve=g==="anomaly"||e.surface_elements?.type==="anomaly";if(e.atmosphere&&!ve){if(e.atmosphere.streaks||["Gas Giant","Frozen Gas Giant"].includes(e.planet_info?.type)){const c=ae(t,e.atmosphere||{},e.seeds?.shape_seed+2e3);if(c){const h={id:`effect_${this.nextId++}`,type:"atmosphere_glow",effect:c,priority:20,enabled:!0};this.effects.set(h.id,h),n.push(h),c.addToScene(o,i.position)}}if(e.atmosphere.type&&e.atmosphere.type!=="None"){const c={...e.atmosphere};g==="oceanic"&&(c.opacity=Math.min(c.opacity||.3,.15),c.width=Math.min(c.width||15,8));const h=this.createEffectFromPythonData("atmosphere",c,t,i,5);h&&(n.push(h),h.effect.addToScene(o,i.position))}}if(e.rings&&e.rings.has_rings||["Gas Giant","Frozen Gas Giant","Super Earth"].includes(e.planet_info?.type)){const c=this.createEffectFromPythonData("ring_system",e,t,i,1);c?(n.push(c),c.effect.addToScene(o,i.position)):console.warn("‚ö†Ô∏è Failed to create ring effect")}if(e.surface_elements?.has_fragmentation_zones){const c=this.createEffectFromPythonData("fragmentation",e,t,i,5);c&&(n.push(c),c.effect.addToScene(o,i.position))}this.layerSystem&&this.layerSystem.addToScene(o);try{const c=this.createEffectFromPythonData("star_field",e,t,i,-100);c&&c.effect&&(c.effect.addToScene(o,i.position),n.push(c))}catch(c){console.warn("Could not create StarField:",c)}return n.forEach((c,h)=>{}),n.length===0&&console.warn("‚ö†Ô∏è NO EFFECTS WERE CREATED! Check the data structure and conditions."),n}catch(l){throw console.error("Error in EffectRegistry.createEffectsFromPythonPlanetData:",l),l}}getEffect(e){return this.effects.get(e)||null}getEffectsByType(e){return Array.from(this.effects.values()).filter(t=>t.type===e)}getAllEffects(){return Array.from(this.effects.values())}toggleEffect(e,t){const i=this.effects.get(e);if(i){i.enabled=t!==void 0?t:!i.enabled;const o=i.effect;if(o&&o.getObject3D){const y=o.getObject3D();y&&(y.visible=i.enabled)}if(this.layerSystem){const y=this.layerSystem.getLayerMeshes(),l={cloud_bands_layer:"cloudBands",cloud_gyros_layer:"cloudGyros",metallic_surface_layer:"metallicSurface",diamond_surface_layer:"diamondSurface",rocky_terrain_layer:"rockyTerrain",savannah_terrain_layer:"savannahTerrain",icy_terrain_layer:"icyTerrain",aquifer_water:"aquiferWater",ocean_currents:"oceanCurrents",molten_lava:"moltenLava"}[i.type];l&&y[l]&&(y[l].visible=i.enabled)}}else console.warn(`‚ö†Ô∏è Effect not found: ${e}`)}updateAllEffects(e,t,i){this.layerSystem&&this.layerSystem.update(e,t);for(const o of this.effects.values())if(o.enabled&&o.effect.update)try{o.type==="star_field"&&i&&"updateWithCamera"in o.effect?o.effect.updateWithCamera(e,i):o.effect.update(e,t)}catch(y){console.error(`Error updating effect ${o.type}:`,y)}}updateLightForAllEffects(e){this.layerSystem&&this.layerSystem.updateFromThreeLight(e);for(const t of this.effects.values())if(t.enabled&&t.effect.updateFromThreeLight)try{t.effect.updateFromThreeLight(e)}catch(i){console.error(`Error updating light for effect ${t.type}:`,i)}}removeEffect(e){const t=this.effects.get(e);t&&(t.effect.dispose&&t.effect.dispose(),this.effects.delete(e))}clearAllEffects(){this.layerSystem&&(this.layerSystem.dispose(),this.layerSystem=void 0);for(const e of this.effects.values())e.effect.dispose&&e.effect.dispose();this.effects.clear(),this.nextId=1}getStats(){const e=Array.from(this.effects.values());return{registeredTypes:this.creators.size,activeEffects:e.length,enabledEffects:e.filter(t=>t.enabled).length}}getAvailableEffectTypes(){return Array.from(this.creators.keys())}}const vt=C.getInstance();export{vt as e};
