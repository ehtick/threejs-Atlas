import{S as M}from"./atlas_CMUvaCD4mo7XQYkYXSJfw.js";import{C as c,G as g,V as f,Q as T,l as L,T as O,t as S,D as x,M as d,i as N}from"./atlas_Ce3hh0hgxYWauQ_qSK6cl.js";const i={RIVER_COUNT:{min:20,max:30},OPACITY:{min:.01,max:.04},ELEVATION:{min:-.015,max:-.01},THICKNESS:{min:4,max:12},SEGMENTS:{min:40,max:80},CURVE_AMOUNT:{min:.05,max:.25},STEP_SIZE:{min:.02,max:.08}};class G{riverGroup;riverLines=[];params;rng;constructor(e,r={}){const t=r.seed||Math.floor(Math.random()*1e6);this.rng=new M(t),this.params={riverCount:r.riverCount||this.rng.randint(i.RIVER_COUNT.min,i.RIVER_COUNT.max),color:r.color||null,opacity:r.opacity||this.rng.uniform(i.OPACITY.min,i.OPACITY.max),elevation:r.elevation||this.rng.uniform(i.ELEVATION.min,i.ELEVATION.max),seed:t},this.riverGroup=new g,this.generateBasicRivers(e)}generateBasicRivers(e){const r=e+e*this.params.elevation;for(let t=0;t<this.params.riverCount;t++){const o=this.createSingleRiver(r,t);o&&(this.riverLines.push(o),this.riverGroup.add(o))}}createSingleRiver(e,r){const t=this.rng.uniform(-.6,.6),o=this.rng.uniform(0,Math.PI*2);let n=new f(Math.cos(o)*Math.cos(t)*e,Math.sin(t)*e,Math.sin(o)*Math.cos(t)*e);const a=[n.clone()];let s=this.getRandomTangentDirection(n,e);const l=this.rng.randint(i.SEGMENTS.min,i.SEGMENTS.max);for(let u=1;u<l;u++){const m=u/l,h=this.rng.uniform(i.CURVE_AMOUNT.min,i.CURVE_AMOUNT.max),v=this.rng.uniform(0,1);let p=0;v<.3?p=Math.sin(m*Math.PI*4)*h*.7:v<.6?p=Math.sin(m*Math.PI)*h:v<.8?p=(this.rng.uniform(-1,1)+Math.sin(m*Math.PI*3)*.5)*h:p=(m*8%2>1?1:-1)*h*(1-Math.abs(.5-m)*2);const C=this.rng.uniform(-.05,.05),R=(p+C)*.3,I=n.clone().normalize(),y=new T().setFromAxisAngle(I,R);s.applyQuaternion(y).normalize();const A=e*this.rng.uniform(i.STEP_SIZE.min,i.STEP_SIZE.max);n=n.clone().add(s.clone().multiplyScalar(A)),n.normalize().multiplyScalar(e),s=this.keepDirectionTangent(s,n,e),a.push(n.clone())}return this.createLineFromPoints(a,r)}getRandomTangentDirection(e,r){const t=e.clone().normalize(),o=Math.abs(t.y)<.9?new f(0,1,0):new f(1,0,0),n=new f().crossVectors(t,o).normalize(),a=this.rng.uniform(0,Math.PI*2),s=new T().setFromAxisAngle(t,a);return n.applyQuaternion(s)}keepDirectionTangent(e,r,t){const o=r.clone().normalize(),n=e.dot(o);return e.clone().sub(o.clone().multiplyScalar(n)).normalize()}createLineFromPoints(e,r){if(e.length<2)return null;const t=new g;let o;this.params.color?o=this.params.color instanceof c?this.params.color.clone():new c().setRGB(this.params.color[0],this.params.color[1],this.params.color[2]):o=new c(.3,.25,.2);const n=r*.05;o.multiplyScalar(1-n*.2);const s=this.rng.uniform(i.THICKNESS.min,i.THICKNESS.max)*.005,l=new L(e),u=new O(l,e.length-1,s,8,!1),m=new S({color:o,opacity:this.params.opacity,transparent:!0,depthWrite:!1,depthTest:!0,side:x}),h=new d(u,m);return h.renderOrder=1e3,t.add(h),t}addToScene(e,r){r&&this.riverGroup.position.copy(r),e.add(this.riverGroup)}update(e){}updateParams(e){this.params={...this.params,...e},(e.color||e.opacity)&&this.riverLines.forEach(r=>{r.children.forEach(t=>{if(t instanceof d&&t.material instanceof S){if(e.color){const o=e.color instanceof c?e.color:new c().setRGB(e.color[0],e.color[1],e.color[2]);t.material.color=o}e.opacity!==void 0&&(t.material.opacity=e.opacity,t.material.transparent=e.opacity<1)}})})}getObject3D(){return this.riverGroup}dispose(){this.riverLines.forEach(e=>{e.children.forEach(r=>{r instanceof d&&(r.geometry.dispose(),r.material instanceof N&&r.material.dispose())})}),this.riverLines=[],this.riverGroup.clear()}}function _(E,e,r){console.log("Creating ULTRA SIMPLE dried river lines for arid planet");const o=(r||Math.floor(Math.random()*1e6))+8e3,n=e.river_data||e.dried_rivers||{},a=new M(o);let s=null;n.color?s=n.color instanceof c?n.color:new c().fromArray(n.color):s=new c(0,0,0);const l={riverCount:n.count||a.randint(i.RIVER_COUNT.min,i.RIVER_COUNT.max),color:s,opacity:n.opacity||a.uniform(i.OPACITY.min,i.OPACITY.max),elevation:n.elevation||a.uniform(i.ELEVATION.min,i.ELEVATION.max),seed:o};return console.log(`Creating ${l.riverCount} ULTRA SIMPLE dried river lines (seed: ${o})`),new G(E,l)}export{G as R,_ as c};
